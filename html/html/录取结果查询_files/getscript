window.TILE_VERSION={"ditu":{"normal":{"version":"088","updateDate":"20240820"},"satellite":{"version":"009","updateDate":"20240820"},"normalTraffic":{"version":"081","updateDate":"20240820"},"satelliteTraffic":{"version":"083","updateDate":"20240820"},"mapJS":{"version":"104","updateDate":"20240820"},"satelliteStreet":{"version":"083","updateDate":"20240820"},"earthVector":{"version":"001","updateDate":"20240820"}},"webapp":{"high_normal":{"version":"001","updateDate":"20240820"},"lower_normal":{"version":"002","updateDate":"20240820"}},"api_for_mobile":{"vector":{"version":"002","updateDate":"20240820"},"vectorIcon":{"version":"002","updateDate":"20240820"}}};window.MSV={"mapstyle":{"version":"001","updateDate":"20240717"}};window.BMAP_AUTHENTIC_KEY="rTXkIfbjSMuTlGvWtHDTDXKBdb6QYute";
(function(t){"use strict";function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t,e){return t(e={exports:{}},e.exports),e.exports}Object.values||(Object.values=function(t){if(t!==Object(t))throw new TypeError("Object.values called on a non-object");var e,n=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.push(t[e]);return n}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=0;n<(arguments.length<=1?0:arguments.length-1);n++){var r=n+1<1||arguments.length<=n+1?void 0:arguments[n+1];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},writable:!0,configurable:!0});var r=n((function(t){function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports})),i=e(r),o=e(n((function(t){function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports}))),a=e(n((function(t){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports}))),s=n((function(t){function e(n,r){return t.exports=e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},t.exports.__esModule=!0,t.exports.default=t.exports,e(n,r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}));e(s);var u,h,c=e(n((function(t){t.exports=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,s(t,e)},t.exports.__esModule=!0,t.exports.default=t.exports}))),l=function(t,e){var n=this;this.width=void 0,this.height=void 0,this.equals=function(t){return t&&n.width===t.width&&n.height===t.height},this.width=t||0,this.height=e||0},f=function(){function t(t,e){this.lng=void 0,this.lat=void 0,this.lng=+t,this.lat=+e}return t.prototype.equals=function(t){return t&&this.lat===t.lat&&this.lng===t.lng},t}(),d={REFRESH:"refresh",DATA_LOADED:"dataload",THUMB_LOADED:"thumb_loaded",SET_POV:"set_pov",POV_CHANGED:"pov_changed",POV_CHANGED_END:"pov_changed_end",ZOOM_CHANGED:"zoom_changed",SIZE_CHANGED:"size_changed",SET_ID:"set_id",SET_POSITION:"set_position",ID_CHANGED:"id_changed",POSITION_CHANGED:"position_changed",TOUCH_START:"touchstart",TOUCH_END:"touchend",CLICK:"click",DOUBLE_CLICK:"dblclick",LINK_CLICK:"link_click",OVERLAY_ADD:"overlay_add",OVERLAY_REMOVE:"overlay_remove",OVERLAYS_CLEAR:"overlays_clear",PANO_ERROR:"pano_error",LINK_VISIBLE_CHANGE:"links_visible_changed",DESTROY:"destroy",SCENE_CHANGE_END:"scene_change_end"},p={TYPE_INNER:"inter",TYPE_STREET:"street",RADIUS:3e3,COLS:16,ROWS:8,TILE_MAX_ZOOM:4,TILE_MIN_ZOOM:1,MIN_PITCH:-90,MAX_PITCH:90,MAX_ZOOM:4,MIN_ZOOM:1,TILE_BASE_URLS:["//apisv0.bdimg.com/","//apisv1.bdimg.com/"],TOPO_ARROW_TEXTURE:"//webmap0.bdimg.com/wolfman/static/pano/images/webgl/topo_arrow_06f0f2e.png",FISHEYE_DURATION:1500,FISHEYE_DELAY:2e3},v=(u={},h=(navigator.userAgent||"").toLowerCase(),u.isAndroid=h.includes("android"),u.isFirefox=h.includes("firefox"),u.isIos=/ip(hone|ad|od)/i.test(h),u.isWeixin=h.includes("micromessenger"),u.isWeibo=h.includes("weibo"),u.isWeChatOrWeiBo=u.isWeixin&&u.isWeibo,u.isBaiduMap=h.includes("baidumap_"),u.isMobile=/android|webos|ip(hone|ad|od)|opera (mini|mobi|tablet)|iemobile|windows.+(phone|touch)|mobile|fennec|kindle (Fire)|Silk|maemo|blackberry|playbook; (touch|kbd)|Symbian(OS)|Ubuntu Touch/i.test(h),u.isPc=!u.isMobile,u),m=function(t){for(var e=arguments.length<=1?0:arguments.length-1,n=0;n<e;n++){var r=n+1<1||arguments.length<=n+1?void 0:arguments[n+1];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},g=function(t){return t*Math.PI/180},y=function(t){return 180*t/Math.PI},_=function(t){return t-360*Math.floor(t/360)},x=function(){return Date.now()};var b=function t(){var e=t;if("boolean"==typeof e._supportWebGL)return e._supportWebGL;if(!window.WebGLRenderingContext)return e._supportWebGL=!1,!1;var n=null,r=document.createElement("canvas");try{(n=r.getContext("webgl")||r.getContext("experimental-webgl"))&&n instanceof WebGLRenderingContext&&(e._supportWebGL=!0)}catch(t){e._supportWebGL=!1}return null===n&&(e._supportWebGL=!1),e._supportWebGL},M=function(t){for(var e,n=Number.MAX_VALUE,r=-Number.MAX_VALUE,i=t.length-1;i>=0;i--)n>(e=t[i])&&(n=e),r<e&&(r=e);return{min:n,max:r}},w={g:function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1===t.nodeType||9===t.nodeType)?t:null},show:function(t){var e=w.g(t);return e&&(e.style.display=""),e},hide:function(t){var e=w.g(t);return e&&(e.style.display="none"),t},create:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=document.createElement(t);for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.setAttribute(r,e[r]);return n},getCurrentStyle:function(t){return window.getComputedStyle(t,null)}};function E(){var t,e,n=function(t,e){var n,r,i="eii",o="dac",a="hem",s="llm",u=function(t,e){return t+e},h="constructor",c=function(t,e){return t(e)},l=function(t,e){return t+e};function f(t,e){for(var n=i;"mill"!==n;)switch(n){case"llm":return c;case"eii":var r=t.length;n=o;break;case a:for(var u=0;u<r;u++){var h=e(t[u]);c.push(h)}n=s;break;case"dac":var c=[];n=a}}var d=decodeURIComponent;b="de",r=l("fr","o")+"m",n=l("Co",b);var p=function(t){return u(t,"")[h][u(r,"Char")+n](t)},v=function(t){return f(t,(function(t){return c(p,t)}))},m=v.call(p,[39,34,37,96,60,120,97,65,98,66,99,67,100,68,101,69,102,70,103,110,109,111,112,48,49,50,51,52,53,54,55,56,57]),g=f([28782,27702,26416,25167,24183],(function(t){return c(d,t)})),y=v.call(g,[22354,22749,24415,23346,22257,22688,24306,25174,23595,25547,22984,25690,22212,27547,21594,27210,23090,29193,22394,29368,29532,29459,29530,24146,24500,26352,27441,28788,29370,27673,26925,25249,24430]),_={};g=c(v,g);for(var x=new RegExp(g.join("|")),b=0;b<m.length;b++)_[y[b]]=m[b];return e=f(e.split(""),(function(t){return _[t]||t})).join(""),f(e.split(x),(function(t){return d(t)}))}(0,"su尫stri犸坺幷囄獜呚囄獜扏su尫str氶h廲廲呚l灮i犸囄呚墠O娲氶呚呚廲廲廲朰墠h姈i囄朰彟曰氙si坺犸彟欱殛");t=n,e=265,function(e){for(;--e;)t.push(t.shift())}(++e);var r=function(t,e){return n[t-=0]};return function(t){var e={dmedm:"F5L2O6R6AD8990O",haael:function(t,e){return t+e},eeaaa:function(t,e){return t(e)},xhcid:function(t,e){return t+e},deiic:function(t,e){return t-e}},n=e[r("0x0")],i=t[r("0x1")](e[r("0x2")](t[r("0x3")]("?"),1)),o=e[r("0x4")](md5,e[r("0x5")](md5(i+n),"H0A9P8P7Y6ABQO0"));return r("0x6")+o[r("0x7")](e.deiic(o.length,12))}}var T=function(t,e,n){var r,o,a="",s=[],u="jsonp"+Math.ceil(1e5*Math.random()),h=t.indexOf("?")>0?"&":"?";for(var c in n=Object.assign({},{jsonpCallback:"jsonp",timeout:5e4,jsonp:"callback"},n),e)({}).hasOwnProperty.call(e,c)&&(a="object"===i(e[c])?c+"="+JSON.stringify(e[c]):c+"="+e[c],s.push(a));function l(){r.parentNode&&r.parentNode.removeChild(r),window[u]=null}return t+=h+s.join("&"),o=document.getElementsByTagName("script")[0]||document.head,t=t+"&"+n.jsonp+"="+u,t+=E()(t),(r=document.createElement("script")).src=t,r.type="text/javascript",o.parentNode.appendChild(r,o),new Promise((function(t,e){window[u]=function(e){if(e&&"string"==typeof e)try{e=JSON.parse(e)}catch(t){e={},console.error("[ERROR] Parse Error.")}t(e),l()},r.onerror=function(t){l(),e({errno:-2,errmsg:"[ERROR] Load Error: ".concat(t),data:{}})}}))},A=function(){function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._size=0,this._cache=void 0,this.keyList=[],this._options=void 0,this._size=t,this._cache=new window.Map;var n={clearCallback:null};this._options=Object.assign({},n,e)}var e=t.prototype;return e.setData=function(t,e){0!==this._size&&(this._cache.size>=this._size&&this._removeOld(),this._cache.has(t)||this.keyList.push(t),this._cache.set(t,e))},e.getData=function(t){return this._cache.get(t)},e._removeOld=function(){for(var t=Math.round(.6*this._size),e=0;e<t;e++){var n=this.keyList[e];this._options.clearCallback&&this._options.clearCallback(this.getData(n)),this._cache.delete(n)}this.keyList.splice(0,t)},e.clear=function(){this._cache.clear(),this.keyList=[]},o(t,[{key:"cacheCount",get:function(){return this._cache.size}}]),t}(),C=function(){function t(){var t=this;this.rid="",this.roadName="",this.roadWidth=5,this.isCurrentRoad=0,this.pointList=[],this.getTopoInRoad=function(e){var n=[],r=t.pointList,i=r.length,o=t.getPointByPanoId(e);if(!o||i<=1)return n;var a=o.order;return 0===a?n.push(t.generateTopoData(o.dir,r[1])):a===i-1?n.push(t.generateTopoData(r[a-1].dir+180,r[a-1])):(n.push(t.generateTopoData((r[a-1].dir+180)%360,r[a-1])),n.push(t.generateTopoData(r[a].dir,r[a+1]))),n},this.getPointByPanoId=function(e){for(var n,r=t.pointList,i=0,o=r.length;i<o;i++)if(r[i].panoId===e){n=r[i];break}return n}}return t.prototype.generateTopoData=function(t,e){return void 0!==e&&(e.topoDir=t,e.roadName=this.roadName),e},t}(),R=function(){var t=this;this.image=void 0,this.panoId="",this.iid="",this.panoType="",this.panoX=0,this.panoY=0,this.panoZ=0,this.heading=0,this.pitch=0,this.defaultHeading=void 0,this.defaultPitch=void 0,this.northDir=0,this.fixHeading=0,this.fixPitch=0,this.fixRoll=0,this.deviceHeight=0,this.date="20130822",this.time="",this.provider=1,this.admission="GS(2013)6021",this.photos=[],this.roadName="",this.roads=[],this.vpoints=[],this.topoArray=void 0,this.currentRoad=void 0,this.roadWidth=void 0,this.getCurrentRoad=function(){if(t.currentRoad)return t.currentRoad;for(var e=t.roads,n=0,r=e.length;n<r;n++)if(e[n].isCurrentRoad){t.currentRoad=e[n];break}return t.currentRoad},this.getTopos=function(){if(t.topoArray)return t.topoArray;if(t.currentRoad||(t.currentRoad=t.getCurrentRoad()),!t.currentRoad)return[];if(t.topoArray=t.currentRoad.getTopoInRoad(t.panoId),t.vpoints.length<1)return t.topoArray;for(var e,n=t.vpoints.length-1;n>=0;n--)(e=t.vpoints[n]).topoDir=e.dir,t.topoArray.push(e);return t.topoArray},this.getRoadWidth=function(){return void 0===t.roadWidth&&(t.currentRoad||(t.currentRoad=t.getCurrentRoad()),t.currentRoad?t.roadWidth=t.currentRoad.roadWidth:t.roadWidth=0),t.roadWidth}};function S(t){var e={};return e.panoId=t.PID,e.panoType=t.Type,e.rid=t.RID,e.dir=t.DIR,e.roadName=t.RoadName,e.order=t.Order,e.panoX=t.X/100,e.panoY=t.Y/100,void 0!==t.CPointX&&void 0!==t.CPointY&&(e.cPoint={x:t.CPointX/100,y:t.CPointY/100}),e}function P(t){if(!t)return console.error("Get none from server"),null;var e=t.result;if(e&&0!==e.error)return console.error("Get error from server"),null;var n=t.content;if(void 0===n||0===n.length||void 0===n[0])return console.error("Get empty data from server"),null;var r=n[0],i=new R,o=r.Roll,a={};if(i.panoId=r.ID,r.Inters instanceof Array){var s=r.Inters[0];void 0!==s&&(i.iid=s.IID)}if(i.panoType=r.Type,i.panoX=(r.X||0)/100,i.panoY=(r.Y||0)/100,i.panoZ=(r.Z||0)/100,i.heading=void 0!==r.MoveDir?r.MoveDir:0,i.northDir=r.NorthDir,i.fixHeading=void 0!==r.Heading?r.Heading:270-r.NorthDir,i.fixPitch=r.Pitch,i.fixRoll=90<o||-90>o?0:o,i.deviceHeight=r.DeviceHeight,i.date=r.Date||i.date,i.time=r.Time,i.provider=void 0!==r.Provider?r.Provider:i.provider,i.admission=r.Admission||i.admission,i.timeLine=r.TimeLine||[],i.roadName=r.Rname,r.Roads){var u=r.Roads;i.roads=u.map((function(t){return a[t.ID]=t.Name,function(t){var e=new C;if(e.rid=t.ID,e.roadName=t.Name,e.roadWidth=void 0!==t.Width?t.Width/100:0,e.isCurrentRoad=t.IsCurrent||0,t.Panos)for(var n=t.Panos,r=0,i=n.length;r<i;r++)e.pointList.push(S(n[r]));return e}(t)}))}if(r.Links)for(var h=r.Links,c=h.length,l=0;l<c;l++){var f=h[l];f.RoadName=a[f.RID],i.vpoints.push(S(f))}return i.photos=r.Photos||[],i}function D(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function O(t,e,n,r,i,o){return D((a=D(D(e,t),D(r,o)))<<(s=i)|a>>>32-s,n);var a,s}function I(t,e,n,r,i,o,a){return O(e&n|~e&r,t,e,i,o,a)}function L(t,e,n,r,i,o,a){return O(e&r|n&~r,t,e,i,o,a)}function B(t,e,n,r,i,o,a){return O(e^n^r,t,e,i,o,a)}function k(t,e,n,r,i,o,a){return O(n^(e|~r),t,e,i,o,a)}function U(t,e){var n,r,i,o,a;t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;var s=1732584193,u=-271733879,h=-1732584194,c=271733878;for(n=0;n<t.length;n+=16)r=s,i=u,o=h,a=c,s=I(s,u,h,c,t[n],7,-680876936),c=I(c,s,u,h,t[n+1],12,-389564586),h=I(h,c,s,u,t[n+2],17,606105819),u=I(u,h,c,s,t[n+3],22,-1044525330),s=I(s,u,h,c,t[n+4],7,-176418897),c=I(c,s,u,h,t[n+5],12,1200080426),h=I(h,c,s,u,t[n+6],17,-1473231341),u=I(u,h,c,s,t[n+7],22,-45705983),s=I(s,u,h,c,t[n+8],7,1770035416),c=I(c,s,u,h,t[n+9],12,-1958414417),h=I(h,c,s,u,t[n+10],17,-42063),u=I(u,h,c,s,t[n+11],22,-1990404162),s=I(s,u,h,c,t[n+12],7,1804603682),c=I(c,s,u,h,t[n+13],12,-40341101),h=I(h,c,s,u,t[n+14],17,-1502002290),s=L(s,u=I(u,h,c,s,t[n+15],22,1236535329),h,c,t[n+1],5,-165796510),c=L(c,s,u,h,t[n+6],9,-1069501632),h=L(h,c,s,u,t[n+11],14,643717713),u=L(u,h,c,s,t[n],20,-373897302),s=L(s,u,h,c,t[n+5],5,-701558691),c=L(c,s,u,h,t[n+10],9,38016083),h=L(h,c,s,u,t[n+15],14,-660478335),u=L(u,h,c,s,t[n+4],20,-405537848),s=L(s,u,h,c,t[n+9],5,568446438),c=L(c,s,u,h,t[n+14],9,-1019803690),h=L(h,c,s,u,t[n+3],14,-187363961),u=L(u,h,c,s,t[n+8],20,1163531501),s=L(s,u,h,c,t[n+13],5,-1444681467),c=L(c,s,u,h,t[n+2],9,-51403784),h=L(h,c,s,u,t[n+7],14,1735328473),s=B(s,u=L(u,h,c,s,t[n+12],20,-1926607734),h,c,t[n+5],4,-378558),c=B(c,s,u,h,t[n+8],11,-2022574463),h=B(h,c,s,u,t[n+11],16,1839030562),u=B(u,h,c,s,t[n+14],23,-35309556),s=B(s,u,h,c,t[n+1],4,-1530992060),c=B(c,s,u,h,t[n+4],11,1272893353),h=B(h,c,s,u,t[n+7],16,-155497632),u=B(u,h,c,s,t[n+10],23,-1094730640),s=B(s,u,h,c,t[n+13],4,681279174),c=B(c,s,u,h,t[n],11,-358537222),h=B(h,c,s,u,t[n+3],16,-722521979),u=B(u,h,c,s,t[n+6],23,76029189),s=B(s,u,h,c,t[n+9],4,-640364487),c=B(c,s,u,h,t[n+12],11,-421815835),h=B(h,c,s,u,t[n+15],16,530742520),s=k(s,u=B(u,h,c,s,t[n+2],23,-995338651),h,c,t[n],6,-198630844),c=k(c,s,u,h,t[n+7],10,1126891415),h=k(h,c,s,u,t[n+14],15,-1416354905),u=k(u,h,c,s,t[n+5],21,-57434055),s=k(s,u,h,c,t[n+12],6,1700485571),c=k(c,s,u,h,t[n+3],10,-1894986606),h=k(h,c,s,u,t[n+10],15,-1051523),u=k(u,h,c,s,t[n+1],21,-2054922799),s=k(s,u,h,c,t[n+8],6,1873313359),c=k(c,s,u,h,t[n+15],10,-30611744),h=k(h,c,s,u,t[n+6],15,-1560198380),u=k(u,h,c,s,t[n+13],21,1309151649),s=k(s,u,h,c,t[n+4],6,-145523070),c=k(c,s,u,h,t[n+11],10,-1120210379),h=k(h,c,s,u,t[n+2],15,718787259),u=k(u,h,c,s,t[n+9],21,-343485551),s=D(s,r),u=D(u,i),h=D(h,o),c=D(c,a);return[s,u,h,c]}function N(t){var e,n="",r=32*t.length;for(e=0;e<r;e+=8)n+=String.fromCharCode(t[e>>5]>>>e%32&255);return n}function F(t){var e,n=[];for(n[(t.length>>2)-1]=void 0,e=0;e<n.length;e+=1)n[e]=0;var r=8*t.length;for(e=0;e<r;e+=8)n[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return n}function j(t){var e,n,r="0123456789abcdef",i="";for(n=0;n<t.length;n+=1)e=t.charCodeAt(n),i+=r.charAt(e>>>4&15)+r.charAt(15&e);return i}function z(t){return unescape(encodeURIComponent(t))}function V(t){return function(t){return N(U(F(t),8*t.length))}(z(t))}function G(t,e){return function(t,e){var n,r,i=F(t),o=[],a=[];for(o[15]=a[15]=void 0,i.length>16&&(i=U(i,8*t.length)),n=0;n<16;n+=1)o[n]=909522486^i[n],a[n]=1549556828^i[n];return r=U(o.concat(F(e)),512+8*e.length),N(U(a.concat(r),640))}(z(t),z(e))}var W,H,Z,q,Y=function(t,e,n){return e?n?G(e,t):j(G(e,t)):n?V(t):j(V(t))},X=function(t,e){return T(t,{},{jsonp:"fn"})},K=function(t,e){if("PANORAMA"===t){var n=window._BMapSecurityConfig&&window._BMapSecurityConfig.serviceHost?window._BMapSecurityConfig.serviceHost+"?qt=pano_entry&v=gl":"https://api.map.baidu.com/?qt=pano_entry&v=gl&ak="+window.BMAP_AUTHENTIC_KEY;"function"==typeof e?X(n).then((function(t){e()})).catch((function(t){})):X(n+"&callback="+e)}},Q=function(t){if("PANORAMA"===t)alert("您需要申请全景地图服务使用权限")},J=(H=null,Z=0,q=W||5e3,function(t){var e=(1e5*Math.random()).toFixed(0);window["cbk"+e]=function(t){t&&void 0!==t.error&&0===t.error||K("PANORAMA",(function(t){t&&void 0!==t.error&&0===t.error||Q("PANORAMA")}))},Z+=t,H||(H=setTimeout((function(){var t=window._BMapSecurityConfig&&window._BMapSecurityConfig.serviceHost?window._BMapSecurityConfig.serviceHost+"?qt=pano_count&v=gl&consume="+Z:"https://api.map.baidu.com/?qt=pano_count&v=gl&ak="+window.BMAP_AUTHENTIC_KEY+"&consume="+Z;X(t+"&callback=window.cbk"+e),Z=0,H=null}),q))}),$=function(t,e){var n=(e=e||{}).counter?e.counter:1,r=!1!==e.isCounter,i=Date.parse(new Date),o=i/1e3,a=t+"-"+(o+1800)+"-"+i+"-"+window.BMAP_AUTHENTIC_KEY+"-SJvEY5h37ZDh5pHS",s=Y(a),u="auth_key="+(o+1800)+"-"+i+"-"+window.BMAP_AUTHENTIC_KEY+"-"+s;return r&&J(n),u},tt=function(){function t(e){var n=this;this.getPanoById=function(e){var r;r="".concat(t.SERVICE_URL,"?qt=sdata&sid=").concat(e,"&").concat($("/")),n.getDataByUrl(r).then((function(t){var e=P(t);if(null===e)throw new Error("数据解析异常");return n._cache.setData(r,t),n._pano.dispatchEvent(d.DATA_LOADED,{data:e}),n._pano.dispatchEvent(d.ID_CHANGED,e.panoId),n._pano.dispatchEvent(d.POSITION_CHANGED,new f(e.panoX,e.panoY)),e})).catch((function(t){n._pano.dispatchEvent({type:d.PANO_ERROR,data:t})}))},this.getPanoByLocation=function(e,r){var i;i="".concat(t.SERVICE_URL,"?qt=qsdata&x=").concat(e.lng,"&y=").concat(e.lat).concat(r?"&r="+r:"","&action=1&").concat($("/")),n.getDataByUrl(i).then((function(t){var r=P(t);n._cache.setData(i,t),n._pano.dispatchEvent(d.DATA_LOADED,{data:r}),n._pano.dispatchEvent(d.POSITION_CHANGED,e)})).catch((function(t){n._pano.dispatchEvent({type:d.PANO_ERROR,data:t})}))},this._pano=e,this._cache=new A(10)}return t.prototype.getDataByUrl=function(t){var e=this._cache.getData(t);return e?Promise.resolve(e):T(t,{},{jsonp:"fn"})},t}();tt.SERVICE_URL="//apisv0.bdimg.com/";var et=n((function(t){function e(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}t.exports=function(t){return function(){var n=this,r=arguments;return new Promise((function(i,o){var a=t.apply(n,r);function s(t){e(a,i,o,s,u,"next",t)}function u(t){e(a,i,o,s,u,"throw",t)}s(void 0)}))}},t.exports.__esModule=!0,t.exports.default=t.exports})),nt=e(et),rt=n((function(t){var e=r.default;function n(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
t.exports=n=function(){return r},t.exports.__esModule=!0,t.exports.default=t.exports;var r={},i=Object.prototype,o=i.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",u=a.asyncIterator||"@@asyncIterator",h=a.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var i=e&&e.prototype instanceof p?e:p,o=Object.create(i.prototype),a=new A(r||[]);return o._invoke=function(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return R()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=w(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=f(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(t,n,a),o}function f(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}r.wrap=l;var d={};function p(){}function v(){}function m(){}var g={};c(g,s,(function(){return this}));var y=Object.getPrototypeOf,_=y&&y(y(C([])));_&&_!==i&&o.call(_,s)&&(g=_);var x=m.prototype=p.prototype=Object.create(g);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,n){function r(i,a,s,u){var h=f(t[i],t,a);if("throw"!==h.type){var c=h.arg,l=c.value;return l&&"object"==e(l)&&o.call(l,"__await")?n.resolve(l.__await).then((function(t){r("next",t,s,u)}),(function(t){r("throw",t,s,u)})):n.resolve(l).then((function(t){c.value=t,s(c)}),(function(t){return r("throw",t,s,u)}))}u(h.arg)}var i;this._invoke=function(t,e){function o(){return new n((function(n,i){r(t,e,n,i)}))}return i=i?i.then(o,o):o()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return d;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=f(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,d;var i=r.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function C(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(o.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:R}}function R(){return{value:void 0,done:!0}}return v.prototype=m,c(x,"constructor",m),c(m,"constructor",v),v.displayName=c(m,h,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,c(t,h,"GeneratorFunction")),t.prototype=Object.create(x),t},r.awrap=function(t){return{__await:t}},b(M.prototype),c(M.prototype,u,(function(){return this})),r.AsyncIterator=M,r.async=function(t,e,n,i,o){void 0===o&&(o=Promise);var a=new M(l(t,e,n,i),o);return r.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},b(x),c(x,h,"Generator"),c(x,s,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},r.values=C,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),T(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:C(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},r}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports}));e(rt);var it=rt(),ot=it;try{regeneratorRuntime=it}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=it:Function("r","regeneratorRuntime = r")(it)}function at(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const st={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function ut(t,{precision:e=st.precision}={}){return t=function(t){return Math.round(t/st.EPSILON)*st.EPSILON}(t),"".concat(parseFloat(t.toPrecision(e)))}function ht(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ct(t,e,n){const r=st.EPSILON;n&&(st.EPSILON=n);try{if(t===e)return!0;if(ht(t)&&ht(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!ct(t[n],e[n]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):"number"==typeof t&&"number"==typeof e&&Math.abs(t-e)<=st.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{st.EPSILON=r}}class lt extends(function(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}(Array)){clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+e];return this.check()}toArray(t=[],e=0){for(let n=0;n<this.ELEMENTS;++n)t[e+n]=this[n];return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:ht(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(st)}formatString(t){let e="";for(let n=0;n<this.ELEMENTS;++n)e+=(n>0?", ":"")+ut(this[n],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!ct(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,n){if(void 0===n)return this.lerp(this,t,e);for(let r=0;r<this.ELEMENTS;++r){const i=t[r];this[r]=i+n*(e[r]-i)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),e[n]);return this.check()}add(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]+=e[t];return this.check()}subtract(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]-=e[t];return this.check()}scale(t){if("number"==typeof t)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(st.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),e);return this.check()}get elements(){return this}}function ft(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function dt(t,e,n=""){if(st.debug&&!function(t,e){if(t.length!==e)return!1;for(let e=0;e<t.length;++e)if(!Number.isFinite(t[e]))return!1;return!0}(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class pt extends lt{get x(){return this[0]}set x(t){this[0]=ft(t)}get y(){return this[1]}set y(t){this[1]=ft(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let n=0;n<this.ELEMENTS;++n){const r=this[n]-t[n];e+=r*r}return ft(e)}dot(t){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*t[n];return ft(e)}normalize(){const t=this.magnitude();if(0!==t)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e[t];return this.check()}divide(...t){for(const e of t)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e[t];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return at(t>=0&&t<this.ELEMENTS,"index is out of range"),ft(this[t])}setComponent(t,e){return at(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}var vt=1e-6,mt="undefined"!=typeof Float32Array?Float32Array:Array,gt=Math.random;function yt(){var t=new mt(2);return mt!=Float32Array&&(t[0]=0,t[1]=0),t}function _t(t,e){var n=new mt(2);return n[0]=t,n[1]=e,n}function xt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function bt(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function Mt(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function wt(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.hypot(n,r)}function Et(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*n+r*r}function Tt(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function At(t){var e=t[0],n=t[1];return e*e+n*n}function Ct(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Rt,St=Tt,Pt=xt,Dt=bt,Ot=Mt,It=wt,Lt=Et,Bt=At,kt=(Rt=yt(),function(t,e,n,r,i,o){var a,s;for(e||(e=2),n||(n=0),s=r?Math.min(r*e+n,t.length):t.length,a=n;a<s;a+=e)Rt[0]=t[a],Rt[1]=t[a+1],i(Rt,Rt,o),t[a]=Rt[0],t[a+1]=Rt[1];return t}),Ut=Object.freeze({__proto__:null,create:yt,clone:function(t){var e=new mt(2);return e[0]=t[0],e[1]=t[1],e},fromValues:_t,copy:function(t,e){return t[0]=e[0],t[1]=e[1],t},set:function(t,e,n){return t[0]=e,t[1]=n,t},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},subtract:xt,multiply:bt,divide:Mt,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},min:function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},max:function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},scale:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},scaleAndAdd:function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t},distance:wt,squaredDistance:Et,length:Tt,squaredLength:At,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},normalize:function(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},cross:function(t,e,n){var r=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=r,t},lerp:function(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t},random:function(t,e){e=e||1;var n=2*gt()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},transformMat2:function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t},transformMat2d:function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t},transformMat3:function(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t},transformMat4:Ct,rotate:function(t,e,n,r){var i=e[0]-n[0],o=e[1]-n[1],a=Math.sin(r),s=Math.cos(r);return t[0]=i*s-o*a+n[0],t[1]=i*a+o*s+n[1],t},angle:function(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+o*o),s=a&&(n*i+r*o)/a;return Math.acos(Math.min(Math.max(s,-1),1))},zero:function(t){return t[0]=0,t[1]=0,t},str:function(t){return"vec2("+t[0]+", "+t[1]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]},equals:function(t,e){var n=t[0],r=t[1],i=e[0],o=e[1];return Math.abs(n-i)<=vt*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=vt*Math.max(1,Math.abs(r),Math.abs(o))},len:St,sub:Pt,mul:Dt,div:Ot,dist:It,sqrDist:Lt,sqrLen:Bt,forEach:kt});function Nt(t,e,n){const r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o||1;return t[0]=(n[0]*r+n[4]*i+n[8]*o)/a,t[1]=(n[1]*r+n[5]*i+n[9]*o)/a,t[2]=(n[2]*r+n[6]*i+n[10]*o)/a,t}function Ft(){var t=new mt(3);return mt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function jt(t){var e=new mt(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function zt(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function Vt(t,e,n){var r=new mt(3);return r[0]=t,r[1]=e,r[2]=n,r}function Gt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Wt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Ht(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Zt(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function qt(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Yt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Xt(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function Kt(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function Qt(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function Jt(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function $t(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function te(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function ee(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}function ne(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function re(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],h=e[2],c=i*h-o*u,l=o*s-r*h,f=r*u-i*s,d=i*f-o*l,p=o*c-r*f,v=r*l-i*c,m=2*a;return c*=m,l*=m,f*=m,d*=2,p*=2,v*=2,t[0]=s+c+d,t[1]=u+l+p,t[2]=h+f+v,t}function ie(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function oe(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function ae(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function se(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),h=u&&$t(t,e)/u;return Math.acos(Math.min(Math.max(h,-1),1))}function ue(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2];return Math.abs(n-o)<=vt*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=vt*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=vt*Math.max(1,Math.abs(i),Math.abs(s))}var he=Ht,ce=Zt,le=qt,fe=Xt,de=Kt,pe=zt,ve=Qt,me=function(){var t=Ft();return function(e,n,r,i,o,a){var s,u;for(n||(n=3),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),ge=Object.freeze({__proto__:null,create:Ft,clone:jt,length:zt,fromValues:Vt,copy:Gt,set:function(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t},add:Wt,subtract:Ht,multiply:Zt,divide:qt,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},min:function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},max:function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},scale:Yt,scaleAndAdd:function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t},distance:Xt,squaredDistance:Kt,squaredLength:Qt,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},normalize:Jt,dot:$t,cross:te,lerp:function(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t},hermite:function(t,e,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,h=a*(o-1),c=a*(3-2*o);return t[0]=e[0]*s+n[0]*u+r[0]*h+i[0]*c,t[1]=e[1]*s+n[1]*u+r[1]*h+i[1]*c,t[2]=e[2]*s+n[2]*u+r[2]*h+i[2]*c,t},bezier:function(t,e,n,r,i,o){var a=1-o,s=a*a,u=o*o,h=s*a,c=3*o*s,l=3*u*a,f=u*o;return t[0]=e[0]*h+n[0]*c+r[0]*l+i[0]*f,t[1]=e[1]*h+n[1]*c+r[1]*l+i[1]*f,t[2]=e[2]*h+n[2]*c+r[2]*l+i[2]*f,t},random:function(t,e){e=e||1;var n=2*gt()*Math.PI,r=2*gt()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t},transformMat4:ee,transformMat3:ne,transformQuat:re,rotateX:ie,rotateY:oe,rotateZ:ae,angle:se,zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t},str:function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},equals:ue,sub:he,mul:ce,div:le,dist:fe,sqrDist:de,len:pe,sqrLen:ve,forEach:me});const ye=[0,0,0];let _e,xe;class be extends pt{static get ZERO(){return _e||(_e=new be(0,0,0),Object.freeze(_e)),_e}constructor(t=0,e=0,n=0){super(-0,-0,-0),1===arguments.length&&ht(t)?this.copy(t):(st.debug&&(ft(t),ft(e),ft(n)),this[0]=t,this[1]=e,this[2]=n)}set(t,e,n){return this[0]=t,this[1]=e,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return st.debug&&(ft(t.x),ft(t.y),ft(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=ft(t)}angle(t){return se(this,t)}cross(t){return te(this,this,t),this.check()}rotateX({radians:t,origin:e=ye}){return ie(this,this,e,t),this.check()}rotateY({radians:t,origin:e=ye}){return oe(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=ye}){return ae(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return ee(this,this,t),this.check()}transformAsVector(t){return Nt(this,this,t),this.check()}transformByMatrix3(t){return ne(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,n){const r=e[0],i=e[1];t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2]}(this,this,t),this.check()}transformByQuaternion(t){return re(this,this,t),this.check()}}class Me extends pt{static get ZERO(){return xe||(xe=new Me(0,0,0,0),Object.freeze(xe)),xe}constructor(t=0,e=0,n=0,r=0){super(-0,-0,-0,-0),ht(t)&&1===arguments.length?this.copy(t):(st.debug&&(ft(t),ft(e),ft(n),ft(r)),this[0]=t,this[1]=e,this[2]=n,this[3]=r)}set(t,e,n,r){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return st.debug&&(ft(t.x),ft(t.y),ft(t.z),ft(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=ft(t)}get w(){return this[3]}set w(t){this[3]=ft(t)}transform(t){return ee(this,this,t),this.check()}transformByMatrix3(t){return function(t,e,n){const r=e[0],i=e[1],o=e[2];t[0]=n[0]*r+n[3]*i+n[6]*o,t[1]=n[1]*r+n[4]*i+n[7]*o,t[2]=n[2]*r+n[5]*i+n[8]*o,t[3]=e[3]}(this,this,t),this.check()}transformByMatrix2(t){return function(t,e,n){const r=e[0],i=e[1];t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t[3]=e[3]}(this,this,t),this.check()}transformByQuaternion(t){return re(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}}class we extends lt{toString(){let t="[";if(st.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let n=0;n<this.RANK;++n)t+=" ".concat(this[n*this.RANK+e])}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=" ".concat(this[e])}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,n){return this[e*this.RANK+t]=ft(n),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const n=t*this.RANK;for(let t=0;t<this.RANK;++t)e[t]=this[n+t];return e}setColumn(t,e){const n=t*this.RANK;for(let t=0;t<this.RANK;++t)this[n+t]=e[t];return this}}function Ee(){var t=new mt(9);return mt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Te(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=n[0],d=n[1],p=n[2],v=n[3],m=n[4],g=n[5],y=n[6],_=n[7],x=n[8];return t[0]=f*r+d*a+p*h,t[1]=f*i+d*s+p*c,t[2]=f*o+d*u+p*l,t[3]=v*r+m*a+g*h,t[4]=v*i+m*s+g*c,t[5]=v*o+m*u+g*l,t[6]=y*r+_*a+x*h,t[7]=y*i+_*s+x*c,t[8]=y*o+_*u+x*l,t}function Ae(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}var Ce=Te,Re=Ae,Se=Object.freeze({__proto__:null,create:Ee,fromMat4:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},clone:function(t){var e=new mt(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromValues:function(t,e,n,r,i,o,a,s,u){var h=new mt(9);return h[0]=t,h[1]=e,h[2]=n,h[3]=r,h[4]=i,h[5]=o,h[6]=a,h[7]=s,h[8]=u,h},set:function(t,e,n,r,i,o,a,s,u,h){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=h,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},invert:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=c*a-s*h,f=-c*o+s*u,d=h*o-a*u,p=n*l+r*f+i*d;return p?(p=1/p,t[0]=l*p,t[1]=(-c*r+i*h)*p,t[2]=(s*r-i*a)*p,t[3]=f*p,t[4]=(c*n-i*u)*p,t[5]=(-s*n+i*o)*p,t[6]=d*p,t[7]=(-h*n+r*u)*p,t[8]=(a*n-r*o)*p,t):null},adjoint:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],c=e[8];return t[0]=a*c-s*h,t[1]=i*h-r*c,t[2]=r*s-i*a,t[3]=s*u-o*c,t[4]=n*c-i*u,t[5]=i*o-n*s,t[6]=o*h-a*u,t[7]=r*u-n*h,t[8]=n*a-r*o,t},determinant:function(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],h=t[8];return e*(h*o-a*u)+n*(-h*i+a*s)+r*(u*i-o*s)},multiply:Te,translate:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=n[0],d=n[1];return t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=f*r+d*a+h,t[7]=f*i+d*s+c,t[8]=f*o+d*u+l,t},rotate:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=Math.sin(n),d=Math.cos(n);return t[0]=d*r+f*a,t[1]=d*i+f*s,t[2]=d*o+f*u,t[3]=d*a-f*r,t[4]=d*s-f*i,t[5]=d*u-f*o,t[6]=h,t[7]=c,t[8]=l,t},scale:function(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},fromRotation:function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat2d:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},fromQuat:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,h=n*a,c=r*a,l=r*s,f=i*a,d=i*s,p=i*u,v=o*a,m=o*s,g=o*u;return t[0]=1-l-p,t[3]=c-g,t[6]=f+m,t[1]=c+g,t[4]=1-h-p,t[7]=d-v,t[2]=f-m,t[5]=d+v,t[8]=1-h-l,t},normalFromMat4:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],p=e[12],v=e[13],m=e[14],g=e[15],y=n*s-r*a,_=n*u-i*a,x=n*h-o*a,b=r*u-i*s,M=r*h-o*s,w=i*h-o*u,E=c*v-l*p,T=c*m-f*p,A=c*g-d*p,C=l*m-f*v,R=l*g-d*v,S=f*g-d*m,P=y*S-_*R+x*C+b*A-M*T+w*E;return P?(P=1/P,t[0]=(s*S-u*R+h*C)*P,t[1]=(u*A-a*S-h*T)*P,t[2]=(a*R-s*A+h*E)*P,t[3]=(i*R-r*S-o*C)*P,t[4]=(n*S-i*A+o*T)*P,t[5]=(r*A-n*R-o*E)*P,t[6]=(v*w-m*M+g*b)*P,t[7]=(m*x-p*w-g*_)*P,t[8]=(p*M-v*x+g*y)*P,t):null},projection:function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},str:function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},subtract:Ae,multiplyScalar:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},multiplyScalarAndAdd:function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},equals:function(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],h=t[7],c=t[8],l=e[0],f=e[1],d=e[2],p=e[3],v=e[4],m=e[5],g=e[6],y=e[7],_=e[8];return Math.abs(n-l)<=vt*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-f)<=vt*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-d)<=vt*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-p)<=vt*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-v)<=vt*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(s-m)<=vt*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-g)<=vt*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(h-y)<=vt*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(c-_)<=vt*Math.max(1,Math.abs(c),Math.abs(_))},mul:Ce,sub:Re});function Pe(){var t=new mt(16);return mt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function De(t){var e=new mt(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Oe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ie(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Le(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Be(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],p=e[12],v=e[13],m=e[14],g=e[15],y=n*s-r*a,_=n*u-i*a,x=n*h-o*a,b=r*u-i*s,M=r*h-o*s,w=i*h-o*u,E=c*v-l*p,T=c*m-f*p,A=c*g-d*p,C=l*m-f*v,R=l*g-d*v,S=f*g-d*m,P=y*S-_*R+x*C+b*A-M*T+w*E;return P?(P=1/P,t[0]=(s*S-u*R+h*C)*P,t[1]=(i*R-r*S-o*C)*P,t[2]=(v*w-m*M+g*b)*P,t[3]=(f*M-l*w-d*b)*P,t[4]=(u*A-a*S-h*T)*P,t[5]=(n*S-i*A+o*T)*P,t[6]=(m*x-p*w-g*_)*P,t[7]=(c*w-f*x+d*_)*P,t[8]=(a*R-s*A+h*E)*P,t[9]=(r*A-n*R-o*E)*P,t[10]=(p*M-v*x+g*y)*P,t[11]=(l*x-c*M-d*y)*P,t[12]=(s*T-a*C-u*E)*P,t[13]=(n*C-r*T+i*E)*P,t[14]=(v*_-p*b-m*y)*P,t[15]=(c*b-l*_+f*y)*P,t):null}function ke(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],h=t[8],c=t[9],l=t[10],f=t[11],d=t[12],p=t[13],v=t[14],m=t[15];return(e*a-n*o)*(l*m-f*v)-(e*s-r*o)*(c*m-f*p)+(e*u-i*o)*(c*v-l*p)+(n*s-r*a)*(h*m-f*d)-(n*u-i*a)*(h*v-l*d)+(r*u-i*s)*(h*p-c*d)}function Ue(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],d=e[10],p=e[11],v=e[12],m=e[13],g=e[14],y=e[15],_=n[0],x=n[1],b=n[2],M=n[3];return t[0]=_*r+x*s+b*l+M*v,t[1]=_*i+x*u+b*f+M*m,t[2]=_*o+x*h+b*d+M*g,t[3]=_*a+x*c+b*p+M*y,_=n[4],x=n[5],b=n[6],M=n[7],t[4]=_*r+x*s+b*l+M*v,t[5]=_*i+x*u+b*f+M*m,t[6]=_*o+x*h+b*d+M*g,t[7]=_*a+x*c+b*p+M*y,_=n[8],x=n[9],b=n[10],M=n[11],t[8]=_*r+x*s+b*l+M*v,t[9]=_*i+x*u+b*f+M*m,t[10]=_*o+x*h+b*d+M*g,t[11]=_*a+x*c+b*p+M*y,_=n[12],x=n[13],b=n[14],M=n[15],t[12]=_*r+x*s+b*l+M*v,t[13]=_*i+x*u+b*f+M*m,t[14]=_*o+x*h+b*d+M*g,t[15]=_*a+x*c+b*p+M*y,t}function Ne(t,e,n){var r,i,o,a,s,u,h,c,l,f,d,p,v=n[0],m=n[1],g=n[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*g+e[12],t[13]=e[1]*v+e[5]*m+e[9]*g+e[13],t[14]=e[2]*v+e[6]*m+e[10]*g+e[14],t[15]=e[3]*v+e[7]*m+e[11]*g+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=e[8],f=e[9],d=e[10],p=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=h,t[7]=c,t[8]=l,t[9]=f,t[10]=d,t[11]=p,t[12]=r*v+s*m+l*g+e[12],t[13]=i*v+u*m+f*g+e[13],t[14]=o*v+h*m+d*g+e[14],t[15]=a*v+c*m+p*g+e[15]),t}function Fe(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function je(t,e,n,r){var i,o,a,s,u,h,c,l,f,d,p,v,m,g,y,_,x,b,M,w,E,T,A,C,R=r[0],S=r[1],P=r[2],D=Math.hypot(R,S,P);return D<vt?null:(R*=D=1/D,S*=D,P*=D,i=Math.sin(n),a=1-(o=Math.cos(n)),s=e[0],u=e[1],h=e[2],c=e[3],l=e[4],f=e[5],d=e[6],p=e[7],v=e[8],m=e[9],g=e[10],y=e[11],_=R*R*a+o,x=S*R*a+P*i,b=P*R*a-S*i,M=R*S*a-P*i,w=S*S*a+o,E=P*S*a+R*i,T=R*P*a+S*i,A=S*P*a-R*i,C=P*P*a+o,t[0]=s*_+l*x+v*b,t[1]=u*_+f*x+m*b,t[2]=h*_+d*x+g*b,t[3]=c*_+p*x+y*b,t[4]=s*M+l*w+v*E,t[5]=u*M+f*w+m*E,t[6]=h*M+d*w+g*E,t[7]=c*M+p*w+y*E,t[8]=s*T+l*A+v*C,t[9]=u*T+f*A+m*C,t[10]=h*T+d*A+g*C,t[11]=c*T+p*A+y*C,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ze(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],h=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+h*r,t[5]=a*i+c*r,t[6]=s*i+l*r,t[7]=u*i+f*r,t[8]=h*i-o*r,t[9]=c*i-a*r,t[10]=l*i-s*r,t[11]=f*i-u*r,t}function Ve(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],h=e[8],c=e[9],l=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-h*r,t[1]=a*i-c*r,t[2]=s*i-l*r,t[3]=u*i-f*r,t[8]=o*r+h*i,t[9]=a*r+c*i,t[10]=s*r+l*i,t[11]=u*r+f*i,t}function Ge(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],h=e[4],c=e[5],l=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+h*r,t[1]=a*i+c*r,t[2]=s*i+l*r,t[3]=u*i+f*r,t[4]=h*i-o*r,t[5]=c*i-a*r,t[6]=l*i-s*r,t[7]=f*i-u*r,t}function We(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,u=i+i,h=o+o,c=r*s,l=r*u,f=r*h,d=i*u,p=i*h,v=o*h,m=a*s,g=a*u,y=a*h;return t[0]=1-(d+v),t[1]=l+y,t[2]=f-g,t[3]=0,t[4]=l-y,t[5]=1-(c+v),t[6]=p+m,t[7]=0,t[8]=f+g,t[9]=p-m,t[10]=1-(c+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function He(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],h=e[9],c=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(u,h,c),t}function Ze(t,e){var n=new mt(3);He(n,e);var r=1/n[0],i=1/n[1],o=1/n[2],a=e[0]*r,s=e[1]*i,u=e[2]*o,h=e[4]*r,c=e[5]*i,l=e[6]*o,f=e[8]*r,d=e[9]*i,p=e[10]*o,v=a+c+p,m=0;return v>0?(m=2*Math.sqrt(v+1),t[3]=.25*m,t[0]=(l-d)/m,t[1]=(f-u)/m,t[2]=(s-h)/m):a>c&&a>p?(m=2*Math.sqrt(1+a-c-p),t[3]=(l-d)/m,t[0]=.25*m,t[1]=(s+h)/m,t[2]=(f+u)/m):c>p?(m=2*Math.sqrt(1+c-a-p),t[3]=(f-u)/m,t[0]=(s+h)/m,t[1]=.25*m,t[2]=(l+d)/m):(m=2*Math.sqrt(1+p-a-c),t[3]=(s-h)/m,t[0]=(f+u)/m,t[1]=(l+d)/m,t[2]=.25*m),t}function qe(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,h=o+o,c=a+a,l=i*u,f=i*h,d=i*c,p=o*h,v=o*c,m=a*c,g=s*u,y=s*h,_=s*c,x=r[0],b=r[1],M=r[2];return t[0]=(1-(p+m))*x,t[1]=(f+_)*x,t[2]=(d-y)*x,t[3]=0,t[4]=(f-_)*b,t[5]=(1-(l+m))*b,t[6]=(v+g)*b,t[7]=0,t[8]=(d+y)*M,t[9]=(v-g)*M,t[10]=(1-(l+p))*M,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Ye(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,h=n*a,c=r*a,l=r*s,f=i*a,d=i*s,p=i*u,v=o*a,m=o*s,g=o*u;return t[0]=1-l-p,t[1]=c+g,t[2]=f-m,t[3]=0,t[4]=c-g,t[5]=1-h-p,t[6]=d+v,t[7]=0,t[8]=f+m,t[9]=d-v,t[10]=1-h-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Xe(t,e,n,r,i,o,a){var s=1/(n-e),u=1/(i-r),h=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(a+o)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*h,t[15]=0,t}function Ke(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var Qe=Ke;function Je(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),h=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*h,t[15]=1,t}var $e=Je;function tn(t,e,n,r){var i,o,a,s,u,h,c,l,f,d,p=e[0],v=e[1],m=e[2],g=r[0],y=r[1],_=r[2],x=n[0],b=n[1],M=n[2];return Math.abs(p-x)<vt&&Math.abs(v-b)<vt&&Math.abs(m-M)<vt?Ie(t):(c=p-x,l=v-b,f=m-M,i=y*(f*=d=1/Math.hypot(c,l,f))-_*(l*=d),o=_*(c*=d)-g*f,a=g*l-y*c,(d=Math.hypot(i,o,a))?(i*=d=1/d,o*=d,a*=d):(i=0,o=0,a=0),s=l*a-f*o,u=f*i-c*a,h=c*o-l*i,(d=Math.hypot(s,u,h))?(s*=d=1/d,u*=d,h*=d):(s=0,u=0,h=0),t[0]=i,t[1]=s,t[2]=c,t[3]=0,t[4]=o,t[5]=u,t[6]=l,t[7]=0,t[8]=a,t[9]=h,t[10]=f,t[11]=0,t[12]=-(i*p+o*v+a*m),t[13]=-(s*p+u*v+h*m),t[14]=-(c*p+l*v+f*m),t[15]=1,t)}function en(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=r[0],u=r[1],h=r[2],c=i-n[0],l=o-n[1],f=a-n[2],d=c*c+l*l+f*f;d>0&&(c*=d=1/Math.sqrt(d),l*=d,f*=d);var p=u*f-h*l,v=h*c-s*f,m=s*l-u*c;return(d=p*p+v*v+m*m)>0&&(p*=d=1/Math.sqrt(d),v*=d,m*=d),t[0]=p,t[1]=v,t[2]=m,t[3]=0,t[4]=l*m-f*v,t[5]=f*p-c*m,t[6]=c*v-l*p,t[7]=0,t[8]=c,t[9]=l,t[10]=f,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function nn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}var rn=Ue,on=nn,an=Object.freeze({__proto__:null,create:Pe,clone:De,copy:Oe,fromValues:function(t,e,n,r,i,o,a,s,u,h,c,l,f,d,p,v){var m=new mt(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=r,m[4]=i,m[5]=o,m[6]=a,m[7]=s,m[8]=u,m[9]=h,m[10]=c,m[11]=l,m[12]=f,m[13]=d,m[14]=p,m[15]=v,m},set:function(t,e,n,r,i,o,a,s,u,h,c,l,f,d,p,v,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=h,t[9]=c,t[10]=l,t[11]=f,t[12]=d,t[13]=p,t[14]=v,t[15]=m,t},identity:Ie,transpose:Le,invert:Be,adjoint:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],h=e[7],c=e[8],l=e[9],f=e[10],d=e[11],p=e[12],v=e[13],m=e[14],g=e[15];return t[0]=s*(f*g-d*m)-l*(u*g-h*m)+v*(u*d-h*f),t[1]=-(r*(f*g-d*m)-l*(i*g-o*m)+v*(i*d-o*f)),t[2]=r*(u*g-h*m)-s*(i*g-o*m)+v*(i*h-o*u),t[3]=-(r*(u*d-h*f)-s*(i*d-o*f)+l*(i*h-o*u)),t[4]=-(a*(f*g-d*m)-c*(u*g-h*m)+p*(u*d-h*f)),t[5]=n*(f*g-d*m)-c*(i*g-o*m)+p*(i*d-o*f),t[6]=-(n*(u*g-h*m)-a*(i*g-o*m)+p*(i*h-o*u)),t[7]=n*(u*d-h*f)-a*(i*d-o*f)+c*(i*h-o*u),t[8]=a*(l*g-d*v)-c*(s*g-h*v)+p*(s*d-h*l),t[9]=-(n*(l*g-d*v)-c*(r*g-o*v)+p*(r*d-o*l)),t[10]=n*(s*g-h*v)-a*(r*g-o*v)+p*(r*h-o*s),t[11]=-(n*(s*d-h*l)-a*(r*d-o*l)+c*(r*h-o*s)),t[12]=-(a*(l*m-f*v)-c*(s*m-u*v)+p*(s*f-u*l)),t[13]=n*(l*m-f*v)-c*(r*m-i*v)+p*(r*f-i*l),t[14]=-(n*(s*m-u*v)-a*(r*m-i*v)+p*(r*u-i*s)),t[15]=n*(s*f-u*l)-a*(r*f-i*l)+c*(r*u-i*s),t},determinant:ke,multiply:Ue,translate:Ne,scale:Fe,rotate:je,rotateX:ze,rotateY:Ve,rotateZ:Ge,fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotation:function(t,e,n){var r,i,o,a=n[0],s=n[1],u=n[2],h=Math.hypot(a,s,u);return h<vt?null:(a*=h=1/h,s*=h,u*=h,r=Math.sin(e),o=1-(i=Math.cos(e)),t[0]=a*a*o+i,t[1]=s*a*o+u*r,t[2]=u*a*o-s*r,t[3]=0,t[4]=a*s*o-u*r,t[5]=s*s*o+i,t[6]=u*s*o+a*r,t[7]=0,t[8]=a*u*o+s*r,t[9]=s*u*o-a*r,t[10]=u*u*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},fromXRotation:function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromYRotation:function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromZRotation:function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotationTranslation:We,fromQuat2:function(t,e){var n=new mt(3),r=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],u=e[5],h=e[6],c=e[7],l=r*r+i*i+o*o+a*a;return l>0?(n[0]=2*(s*a+c*r+u*o-h*i)/l,n[1]=2*(u*a+c*i+h*r-s*o)/l,n[2]=2*(h*a+c*o+s*i-u*r)/l):(n[0]=2*(s*a+c*r+u*o-h*i),n[1]=2*(u*a+c*i+h*r-s*o),n[2]=2*(h*a+c*o+s*i-u*r)),We(t,e,n),t},getTranslation:function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},getScaling:He,getRotation:Ze,fromRotationTranslationScale:qe,fromRotationTranslationScaleOrigin:function(t,e,n,r,i){var o=e[0],a=e[1],s=e[2],u=e[3],h=o+o,c=a+a,l=s+s,f=o*h,d=o*c,p=o*l,v=a*c,m=a*l,g=s*l,y=u*h,_=u*c,x=u*l,b=r[0],M=r[1],w=r[2],E=i[0],T=i[1],A=i[2],C=(1-(v+g))*b,R=(d+x)*b,S=(p-_)*b,P=(d-x)*M,D=(1-(f+g))*M,O=(m+y)*M,I=(p+_)*w,L=(m-y)*w,B=(1-(f+v))*w;return t[0]=C,t[1]=R,t[2]=S,t[3]=0,t[4]=P,t[5]=D,t[6]=O,t[7]=0,t[8]=I,t[9]=L,t[10]=B,t[11]=0,t[12]=n[0]+E-(C*E+P*T+I*A),t[13]=n[1]+T-(R*E+D*T+L*A),t[14]=n[2]+A-(S*E+O*T+B*A),t[15]=1,t},fromQuat:Ye,frustum:Xe,perspectiveNO:Ke,perspective:Qe,perspectiveZO:function(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t},perspectiveFromFieldOfView:function(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),h=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-(a-s)*u*.5,t[9]=(i-o)*h*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t},orthoNO:Je,ortho:$e,orthoZO:function(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),h=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=h,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=o*h,t[15]=1,t},lookAt:tn,targetTo:en,str:function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},subtract:nn,multiplyScalar:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},multiplyScalarAndAdd:function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},equals:function(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],h=t[7],c=t[8],l=t[9],f=t[10],d=t[11],p=t[12],v=t[13],m=t[14],g=t[15],y=e[0],_=e[1],x=e[2],b=e[3],M=e[4],w=e[5],E=e[6],T=e[7],A=e[8],C=e[9],R=e[10],S=e[11],P=e[12],D=e[13],O=e[14],I=e[15];return Math.abs(n-y)<=vt*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-_)<=vt*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-x)<=vt*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-b)<=vt*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-M)<=vt*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(s-w)<=vt*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(u-E)<=vt*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(h-T)<=vt*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(c-A)<=vt*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(l-C)<=vt*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(f-R)<=vt*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(d-S)<=vt*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(p-P)<=vt*Math.max(1,Math.abs(p),Math.abs(P))&&Math.abs(v-D)<=vt*Math.max(1,Math.abs(v),Math.abs(D))&&Math.abs(m-O)<=vt*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(g-I)<=vt*Math.max(1,Math.abs(g),Math.abs(I))},mul:rn,sub:on});function sn(){var t=new mt(4);return mt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function un(t){var e=new mt(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function hn(t,e,n,r){var i=new mt(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function cn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ln(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function fn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function dn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function pn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function vn(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function mn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function gn(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.hypot(n,r,i,o)}function yn(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return n*n+r*r+i*i+o*o}function _n(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.hypot(e,n,r,i)}function xn(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function bn(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=n*a,t[1]=r*a,t[2]=i*a,t[3]=o*a,t}function Mn(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function wn(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t[3]=s+r*(n[3]-s),t}function En(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}function Tn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function An(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=e[0],s=e[1],u=e[2],h=e[3];return Math.abs(n-a)<=vt*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=vt*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=vt*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-h)<=vt*Math.max(1,Math.abs(o),Math.abs(h))}var Cn,Rn=dn,Sn=pn,Pn=vn,Dn=gn,On=yn,In=_n,Ln=xn,Bn=function(){var t=sn();return function(e,n,r,i,o,a){var s,u;for(n||(n=4),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),kn=Object.freeze({__proto__:null,create:sn,clone:un,fromValues:hn,copy:cn,set:ln,add:fn,subtract:dn,multiply:pn,divide:vn,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},min:function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},max:function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},scale:mn,scaleAndAdd:function(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t},distance:gn,squaredDistance:yn,length:_n,squaredLength:xn,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},normalize:bn,dot:Mn,cross:function(t,e,n,r){var i=n[0]*r[1]-n[1]*r[0],o=n[0]*r[2]-n[2]*r[0],a=n[0]*r[3]-n[3]*r[0],s=n[1]*r[2]-n[2]*r[1],u=n[1]*r[3]-n[3]*r[1],h=n[2]*r[3]-n[3]*r[2],c=e[0],l=e[1],f=e[2],d=e[3];return t[0]=l*h-f*u+d*s,t[1]=-c*h+f*a-d*o,t[2]=c*u-l*a+d*i,t[3]=-c*s+l*o-f*i,t},lerp:wn,random:function(t,e){var n,r,i,o,a,s;e=e||1;do{a=(n=2*gt()-1)*n+(r=2*gt()-1)*r}while(a>=1);do{s=(i=2*gt()-1)*i+(o=2*gt()-1)*o}while(s>=1);var u=Math.sqrt((1-a)/s);return t[0]=e*n,t[1]=e*r,t[2]=e*i*u,t[3]=e*o*u,t},transformMat4:En,transformQuat:function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2],h=n[3],c=h*r+s*o-u*i,l=h*i+u*r-a*o,f=h*o+a*i-s*r,d=-a*r-s*i-u*o;return t[0]=c*h+d*-a+l*-u-f*-s,t[1]=l*h+d*-s+f*-a-c*-u,t[2]=f*h+d*-u+c*-s-l*-a,t[3]=e[3],t},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},str:function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},exactEquals:Tn,equals:An,sub:Rn,mul:Sn,div:Pn,dist:Dn,sqrDist:On,len:In,sqrLen:Ln,forEach:Bn});!function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"}(Cn||(Cn={}));const Un=45*Math.PI/180,Nn=1,Fn=.1,jn=500,zn=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Vn extends we{static get IDENTITY(){return function(){Wn||(Wn=new Vn,Object.freeze(Wn));return Wn}()}static get ZERO(){return function(){Gn||(Gn=new Vn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Gn));return Gn}()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Cn}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,e,n,r,i,o,a,s,u,h,c,l,f,d,p,v){return this[0]=t,this[1]=e,this[2]=n,this[3]=r,this[4]=i,this[5]=o,this[6]=a,this[7]=s,this[8]=u,this[9]=h,this[10]=c,this[11]=l,this[12]=f,this[13]=d,this[14]=p,this[15]=v,this.check()}setRowMajor(t,e,n,r,i,o,a,s,u,h,c,l,f,d,p,v){return this[0]=t,this[1]=i,this[2]=u,this[3]=f,this[4]=e,this[5]=o,this[6]=h,this[7]=d,this[8]=n,this[9]=a,this[10]=c,this[11]=p,this[12]=r,this[13]=s,this[14]=l,this[15]=v,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(zn)}fromObject(t){return this.check()}fromQuaternion(t){return Ye(this,t),this.check()}frustum(t){const{left:e,right:n,bottom:r,top:i,near:o=Fn,far:a=jn}=t;return a===1/0?function(t,e,n,r,i,o){const a=2*o/(n-e),s=2*o/(i-r),u=(n+e)/(n-e),h=(i+r)/(i-r),c=-1,l=-1,f=-2*o;t[0]=a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=u,t[9]=h,t[10]=c,t[11]=l,t[12]=0,t[13]=0,t[14]=f,t[15]=0}(this,e,n,r,i,o):Xe(this,e,n,r,i,o,a),this.check()}lookAt(t){const{eye:e,center:n=[0,0,0],up:r=[0,1,0]}=t;return tn(this,e,n,r),this.check()}ortho(t){const{left:e,right:n,bottom:r,top:i,near:o=Fn,far:a=jn}=t;return $e(this,e,n,r,i,o,a),this.check()}orthographic(t){const{fovy:e=Un,aspect:n=Nn,focalDistance:r=1,near:i=Fn,far:o=jn}=t;Hn(e);const a=e/2,s=r*Math.tan(a),u=s*n;return this.ortho({left:-u,right:u,bottom:-s,top:s,near:i,far:o})}perspective(t){const{fovy:e=45*Math.PI/180,aspect:n=1,near:r=.1,far:i=500}=t;return Hn(e),Qe(this,e,n,r,i),this.check()}determinant(){return ke(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),r=1/n[0],i=1/n[1],o=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*r,t[5]=this[5]*i,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*r,t[9]=this[9]*i,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,e){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=e||[-0,-0,-0];const n=this.getScale(e),r=1/n[0],i=1/n[1],o=1/n[2];return t[0]=this[0]*r,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=this[4]*r,t[4]=this[5]*i,t[5]=this[6]*o,t[6]=this[8]*r,t[7]=this[9]*i,t[8]=this[10]*o,t}transpose(){return Le(this,this),this.check()}invert(){return Be(this,this),this.check()}multiplyLeft(t){return Ue(this,t,this),this.check()}multiplyRight(t){return Ue(this,this,t),this.check()}rotateX(t){return ze(this,this,t),this.check()}rotateY(t){return Ve(this,this,t),this.check()}rotateZ(t){return Ge(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,e){return je(this,this,t,e),this.check()}scale(t){return Fe(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return Ne(this,this,t),this.check()}transform(t,e){return 4===t.length?(dt(e=En(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}transformAsPoint(t,e){const{length:n}=t;let r;switch(n){case 2:r=Ct(e||[-0,-0],t,this);break;case 3:r=ee(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return dt(r,t.length),r}transformAsVector(t,e){let n;switch(t.length){case 2:n=function(t,e,n){const r=e[0],i=e[1],o=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/o,t[1]=(n[1]*r+n[5]*i)/o,t}(e||[-0,-0],t,this);break;case 3:n=Nt(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return dt(n,t.length),n}transformPoint(t,e){return this.transformAsPoint(t,e)}transformVector(t,e){return this.transformAsPoint(t,e)}transformDirection(t,e){return this.transformAsVector(t,e)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,e,n){return this.identity().translate([t,e,n])}}let Gn,Wn;function Hn(t){if(t>2*Math.PI)throw Error("expected radians")}function Zn(){var t=new mt(4);return mt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function qn(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Yn(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function Xn(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=n[0],u=n[1],h=n[2],c=n[3];return t[0]=r*c+a*s+i*h-o*u,t[1]=i*c+a*u+o*s-r*h,t[2]=o*c+a*h+r*u-i*s,t[3]=a*c-r*s-i*u-o*h,t}function Kn(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=Math.sqrt(n*n+r*r+i*i),s=Math.exp(o),u=a>0?s*Math.sin(a)/a:0;return t[0]=n*u,t[1]=r*u,t[2]=i*u,t[3]=s*Math.cos(a),t}function Qn(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=Math.sqrt(n*n+r*r+i*i),s=a>0?Math.atan2(a,o)/a:0;return t[0]=n*s,t[1]=r*s,t[2]=i*s,t[3]=.5*Math.log(n*n+r*r+i*i+o*o),t}function Jn(t,e,n,r){var i,o,a,s,u,h=e[0],c=e[1],l=e[2],f=e[3],d=n[0],p=n[1],v=n[2],m=n[3];return(o=h*d+c*p+l*v+f*m)<0&&(o=-o,d=-d,p=-p,v=-v,m=-m),1-o>vt?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-r)*i)/a,u=Math.sin(r*i)/a):(s=1-r,u=r),t[0]=s*h+u*d,t[1]=s*c+u*p,t[2]=s*l+u*v,t[3]=s*f+u*m,t}function $n(t,e){var n,r=e[0]+e[4]+e[8];if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*a+a]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*o+a]-e[3*a+o])*n,t[o]=(e[3*o+i]+e[3*i+o])*n,t[a]=(e[3*a+i]+e[3*i+a])*n}return t}function tr(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var o=Math.sin(e),a=Math.cos(e),s=Math.sin(n),u=Math.cos(n),h=Math.sin(r),c=Math.cos(r);return t[0]=o*u*c-a*s*h,t[1]=a*s*c+o*u*h,t[2]=a*u*h-o*s*c,t[3]=a*u*c+o*s*h,t}var er,nr,rr,ir,or,ar,sr=un,ur=hn,hr=cn,cr=ln,lr=fn,fr=Xn,dr=mn,pr=Mn,vr=wn,mr=_n,gr=mr,yr=xn,_r=yr,xr=bn,br=Tn,Mr=An,wr=(er=Ft(),nr=Vt(1,0,0),rr=Vt(0,1,0),function(t,e,n){var r=$t(e,n);return r<-.999999?(te(er,nr,e),pe(er)<1e-6&&te(er,rr,e),Jt(er,er),Yn(t,er,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(te(er,e,n),t[0]=er[0],t[1]=er[1],t[2]=er[2],t[3]=1+r,xr(t,t))}),Er=(ir=Zn(),or=Zn(),function(t,e,n,r,i,o){return Jn(ir,e,i,o),Jn(or,n,r,o),Jn(t,ir,or,2*o*(1-o)),t}),Tr=(ar=Ee(),function(t,e,n,r){return ar[0]=n[0],ar[3]=n[1],ar[6]=n[2],ar[1]=r[0],ar[4]=r[1],ar[7]=r[2],ar[2]=-e[0],ar[5]=-e[1],ar[8]=-e[2],xr(t,$n(t,ar))}),Ar=Object.freeze({__proto__:null,create:Zn,identity:qn,setAxisAngle:Yn,getAxisAngle:function(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return r>vt?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n},getAngle:function(t,e){var n=pr(t,e);return Math.acos(2*n*n-1)},multiply:Xn,rotateX:function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+a*s,t[1]=i*u+o*s,t[2]=o*u-i*s,t[3]=a*u-r*s,t},rotateY:function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u-o*s,t[1]=i*u+a*s,t[2]=o*u+r*s,t[3]=a*u-i*s,t},rotateZ:function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*s,t[1]=i*u-r*s,t[2]=o*u+a*s,t[3]=a*u-o*s,t},calculateW:function(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t},exp:Kn,ln:Qn,pow:function(t,e,n){return Qn(t,e),dr(t,t,n),Kn(t,t),t},slerp:Jn,random:function(t){var e=gt(),n=gt(),r=gt(),i=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*n),t[1]=i*Math.cos(2*Math.PI*n),t[2]=o*Math.sin(2*Math.PI*r),t[3]=o*Math.cos(2*Math.PI*r),t},invert:function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n*n+r*r+i*i+o*o,s=a?1/a:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-i*s,t[3]=o*s,t},conjugate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},fromMat3:$n,fromEuler:tr,str:function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},clone:sr,fromValues:ur,copy:hr,set:cr,add:lr,mul:fr,scale:dr,dot:pr,lerp:vr,length:mr,len:gr,squaredLength:yr,sqrLen:_r,normalize:xr,exactEquals:br,equals:Mr,rotationTo:wr,sqlerp:Er,setAxes:Tr});function Cr(t){return Cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cr(t)}var Rr=function(t){return"[object String]"===Object.prototype.toString.call(t)},Sr=function(t){var e="[object Function]"===Object.prototype.toString.call(t),n="[object AsyncFunction]"===Object.prototype.toString.call(t);return e||n},Pr=365611;function Dr(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null}var Or=function(){function t(){this.__listeners=void 0}var e=t.prototype;return e.on=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.alias("addEventListener")(e)},e.off=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.alias("removeEventListener")(e)},e.emit=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.alias("dispatchEvent")(e)},e.addEventListener=function(t,e,n){if(Sr(e)){var r;!this.__listeners&&(this.__listeners={});var i=this.__listeners;if("string"==typeof n&&n){if(/[^\w-]/.test(n))throw"nonstandard key:"+n;e.hashCode=n,r=n}!t.startsWith("on")&&(t="on"+t),"object"!==Cr(i[t])&&(i[t]={}),r=r||(++Pr).toString(),e.hashCode=r,i[t][r]=e}},e.removeEventListener=function(t,e){if(Sr(e))e=e.hashCode;else if(!Rr(e))return;!this.__listeners&&(this.__listeners={}),!t.startsWith("on")&&(t="on"+t);var n=this.__listeners;n[t]&&n[t][e]&&delete n[t][e]},e.dispatchEvent=function(t,e){Rr(t)&&(t=new Dr(t)),!this.__listeners&&(this.__listeners={});var n=this.__listeners,r=t.type,i=e||t;if(t.target=t.target||this,t.currentTarget=this,0!==r.indexOf("on")&&(r="on".concat(r)),Sr(n[r])&&n[r].call(this,i),"object"===Cr(n[r]))for(var o in n[r])Object.prototype.hasOwnProperty.call(n[r],o)&&n[r][o].call(this,i);return t.returnValue},e.alias=function(t){var e=this;return function(n){return e[t].apply(e,n)}},t}();function Ir(t,e){var n=e[2],r=e[0],i=e[1],o=e[3],a=o*o,s=n*n,u=r*r,h=i*i,c=i*n-r*o,l=.4999999;return c<-l?(t[0]=Math.PI/2,t[1]=2*Math.atan2(i,o),t[2]=0):c>l?(t[0]=-Math.PI/2,t[1]=2*Math.atan2(i,o),t[2]=0):(t[0]=Math.asin(-2*(n*i-r*o)),t[1]=Math.atan2(2*(n*r+i*o),s-u-h+a),t[2]=Math.atan2(2*(r*i+n*o),-s-u+h+a)),t}var Lr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DefaultOrder;this.isEuler=!0,this._x=void 0,this._y=void 0,this._z=void 0,this._order=void 0,this._onChangeCallback=void 0,this._x=e,this._y=n,this._z=r,this._order=i,this._onChangeCallback=function(){}}var e=t.prototype;return e.set=function(t,e,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return this._x=t,this._y=e,this._z=n,r&&this._onChangeCallback(),this},e.clone=function(){return new t(this._x,this._y,this._z,this._order)},e.copy=function(t){return t.isEuler?(this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this):this},e.equals=function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},e.toVector3=function(){return Vt(this._x,this._y,this._z)},e.onChange=function(t){"function"==typeof t&&(this._onChangeCallback=t)},o(t,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}]),t}();function Br(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}Lr.DefaultOrder="XYZ";var kr=function(t){return 180*t/Math.PI},Ur=function(t){function e(){var n;return(n=t.call(this)||this).isObject3D=!0,n.uuid=Br(),n.name="",n.parent=null,n.children=[],n.visible=!0,n.position=Ft(),n.rotation=new Lr,n.scale=Vt(1,1,1),n.quaternion=Zn(),n.up=jt(e.DefaultUp),n.modelMatrix=Pe(),n.worldMatrix=Pe(),n.modelMatrixNeedUpdate=!1,n.worldMatrixNeedsUpdate=!1,n.rotation.onChange((function(){n.modelMatrixNeedUpdate=!0})),n}c(e,t);var n=e.prototype;return n.rotateX=function(t){this.rotation.x=t},n.rotateY=function(t){this.rotation.y=t},n.rotateZ=function(t){this.rotation.z=t},n.translate=function(t,e,n){var r=Vt(t,e,n);return this.position=Wt(this.position,this.position,r),this.modelMatrixNeedUpdate=!0,this},n.setPosition=function(t,e,n){var r=Vt(t,e,n);return ue(this.position,r)||(this.position=r,this.modelMatrixNeedUpdate=!0),this},n.lookAt=function(t,e,n){var r=this.up,i=this.position,o=Vt(t,e,n),a=en(Pe(),i,o,r),s=Ze(Zn(),a),u=Ir(Ft(),s);this.rotation.set(kr(u[0]),kr(u[1]),kr(u[2]))},n.setVisible=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.visible!==t&&(this.visible=t,e))for(var n=0,r=this.children.length;n<r;n++)this.children[n].setVisible(t,e)},n.setScale=function(t,e,n){var r=Vt(t,e,n);return ue(this.scale,r)||(this.scale=r,this.modelMatrixNeedUpdate=!0),this},n.updateMatrix=function(){Ie(this.modelMatrix),qn(this.quaternion),tr(this.quaternion,this.rotation.x,this.rotation.y,this.rotation.z),qe(this.modelMatrix,this.quaternion,this.position,this.scale),this.modelMatrixNeedUpdate=!1,this.worldMatrixNeedsUpdate=!0},n.updateWorldMatrix=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!0!==this.modelMatrixNeedUpdate&&!0!==t||this.updateMatrix(),!0===this.worldMatrixNeedsUpdate&&(this.parent?Ue(this.worldMatrix,this.parent.worldMatrix,this.modelMatrix):Oe(this.worldMatrix,this.modelMatrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(var e=0,n=this.children.length;e<n;e++)this.children[e].updateWorldMatrix(t)},n.add=function(t){if(t===this)return console.error("object3D.add: object can't be added as a child of itself. ==> ".concat(t)),this;if(t instanceof Array){for(var e=0,n=t.length;e<n;e++)this.add(t[e]);return this}return t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t)):console.error("Object3D.add: object not an instance of Object3D.",t),this},n.remove=function(t){if(t instanceof Array){for(var e=0,n=t.length;e<n;e++)this.remove(t[e]);return this}var r=this.children.indexOf(t);return-1!==r&&(t.parent=null,this.children.splice(r,1)),this},n.traverse=function(t){t(this),this.children&&this.children.length>0&&this.children.forEach((function(e){e.traverse(t)}))},n.clone=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=new e;if(n.up=jt(this.up),n.scale=jt(this.scale),n.position=jt(this.position),n.rotation=this.rotation.clone(),n.quaternion=sr(this.quaternion),n.modelMatrix=De(this.modelMatrix),n.worldMatrix=De(this.worldMatrix),n.visible=this.visible,this.children.length&&t)for(var r=0,i=this.children.length;r<i;r++)n.add(this.children[r].clone());return n},n.raycast=function(t){return null},e}(Or);Ur.DefaultUp=Vt(0,1,0);var Nr=function(){function t(t,e){this.isBox=!0,this.min=void 0,this.max=void 0,this.min=void 0!==t?t:Vt(1/0,1/0,1/0),this.max=void 0!==e?e:Vt(-1/0,-1/0,-1/0)}var e=t.prototype;return e.set=function(t,e){return Gt(this.min,t),Gt(this.max,e),this},e.setFromBufferAttribute=function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,a=-1/0,s=t.array,u=t.count,h=t.itemSize,c=0;c<u;c++){var l=s[c*h],f=s[c*h+1],d=s[c*h+2];l<e&&(e=l),f<n&&(n=f),d<r&&(r=d),l>i&&(i=l),f>o&&(o=f),d>a&&(a=d)}var p=Vt(e,n,r),v=Vt(i,o,a);return this.set(p,v),this},e.getCenter=function(){return this.isInvalid()?Ft():Vt((this.max[0]+this.min[0])/2,(this.max[1]+this.min[1])/2,(this.max[2]+this.min[2])/2)},e.isInvalid=function(){return this.max[0]<this.min[0]||this.max[1]<this.min[1]||this.max[2]<this.min[2]},t}(),Fr=function(){function t(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.isBufferAttribute=!0,this.name="",this.type=void 0,this.array=void 0,this.itemSize=void 0,this.count=void 0,this.normalized=void 0,this.usage=void 0,this.needUpdate=void 0,Array.isArray(e))throw new TypeError("BufferAttribute: array should be a Typed Array.");if(this.name="BufferAttribute",this.array=e,this.itemSize=n,this.count=void 0!==e?e.length/n:0,this.normalized=!0===i,this.usage=35044,this.needUpdate=!0,void 0===r){var o=this.array;this.type=t.FLOAT,o instanceof Int8Array?this.type=t.BYTE:o instanceof Uint8Array?this.type=t.UNSIGNED_BYTE:o instanceof Int16Array?this.type=t.SHORT:o instanceof Uint16Array?this.type=t.UNSIGNED_SHORT:o instanceof Int32Array?this.type=t.INT:o instanceof Uint32Array&&(this.type=t.UNSIGNED_INT)}else this.type=r}t.isBufferAttribute=function(e){var n=!1;return e&&e instanceof t&&(n=!0),n};var e=t.prototype;return e.setUsage=function(t){return this.usage=t,this},e.setArray=function(t){return this.array.set(t),this},t}();Fr.BYTE=5120,Fr.UNSIGNED_BYTE=5121,Fr.SHORT=5122,Fr.UNSIGNED_SHORT=5123,Fr.INT=5124,Fr.UNSIGNED_INT=5125,Fr.FLOAT=5126;var jr=function(t){function e(e,n,r,i){var o;return(o=t.call(this,new Uint8Array(e),n,r,i)||this).name="Uint8BufferAttribute",o}return c(e,t),e}(Fr),zr=function(t){function e(e,n,r,i){var o;return(o=t.call(this,new Uint16Array(e),n,r,i)||this).name="Uint16BufferAttribute",o}return c(e,t),e}(Fr),Vr=function(t){function e(e,n,r,i){var o;return(o=t.call(this,new Uint32Array(e),n,r,i)||this).name="Uint32BufferAttribute",o}return c(e,t),e}(Fr),Gr=function(t){function e(e,n,r,i){var o;return(o=t.call(this,new Float32Array(e),n,r,i)||this).name="Float32ArrayAttribute",o}return c(e,t),e}(Fr),Wr=function(t){function e(e,n,r,i){var o;if(Array.isArray(e)){var a=function(t){for(var e,n=Number.MAX_VALUE,r=-Number.MAX_VALUE,i=t.length-1;i>=0;i--)n>(e=t[i])&&(n=e),r<e&&(r=e);return{min:n,max:r}}(e);o=new(a.max>65535?Uint32Array:Uint16Array)(e)}else o=e;return t.call(this,o,n,r,i)||this}return c(e,t),e}(Fr),Hr=0,Zr=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).id=Hr++,e.uuid=Br(),e.name="",e.type="BufferGeometry",e.indexes=null,e.attributes={},e.__webglInit=!1,e.groupsNeedUpdate=!1,e.boundingBox=null,e}c(e,t);var n=e.prototype;return n.getIndexes=function(){return this.indexes},n.getCenter=function(){return this.computeBoundingBox(),this.boundingBox?this.boundingBox.getCenter():void 0},n.setIndexes=function(t){return Array.isArray(t)||ArrayBuffer.isView(t)?this.indexes=new Wr(t,1):Wr.isBufferAttribute(t)&&(this.indexes=t),this},n.getAttribute=function(t){return t?this.attributes[t]:this.attributes},n.setAttribute=function(t,e){return t&&Fr.isBufferAttribute(e)&&(this.attributes[t]=e),this},n.deleteAttribute=function(t){return this.attributes[t]&&delete this.attributes[t],this},n.computeBoundingBox=function(){null===this.boundingBox&&(this.boundingBox=new Nr);var t=this.attributes.position;t&&t.isBufferAttribute&&this.boundingBox.setFromBufferAttribute(t)},e}(Or),qr=new be,Yr=new be,Xr=new be,Kr=function(t){function e(e,n){var r;return(r=t.call(this)||this).type="Mesh",r.geometry=void 0,r.material=void 0,r.materialChanged=void 0,r.__webglInit=!1,r.geometry=void 0!==e?e:new Zr,r.material=void 0!==n?n:null,r.materialChanged=!1,r}c(e,t);var n=e.prototype;return n.updateMaterial=function(t){this.material&&t.isMaterial&&t.uuid!==this.material.uuid&&(this.material=t,this.materialChanged=!0)},n.raycast=function(t){var e=this.geometry,n=e.indexes&&e.indexes.array,r=e.attributes.position.array;if(!n)return null;for(var i=0;i<n.length;i+=3){var o=3*n[i],a=3*n[i+1],s=3*n[i+2],u=qr.set(r[o],r[o+1],r[o+2]).transform(this.worldMatrix),h=Yr.set(r[a],r[a+1],r[a+2]).transform(this.worldMatrix),c=Xr.set(r[s],r[s+1],r[s+2]).transform(this.worldMatrix),l=t.intersectTriangle(u,h,c);if(l)return{distance:l.distance,point:l.point,object:this}}return null},e}(Ur),Qr=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).type="Scene",e.isScene=!0,e.autoUpdate=!0,e}c(e,t);var n=e.prototype;return n.updateWorldMatrix=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!0===this.autoUpdate&&t.prototype.updateWorldMatrix.call(this,e)},n.clone=function(n){return void 0===n&&(n=new e),t.prototype.clone.call(this,n),n.autoUpdate=this.autoUpdate,n},e}(Ur),Jr=function(t){function e(){var e;return(e=t.call(this)||this).type="Geometry",e.vertices=[],e.verticesBufferData=new Float32Array,e.indicesBufferData=new Uint16Array,e.uvtsBufferData=new Float32Array,e.groupsNeedUpdate=!1,e}return c(e,t),e}(Or),$r=new be,ti=new be,ei=new be,ni=new be,ri=new be,ii=function(){function t(t,e){this.origin=void 0,this.direction=void 0,this.origin=t||new be,this.direction=e||new be(0,0,-1)}var e=t.prototype;return e.set=function(t,e){return this.origin.copy(t),this.direction.copy(e),this},e.setFromCamera=function(t,e){var n=new be(e.position[0],e.position[1],e.position[2]),r=(new Vn).fromArray(e.projectionMatrix),i=e.worldMatrix,o=new Me(t[0],t[1],.5,1).transform(r).transform(i),a=o.x,s=o.y,u=o.z,h=new be(a,s,u).sub(n).normalize();this.set(n,h)},e.getPointByLen=function(t,e){var n=void 0!==e?e:new be;return n.copy(this.direction),n.scale(t),n.add(this.origin),n},e.intersectTriangle_Old=function(t,e,n){var r,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0,a=$r.copy(e).subtract(t),s=ti.copy(n).subtract(t),u=ei.copy(a).cross(s),h=ni.copy(this.origin).subtract(t),c=this.direction.dot(u);if(0<c){if(i)return null;r=1}else{if(!(0>c))return null;r=-1,c=-c}s.copy((new be).copy(h).cross(s));var l=r*this.direction.dot(s);if(0>l)return null;var f=r*this.direction.dot((new be).copy(h).cross(a));if(0>f)return null;if(l+f>c)return null;var d=-r*h.dot(u);return 0>d?null:this.getPointByLen(d/c,o)},e.intersectTriangle=function(t,e,n){var r=arguments.length>4?arguments[4]:void 0,i=1e-6,o=$r.subVectors(e,t),a=ti.subVectors(n,t),s=ei.copy(this.direction).cross(a),u=o.dot(s);if(u>-i&&u<i)return null;var h=1/u,c=ni.subVectors(this.origin,t),l=h*c.dot(s);if(l<0||l>1)return null;var f=ri.copy(c).cross(o),d=h*this.direction.dot(f);if(d<0||l+d>1)return null;var p=a.dot(f)*h;return p>i?{distance:p,point:this.getPointByLen(p,r)}:null},e.intersectSphere=function(t,e,n){var r=(new be).subtract(t,this.origin),i=r.dot(this.direction),o=r.dot(r)-i*i,a=e*e;if(o>a)return null;var s=Math.sqrt(a-o),u=i-s,h=i+s;return 0>u&&0>h?null:0>u?this.getPointByLen(h,n):this.getPointByLen(u,n)},t}();function oi(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return ai(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ai(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ai(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var si=function(){function t(t,e,n,r){this.ray=void 0,this.near=void 0,this.far=void 0,this.ray=new ii(t,e),this.near=n||0,this.far=r||1/0}var e=t.prototype;return e.set=function(t,e){this.ray.set(t,e)},e.setFromCamera=function(t,e){var n=new be(e.position[0],e.position[1],e.position[2]),r=(new Vn).fromArray(e.projectionMatrix).invert(),i=e.worldMatrix,o=new Me(t[0],t[1],.5,1).transform(r).transform(i),a=o.x,s=o.y,u=o.z,h=new be(a,s,u).sub(n).normalize();this.set(n,h)},e.pick=function(t){var e,n=this.ray,r=[],i=oi([].concat(t));try{for(i.s();!(e=i.n()).done;){var o=e.value.raycast(n);o&&r.push(o)}}catch(t){i.e(t)}finally{i.f()}return r.sort((function(t,e){return t.distance-e.distance})),r},t}(),ui=function(t){function e(n){var r;return(r=t.call(this)||this).image=void 0,r.flipY=!0,r.premultiplyAlpha=!1,r.needsUpdate=!0,r.glTexture=null,r.isTexture=!0,r.gl=null,r.__textureInit=!1,r.clone=function(t){return void 0===t&&(t=new e),t.image=r.image,t.flipY=r.flipY,t},r.destory=function(){r.emit("destory",r.glTexture)},r.destoryTexture=function(){r.glTexture&&r.gl&&(r.off("destory",r.destoryTexture),r.gl.deleteTexture(r.glTexture))},void 0!==n&&(r.image=n),r}return c(e,t),e.prototype.init=function(t){!0!==this.__textureInit&&(this.gl=t,this.glTexture=t.createTexture(),this.on("destory",this.destoryTexture),this.__textureInit=!0)},e}(Or),hi=function(t){function e(e){var n;return(n=t.call(this)||this).isCube=!0,n.image=e||[],n.flipY=!1,n}return c(e,t),e}(ui),ci=function(){function t(t,e,n){var r=this;this.gl=void 0,this.maxTextureSize=void 0,this.maxTextures=void 0,this.usedTextureUnits=0,this.getTextureUnit=function(){var t=r.usedTextureUnits;return r.usedTextureUnits>=r.maxTextures?r.usedTextureUnits=0:r.usedTextureUnits+=1,t},this.resetUsedTextureUnits=function(){r.usedTextureUnits=0},this.setTexture=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t instanceof hi)r.setCubeTexture(t,e);else{var n=r.gl;n.activeTexture(n.TEXTURE0+e),t.needsUpdate?(t.init(n),r.uploadTexture(n,t)):n.bindTexture(n.TEXTURE_2D,t.glTexture)}},this.setTextureForRenderTarget=function(t){var e=r.gl;t.glTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,t.glTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),r.setTextureParameter(e);var n=e.RGBA,i=e.RGBA,o=e.UNSIGNED_BYTE;e.texImage2D(e.TEXTURE_2D,0,n,t.width,t.height,0,i,o,null)},this.uploadTexture=function(t,e){e.init(t),t.bindTexture(t.TEXTURE_2D,e.glTexture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),r.setTextureParameter(t),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e.image),e.needsUpdate=!1},this.setTextureParameter=function(t){t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)},this.gl=t,this.maxTextureSize=n,this.maxTextures=e}return t.prototype.setCubeTexture=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t.image;if(6!==n.length)throw new Error("[setCubeTexture] CubeTexture need six images, but get\n                ".concat(n.length,"\n            "));var r=this.gl;if(t.needsUpdate){t.init(r),r.activeTexture(r.TEXTURE0+e),r.bindTexture(r.TEXTURE_CUBE_MAP,t.glTexture),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t.flipY),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);for(var i=0;i<6;i++){var o=n[i];r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,o)}t.needsUpdate=!1}else r.bindTexture(r.TEXTURE_CUBE_MAP,t.glTexture)},t}(),li=n((function(t){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r},t.exports.__esModule=!0,t.exports.default=t.exports}));e(li);var fi=n((function(t){t.exports=function(t){if(Array.isArray(t))return li(t)},t.exports.__esModule=!0,t.exports.default=t.exports}));e(fi);var di=n((function(t){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.__esModule=!0,t.exports.default=t.exports}));e(di);var pi=n((function(t){t.exports=function(t,e){if(t){if("string"==typeof t)return li(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?li(t,e):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports}));e(pi);var vi=n((function(t){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports}));e(vi);var mi=e(n((function(t){t.exports=function(t){return fi(t)||di(t)||pi(t)||vi()},t.exports.__esModule=!0,t.exports.default=t.exports}))),gi=n((function(t){t.exports=function(t){if(Array.isArray(t))return t},t.exports.__esModule=!0,t.exports.default=t.exports}));e(gi);var yi=n((function(t){t.exports=function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}},t.exports.__esModule=!0,t.exports.default=t.exports}));e(yi);var _i=n((function(t){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports}));e(_i);var xi=e(n((function(t){t.exports=function(t,e){return gi(t)||yi(t,e)||pi(t,e)||_i()},t.exports.__esModule=!0,t.exports.default=t.exports}))),bi=function(t,e,n){if(t&&e&&e.length)for(var r=e.length,i=0;i<r;i++){var o=void 0,a=void 0,s=void 0,u=e[i],h=xi(u,2),c=h[0],l=h[1],f=c.type,d=c.value;switch(c.type){case"1i":case"1f":t["uniform".concat(f)](l,c.value);break;case"2f":case"3f":case"4f":t["uniform".concat(f)].apply(t,[l].concat(mi(d)));break;case"t":if(!(o=c.value)||!o.image&&!o.glTexture)break;a=n.getTextureUnit(),t.uniform1i(l,a),n.setTexture(o,a);break;case"tv":s=[];for(var p=c.value,v=0,m=p.length;v<m;v++)s[v]=n.getTextureUnit();t.uniform1iv(l,s);for(var g=0,y=p.length;g<y;g++)(o=p[g])&&(o.image||o.glTexture)&&(a=s[g],n.setTexture(o,a));break;case"mat4fv":t.uniformMatrix4fv(l,!1,c.value);break;default:console.warn("[UniformOperation] Unknown uniform type: ".concat(f))}}};var Mi="\nvoid main() {\n    gl_Position = mvpMatrix * vec4(position, 1.0);\n}\n",wi="\nvoid main() {\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n",Ei=0,Ti=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).isMaterial=!0,e.id=Ei++,e.type="Material",e.name="",e.uuid=Br(),e.uniforms={},e.vertexShader=Mi,e.fragmentShader=wi,e.program=null,e.depthTest=!0,e.visible=!0,e.opacity=1,e.needsUpdate=!0,e.uniformsList=[],e}c(e,t);var n=e.prototype;return n.setValues=function(t){if(void 0!==t)for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var n=t[e];if(void 0===n){console.warn("Material: '"+e+"' parameter is undefined.");continue}if(void 0===this[e]){console.warn("".concat(this.type,": ").concat(e," is not a property of this material."));continue}var r="set"+e.charAt(0).toUpperCase()+e.slice(1);"function"==typeof this[r]?this[r](n):this[e]=n}},n.clone=function(){return(new e).copy(this)},n.copy=function(t){return this.uniforms=function(t){var e,n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))for(var i in n[r]={},t[r])Object.prototype.hasOwnProperty.call(t[r],i)&&((e=t[r][i])&&e.isTexture?n[r][i]=e.clone():n[r][i]=e instanceof Array?e.slice(0):e);return n}(t.uniforms),this.depthTest=t.depthTest,this.visible=t.visible,this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this},o(e,[{key:"defines",get:function(){return""}}]),e}(Or),Ai={useColor:"USE_COLOR",useUV:"NEED_UV"},Ci=function(){function t(){this.useColor=!1,this.useUV=!1}return t.prototype.getDefines=function(){for(var t=[],e=0,n=Object.keys(this);e<n.length;e++){var r=n[e];Ai[r]&&!0===this[r]&&t.push("#define ".concat(Ai[r]))}return t.push(""),t.join("\n")},t}(),Ri="\n#ifdef NEED_UV\n    varying vec2 vUV;\n#endif\nvoid main(void) {\n    gl_Position = mvpMatrix * vec4(position, 1.0);\n    #ifdef NEED_UV\n        vUV = uv;\n    #endif\n}\n",Si="\nprecision mediump float;\n#ifdef NEED_UV\n    varying vec2 vUV;\n    uniform sampler2D uSampler;\n#endif\n#ifdef USE_COLOR\n    uniform vec4 uColor;\n#endif\nuniform float uOpacity;\nvoid main(void) {\n    vec4 finalColor;\n    vec4 defaultColor = vec4(1.0, 0.0, 0.0, 1.0);\n    finalColor = defaultColor;\n    #ifdef USE_COLOR\n        finalColor = uColor;\n    #endif\n    #ifdef NEED_UV\n        finalColor = texture2D(uSampler, vUV);\n    #endif\n    gl_FragColor = vec4(finalColor.rgb, finalColor.a * uOpacity);\n}\n",Pi=function(t){function e(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(e=t.call(this)||this).map=null,e.color=[1,0,0,1],e.type="BasicMaterial",e.opacity=1,e.depthTest=!0,e.vertexShader=Ri,e.fragmentShader=Si,e.uniforms={uSampler:{type:"t",value:null},uColor:{type:"4f",value:[1,0,0,1]},uOpacity:{type:"1f",value:e.opacity}},e.setValues(n),e}c(e,t);var n=e.prototype;return n.setOpacity=function(t){this.uniforms.uOpacity.value=t,this.opacity=t},n.setColor=function(t){!Array.isArray(t)||t.length<4||(this.uniforms.uColor.value=t,this.color=t)},n.setMap=function(t){var e=this;t&&(t instanceof Promise?t.then((function(t){e.uniforms.uSampler.value=t instanceof ui==!0?t:new ui(t)})).catch((function(t){return console.error(t)})):!0===t.isTexture&&(this.uniforms.uSampler.value=t),this.map=t)},o(e,[{key:"defines",get:function(){var t=new Ci;return t.useColor=!!this.color,t.useUV=!!this.map,t.getDefines()}}]),e}(Ti),Di=function(t){var e=this;this.gl=void 0,this.newAttributes=new Uint8Array(16),this.enabledAttributes=new Uint8Array(16),this.currentDepthTest=!1,this.currentDepthWrite=!0,this.currentColorWrite=!0,this.currentDoubleSided=!1,this.currentFlipSided=!1,this.initAttributes=function(){for(var t=0,n=e.newAttributes.length;t<n;t++)e.newAttributes[t]=0},this.enableAttribute=function(t){var n=e.gl,r=e.newAttributes,i=e.enabledAttributes;r[t]=1,0===i[t]&&(n.enableVertexAttribArray(t),i[t]=1)},this.disableAttribute=function(t){var n=e.gl,r=e.newAttributes,i=e.enabledAttributes;r[t]=0,1===i[t]&&(n.disableVertexAttribArray(t),i[t]=0)},this.disableUnusedAttributes=function(){for(var t=e.gl,n=e.newAttributes,r=e.enabledAttributes,i=0,o=r.length;i<o;i++)r[i]!==n[i]&&(t.disableVertexAttribArray(i),r[i]=0)},this.setDepthTest=function(t){var n=e.gl;e.currentDepthTest!==t&&(t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),e.currentDepthTest=t)},this.setDepthWrite=function(t){var n=e.gl;e.currentDepthWrite!==t&&(n.depthMask(t),e.currentDepthWrite=t)},this.setColorWrite=function(t){var n=e.gl;e.currentColorWrite!==t&&(n.colorMask(t,t,t,t),e.currentColorWrite=t)},this.setDefaultGLState=function(t,n,r,i){var o=e.gl;o.clearColor(229/255,227/255,223/255,1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),o.clearDepth(1),o.clearStencil(0),o.disable(o.DEPTH_TEST),o.depthFunc(o.LEQUAL),o.frontFace(o.CCW),o.disable(o.CULL_FACE),o.depthMask(!0),o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.viewport(t,n,r,i)},this.setDoubleSided=function(t){var n=e.gl;e.currentDoubleSided!==t&&(t?n.disable(n.CULL_FACE):n.enable(n.CULL_FACE),e.currentDoubleSided=t)},this.setFlipSided=function(t){var n=e.gl;e.currentFlipSided!==t&&(t?n.frontFace(n.CW):n.frontFace(n.CCW),e.currentFlipSided=t)},this.reset=function(){for(var t=e.enabledAttributes,n=0;n<t.length;n++)t[n]=0;e.currentDepthTest=!1,e.currentDepthWrite=!0,e.currentColorWrite=!0,e.currentDoubleSided=!1,e.currentFlipSided=!1},this.gl=t},Oi=function(t){var e=this;this.maxTextures=void 0,this.maxTextureSize=void 0,this.maxVerticesOneDraw=void 0,this.maxVertexShaderTextureUnits=void 0,this.maxFragmentShaderTextureUnits=void 0,this.gl=void 0,this.getMaxTextures=function(){var t=e.gl;return t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS)},this.getLineWidthRange=function(){var t=e.gl;return t.getParameter(t.ALIASED_LINE_WIDTH_RANGE)},this.getMaxVertexShaderTextureUnits=function(){var t=e.gl;return t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)},this.getMaxFragmentShaderTextureUnits=function(){var t=e.gl;return t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)},this.getMaxTextureSize=function(){var t=e.gl;return t.getParameter(t.MAX_TEXTURE_SIZE)},this.getMaxVerticesOneDraw=function(){return e.gl.getExtension("OES_element_index_uint")?4294967296:65535},this.getLegalPrecision=function(t){var n=e.gl,r=n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT),i=n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT),o=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT),a=n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT),s=r&&o&&r.precision>0&&o.precision>0,u=i&&a&&i.precision>0&&a.precision>0;return"highp"!==t||s?"mediump"!==t||u||(t="lowp",console.warn("[WebGLCapability] mediump is not supported, using lowp by default.")):u?(t="mediump",console.warn("[WebGLCapability] highp is not supported, using mediump by default.")):(t="lowp",console.warn("[WebGLCapability] highp and mediump is not supported, using lowp by default.")),t},this.gl=t,this.maxTextures=this.getMaxTextures(),this.maxVertexShaderTextureUnits=this.getMaxVertexShaderTextureUnits(),this.maxFragmentShaderTextureUnits=this.getMaxFragmentShaderTextureUnits(),this.maxTextureSize=this.getMaxTextureSize(),this.maxVerticesOneDraw=this.getMaxVerticesOneDraw()},Ii=0,Li=function(t,e,n){var r=t.createShader(n);if(!r)throw new Error("Something went wrong while compile the shader.");return t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)||console.error("Error compiling shader: ".concat(t.getShaderInfoLog(r))),r},Bi=function(){function t(t,e,n){this.usedTimes=void 0,this.id=void 0,this.code=void 0,this.program=void 0,this.attributes=void 0,this.uniforms=void 0,this.gl=void 0,this.parameters=void 0,this.precision=void 0,this.gl=t,this.parameters=e,this.precision=n.precision||"highp",this.usedTimes=1,this.id=Ii++;var r=e.defines,i=void 0===r?"":r,o=e.vertexShader,a=e.fragmentShader;this.code=i+o+a,this.program=this.createProgram(t,e,this.precision),this.attributes=this.fetchAttributes(t,this.program),this.uniforms=function(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i={},o=r.length;if(!o)return i;for(var a=0;a<o;a++)i[n=r[a]]=t.getUniformLocation(e,n);return i}(t,this.program,this.getFullUniforms(e.uniforms))}var e=t.prototype;return e.getAttributes=function(){return this.attributes},e.getUniforms=function(){return this.uniforms},e.createProgram=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"highp",r=e.vertexShader,i=e.fragmentShader,o=e.defines,a=void 0===o?"":o,s=["precision ".concat(n," float;"),"uniform mat4 modelMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat4 mvpMatrix;","attribute vec3 position;","attribute vec2 uv;",""].join("\n"),u=t.createProgram(),h=["precision ".concat(n," float;"),""].join("\n"),c=Li(t,s+a+r,t.VERTEX_SHADER),l=Li(t,h+a+i,t.FRAGMENT_SHADER);if(!u)throw new Error("Something went wrong while createProgram.");return t.attachShader(u,c),t.attachShader(u,l),t.linkProgram(u),u},e.fetchAttributes=function(t,e){for(var n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),i=0;i<r;i++){var o=t.getActiveAttrib(e,i);if(!o)throw new Error("Something went wrong while getActiveAttrib.");var a=o.name;n[a]=t.getAttribLocation(e,a)}return n},e.getFullUniforms=function(t){var e=["mvpMatrix","modelMatrix","projectionMatrix","viewMatrix"];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.push(n);return e},t}(),ki={canvas:document.createElement("canvas"),context:void 0,width:0,height:0,pixelRatio:1,precision:"highp",alpha:!1,premultipliedAlpha:!0,antialias:!0,stencil:!0,depth:!0,preserveDrawingBuffer:!1},Ui=function(){function t(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.state=void 0,this.domElement=void 0,this.capability=void 0,this.textureOperation=void 0,this._gl=void 0,this.parameters=void 0,this.programs=void 0,this.viewportInfo=void 0,this.autoDisposeProgram=!0,this.currentCacheState=void 0,this.setSize=function(e,n){var r=t.parameters,i=r.canvas,o=r.pixelRatio;i.style.width="".concat(e,"px"),i.style.height="".concat(n,"px"),i.width=e*o,i.height=n*o,t.setViewport(0,0,e,n)},this.setViewport=function(e,n,r,i){var o=t.parameters.pixelRatio,a=t.viewportInfo;a.x=e*o,a.y=n*o,a.width=r*o,a.height=i*o,t._gl.viewport.apply(t._gl,Object.values(a))},this.setClearColor=function(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;!0===t.parameters.premultipliedAlpha&&(e*=i,n*=i,r*=i),t._gl.clearColor(e,n,r,i)},this.getContext=function(){return t._gl},this.forceContextLoss=function(){try{var e=t._gl.getExtension("WEBGL_lose_context");e&&e.loseContext()}catch(t){console.error("[WebGLRenderer] WEBGL_lose_context error: ",t)}},this.initScene=function(e){!0===e.visible&&e.traverse((function(e){!0===e.visible&&e instanceof Kr&&t.initMesh(e)}))},this.initMesh=function(e){!0===e.visible&&(!0!==e.__webglInit&&(e.__webglInit=!0,e.addEventListener("removed",t.onObjectRemoved)),e.geometry&&t.checkAndUpdateGeometry(e.geometry),e.children&&e.children.length>0&&e.children.forEach((function(e){t.initMesh(e)})))},this.checkAndUpdateGeometry=function(e){!0!==e.__webglInit&&(e.__webglInit=!0,e.addEventListener("removed",t.onGeometryRemove),e.groupsNeedUpdate=!0),!0===e.groupsNeedUpdate&&("BufferGeometry"===e.type?t.updateBufferGeometry(e):t.updateGeometryBuffer(e,t._gl.STATIC_DRAW),e.groupsNeedUpdate=!1)},this.updateGeometryBuffer=function(e,n){var r=e.verticesBufferData,i=e.uvtsBufferData,o=e.indicesBufferData,a=e.borderVerticesBufferData,s=t._gl;0<r.length&&(e.glVerticesBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,e.glVerticesBuffer),s.bufferData(s.ARRAY_BUFFER,r,n)),0<i.length&&(e.glUvtsBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,e.glUvtsBuffer),s.bufferData(s.ARRAY_BUFFER,i,n)),0<o.length&&(e.glIndicesBuffer=s.createBuffer(),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.glIndicesBuffer),s.bufferData(s.ELEMENT_ARRAY_BUFFER,o,n)),!0===e.showBorder&&void 0!==a&&0<a.length&&(e.glBorderVerticesBuffer=s.createBuffer(),s.bindBuffer(s.ARRAY_BUFFER,e.glBorderVerticesBuffer),s.bufferData(s.ARRAY_BUFFER,e.borderVerticesBufferData,n))},this.renderScene=function(e,n){!0===e.visible&&e.traverse((function(e){e instanceof Kr&&(t.renderObject(e,n),e.children.length&&e.children.forEach((function(e){t.renderObject(e,n)})))}))},this.renderObject=function(e,n){var r=e.material,i=e.geometry;if(!0===e.visible&&r&&i&&!0===r.visible){t.state.setDepthTest(r.depthTest);var o=!1,a=t.setProgram(n,r,e);o="BufferGeometry"===i.type?t.updateVerticesAttribute2(a,i,!1):t.updateVerticesAttribute(a,i,!1),t.renderGeometryWithProgram(a,i,r,o)}},this.setProgram=function(e,n,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=t._gl;t.textureOperation.resetUsedTextureUnits(),t.checkAndUpdateMaterial(r.material);var a=n.program,s=a.getUniforms();return a.id!==t.currentCacheState.programId&&(o.useProgram(a.program),t.currentCacheState.programId=a.id),!1!==i&&bi(o,n.uniformsList,t.textureOperation),t.updateMVPMatrix(s,e,r),a},this.checkAndUpdateMaterial=function(e){void 0!==e&&(!0!==e.__webglInit&&(e.__webglInit=!0,e.addEventListener("removed",t.onMaterialRomove),e.needsUpdate=!0),!0===e.needsUpdate&&(t.updateMaterial(e),e.needsUpdate=!1))},this.updateMaterial=function(e){e.program&&t.removeMaterial(e);for(var n=null,r=t.programs.length,i=e.defines,o=(void 0===i?"":i)+e.vertexShader+e.fragmentShader,a=r-1;a>=0;a--){var s=t.programs[a];if(s.code===o){(n=s).usedTimes++;break}}if(null===n){var u={uniforms:e.uniforms,defines:e.defines||"",vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};n=new Bi(t._gl,u,{precision:t.parameters.precision}),t.programs.push(n)}e.program=n,e.uniformsList=[];var h=0,c=n.uniforms,l=e.uniforms;for(var f in l)if(Object.prototype.hasOwnProperty.call(l,f)){var d=c[f];d&&(e.uniformsList[h]=[l[f],d],h++)}},this.updateMVPMatrix=function(e,n,r){if(void 0!==e.mvpMatrix){var i=De(n.projectionMatrix);Ue(i,i,n.viewMatrix),Ue(i,i,r.worldMatrix),t._gl.uniformMatrix4fv(e.mvpMatrix,!1,i),t._gl.uniformMatrix4fv(e.modelMatrix,!1,r.worldMatrix),t._gl.uniformMatrix4fv(e.viewMatrix,!1,n.viewMatrix),t._gl.uniformMatrix4fv(e.projectionMatrix,!1,n.projectionMatrix)}t.currentCacheState.camera=n},this.renderGeometryWithProgram=function(e,n,r){var i=t._gl,o=t.currentCacheState.curRenderTarget;if(e.uniforms.showDebugLine&&i.uniform1i(e.uniforms.showDebugLine,0),"BufferGeometry"===n.type?i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n.indexesBuffer):i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n.glIndicesBuffer),null!==o&&void 0!==o.glFrameBuffer){var a=i.checkFramebufferStatus(i.FRAMEBUFFER);if(i.FRAMEBUFFER_COMPLETE!==a)return t.removeRenderTarget(o),void(t.currentCacheState.curRenderTarget=null)}n.indexes&&n.indexes.count>0?i.drawElements(i.TRIANGLES,n.indexes.count,i.UNSIGNED_SHORT,0):i.drawArrays(i.TRIANGLES,0,n.attributes.position.count)},this.onObjectRemoved=function(e){e.target.traverse((function(e){e.removeEventListener("removed",t.onObjectRemoved),t.removeObject(e)}))},this.onGeometryRemove=function(e){var n=e.target;n.removeEventListener("removed",t.onGeometryRemove),t.removeGeometry(n)},this.onMaterialRomove=function(e){var n=e.target;n.removeEventListener("removed",t.onMaterialRomove),t.removeMaterial(n)},this.onRenderTargetRemove=function(e){var n=e.target;n.removeEventListener("removed",t.onRenderTargetRemove),t.removeRenderTarget(n)},this.removeObject=function(t){t.geometry&&delete t.geometry.__webglInit,delete t.__webglInit},this.removeGeometry=function(e){delete e.__webglInit,t.deleteBuffers(e),t.currentCacheState.geometryProgramId=null},this.deleteBuffers=function(e){["glVerticesBuffer","glUvtsBuffer","glIndicesBuffer","glBorderVerticesBuffer"].forEach((function(n){t._gl.deleteBuffer(e[n]),void 0!==e[n]&&0<e[n]&&delete e[n]}))},this.removeMaterial=function(e){var n=e.program.program;if(n){e.program=null;for(var r=t.programs,i=r.length-1;i>=0;i--){var o=r[i];if(o.program===n){o.usedTimes--,0===o.usedTimes&&!1!==t.autoDisposeProgram&&(r.splice(i,1),t._gl.deleteProgram(n));break}}}},this.removeRenderTarget=function(e){t._gl.deleteRenderbuffer(e.glDepthBuffer),e.glDepthBuffer=null,t._gl.deleteTexture(e.glTexture),e.glTexture=null,t._gl.deleteFramebuffer(e.glFrameBuffer),e.glFrameBuffer=null},this.parameters=Object.assign({},ki,e),e&&!e.canvas&&(this.parameters.canvas=document.createElement("canvas")),this.initGL(),this.programs=[],this.viewportInfo={x:0,y:0,width:this.parameters.canvas.width,height:this.parameters.canvas.height},this.parameters.width&&this.parameters.height&&this.setSize(this.parameters.width,this.parameters.height),this.domElement=this.parameters.canvas,this.state=new Di(this._gl),this.state.setDefaultGLState.apply(this.state,Object.values(this.viewportInfo)),this.currentCacheState={programId:null,geometryProgramId:null,materialId:null,camera:null,curRenderTarget:null},this.capability=new Oi(this._gl);var n=this.capability.maxTextures,r=this.capability.maxTextureSize;this.textureOperation=new ci(this._gl,n,r)}var e=t.prototype;return e.clearBuffer=function(){var t=this._gl;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},e.initGL=function(){var t=this,e=this.parameters,n=e.canvas,r=e.context,i=e.alpha,o=e.depth,a=e.stencil,s=e.antialias,u=e.premultipliedAlpha,h=e.preserveDrawingBuffer;try{var c={alpha:i,depth:o,stencil:a,antialias:s,premultipliedAlpha:u,preserveDrawingBuffer:h},l=r||n.getContext("webgl",c)||n.getContext("experimental-webgl",c)||n.getContext("moz-webgl",c)||n.getContext("webkit-3d",c);if(!l)throw null!==n.getContext?"Error creating WebGL context with your provided attributes.":"Error creating WebGL context.";this._gl=l,n.addEventListener("webglcontextlost",(function(e){e.preventDefault(),void 0!==t.state&&(t.resetGLState(),t.state.setDefaultGLState.apply(t.state,Object.values(t.viewportInfo)))}),!1)}catch(t){console.error("[WebGLRenderer] Create webgl error: ",t)}},e.resetGLState=function(){this.currentCacheState={programId:null,geometryProgramId:null,materialId:null,camera:null,curRenderTarget:null},this.state.reset()},e.setRenderTarget=function(t){var e=this._gl;void 0!==t&&null===t.glFrameBuffer&&(t.addEventListener("removed",this.onRenderTargetRemove),t.glFrameBuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,t.glFrameBuffer),this.textureOperation.setTextureForRenderTarget(t),t.glDepthBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,t.glDepthBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.width,t.height),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.glTexture,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t.glDepthBuffer),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null))},e.render=function(t,e,n){if(e.isCamera){var r=this._gl;if(t.updateWorldMatrix(),e.updateWorldMatrix(),e.updateProjectionMatrix(),this.currentCacheState.camera=null,void 0!==n)this.setRenderTarget(n),this.currentCacheState.curRenderTarget=n,r.bindFramebuffer(r.FRAMEBUFFER,n.glFrameBuffer),r.viewport(0,0,n.width,n.height);else{var i=this.viewportInfo,o=i.width,a=i.height;this.currentCacheState.curRenderTarget=null,r.bindFramebuffer(r.FRAMEBUFFER,null),r.viewport(0,0,o,a)}this.initScene(t),this.renderScene(t,e)}else console.error("[WebGLRenderer]  Camera is not leagal.")},e.updateBufferGeometry=function(t){var e=this._gl,n=t.getIndexes(),r=t.getAttribute();for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){var o=i+"Buffer",a=r[i],s=a.array,u=a.usage;t[o]=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t[o]),e.bufferData(e.ARRAY_BUFFER,s,u)}n&&(t.indexesBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.indexesBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,n.array,n.usage))},e.updateVerticesAttribute2=function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this._gl,i=!1,o="".concat(e.id,"_").concat(t.id);if(o!==this.currentCacheState.geometryProgramId){this.currentCacheState.geometryProgramId=o,this.state.initAttributes(),i=!0;var a=e.getAttribute();for(var s in a)if(Object.prototype.hasOwnProperty.call(a,s)){var u=s+"Buffer",h=a[s],c=h.itemSize,l=h.type,f=h.normalized;0<=t.attributes[s]&&(!0!==n&&(r.bindBuffer(r.ARRAY_BUFFER,e[u]),r.vertexAttribPointer(t.attributes[s],c,l,f,0,0)),this.state.enableAttribute(t.attributes[s]))}}return this.state.disableUnusedAttributes(),i},e.updateVerticesAttribute=function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this._gl,i=!1,o="".concat(e.id,"_").concat(t.id);if(o!==this.currentCacheState.geometryProgramId){this.currentCacheState.geometryProgramId=o,this.state.initAttributes(),i=!0;var a=t.getAttributes();0<=a.position&&(!0!==n&&(r.bindBuffer(r.ARRAY_BUFFER,e.glVerticesBuffer),r.vertexAttribPointer(a.position,3,r.FLOAT,!1,0,0)),this.state.enableAttribute(a.position)),0<=a.uv&&void 0!==e.glUvtsBuffer&&(r.bindBuffer(r.ARRAY_BUFFER,e.glUvtsBuffer),r.vertexAttribPointer(a.uv,2,r.FLOAT,!1,0,0),this.state.enableAttribute(a.uv))}return this.state.disableUnusedAttributes(),i},t}(),Ni=function(t){function e(e,n,r,i,o,a){var s;switch((s=t.call(this)||this).addIntoBuffer=function(t,e,n){t[n]=e[0],t[n+1]=e[1],t[n+2]=e[2]},s.get3DVertex=function(t,e){var n;switch(e){case"x":n=Vt(0,t[0],t[1]);break;case"y":n=Vt(t[0],0,t[1]);break;default:n=Vt(t[0],t[1],0)}return n},s.zeroAxis=void 0!==o?o:"z",s.zeroAxis){case"x":s.normal=Vt(-1,0,0);break;case"y":default:s.normal=Vt(0,-1,0);break;case"z":s.normal=Vt(0,0,-1)}a=void 0!==a?a:{},s.showBorder=!(!1===a.showBorder),s.borderWidth=void 0!==a.borderWidth?a.borderWidth:1,s.borderColor=void 0!==a.borderColor?a.borderColor:[0,0,0,1];var u,h,c,l=.5*e,f=.5*n,d=r||1,p=i||1,v=e/d,m=n/p,g=(d+1)*(p+1);s.verticesBufferData=new Float32Array(3*g),s.uvtsBufferData=new Float32Array(2*g),s.indicesBufferData=new(g>65535?Uint32Array:Uint16Array)(d*p*6);for(var y=0,_=0,x=0;x<=p;x++){u=x*m-f;for(var b=0;b<=d;b++)c=_t(b*v-l,u),h=s.get3DVertex(c,s.zeroAxis),s.vertices.push(h),s.addIntoBuffer(s.verticesBufferData,h,y),s.uvtsBufferData[_]=b/d,s.uvtsBufferData[_+1]=1-x/p,y+=3,_+=2}for(var M,w,E,T,A=0,C=0;C<p;C++)for(var R=0;R<d;R++)M=R+(d+1)*C,w=R+(d+1)*(C+1),E=R+1+(d+1)*(C+1),T=R+1+(d+1)*C,s.addIntoBuffer(s.indicesBufferData,[M,w,E],A),s.addIntoBuffer(s.indicesBufferData,[M,E,T],A+3),A+=6;s.borderIndicesBufferData=new Uint16Array(4),s.borderIndicesBufferData[0]=0,s.borderIndicesBufferData[1]=d,s.borderIndicesBufferData[2]=(d+1)*p,s.borderIndicesBufferData[3]=(d+1)*(p+1)-1;var S=0;s.borderVerticesBufferData=new Float32Array(6*(d+p));for(var P=0;P<g;P+=d+1)s.addIntoBuffer(s.borderVerticesBufferData,s.vertices[P],S),S+=3;for(var D=(d+1)*p+1;D<g;D++)s.addIntoBuffer(s.borderVerticesBufferData,s.vertices[D],S),S+=3;for(var O=(d+1)*p-1;O>0;O-=d+1)s.addIntoBuffer(s.borderVerticesBufferData,s.vertices[O],S),S+=3;for(var I=d-1;I>0;I--)s.addIntoBuffer(s.borderVerticesBufferData,s.vertices[I],S),S+=3;return s}return c(e,t),e}(Jr),Fi="z",ji=function(t){function e(n,r,i,o){var a,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};a=t.call(this)||this;var u=e.buildPlane(n,r,i,o,s),h=u.uvs,c=u.indices,l=u.normals,f=u.vertices;return a.name="PlaneBufferGeometry",a.setAttribute("position",new Gr(f,3)),a.setAttribute("normals",new Gr(l,3)),a.setAttribute("uv",new Gr(h,2)),a.setIndexes(c),a}return c(e,t),e.buildPlane=function(t,n,r,i){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=o.normalAxis,s=void 0===a?Fi:a,u=o.useBack,h=void 0!==u&&u,c=o.normalDest,l=void 0===c?0:c,f=.5*t,d=.5*n,p=r||1,v=i||1,m=t/p,g=n/v,y=e.getNormal(s,h),_=[],x=[],b=[],M=[],w=0;w<=v;w++)for(var E=w*g-d,T=0;T<=p;T++){var A=T*m-f,C=e.get3DVertex([A,E],s,l);b.push.apply(b,mi(C)),_.push(T/p,1-w/v),M.push.apply(M,mi(y))}for(var R=0;R<v;R++)for(var S=0;S<p;S++){var P=S+(p+1)*R,D=S+(p+1)*(R+1),O=S+1+(p+1)*(R+1),I=S+1+(p+1)*R;x.push(P,D,O),x.push(P,O,I)}return{uvs:_,indices:x,vertices:b,normals:M}},e.getNormal=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=n?-1:1;switch(t){case"x":e=[r,0,0];break;case Fi:e=[0,0,r];break;default:e=[0,r,0]}return e},e}(Zr);ji.get3DVertex=function(t,e){var n,r=xi(t,2),i=r[0],o=r[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;switch(e){case"x":n=[a,i,o];break;case"y":n=[i,a,o];break;default:n=[i,o,a]}return n};var zi=function(t){function e(e,n,r,i,o,a){var s;(s=t.call(this)||this).name="BoxGeometry";var u=s.initBox(e,n,r,i,o,a),h=u.uvs,c=u.normals,l=u.vertices,f=u.indices;return s.setAttribute("position",new Gr(l,3)),s.setAttribute("normals",new Gr(c,3)),s.setAttribute("uv",new Gr(h,2)),s.setIndexes(f),s}return c(e,t),e.prototype.initBox=function(t,e,n,r,i,o){var a=[],s=ji.buildPlane,u=s(n,e,o,i,{normalAxis:"x",normalDest:t/2}),h=s(n,e,o,i,{normalAxis:"x",useBack:!0,normalDest:-t/2}),c=s(t,n,r,o,{normalAxis:"y",normalDest:e/2}),l=s(t,n,r,o,{normalAxis:"y",useBack:!0,normalDest:-e/2}),f=s(t,e,r,i,{normalAxis:"z",normalDest:n/2}),d=s(t,e,r,i,{normalAxis:"z",useBack:!0,normalDest:-n/2});a.push(u,h,c,l,f,d);for(var p=0,v=[],m=[],g=[],y=[],_=function(t){var e=a[t],n=e.uvs,r=e.vertices,i=e.normals,o=e.indices,s=p;v=v.concat(n),m=m.concat(r),g=g.concat(i),y=y.concat(o.map((function(t){return s+t}))),p+=r.length/3},x=0;x<6;x++)_(x);return{uvs:v,vertices:m,normals:g,indices:y}},e}(Zr),Vi=function(t){function e(e,n){var r;return(r=t.call(this)||this).width=void 0,r.height=void 0,r.glFrameBuffer=null,r.glDepthBuffer=null,r.flipY=!1,r.premultiplyAlpha=!1,r.glTexture=null,r.width=e,r.height=n,r}return c(e,t),e}(Or);function Gi(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Wi(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wi(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Wi(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Hi=function(){function t(){this.faceCount=0,this.verticesCoords=[],this.textureCoords=[],this.uvs=[],this.vertices=[],this.normals=[],this.indexes=[]}var e=t.prototype;return e.load=function(t){var e=this;return new Promise((function(n){(function(t){var e=new XMLHttpRequest;return e.open("GET",t,!0),e.send(null),new Promise((function(t){e.addEventListener("load",(function(){t(e.responseText)}),!1)}),(function(t){e.addEventListener("error",(function(e){console.error("request error"),t(e)}),!1)}))})(t).then((function(t){e.parse(t);var r=e.genObject3D();n(r)}))}))},e.genObject3D=function(){var t=new Zr;t.setAttribute("position",new Gr(this.vertices,3)),this.uvs.length&&t.setAttribute("uv",new Gr(this.uvs,2)),t.setIndexes(this.indexes);var e=new Pi;return new Kr(t,e)},e.parse=function(t){var e,n=Gi(t.split("\n"));try{for(n.s();!(e=n.n()).done;){var r=e.value,i=r.indexOf("#");-1!==i&&(r=r.substring(0,i));var o=(r=r.trim()).split(/\s+/);switch(o[0]){case"v":this.verticesCoords.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));break;case"vn":this.normals.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3]));break;case"vt":this.textureCoords.push(parseFloat(o[1]),parseFloat(o[2]));break;case"p":case"l":case"usemtl":break;case"f":o.shift(),this.parseFaceLine(o)}}}catch(t){n.e(t)}finally{n.f()}},e.parseFaceLine=function(t){for(var e=[],n=t.length,r=0;r<n;r++){var i=t[r];if(i.length>0){var o=i.split("/");e.push(o)}}for(var a=e[0],s=1,u=e.length-1;s<u;s++){var h=e[s],c=e[s+1];this.addFace(a,h,c)}},e.addFace=function(t,e,n){var r=this.verticesCoords,i=r.length/3,o=this.parseVertexIndex(t[0],i),a=this.parseVertexIndex(e[0],i),s=this.parseVertexIndex(n[0],i);this.vertices.push(r[o],r[o+1],r[o+2],r[a],r[a+1],r[a+2],r[s],r[s+1],r[s+2]);var u=3*this.faceCount;if(this.indexes.push(u,u+1,u+2),this.faceCount++,""!==t[1]){var h=this.textureCoords,c=h.length,l=this.parseUVIndex(t[1],c),f=this.parseUVIndex(e[1],c),d=this.parseUVIndex(n[1],c);this.uvs.push(h[l],h[l+1],h[f],h[f+1],h[d],h[d+1])}t[2]},e.parseVertexIndex=function(t,e){var n=parseInt(t,10);return 3*(n>=0?n-1:n+e/3)},e.parseUVIndex=function(t,e){var n=parseInt(t,10);return 2*(n>=0?n-1:n+e/2)},t}();function Zi(t){return new Promise((function(e,n){var r=new Image;r.src=t,r.crossOrigin="Anonymous",r.onload=function(){e(r)},r.onerror=function(t){n(t)}}))}function qi(t){if(6!==t.length)throw new Error("[loadCubeTexture] param urls need len six. [px, nx, py, ny, pz, nz]");return new Promise((function(e,n){for(var r=0,i=new hi,o=i.image,a=function(a){Zi(t[a]).then((function(t){r++,o[a]=t,6===r&&(i.needsUpdate=!0,e(i))})).catch((function(t){console.error(t),n(t)}))},s=0;s<6;s++)a(s)}))}var Yi=function(t){function e(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;return(e=t.call(this)||this).isCamera=!0,e.viewMatrix=Pe(),e.projectionMatrix=Pe(),e.projectionMatrixNeedUpdate=!1,e._far=void 0,e._near=void 0,e._far=r,e._near=n,e}return c(e,t),e.prototype.updateWorldMatrix=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t.prototype.updateWorldMatrix.call(this,e),Be(this.viewMatrix,this.worldMatrix)},o(e,[{key:"near",get:function(){return this._near},set:function(t){this._near=t,this.projectionMatrixNeedUpdate=!0}},{key:"far",get:function(){return this._far},set:function(t){this._far=t,this.projectionMatrixNeedUpdate=!0}}]),e}(Ur),Xi=function(t){function e(e,n,r,i,o,a){var s;return(s=t.call(this,o,a)||this)._left=void 0,s._right=void 0,s._top=void 0,s._bottom=void 0,s._top=r,s._left=e,s._right=n,s._bottom=i,s.updateProjectionMatrix(!0),s}c(e,t);var n=e.prototype;return n.updateProjectionMatrix=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===t||!0===this.projectionMatrixNeedUpdate){var e=(this.right-this.left)/2,n=(this.top-this.bottom)/2,r=(this.right+this.left)/2,i=(this.top+this.bottom)/2,o=r-e,a=r+e,s=i+n,u=i-n;Ie(this.projectionMatrix),$e(this.projectionMatrix,o,a,s,u,this.near,this.far),this.projectionMatrixNeedUpdate=!1}},n.clone=function(n){return void 0===n&&(n=new e(0,0,0,0,0,0)),t.prototype.clone.call(this,n),n.left=this.left,n.right=this.right,n.top=this.top,n.bottom=this.bottom,n.near=this.near,n.far=this.far,n.updateProjectionMatrix(),n.updateWorldMatrix(),n},o(e,[{key:"top",get:function(){return this._top},set:function(t){t!==this._top&&(this._top=t,this.projectionMatrixNeedUpdate=!0)}},{key:"left",get:function(){return this._left},set:function(t){t!==this._left&&(this._left=t,this.projectionMatrixNeedUpdate=!0)}},{key:"right",get:function(){return this._right},set:function(t){t!==this._right&&(this._right=t,this.projectionMatrixNeedUpdate=!0)}},{key:"bottom",get:function(){return this._bottom},set:function(t){t!==this._bottom&&(this._bottom=t,this.projectionMatrixNeedUpdate=!0)}}]),e}(Yi),Ki=function(t){function e(e,n,r,i){var o;return(o=t.call(this,r,i)||this).type="PerspectiveCamera",o._fov=void 0,o._aspect=void 0,o._fov=e,o._aspect=n,o.updateProjectionMatrix(!0),o}c(e,t);var n=e.prototype;return n.updateProjectionMatrix=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!0!==t&&!0!==this.projectionMatrixNeedUpdate||(Ie(this.projectionMatrix),Qe(this.projectionMatrix,this.fov*Math.PI/180,this.aspect,this.near,this.far),this.projectionMatrixNeedUpdate=!1)},n.clone=function(n){return void 0===n&&(n=new e(0,0,0,0)),t.prototype.clone.call(this,n),n.fov=this.fov,n.aspect=this.aspect,n.near=this.near,n.far=this.far,n.updateProjectionMatrix(),n.updateWorldMatrix(),n},o(e,[{key:"fov",get:function(){return this._fov},set:function(t){t!==this._fov&&(this._fov=t,this.projectionMatrixNeedUpdate=!0)}},{key:"aspect",get:function(){return this._aspect},set:function(t){t!==this._aspect&&(this._aspect=t,this.projectionMatrixNeedUpdate=!0)}}]),e}(Yi),Qi=Object.freeze({__proto__:null,Mesh:Kr,Scene:Qr,Geometry:Jr,Object3D:Ur,Raycaster:si,Texture:ui,CubeTexture:hi,TextureOperation:ci,Material:Ti,BasicMaterial:Pi,BufferGeometry:Zr,WebGLRenderer:Ui,PlaneGeometry:Ni,BoxGeometry:zi,WebGLRenderTarget:Vi,PlaneBufferGeometry:ji,Box3:Nr,OBJLoader:Hi,loadImage:Zi,loadTexture:function(t,e,n){return Zi(t).then((function(t){var n=new ui(t);return e&&e(n),n})).catch((function(t){n&&n(t)}))},loadCubeTexture:qi,Vec2:Ut,Vec3:ge,Vec4:kn,Mat3:Se,Mat4:an,Quat:Ar,quatToEuler:Ir,BufferAttribute:Fr,Uint8BufferAttribute:jr,Uint16BufferAttribute:zr,Uint32BufferAttribute:Vr,Float32ArrayAttribute:Gr,UintBufferAttribute:Wr,OrthographicCamera:Xi,PerspectiveCamera:Ki}),Ji=function(){function t(t){this.pano=void 0,this.panoData=void 0,this._meshs=new Kr,this.pano=t}return o(t,[{key:"camera",get:function(){return this.pano.camera}},{key:"meshs",get:function(){return this._meshs},set:function(t){this._meshs=t}}]),t}(),$i=["varying vec3 v_normal;","void main(void){","   gl_Position = mvpMatrix * vec4(position, 1.0);","   v_normal = normalize(position.xyz);","}"].join("\n"),to=["uniform samplerCube uSampler;","uniform float uOpacity;","varying vec3 v_normal;","void main(void){","    vec4 textureColor = textureCube(uSampler, normalize(v_normal));","    gl_FragColor = vec4(textureColor.rgb, textureColor.a * uOpacity);","}"].join("\n"),eo=function(t){function e(e){var n;return(n=t.call(this,e)||this).initMesh(),n}c(e,t);var n=e.prototype;return n.initMesh=function(){var t=new zi(8,8,8,1,1,1),e=new Ti;e.vertexShader=$i,e.fragmentShader=to,e.uniforms={vColor:{type:"4f",value:[1,0,0,1]},uSampler:{type:"t",value:null},uOpacity:{type:"1f",value:1}};var n=new Kr(t,e);n.visible=!1,n.setScale(-1,1,1),this.meshs=n},n.setData=function(t){var e=this;if(!t.image||6!==t.image.length)throw new Error("天空盒模型需要6张纹理，但只获取到 ".concat(t.image?t.image.length:0,"张"));this.panoData=t;var n=this.meshs;qi(t.image).then((function(t){n.material.uniforms.uSampler.value=t,n.visible=!0,e.pano.emit({type:d.REFRESH,log:"[Refresh Log] 立方贴图加载完成， 渲染一帧"})})).catch((function(t){return console.error(t)}))},n.update=function(){},n.draw=function(){},e}(Ji),no=function(t){return t},ro=function(t){return t*t},io=function(t){return-t*(t-2)},oo=ro,ao=io,so=Object.freeze({__proto__:null,linear:no,reverse:function(t){return 1-t},easeInQuad:ro,easeInCubic:function(t){return Math.pow(t,3)},easeOutQuad:io,easeOutCubic:function(t){return Math.pow(t-1,3)+1},easeInOutQuad:function(t){return t<.5?t*t*2:-2*(t-2)*t-1},easeInOutCubic:function(t){return t<.5?4*Math.pow(t,3):4*Math.pow(t-1,3)+1},easeInOutSine:function(t){return(1-Math.cos(Math.PI*t))/2},easeIn:oo,easeOut:ao}),uo=function(){},ho=function(){function t(t,e,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:no;this.from=void 0,this.to=void 0,this.duration=void 0,this.easingFn=void 0,this._isPlaying=!1,this._autoTimer=null,this._startTime=null,this._onUpdateCallback=uo,this._onEndCallback=uo,this.start=function(){return r._isPlaying||(r._isPlaying=!0,r._startTime=r.getNow()),r},this.stop=function(){return r._isPlaying=!1,r},this.startAndAutoUpdate=function(){if(r._isPlaying)return r;r.start(),r._autoTimer=null;return function t(){r.update(),r._autoTimer=requestAnimationFrame(t)}(),r},this.onEnd=function(t){return"function"==typeof t?r._onEndCallback=t:console.warn("[Warning] onUpdate required a funtion"),r},this.onUpdate=function(t){return"function"==typeof t?r._onUpdateCallback=t:console.warn("[Warning] onUpdate required a funtion"),r},this.update=function(){if(!r._isPlaying)return!1;var t=r.from,e=r.to,n=r.getNow(),i=r.easingFn,o=r._startTime;if(o>n)return!1;var a=(n-o)/r.duration,s=t+(e-t)*i(a=0===r.duration||a>1?1:a);return r._onUpdateCallback(s),1===a&&r.handleEnd(),!0},this.from=t,this.to=e,this.duration=n,this.easingFn=i}var e=t.prototype;return e.getNow=function(){return Date.now()},e.handleEnd=function(){this._isPlaying=!1,this._autoTimer=null,this._onEndCallback()},t}(),co=function(t,e,n){var r=.5*e,i=.5*n;return _t((t[0]-r)/r,(i-t[1])/i)},lo=function(t,e,n){var r=.5*e,i=.5*n;return _t((t[0]+1)*r,(1-t[1])*i)},fo=function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100,o=sn(),a=co(t,n,r),s=hn(a[0],a[1],i,1),u=Pe(),h=e.worldMatrix;return Be(u,e.projectionMatrix),En(o,s,u),En(o,o,h),o},po=function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=hn(e[0],e[1],e[2],1);if(En(o,o,t.viewMatrix),0<o[2]&&!0!==i)return null;En(o,o,t.projectionMatrix),o[0]=o[0]/o[3],o[1]=o[1]/o[3],o[2]=o[2]/o[3],o[3]=1;var a=_t(o[0],o[1]);return lo(a,n,r)},vo=function(t,e,n,r){var i=po(e,t,n,r)||[-1,-1],o=xi(i,2),a=o[0],s=o[1],u=!1;return a>=0&&a<=n&&s>=0&&s<=r&&(u=!0),u},mo=Object.freeze({__proto__:null,viewportToNormalizeProjection:co,normalizeProjectionToViewport:lo,viewportToWorld:fo,worldToViewport:po,isCoordsInView:vo}),go=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;this.getVertexs=function(){return e.vertexs},this.getFacesVertex=function(){return e.facesVertex},this.generateTextureCoord=function(n,r,i){var o=e.facesVertex[Math.round(e.facesVertex.length/2)];if(o){for(var a=[],s=Math.pow(2,5-i),u=r%s,h=n%s,c=t.H_SEGS/e.cols,l=1/c,f=1/((t.V_SEGS-1)/e.rows),d=0;d<o.length/3;d++){var p=d%(c+1)*l,v=Math.floor(d/(c+1))*f;p=p/s+1*u/s,v=v/s+1*h/s,1===i&&(v*=2),a.push(p,v)}return a}},this.getFaceIndex=function(n){var r=0,i=xi(n,3),o=i[0],a=i[1],s=i[2],u=Math.round(180*Math.atan(Math.abs(s)/Math.abs(o))/Math.PI);o>0?s<0&&(u=360-u):u=s>0?180-u:180+u,u%=360,r=a>e._x3?7:a>e._x2?6:a>e._x1?5:a>0?4:a>-e._x1?3:a>-e._x2?2:a>-e._x3?1:0;var h=Math.floor(u/22.5),c=t.H_SEGS;return[h,r,h+r*(c/(c/e.cols))]},this.viewportToSphereCoord=function(t,n,r,i){var o=e.radius,a=fo(t,i,n,r),s=xi(a,3),u=s[0],h=s[1],c=s[2],l=o/Math.sqrt(u*u+h*h+c*c);return[u*l,h*l,c*l]},this.getFaceVertex=function(n,r){var i=t.H_SEGS/e.cols,o=r+n*(t.H_SEGS/i);return e.facesVertex[o]},this.radius=n,this.rows=t.DEFAULT_COLS/2,this.cols=t.DEFAULT_COLS,this.vertexs=null,this.facesVertex=[],this.facesVertexIndice=[],this.init()}var e=t.prototype;return e.init=function(){var t=this.getSphereVertexInfo();this.facesVertexIndice=this.getSphereFacesIndices(),this.vertexs=t.vertexs,this.facesVertex=t.facesVertex,this.calcConst()},e.calcConst=function(){var t=360/this.cols;this._x1=Math.cos(g(3*t))*this.radius,this._x2=Math.cos(g(2*t))*this.radius,this._x3=Math.cos(g(1*t))*this.radius},e.getSphereVertexInfo=function(){for(var e,n=[],r=[],i=this.radius,o=t.H_SEGS,a=t.V_SEGS,s=360/o,u=180/(a-1),h=o/this.cols,c=o/h,l=0,f=0,d=[],p=0;p<a;p++){var v=Math.sin(g(p*u-90))*i,m=Math.cos(g(p*u-90))*i;v=Math.round(100*v)/100,m=Math.round(100*m)/100,l=Math.floor(p/h);for(var y=0;y<o;y++){var _=Math.cos(g(y*s))*m,x=Math.sin(g(y*s))*m;if(_=Math.round(100*_)/100,x=Math.round(100*x)/100,n.push(_,v,x),e=(f=Math.floor(y/h))+l*c,l<this.rows&&(r[e]||(r[e]=[]),r[e].push(_,v,x)),l>0&&p%h==0){var b=f+(l-1)*c;r[b].push(_,v,x),y>0&&y%h==0&&r[b-1]&&r[b-1].push(_,v,x),y===o-1&&r[b].push(d[0],d[1],d[2])}0===f&&0===y&&(d=[_,v,x]),y>0&&y%h==0&&r[e-1]&&r[e-1].push(_,v,x),l<this.rows&&y===o-1&&r[e].push(d[0],d[1],d[2])}}return{vertexs:n,facesVertex:r}},e.getSphereFacesIndices=function(){for(var e=[],n=t.H_SEGS/this.cols,r=n+1,i=0;i<n;i++)for(var o=0;o<n;o++){var a=i*r,s=a+o+1,u=a+o+1+r;e.push(a+o,s,u),s=a+o+1+r,e.push(a+o,s,a+r+o)}return e},e.getSphereFacesIndicesByimageZoom=function(e){for(var n=this,r=[],i=t.H_SEGS,o=Math.pow(2,5-e),a=i/this.cols+1,s=a*a,u=function(t){for(var e=function(e){n.facesVertexIndice.forEach((function(n){r.push(n+s*e+s*t*2)}))},i=0;i<o;i++)e(i)},h=0;h<o;h++)u(h);return r},t}();go.DEFAULT_COLS=Math.pow(2,4),go.H_SEGS=64,go.V_SEGS=33;var yo=function(){function t(){this._counter=0,this._imageCollection={}}var e=t.prototype;return e.getImageInstance=function(){var t;for(var e in this._imageCollection)if(this._imageCollection[e]&&!0===this._imageCollection[e]._free)return this._imageCollection[e]._free=!1,this._imageCollection[e];t=new Image;var n=this.getGUID();return this._imageCollection[n]=t,t},e.freeImage=function(t){t&&(t._free=!0,t.src="",t.onload=t.onerror=null)},e.getGUID=function(){return this._counter++,"img_".concat(this._counter)},t}(),_o=function(){function t(e,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this.imageInstancePool=void 0,this.tileImagesCache=void 0,this.textureInfo=void 0,this.pano=void 0,this.udtVersion=void 0,this.cdnList=void 0,this.calcTileKey=function(t,e,n,r){return"".concat(t,"_").concat(e,"_").concat(n,"_").concat(r)},this.loadImage=function(t,e,n,i){var o=r.calcTileKey(t,e,n,i),a=r.getTilesUrl(t,{x:e,y:n},i),s=r.tileImagesCache.getData(o);return new Promise((function(t,e){s?t(s._loaded?s:null):((s=r.imageInstancePool.getImageInstance()).crossOrigin="anonymous",s._loaded=!1,s.onload=function(){s._loaded=!0,t(s)},s.onerror=function(t){console.error("Tile ".concat(o," load error => "),t),e(t)},s.src=a,r.tileImagesCache.setData(o,s))}))},this.loadTexture=function(t,e,n,i){var o=r.calcTileKey(t,e,n,i),a=r.textureInfo.getData(o);return new Promise((function(s,u){a&&a.loaded?s(a):r.loadImage(t,e,n,i).then((function(t){if(!t)return null;var e=new ui(t);1!==i&&r.textureInfo.setData(o,e),s(e)})).catch((function(t){console.error("[TextureManager] loadTexture fail => ".concat(t)),u(null)}))}))},this.loadTopoTexture=function(t){var e=0,n=new Image;return new Promise((function(r){n.onload=function(){var t=new ui(n);t.flipY=!1,r(t)},n.onerror=function(){2>e?(e++,n.src="".concat(t,"&random=").concat((new Date).getTime())):r(null)},n.crossOrigin="anonymous",n.src=t}))},this.clear=function(){r.textureInfo.clear()},this.pano=e,this.udtVersion=i,this.cdnList=n||e.opts.tileBaseUrls,this.imageInstancePool=new yo,this.tileImagesCache=new A(t.MAX_TILE_CACHED,{clearCallback:function(t){r.imageInstancePool.freeImage(t)}}),this.textureInfo=new A(t.MAX_TILE_CACHED,{clearCallback:function(t){t.destory()}})}var e=t.prototype;return e.getRandomCDN=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=t.length;return t[Math.floor(Math.random()*e)]},e.getTilesUrl=function(e,n,r){return this.getRandomCDN(this.cdnList)+(t.TILE_URL_TEMPLATE+"&".concat($("/",{isCounter:!0}))).replace("{udt}",this.udtVersion).replace("{sid}",e).replace("{x}","".concat(n.x)).replace("{y}","".concat(n.y)).replace("{zoom}","".concat(r))},t}();_o.MAX_TILE_CACHED=160,_o.TILE_URL_TEMPLATE="?qt=pdata&sid={sid}&pos={y}_{x}&z={zoom}&udt={udt}&from=H5";var xo=["attribute vec2 uvBack;","varying mediump vec2 vTextureCoordBack;","varying mediump vec2 vTextureCoord;","void main(void) {","    gl_Position = mvpMatrix * vec4(position, 1.0);","    vTextureCoordBack = uvBack;","    vTextureCoord = uv;","}"].join("\n"),bo=["precision mediump float;","varying vec2 vTextureCoordBack;","varying vec2 vTextureCoord;","uniform sampler2D uSamplerBack;","uniform sampler2D uSampler;","uniform bool uDrawThumb;","uniform bool uDrawBack;","uniform float uAlpha;","void main(void) {","    if (uDrawThumb) {","        gl_FragColor = texture2D(uSamplerBack, vTextureCoordBack);","        return;","    }","    if (uAlpha == 1.0) {","        gl_FragColor = texture2D(uSampler, vTextureCoord);","        return;","    }","    if (uDrawBack) {","        gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha + texture2D(uSamplerBack, vTextureCoordBack) * (1.0 - uAlpha);","    } else {","        vec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));","        gl_FragColor =  vec4(textureColor.rgb, textureColor.a * uAlpha);","    }","}"].join("\n"),Mo=["varying highp vec2 vTextureCoord;","void main(void) {","    gl_Position = mvpMatrix * vec4(position, 1.0);","    vTextureCoord = uv;","}"].join("\n"),wo=["precision mediump float;","uniform sampler2D uSampler;","varying highp vec2 vTextureCoord;","void main(void) {","    gl_FragColor = texture2D(uSampler, vTextureCoord);","}"].join("\n"),Eo=["varying highp vec2 vTextureCoord;","void main(void) {","    gl_Position = mvpMatrix * vec4(position, 1.0);","    vTextureCoord = uv;","}"].join("\n"),To=["uniform sampler2D uSampler;","uniform float uOpacity;","varying vec2 vTextureCoord;","void main(void){","    vec4 textureColor = texture2D(uSampler, vTextureCoord);","    gl_FragColor = vec4(textureColor.rgb, textureColor.a * uOpacity);","}"].join("\n"),Ao=["varying highp vec3 vTextureCoord;","void main(void){","   gl_Position = mvpMatrix  * vec4(position, 1.0);","   vTextureCoord = vec3(uv, 1.0) * length(position);","}"].join("\n"),Co=["uniform sampler2D uSampler;","uniform float uOpacity;","varying vec3 vTextureCoord;","uniform bool showDebugLine;","uniform vec4 vColor;","void main(void){","   if (!showDebugLine) {","       vec4 textureColor = texture2DProj(uSampler, vTextureCoord);","       gl_FragColor = vec4(textureColor.rgb, textureColor.a * uOpacity);","   } else {","       gl_FragColor = vec4(vColor.rgb, vColor.a);","   }","}"].join("\n"),Ro=function(){function t(e,n,r,i){this.nodes=void 0,this.level=void 0,this.key=void 0,this.nodes=[],this.level=e,this.key="".concat(r,"_").concat(i),e<n&&(this.nodes[0]=new t(e+1,n,2*r,2*i),this.nodes[1]=new t(e+1,n,2*r,2*i+1),this.nodes[2]=new t(e+1,n,2*r+1,2*i),this.nodes[3]=new t(e+1,n,2*r+1,2*i+1))}var e=t.prototype;return e.hasNodes=function(){return this.nodes.length>0},e.getNodeKeysByLevel=function(t){if(t<this.level)return console.warn("指定节点".concat(t," 不在当前节点").concat(this.level,"范围内！")),[];if(this.level===t)return[this.key];for(var e=[],n=0;n<this.nodes.length;n++)if(Object.prototype.hasOwnProperty.call(this.nodes,n)){var r=this.nodes[n];if(this.level===t-1)e.push(r.key);else if(r.hasNodes()){var i=r.getNodeKeysByLevel(t);e.push.apply(e,mi(i))}}return e},t}();var So=function(t){function e(e){var n;return(n=t.call(this,e)||this).name="SphereRender",n.sphere=void 0,n.textureManager=void 0,n.imgColsRows=void 0,n.curThumbTexture=void 0,n.meshCache={},n.tileInfoCache={},n.imgRange=void 0,n.faceRange=void 0,n.hitTile=void 0,n.setData=function(t){n.panoData=t,n.curThumbTexture=null,n.loadThumbTextures(t.panoId)},n.update=function(){n.updateRangeInfo(),n.checkAndLoadTiles()},n.checkAndLoadTiles=function(){if(n.curThumbTexture&&n.panoData){var t=n.panoData.panoId,e=n.camera,r=n.imgColsRows[n._imgZoom],i=r.cols,o=i-1,a=r.rows-1,s=n.pano.getContainerSize(),u=s.width,h=s.height,c=!1,l=[],f=xi(n.imgRange,4),d=f[0],p=f[1],v=f[2],m=f[3];if(vo(Vt(0,100,0),e,u,h)){for(var g=0;g<=v;g++)for(var y=0;y<=o;y++)n.checkAndLoadTile(t,y,g,n._imgZoom),l.push([g,y]);v<m&&(v+=1,c=!0)}else if(vo(Vt(0,-100,0),e,u,h)){for(var _=m;_<=a;_++)for(var x=0;x<=o;x++)n.checkAndLoadTile(t,x,_,n._imgZoom),l.push([_,x]);v<m&&(m-=1,c=!0)}else c=!0;if(!0===c){p>o&&(p=o);for(var b=d;b<=p;b++)for(var M=v;M<=m;M++){var w=b<0?b+i:b;n.checkAndLoadTile(t,w,M,n._imgZoom),l.push([M,w])}}n.hitTile=l,l.forEach((function(t){var e=xi(t,2),r=e[0],i=e[1],o="".concat(r,"_").concat(i,"_").concat(n._imgZoom);if(void 0===n.tileInfoCache[o]){var a=new Ro(n._imgZoom,5,r,i).getNodeKeysByLevel(5);n.tileInfoCache[o]=a}}))}},n.draw=function(){var t=n.meshs;if(!n.faceRange||!n.curThumbTexture)return!1;t.children=[];for(var e=function(e,r){var i=n.curThumbTexture,o=n.textureManager.calcTileKey(n.panoData.panoId,e,r,n._imgZoom),a=n.textureManager.textureInfo.getData(o),s=!1,u=null;if(a?!(u=a).finished&&u.aniInfo&&u.aniInfo&&u.aniInfo.update():i&&(s=!0,u=i),u){var h="".concat(r,"_").concat(e,"_").concat(n._imgZoom),c=n.meshCache[h];if(!c){if(!(c=n.createTileMesh(r,e)))return;n.meshCache[h]=c}if(!c.material)return;var l=c.material.uniforms;l.uSamplerBack.value=i,s?l.uDrawThumb.value=!0:(l.uDrawThumb.value=!1,l.uSampler.value=u,l.uAlpha.value=u.alpha),t.add(c)}},r=0;r<n.hitTile.length;r++){var i=xi(n.hitTile[r],2),o=i[0];e(i[1],o)}return!0},n.pano=e,n.sphere=new go(e.opts.radius),n.textureManager=new _o(e),n.imgColsRows=function(){for(var t=[],e=0;e<=5;e++)t[e]=e<2?{cols:1,rows:1}:{cols:Math.pow(2,e-1),rows:Math.pow(2,e-1)/2};return t}(),n.curThumbTexture=null,n.meshs=new Kr,n}c(e,t);var n=e.prototype;return n.checkAndLoadTile=function(t,e,n,r){var i=this,o=this.textureManager,a=o.calcTileKey(t,e,n,r);!0!==(void 0!==o.textureInfo.getData(a))&&this.textureManager.loadTexture(t,e,n,r).then((function(t){t&&!t.done&&(t.aniInfo=i.createTextureAnimation(t),t.done=!0,i.pano.dispatchEvent({type:d.REFRESH,log:"[Refresh Log] 瓦片加载完成， 渲染一帧"}))}))},n.loadThumbTextures=function(t){var e=this;this.textureManager.loadTexture(t,0,0,1).then((function(t){e.curThumbTexture=t,e.pano.dispatchEvent({type:d.THUMB_LOADED}),e.pano.dispatchEvent({debug:!0,type:d.REFRESH,log:"[Refresh Log] 缩略图加载完毕，渲染一帧"})}))},n.createTextureAnimation=function(t){var e=this;return t.alpha=0,new ho(0,1,300).onUpdate((function(n){t.alpha=n,e.pano.dispatchEvent({debug:!0,type:d.REFRESH,log:"[Refresh Log] 纹理清晰度渐变动画，渲染一帧"})})).onEnd((function(){t.finished=!0})).start()},n.createTileMesh=function(t,e){var n=new Ti,r=new Zr;if(n.depthTest=!1,n.vertexShader=xo,n.fragmentShader=bo,n.uniforms={uSampler:{type:"t",value:null},uSamplerBack:{type:"t",value:null},uDrawThumb:{type:"1i",value:1},uDrawBack:{type:"1i",value:1},uAlpha:{type:"1f",value:1}},!this.setGeometryAttrib(r,t,e))return null;var i=new Kr(r,n);return i.name="tile-mesh",i},n.setGeometryAttrib=function(t,e,n){var r="".concat(e,"_").concat(n,"_").concat(this._imgZoom),i=this.tileInfoCache[r];if(!i)return!1;for(var o=[],a=[],s=[],u=0;u<i.length;u++){var h=i[u].split("_"),c=this.sphere.rows,l=Number(h[1]),f=c-1-Number(h[0]);o.push.apply(o,mi(this.sphere.getFaceVertex(f,l))),a.push.apply(a,mi(this.sphere.generateTextureCoord(f,l,this._imgZoom))),s.push.apply(s,mi(this.sphere.generateTextureCoord(f,l,1)))}var d=this.sphere.getSphereFacesIndicesByimageZoom(this._imgZoom);return t.setAttribute("uv",new Gr(a,2)),t.setAttribute("uvBack",new Gr(s,2)),t.setAttribute("position",new Gr(o,3)),t.setIndexes(d),!0},n.getTileBoundary=function(){var t=this.pano.getContainerSize(),e=t.width,n=t.height,r=_t(0,0),i=_t(e,0),o=_t(0,n),a=_t(e,n),s=_t(.5*e,0),u=_t(.5*e,n),h=_t(0,.5*n),c=_t(e,.5*n),l=this.getSpherePosition(r),f=this.getSpherePosition(i),d=this.getSpherePosition(o),p=this.getSpherePosition(a),v=this.getSpherePosition(s),m=this.getSpherePosition(u),g=this.getSpherePosition(h),y=this.getSpherePosition(c),_=Math.max(l[1],v[1],f[1]),x=Math.min(d[1],m[1],p[1]),b=[l[0],g[0],d[0],v[0]],w=[f[0],y[0],p[0],m[0]],E=Math.min.apply(Math,b),T=Math.max.apply(Math,w),A=M(b),C=M(w),R=this.sphere.cols,S=R/2;A.max-A.min>S&&(E=Math.min.apply(Math,mi(b.filter((function(t){return t>S}))))),C.max-C.min>S&&(T=Math.max.apply(Math,mi(w.filter((function(t){return t<S}))))),E>T&&(E-=R);var P=this.getImgIndexByFaceColRow(E,_),D=xi(P,2),O=D[0],I=D[1],L=this.getImgIndexByFaceColRow(T,x),B=xi(L,2);return[[E,T,_,x],[O,B[0],I,B[1]]]},n.updateRangeInfo=function(){var t=this.getTileBoundary(),e=xi(t,2),n=e[0],r=e[1];this.imgRange=r,this.faceRange=n},n.getImgIndexByFaceColRow=function(t,e,n){n=n||this._imgZoom;var r=Math.pow(2,5-n),i=Math.floor(t/r),o=Math.floor(e/r);return[i,o=this.imgColsRows[n].rows-o-1,i+o*go.DEFAULT_COLS/r]},n.normalizeNum=function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=t;r<n;)r+=e;return r%=e},n.getSpherePosition=function(t){var e=this.camera,n=this.pano.getContainerSize(),r=n.width,i=n.height,o=this.sphere.viewportToSphereCoord(t,r,i,e),a=this.sphere.getFaceIndex(o),s=xi(a,2);return _t(s[0],s[1])},n.generateBackThumb=function(t){if(t){var e=this.pano,n=e.getContainerSize(),r=n.width,i=n.height,o="//apisv0.bdimg.com/?udt=20140616&qt=pdata&pos=0_0&z=2&sid=".concat(t,"&from=H5&").concat($("/",{isCounter:!0})),a=e.getPanes().tileLayer;a.style.backgroundImage='url("'+o+'")',a.style.backgroundPosition="50% 50%",a.style.backgroundSize="150% 150%",a.style.width="".concat(r,"px"),a.style.height="".concat(i,"px")}},o(e,[{key:"_imgZoom",get:function(){return this.pano.imageZoom}}]),e}(Ji),Po=[10,-20,30,10,-20,10,-10,-20,10,-10,-20,30].map((function(t){return-20===t?-20:1.8*t})),Do=[10,-22,30,10,-22,10,-10,-22,10,-10,-22,30].map((function(t){return-22===t?-22:1.8*t})),Oo=[1.8,-20,24.9,1.8,-20,16.3,-1.8,-20,16.3,-1.8,-20,24.9].map((function(t){return-20===t?-20:1.8*t})),Io=[0,0,0,.5,.25,.5,.25,0],Lo=function(){function t(t,e,n){var r=this;this.mesh=void 0,this.material=void 0,this.linkData=void 0,this._pano=void 0,this.northDir=void 0,this.yAxisDis=void 0,this.isPosInArrow=function(t,e,n,i,o){var a=_t(t,e),s=fo(a,n,i,o,-1),u=200*s[0],h=200*s[1],c=200*s[2],l=r.yAxisDis/h;if(l<0)return!1;var f=[u*l,h*l,c*l];return r.isHitLink(f)},this._pano=t,this.linkData=e,this.northDir=n,this.yAxisDis=0,this.linkData.refinedDir=_((e.topoDir||0)+this.northDir),this.material=this.createArrowMaterial(),this.mesh=this.initMesh(),this.changePose()}var e=t.prototype;return e.initMesh=function(){var t=this.createGeometry(),e=new Kr(t,this.material);return e.visible=!1,e.name="link-mesh",e},e.createArrowMaterial=function(){var t=new Ti;return t.depthTest=!1,t.vertexShader=Mo,t.fragmentShader=wo,t.uniforms={uSampler:{type:"t",value:null}},t},e.setTopoTexture=function(t){t.isTexture&&(this.material.uniforms.uSampler.value=t)},e.setVisible=function(t){this.mesh.setVisible(t,!0)},e.createGeometry=function(){var t=new Zr,e=this.getTextCoord(this.linkData.topoDir),n=[].concat(Do,Po,Oo),r=[].concat([.5,0,.5,.5,1,.5,1,0],[0,0,0,.5,.5,.5,.5,0],e),i=[].concat([0,1,2,0,2,3],[4,5,6,4,6,7],[8,9,11,10,11,9]);return t.setAttribute("position",new Gr(n,3)),t.setAttribute("uv",new Gr(r,2)),t.setIndexes(i),t},e.changePose=function(t){t=t||this.mesh;var e=50,n=-30,r=this._pano.getPov().pitch,i=this.linkData.refinedDir;(e+=20*this._pano.getZoom(),r<0)&&(e*=(90-(r=Math.abs(r)))/90,n-=20*r/90);var o=Math.cos(g(i))*e,a=Math.sin(g(i))*e;this.yAxisDis=n+-20,t.setPosition(o,n,a),t.rotateY(-_(i-90)),t.rotateX(-5),t.updateWorldMatrix(!0)},e.getTextCoord=function(t){t=(t+360)%360;var e=Math.ceil(Math.floor(t/22.5)/2);8===e&&(e=0);for(var n=Io.slice(0),r=Math.floor(e/2),i=e%2,o=0;o<n.length;o++)o%2==0?(n[o]+=.25*r,n[o]=.5*n[o]):(n[o]+=.5*i,n[o]=.5*n[o]+.5);return n},e.isHitLink=function(t){var e=t[0],n=t[2],r=this.mesh.worldMatrix,i=Vt(Po[0],Po[1],Po[2]),o=Vt(Po[6],Po[7],Po[8]),a=Vt((i[0]+o[0])/2,(i[1]+o[1])/2,(i[2]+o[2])/2);return ee(a,a,r),Math.abs(e-a[0])<18&&Math.abs(n-a[2])<18},t}(),Bo=function(t){function e(e){var n;return(n=t.call(this,e)||this).name="PanoLinkRender",n.linkVisible=!0,n.textureManager=void 0,n.linkInfos=[],n.setData=function(t){if(t&&(o=t.getTopos,a="[object Function]"===Object.prototype.toString.call(o),s="[object AsyncFunction]"===Object.prototype.toString.call(o),a||s)){n.reset();var e=t.getTopos(),r=t.northDir,i=t.panoType===p.TYPE_STREET;e.length&&i&&(n.linkInfos=e.map((function(t){return new Lo(n.pano,t,r)})),n.meshs=n.linkInfos.map((function(t){return t.mesh})),n.loadTextures(),n.setVisible(!0))}var o,a,s},n.clickChecker=function(t,e){if(n.linkVisible){var r=n.getIdByTouchPos(t,e);return r&&(n.setVisible(!1),n.pano.dispatchEvent({type:d.LINK_CLICK,id:r}),n.pano.setId(r,{animation:!0})),!r}},n.pano=e,n.meshs=[],n.textureManager=new _o(e),n}c(e,t);var n=e.prototype;return n.reset=function(){this.meshs=[],this.linkInfos=[]},n.update=function(){this.linkInfos.forEach((function(t){t.changePose()}))},n.setVisible=function(t){var e=this.linkInfos;if(!(e.length<1)){var n=this.pano.opts.linksControl,r=!1;!0===n&&(r=t),this.linkVisible=r,e.forEach((function(t){return t.setVisible(r)}))}},n.draw=function(){},n.loadTextures=function(){var t=this,e=this.pano.opts.imgPath?"".concat(this.pano.opts.imgPath,"topo_arrow.png"):p.TOPO_ARROW_TEXTURE;this.textureManager.loadTopoTexture(e).then((function(e){e&&t.linkInfos.forEach((function(t){t.setTopoTexture(e)}))}))},n.getIdByTouchPos=function(t,e){var n=this,r=null;if(!this.linkInfos.length)return r;var i=this.pano.getContainerSize(),o=i.width,a=i.height,s=this.linkInfos.filter((function(r){return r.isPosInArrow(t,e,n.camera,o,a)}));return s.length&&(r=s[0].linkData.panoId),r},e}(Ji),ko=function(){function t(t,e,n){var r=this;this.start=function(){r.fadeAni.start(),r._pano.dispatchEvent({debug:!0,log:"淡出动画，渲染一帧",type:d.REFRESH})},this.update=function(){r.fadeAni.update()},this._pano=t,this.gl=this._pano.gl,this.snapshot=e,this.scene=this.initScene(),this.camera=this.initCamera();this.fadeAni=new ho(1,0,600).onUpdate((function(t){r.material.uniforms.uOpacity.value=t,r._pano.dispatchEvent({type:d.REFRESH})})).onEnd((function(){n&&n(),r._pano.dispatchEvent({type:d.REFRESH,debug:!0,log:"淡出动画结束，渲染一帧"})}))}var e=t.prototype;return e.initScene=function(){var t=new Qr,e=this._pano.getContainerSize(),n=e.width,r=e.height,i=new ji(n,r),o=this.initMaterial(),a=new Kr(i,o);return t.add(a),t},e.initMaterial=function(){var t=new Ti;return t.depthTest=!1,t.vertexShader=Eo,t.fragmentShader=To,t.uniforms={uSampler:{type:"t",value:this.snapshot},uOpacity:{type:"1f",value:1}},this.material=t,t},e.initCamera=function(){var t=this._pano.getContainerSize(),e=t.width/2,n=t.height/2;return new Xi(-e,e,n,-n,0,11e3)},t}(),Uo=function(){function t(t,e,n){var r=this;this.start=function(){r.waveAni.start(),r._pano.dispatchEvent({debug:!0,log:"淡出动画，渲染一帧",type:d.REFRESH})},this.update=function(){r.waveAni.update()},this._pano=t,this.gl=this._pano.gl,this.snapshot=e,this.scene=this.initScene(),this.camera=this.initCamera();this.waveAni=new ho(0,1,800).onUpdate((function(t){r.material.uniforms.progress.value=t,r.material.uniforms.uOpacity.value=1-t,r._pano.dispatchEvent({type:d.REFRESH})})).onEnd((function(){n&&n(),r._pano.dispatchEvent({type:d.REFRESH,debug:!0,log:"淡出动画结束，渲染一帧"})}))}var e=t.prototype;return e.initCamera=function(){var t=this._pano.getContainerSize(),e=t.width/2,n=t.height/2;return new Xi(-e,e,n,-n,0,11e3)},e.initScene=function(){var t=new Qr,e=this._pano.getContainerSize(),n=e.width,r=e.height,i=new ji(n,r),o=this.initMaterial(),a=new Kr(i,o);return t.add(a),t},e.initMaterial=function(){var t=new Ti,e=this._pano.getContainerSize(),n=e.width,r=e.height;return t.depthTest=!1,t.vertexShader=Eo,t.fragmentShader="\n    uniform float aspect;\n    uniform float radius;\n    uniform float amp;\n    uniform float band;\n    uniform float waves;\n    uniform float speed;\n    uniform float progress;\n    uniform vec2 uCenter;\n    uniform sampler2D uSampler;\n    uniform float uOpacity;\n\n    varying vec2 vTextureCoord;\n\n    void main() {\n        vec2 tc = vTextureCoord;\n        vec2 uv = vec2(0.0, 0.0);\n        vec2 p;\n        float len;\n        vec2 uv_offset;\n        float wave_width = band * radius;\n\n        p = (tc - uCenter);\n        p.x = p.x * aspect;\n        len = length(p);\n\n        float current_radius = radius * progress;\n        float damp_factor = 1.0;\n        if (progress > .5) {\n            damp_factor = (1.0 - progress) * 2.0;\n        }\n\n        float cut_factor = clamp(wave_width * damp_factor - abs(current_radius - len), 0.0, 1.0);\n        float waves_factor = waves * len / radius;\n        uv_offset = (p / len) * cos((waves_factor - progress * speed) * 3.14) * amp * cut_factor;\n\n        uv += uv_offset;\n\n        vec4 t_image = texture2D(uSampler, fract(tc + uv));\n\n        // gl_FragColor = t_image;\n        gl_FragColor = vec4(t_image.rgb, t_image.a * uOpacity);\n    }\n",t.uniforms={uSampler:{type:"t",value:this.snapshot},uCenter:{type:"2f",value:[.5,.5]},uOpacity:{type:"1f",value:1},progress:{type:"1f",value:0},speed:{type:"1f",value:4},waves:{type:"1f",value:14},band:{type:"1f",value:.3},amp:{type:"1f",value:.3},aspect:{type:"1f",value:n/r},radius:{type:"1f",value:1}},this.material=t,t},t}(),No=function(){function t(t,e,n,r){var i=this;this.startAni=function(){i.animation.start()},this.update=function(){i.animation.update()},this.pano=t,this.distance=n,this.refinedDir=e,this.camera=this.pano.camera,this.cameraBase=this.pano.camera.clone(),this.handleEnd=r,this.initAni()}return t.prototype.initAni=function(){var t=this,e=this.distance,n=this.refinedDir,r=Math.cos(g(n)),i=Math.sin(g(n));this.animation=new ho(0,1,400,so.easeOutQuad).onUpdate((function(n){var o=e*n,a=r*o,s=i*o;t.camera.setPosition(a,0,s),t.pano.dispatchEvent({debug:!0,type:d.REFRESH,log:"[Refresh Log] 前进动画， 渲染一帧"})})).onEnd((function(){t.handleEnd&&t.handleEnd()}))},t}(),Fo=function(t,e,n,r){this.x=t||0,this.y=e||0,this.width=n||0,this.height=r||0},jo=function(t,e){var n=this;this.angleDegreeDelta=function(t,e){var n=Math.abs(t-e);return n>180?360-n:n},this.getRoad=function(t,e,n,r,i){for(var o,a=[],s=[[-t/2,-e,-10],[-t/2,-e,-20],[t/2,-e,-10],[t/2,-e,-20]],u=s.length,h=0;h<u;h++)ee(o=s[h],o,n),a[h]={x:o[0]*r*.5,y:-o[1]*i*.5};return a},this.getIntersection=function(t,e,n,r){if(t.x===e.x||n.x===r.x)return null;var i=(e.y-t.y)/(e.x-t.x),o=(r.y-n.y)/(r.x-n.x);if(i===o)return null;var a=(o*n.x-i*t.x+t.y-n.y)/(o-i);return{x:a,y:i*(a-t.x)+t.y}},this.calculateVanishPoint=function(t,e,r,i){var o=n.getIntersection(t[0],t[1],t[2],t[3]);return null===o?null:(o.x+=r*e*.5,o.y+=i*e*.5,o)},this.getOuterRect=function(t,e,n){return new Fo(t*(n-1)*.5,e*(n-1)*.5,t,e)},this.transformPoint=function(t,e,n){return t&&void 0!==t.x&&void 0!==t.y?{x:t.x+e,y:t.y+n}:t},this.getInnerRect=function(t,e,r,i,o){var a=n.transformPoint(t,.5*-r*o,.5*-i*o),s=n.transformPoint(a,0,20),u=n.transformPoint(a,10,20),h=n.getIntersection(e[0],e[1],s,u),c=n.getIntersection(e[2],e[3],s,u),l=n.transformPoint(h,0,-70),f=new Fo(l.x+r*o*.5,l.y+i*o*.5,c.x-h.x,70);return f=n.fixInnerRectPosition(f,t),f=n.fixInnerRectSize(f,t,r)},this.fixInnerRectPosition=function(t,e){var n=t,r=(e.x-t.x)/t.width,i=0;return r>.7&&(i=r-.7),r<.3&&(i=.3-r),n.x=n.x+n.width*i,n},this.fixInnerRectSize=function(t,e,n){var r,i,o,a,s=t;s.width/n>.12&&(a=(o=.12*n)*(s.width/s.height),r=s.x+(s.width-o)*(e.x-s.x)/s.width,i=s.y+(s.height-a)*(e.y-s.y)/s.height,s=new Fo(r,i,o,a));var u=s.width/s.height;return a=s.height,u>1.2&&(a=s.height*u/1.2),u<.9&&(a=s.height*u/.9),i=s.y+s.height-a,s.height=a,s.y=i,s},this.panoData=t.panoData,this.camera=t.camera,this.projectionMatrix=this.camera.projectionMatrix,this.fov=g(this.camera.fov),this.traverseDir=e,this.cameraHeading=t.getPov().heading||0,this.isMovingForward=this.angleDegreeDelta(this.cameraHeading,this.traverseDir)<=90,this.roadWith=Math.min(1.5*this.panoData.getRoadWidth(),10),this.deviceHeight=this.panoData.deviceHeight||2.2,this.panoWidth=t._container.clientWidth,this.panoHeight=t._container.clientHeight;var r=this.angleDegreeDelta(this.cameraHeading,this.traverseDir)>45;this.snapshotRatio=r?1:1.8,this.projectionRoadInfos=this.getRoad(this.roadWith,this.deviceHeight,this.projectionMatrix,this.panoWidth,this.panoHeight),this.vanishPoint=this.calculateVanishPoint(this.projectionRoadInfos,this.snapshotRatio,this.panoWidth,this.panoHeight),this.innerRect=this.getInnerRect(this.vanishPoint,this.projectionRoadInfos,this.panoWidth,this.panoHeight,this.snapshotRatio),this.outerRect=this.getOuterRect(this.panoWidth,this.panoHeight,this.snapshotRatio),this.focusLength=.5*this.panoHeight/Math.tan(.75*this.fov),this.vanishPointDeltaX=this.vanishPoint.x-this.outerRect.x-.5*this.outerRect.width,this.vanishPointDeltaY=this.vanishPoint.y-this.outerRect.y-.5*this.outerRect.height},zo={FAR:[10,10,0],LEFT:[0,10,30],RIGHT:[0,10,30],TOP:[10,0,30],BOTTOM:[10,0,30]},Vo={FAR:["innerTopLeftVertex","innerBottomRightVertex"],LEFT:["outerTopLeftVertex","innerBottomLeftVertex"],RIGHT:["innerTopRightVertex","outerBottomRightVertex"],TOP:["outerTopLeftVertex","innerTopRightVertex"],BOTTOM:["innerBottomLeftVertex","outerBottomRightVertex"]},Go=Object.keys(zo),Wo=function(t){function e(e,n){var r;if((r=t.call(this)||this).createSkeleton=function(t){var e=t.vanishPoint,n=t.innerRect,r=t.outerRect,i=t.focusLength,o=r.y+r.height-n.y-n.height,a=e.y-n.y,s=e.x-n.x,u=n.x+n.width-e.x,h=r.y+r.height-e.y,c=o*i/(h-o),l=u*(i+c)/i,f=-(s*(i+c)/i),d=h+a*(i+c)/i-h,p=-h,v=c/5;return{innerTopLeftVertex:{x:f,y:d,z:-c},innerBottomLeftVertex:{x:f,y:p,z:-c},innerTopRightVertex:{x:l,y:d,z:-c},innerBottomRightVertex:{x:l,y:p,z:-c},outerTopLeftVertex:{x:f,y:d,z:v},outerTopRightVertex:{x:l,y:d,z:v},outerBottomLeftVertex:{x:f,y:p,z:v},outerBottomRightVertex:{x:l,y:p,z:v}}},r.modelSkeleton=function(t,e){var n=[],i=[];return Go.forEach((function(o){var a=xi(Vo[o],2),s=a[0],u=a[1],h=n.length/3;n=n.concat(r.calculatePlaneVertex(t[s],t[u],o,e)),i=i.concat(r.calculateIndices(o,h))})),[n,i]},r.calculatePlaneVertex=function(t,e,n,i){for(var o,a=[],s=xi(zo[n],3),u=s[0],h=s[1],c=s[2],l=r.linerInterpolate(t.x,e.x,u),f=r.linerInterpolate(t.y,e.y,h),d=r.linerInterpolate(t.z,e.z,c),p=0;p<=u;p++)for(var v=0;v<=h;v++)for(var m=0;m<=c;m++)En(o=hn(l[p],f[v],d[m],1),o,i),o[0]=o[0]/o[3],o[1]=o[1]/o[3],o[2]=o[2]/o[3],a.push(o[0],o[1],o[2]);return a},r.calculateIndices=function(t,e){var n=[],r=zo[t];r=r.filter((function(t){return t>0}));for(var i=xi(r,2),o=i[0],a=i[1],s=0,u=0,h=0,c=0,l=0;l<o;l++)for(var f=0;f<a;f++)u=(s=e+(a+1)*l+f)+1,c=(h=s+a+1)+1,n.push(s,h,c),n.push(s,c,u);return n},r.linerInterpolate=function(t,e,n){var r=[];if(n<=0)r.push(t);else for(var i=(e-t)/n,o=0;o<=n;o++)r[o]=t+i*o;return r},r.calculateUVCoordinate=function(t,e,n){for(var i,o=t.camera,a=t.panoWidth,s=t.panoHeight,u=t.vanishPointDeltaX,h=t.vanishPointDeltaY,c=[],l=e.width,f=e.height,d=0,p=0,v=n.length/3,m=0;m<v;m++)En(i=hn(n[3*m],n[3*m+1],n[3*m+2],1),i,o.viewMatrix),En(i,i,o.projectionMatrix),i[0]=i[0]/i[3],i[1]=i[1]/i[3],i[2]=i[2]/i[3],i[3]=1,d=(i[0]*a*.5+u+.5*l)/l,p=(i[1]*s*.5+h+.5*f)/f,c.push(r.getValidateUV(d),r.getValidateUV(p));return new Float32Array(c)},r.getValidateUV=function(t){return Math.max(-.1,Math.min(1.1,t))},r.rotationMatrix=Pe(),r.camera=e.camera,e.isMovingForward)Ve(r.rotationMatrix,r.rotationMatrix,g(_(-e.traverseDir+e.panoData.heading)));else{var i=_(180-e.traverseDir+e.panoData.heading);Ve(r.rotationMatrix,r.rotationMatrix,g(i))}r.cuboidVertexes=r.createSkeleton(e);var o=r.modelSkeleton(r.cuboidVertexes,r.rotationMatrix),a=xi(o,2),s=a[0],u=a[1];return r.verticesBufferData=new Float32Array(s),r.indicesBufferData=new Uint16Array(u),r.uvtsBufferData=r.calculateUVCoordinate(e,n,s,r.rotationMatrix),r.setAttribute("position",new Gr(r.verticesBufferData,3)),r.setAttribute("uv",new Gr(r.uvtsBufferData,2)),r.setIndexes(r.indicesBufferData),r}return c(e,t),e}(Zr),Ho=[0,1,0,.5],Zo=function(){function t(t,e,n,r,i){var o=this;this.start=function(){o.animation.start(),o._pano.dispatchEvent({debug:!0,log:"淡出动画，渲染一帧",type:d.REFRESH})},this.update=function(){o.animation.update()},this._pano=t,this.distance=e,this.handleEnd=i,this.traverseDir=r,this.snapshot=n,this.camera=t.camera,this.scene=this.initScene(),this.rotationMatrix=this.traverseGeometry.rotationMatrix,this.initAni()}var e=t.prototype;return e.initAni=function(){var t=this,e=Vt(0,0,this.distance);ee(e,e,this.rotationMatrix),this.animation=new ho(0,1,700,so.linear).onUpdate((function(n){var r=Ft();Yt(r,e,n),t.scene.traverse((function(t){t.position=r,t.updateWorldMatrix(!0)})),t._pano.dispatchEvent({debug:!0,type:d.REFRESH,log:"[Refresh Log] 前进动画， 渲染一帧"})})).onEnd((function(){t.handleEnd&&t.handleEnd(),t._pano.dispatchEvent({debug:!0,type:d.REFRESH,log:"[Refresh Log] 前进动画， 渲染一帧"})}))},e.initScene=function(){var t=new Qr,e=this._pano.getContainerSize(),n=e.width,r=e.height,i=new jo(this._pano,this.traverseDir),o=new Fo(0,0,n,r),a=new Wo(i,o),s=this.initMaterial(),u=new Kr(a,s);return this.traverseGeometry=a,t.add(u),t},e.initMaterial=function(){var t=new Ti;return t.depthTest=!1,t.vertexShader=Ao,t.fragmentShader=Co,t.uniforms={uSampler:{type:"t",value:this.snapshot},uOpacity:{type:"1f",value:1},vColor:{type:"4f",value:Ho},showDebugLine:{type:"1i",value:true}},this.material=t,t},t}(),qo=function(){function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=t,this.y=e}return t.prototype.equals=function(t){return t&&t.x===this.x&&t.y===this.y},t}(),Yo=function(){function t(t,e){var n=this;this.setData=function(t,e){n.panoData=t,n.nextPanoData=e},this.sceneChangeHandler=function(){if(n.panoData&&n.nextPanoData)return new Promise((function(t){var e=n.isStreet(n.panoData.panoType),r=n.isStreet(n.nextPanoData.panoType),i=n.snapshotFn(),o=n.pano.animationType;if(o&&["waterwave","fade"].indexOf(o)>-1)switch(o){case"waterwave":n.prepareWaterWave(i),t();break;case"fade":n.prepareFade(i),t()}else r&&e?(n.setDir(),n.prepareTraverse(i).then((function(e){n.prepareFade(e),t()}))):(n.prepareFade(i),t())}))},this.setSnapshot=function(t){n.snapshot=t},this.pano=t,this.snapshotFn=e,this.panoData=null,this.nextPanoData=null,this.changeAni=null,this.animateDir=0}var e=t.prototype;return e.draw=function(){if(this.changeAni){var t=this.changeAni,e=t.scene,n=t.camera;this.changeAni.update(),this.pano.renderer.render(e,n)}},e.setDir=function(){if(this.panoData&&this.nextPanoData){var t=this.nextPanoData.panoId,e=this.panoData.getTopos().filter((function(e){return e&&e.panoId===t}));if(e.length){var n=e[0].topoDir;this.animateDir=n}else this.animateDir=this.pano.getPov().heading||0}},e.prepareJump=function(){var t=this,e=this.calcJumpDistance();return new Promise((function(n){t.changeAni=new No(t.pano,t.animateDir,e,(function(){t.changeAni=null,n()})),t.changeAni.startAni(),t.pano.dispatchEvent({debug:!0,log:"穿梭动画，渲染一帧",type:d.REFRESH})}))},e.prepareTraverse=function(t){var e=this,n=this.calcJumpDistance();return new Promise((function(r){e.changeAni=new Zo(e.pano,n,t,e.animateDir,(function(){var t=e.snapshotFn(e.changeAni.scene,e.changeAni.camera);r(t),e.changeAni=null})),e.changeAni.start(),e.pano.dispatchEvent({debug:!0,log:"穿梭动画，渲染一帧",type:d.REFRESH})}))},e.prepareFade=function(t){var e=this;this.changeAni=new ko(this.pano,t,(function(){e.changeAni=null,e.pano.emit(d.SCENE_CHANGE_END)}))},e.prepareWaterWave=function(t){var e=this;this.changeAni=new Uo(this.pano,t,(function(){e.changeAni=null,e.pano.emit(d.SCENE_CHANGE_END)}))},e.calcJumpDistance=function(){var t,e,n=300,r=(t=new qo(this.panoData.panoX,this.panoData.panoY),e=new qo(this.nextPanoData.panoX,this.nextPanoData.panoY),t&&e?Math.round(Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))):0);"number"==typeof r&&(n*=Math.pow(r,1/4));return n},e.isStreet=function(t){return t===p.TYPE_STREET},t}(),Xo=function(){function t(t,e){var n=e.fov,r=void 0===n?145:n,i=e.cameraY,o=void 0===i?3e3:i,a=e.handleEnd;this._pano=void 0,this.originFov=void 0,this.originRotateX=void 0,this.originRotateY=void 0,this.targetFov=void 0,this.targetCameraY=void 0,this.handleEnd=void 0,this.animate=void 0,this._pano=t,this.originFov=this.camera.fov,this.originRotateX=this.camera.rotation.x,this.originRotateY=this.camera.rotation.y,this.targetFov=r,this.targetCameraY=o,this.handleEnd=a,this.init()}var e=t.prototype;return e.start=function(){this._pano.dispatchEvent({type:d.REFRESH,debug:!0,log:"开场动画动画起始，渲染一帧"}),this.animate.start()},e.update=function(){this.animate.update()},e.init=function(){var t=this,e=this.camera;this.handleCameraChange(0),this.animate=new ho(0,1,p.FISHEYE_DURATION,so.easeInOutQuad).onUpdate((function(e){t.handleCameraChange(e),t._pano.dispatchEvent({type:d.REFRESH,debug:!0,log:"开场动画动画，渲染一帧"})})).onEnd((function(){e.fov=t.originFov,e.rotateX(t.originRotateX),e.rotateY(t.originRotateY),e.setPosition(0,0,0),e.updateWorldMatrix(),e.updateProjectionMatrix(),t._pano.dispatchEvent({type:d.REFRESH,debug:!0,log:"开场动画动画结束，渲染一帧"}),t.handleEnd()}))},e.handleCameraChange=function(t){var e=this.camera,n=this.targetCameraY,r=this.targetFov-(this.targetFov-this.originFov)*t,i=(this.originRotateX- -90)*t-90,o=this.originRotateY*t;e.fov=r,e.rotateX(i),e.rotateY(o),e.setPosition(0,n-n*t,0),e.updateWorldMatrix(),e.updateProjectionMatrix()},o(t,[{key:"camera",get:function(){return this._pano.camera}}]),t}();function Ko(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return Qo(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qo(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Qo(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Jo=function(){function t(t){var e=this;this.name="PanoOverlayManager",this.overlays=[],this.pano=void 0,this.isReady=!1,this.clickChecker=function(t,n){var r,i=!0,o=Ko(e.overlays);try{for(o.s();!(r=o.n()).done;){var a=r.value,s=a.dom.getBoundingClientRect(),u=s.left,h=s.right,c=s.top,l=s.bottom;if(t>=u&&t<=h&&n>=c&&n<=l){i=!1,a.handleClick();break}}}catch(t){o.e(t)}finally{o.f()}return i},this.pano=t}var e=t.prototype;return e.handleAdd=function(t){t&&t.id&&(this.overlays.some((function(e){return e.id===t.id}))||(this.overlays.push(t),this.isReady&&t.init(this.pano)))},e.handleRemove=function(t){for(var e=0;e<this.overlays.length;e++)if(this.overlays[e].id===t.id)return this.overlays[e].remove(),void this.overlays.splice(e,1)},e.init=function(){this.isReady=!0;var t,e=Ko(this.overlays);try{for(e.s();!(t=e.n()).done;){t.value.init(this.pano)}}catch(t){e.e(t)}finally{e.f()}},e.draw=function(){if(this.isReady){var t,e=Ko(this.overlays);try{for(e.s();!(t=e.n()).done;){t.value.draw()}}catch(t){e.e(t)}finally{e.f()}}},e.destroy=function(){var t,e=Ko(this.overlays);try{for(e.s();!(t=e.n()).done;){t.value.remove()}}catch(t){e.e(t)}finally{e.f()}this.overlays=[]},t}();function $o(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return ta(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ta(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ta(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ea=function(){function t(t){var e=this;this.renderer=void 0,this.gl=void 0,this.camera=void 0,this.cameraNoFix=null,this.panoData=null,this.scene=void 0,this.sceneChange=void 0,this.openingAni=void 0,this.sphereRender=void 0,this.linkGLRender=void 0,this.overlayManager=void 0,this.skyboxRender=void 0,this.pano=void 0,this.renderThreadId=null,this.requestId=null,this.isRAFRuning=!1,this.setData=function(){var t=nt(ot.mark((function t(n){var r,o;return ot.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:if(!e.panoData||!e.pano.useAnimation){t.next=8;break}return e.sceneChange.setData(e.panoData,n),t.next=6,e.sceneChange.sceneChangeHandler();case 6:void 0!==e.pano.backupUseAnimation&&(e.pano.useAnimation=e.pano.backupUseAnimation),e.pano.animationType="";case 8:e.reset(),e.panoData=n,e.pano.panoData=n,void 0===i(n.defaultHeading)&&void 0===i(n.defaultPitch)||e.pano.handlePovChange({heading:n.defaultHeading,pitch:n.defaultPitch}),r=n.image&&6===n.image.length,(o=r?e.skyboxRender:e.sphereRender).setData(n),e.linkGLRender.setData(n),e.overlayManager.init(),e.scene.add(o.meshs),e.updateProjectionMatrix(e.camera),e.updateCameraHeadingAndPitch(e.camera);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.getSnapshot=function(t,n){t=t||e.scene,n=n||e.camera;var r=e.pano.getContainerSize(),i=r.width,o=r.height,a=new Vi(i,o);return a.premultiplyAlpha=!0,e.renderer.render(t,n,a),a},this.update=function(){e.panoData&&(e.sphereRender.update(),e.linkGLRender.update(),e.startRenderThread())},this.onThumbLoaded=function(){e.sceneChange.changeAni&&e.sceneChange.changeAni.start();var t=e.linkGLRender.meshs;t&&e.scene.add(t),e.startFishEyeAni()},this.startRenderThread=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;e.renderThreadId&&(clearTimeout(e.renderThreadId),e.renderThreadId=null),e.renderThreadId=window.setTimeout((function(){e.isRAFRuning=!1,e.renderThreadId=null}),t),e.isRAFRuning||(e.isRAFRuning=!0,e.renderFrame())},this.resize=function(){var t=e.pano.getContainer();e.renderer.setSize(t.clientWidth,t.clientHeight)};var n=window.devicePixelRatio||1,r=t.getContainer();this.pano=t,this.renderer=new Ui({premultipliedAlpha:!1,preserveDrawingBuffer:t.opts.enableCapture||!1,antialias:!(n>1),pixelRatio:n,width:r.clientWidth,height:r.clientHeight}),this.renderer.setSize(r.clientWidth,r.clientHeight),t.getPanes().tileLayer.appendChild(this.renderer.domElement),this.gl=this.renderer.getContext(),this.camera=new Ki(75,r.clientWidth/r.clientHeight,.01,67e3),this.scene=new Qr,t.gl=this.gl,t.canvas=this.renderer.domElement,t.scene=this.scene,t.camera=this.camera,t.cameraNoFix=this.cameraNoFix,t.renderer=this.renderer,t.renders=[],this.sceneChange=new Yo(t,this.getSnapshot),this.initModule()}var e=t.prototype;return e.initModule=function(){var t=this.pano;this.sphereRender=new So(t),this.linkGLRender=new Bo(t),this.overlayManager=new Jo(t),this.skyboxRender=new eo(t),this.pano.renders.push(this.sphereRender,this.linkGLRender,this.overlayManager,this.skyboxRender)},e.reset=function(){this.scene.remove(this.sphereRender.meshs),this.scene.remove(this.linkGLRender.meshs)},e.getModule=function(t){var e,n=null,r=$o(this.pano.renders);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(i.name===t){n=i;break}}}catch(t){r.e(t)}finally{r.f()}return n},e.renderFrame=function(){!1!==this.isRAFRuning?(this.openingAni&&this.openingAni.update(),this.sphereRender.draw(),this.renderer.render(this.scene,this.camera),this.overlayManager.draw(),this.sceneChange.draw(),this.requestId=requestAnimationFrame(this.renderFrame.bind(this))):this.requestId&&(cancelAnimationFrame(this.requestId),this.requestId=null)},e.startFishEyeAni=function(){var t=this;this.pano.fisheye&&(this.openingAni=new Xo(this.pano,{handleEnd:function(){t.openingAni=null,t.pano.fisheye=!1}}),setTimeout((function(){t.openingAni.start(),t.startRenderThread()}),p.FISHEYE_DELAY))},e.updateProjectionMatrix=function(t,e){var n=this.pano.getFov(e),r=this.pano.getContainerSize(),i=r.width/r.height;t.fov=n,t.aspect=i,t.updateProjectionMatrix()},e.updateCameraHeadingAndPitch=function(t){var e=this.pano.getPov(),n=e.heading,r=e.pitch,i=this.panoData,o=i.fixHeading,a=void 0===o?0:o,s=i.fixPitch,u=void 0===s?0:s,h=i.fixRoll,c=void 0===h?0:h;t.rotateX(r-u),t.rotateY(-n+a),t.rotateZ(c),t.updateWorldMatrix()},e.safeCall=function(t,e,n){var r=this.getModule(t);if(r&&r[e])return r[e].apply(r,n||[]);throw new Error("[safeCall] get module error => ".concat(t))},o(t,[{key:"isCanUpdate",get:function(){var t=this.sceneChange.changeAni,e=this.openingAni;return this.panoData&&!(t||e)}}]),t}(),na=function(){function t(t){var e=this;this.updateAnglePerPixel=function(){e._anglePerPixel=e._pano.calcAnglePerPixel()},this.destroy=function(){e.bindEvent(!1)},this._pano=t,this._displayZoom=t.getZoom(),this._anglePerPixel=t.calcAnglePerPixel(),this._container=t.getContainer(),this.lock=!1,this.clickTimer=null,this.dragAni=null,this.state={initPos:null,initHeading:0,initPitch:0,lastDiffPos:null,moveDiffPos:null,isTouchDown:!1,isTouchMove:!1,startTime:0,lastMoveTime:0}}var e=t.prototype;return e.init=function(){if(!this._initialized){if(this._initialized=!0,this.isMobile=navigator.userAgent.toLowerCase().match(/ipod|ipad|iphone|android/),this.isMobile){this.EVENTS={START:"touchstart",MOVING:"touchmove",END:"touchend",OUT:"touchcancel",WHEEL:"gesturechange",DOMMouseScroll:"DOMMouseScroll"};var t=this._container.getBoundingClientRect?this._container.getBoundingClientRect():{},e=t.left,n=void 0===e?0:e,r=t.top,i=void 0===r?0:r;this.getPagePosition=function(t){var e=t.touches.length>0?t.touches[0]:t.changedTouches[0];return{x:e.pageX-n,y:e.pageY-i}}}else this.EVENTS={START:"mousedown",MOVING:"mousemove",END:"mouseup",OUT:"mouseout",WHEEL:"mousewheel"},this.getPagePosition=function(t){return{x:t.offsetX,y:t.offsetY}};this.bindEvent()}},e.bindEvent=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=document.body,n=this.EVENTS,r=n.START,i=n.MOVING,o=n.END,a=this._pano._svContainer,s=t?"addEventListener":"removeEventListener";a[s](r,this.handleDown.bind(this)),a[s](i,this.handleMove.bind(this)),e[s](o,this.handleUp.bind(this))},e.handleDown=function(t){this.dragAni&&this.dragAni.stop();var e=this.state,n=this.getPagePosition(t),r=this._pano.getPov();e.initPos=n,e.isTouchDown=!0,e.initHeading=r.heading,e.initPitch=r.pitch,e.startTime=x(),this._pano.dispatchEvent(d.TOUCH_START,t)},e.handleMove=function(t){if(this.state.isTouchDown){this.state.isTouchMove=!0;var e=this.calcDiffPos(this.state.initPos,this.getPagePosition(t));this.setPov(e),this.state.moveDiffPos=e,this.state.lastDiffPos=e,this.state.lastMoveTime=x(),t.preventDefault(),t.stopPropagation()}},e.handleUp=function(t){var e=this;if(this.state.isTouchDown){var n=!0,r=this.getPagePosition(t);if(t.pos=r,this.state.isTouchDown=!1,this._pano.dispatchEvent(d.TOUCH_END,t),this._pano.renders.length)for(var i=0;i<this._pano.renders.length;i++){var o=this._pano.renders[i];if(o.clickChecker&&!(n=o.clickChecker(r.x,r.y))){t.stopPropagation();break}}if(!1!==n)if(this.state.isTouchMove)this.state.isTouchMove=!1,this.processMotion(t);else if(t.stopPropagation(),this.clickTimer)clearTimeout(this.clickTimer),this.clickTimer=null,this._pano.dispatchEvent(d.DOUBLE_CLICK,t);else{this.clickTimer=setTimeout((function(){e.clickTimer=null,e._pano.dispatchEvent(d.CLICK,t)}),300)}}},e.setPov=function(t){var e=t.x,n=t.y,r=-e*this._anglePerPixel,i=n*this._anglePerPixel,o=this.state.initHeading+r,a=this.state.initPitch+i;this._pano.setPov({heading:o,pitch:a})},e.processMotion=function(t){var e=this,n=this.state,r=x(),i=r-n.lastMoveTime,o=n.moveDiffPos,a=o.x,s=o.y;if(i<300&&(Math.abs(a)>10||Math.abs(s)>10)){var u=this.calcDiffPos(this.state.initPos,this.getPagePosition(t)),h=2*Math.sqrt(Math.pow(u.x,2)+Math.pow(u.y,2))/(.008*(r-n.startTime)),c=[u.x>0?1:-1,u.y>0?1:-1],l=Math.abs(u.x),f=Math.abs(u.y),p=Math.atan2(f,l),v=Math.cos(p)*h,m=Math.sin(p)*h;-1===c[0]&&(v=-v),-1===c[1]&&(m=-m),this.dragAni&&this.dragAni.stop();var g=this._pano.getPov(),y=g.heading,_=g.pitch;n.initHeading=y,n.initPitch=_;this.dragAni=new ho(0,1,400,(function(t){return.3125*t-.15625*t*t})).onUpdate((function(t){var n=(t*=6.4)*v,r=t*m;e.setPov({x:n,y:r})})).onEnd((function(){e.dragAni=null,e._pano.dispatchEvent({type:d.POV_CHANGED_END})})).startAndAutoUpdate()}else this._pano.dispatchEvent({type:d.POV_CHANGED_END})},e.calcDiffPos=function(t,e){return t&&e?{x:e.x-t.x,y:e.y-t.y}:{x:0,y:0}},t}();function ra(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return ia(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ia(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ia(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var oa=function(){function t(t){this.pano=t,this.preZoom=t.getZoom(),this.zoomChangeAni=null,this.debug=!1,this.panoServiceLock=!1,this.bindEvent(),this.initModule(),this.initResize(),this.handleContextStatus()}var e=t.prototype;return e.initModule=function(){var t=this.pano;this.panoService=new tt(t),this.panoGLRender=new ea(t),this.op=new na(t)},e.initResize=function(){var t=this,e=this.pano.getContainerSize(),n=this.pano.getContainer(),r=function(n,r){if(n&&r){var i=new l(n,r);i.equals(e)||(t.pano.dispatchEvent({type:d.SIZE_CHANGED}),e=i)}};if(void 0!==window.ResizeObserver){var i=new window.ResizeObserver((function(t){var e,n=ra(t);try{for(n.s();!(e=n.n()).done;){var i=e.value.target;r(i.clientWidth,i.clientHeight)}}catch(t){n.e(t)}finally{n.f()}}));i.observe(n),this.resizeOb=i}else this.checkSizeTimer=setInterval((function(){r(n.clientWidth,n.clientHeight)}),80)},e.bindEvent=function(){var t=this,e=this.pano;e.on(d.PANO_ERROR,(function(){t.panoServiceLock=!1})),e.on(d.DATA_LOADED,(function(n){t.pano.opts.visible?t.pano.show():t.pano.hide(),t.panoServiceLock=!1,n.options&&n.options.animation&&(e.backupUseAnimation=e.useAnimation,e.useAnimation=n.options.animation,""!==n.options.animationType&&(e.animationType=n.options.animationType)),t.panoGLRender.setData(n.data),t.op.init()})),e.on(d.SET_POV,(function(n){var r=n.pov,i=n.options,o=(void 0===i?{animation:!0}:i).animation;if(t.panoGLRender.isCanUpdate){var a=function(n){e.handlePovChange(n)&&(t.panoGLRender.updateCameraHeadingAndPitch(e.camera),t.panoGLRender.update(),e.dispatchEvent(d.POV_CHANGED,n))};if(o){var s=e.getPov(),u=s.heading,h=s.pitch,c=r.heading-u,l=r.pitch-h;c>180?(u+=360,c=r.heading-u):c<-180&&(u-=360,c=r.heading-u),new ho(0,1,400,so["ease-out"]).onUpdate((function(t){a({heading:u+t*c,pitch:h+t*l})})).onEnd((function(){})).startAndAutoUpdate()}else a(r)}else e.handlePovChange(r)})),e.on(d.ZOOM_CHANGED,(function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.panoGLRender.isCanUpdate){var r=t.preZoom,i=e.getZoom();if(r!==i){var o=n.noAnimation||!1;if(t.zoomChangeAni&&(t.zoomChangeAni.stop(),t.zoomChangeAni=null),o)return t.op.updateAnglePerPixel(),t.panoGLRender.updateProjectionMatrix(e.camera),t.panoGLRender.update(),void(t.preZoom=i);var a=400;t.zoomChangeAni=new ho(r,i,a,so.easeOutCubic).onUpdate((function(n){t.panoGLRender.updateProjectionMatrix(e.camera,n),t.panoGLRender.update(n)})).onEnd((function(){t.zoomChangeAni=null,t.preZoom=i})).startAndAutoUpdate()}}})),e.on(d.DOUBLE_CLICK,(function(){t.panoGLRender.isCanUpdate&&(v.isMobile&&(3===e.getZoom()?e.setZoom(2):e.setZoom(3)))})),e.on(d.REFRESH,(function(e){var n=e.duration||200;t.panoGLRender.startRenderThread(n),t.debug&&e.log&&e.debug&&console.warn(e.log)})),e.on(d.SET_ID,(function(e){if(!t.panoServiceLock&&e.id){t.panoServiceLock=!0,window.getPanoById=t.panoService.getPanoById;var n=(1e5*Math.random()).toFixed(0);BMapGL._rd=BMapGL._rd||{},BMapGL._rd["_cbk"+n]=function(t){t&&void 0!==t.error&&0===t.error?window.getPanoById(e.id):Q("PANORAMA"),delete BMapGL._rd["_cbk"+n]},K("PANORAMA","BMapGL._rd._cbk"+n)}})),e.on(d.SET_POSITION,(function(e){if(!t.panoServiceLock&&e.point){t.panoServiceLock=!0,window.getPanoByLocation=t.panoService.getPanoByLocation;var n=(1e5*Math.random()).toFixed(0);BMapGL._rd=BMapGL._rd||{},BMapGL._rd["_cbk"+n]=function(t){t&&void 0!==t.error&&0===t.error?window.getPanoByLocation(e.point):Q("PANORAMA"),delete BMapGL._rd["_cbk"+n]},K("PANORAMA","BMapGL._rd._cbk"+n)}})),e.on(d.SIZE_CHANGED,(function(){t.op.updateAnglePerPixel(),t.panoGLRender.resize(),t.panoGLRender.updateProjectionMatrix(e.camera),t.panoGLRender.update()})),e.on(d.THUMB_LOADED,(function(){t.panoGLRender.onThumbLoaded(),t.panoGLRender.update()})),e.on(d.OVERLAY_ADD,(function(e){t.panoGLRender.overlayManager.handleAdd(e)})),e.on(d.OVERLAY_REMOVE,(function(e){t.panoGLRender.overlayManager.handleRemove(e)})),e.on(d.OVERLAYS_CLEAR,(function(){t.panoGLRender.overlayManager.destroy()})),e.on(d.LINK_VISIBLE_CHANGE,(function(e){"boolean"==typeof e.value&&(t.panoGLRender.safeCall("PanoLinkRender","setVisible",[e.value]),t.pano.dispatchEvent(d.REFRESH))})),e.on(d.DESTROY,(function(){t.op.destroy(),t.resizeOb&&t.resizeOb.disconnect(),t.checkSizeTimer&&clearInterval(t.checkSizeTimer),t.panoGLRender.renderer.forceContextLoss(),e.canvas.removeEventListener("webglcontextlost",t.onWebGLContextLost,!1)}));var n=v.isFirefox?"DOMMouseScroll":"mousewheel",r=new Date;e._svContainer.addEventListener(n,(function(t){if(e.opts.enableScrollWheelZoom&&e.opts.visible){var n=new Date;if(n-r<400)return;r=n;var i=-t.detail/3||t.wheelDelta/120,o=e.getZoom()+i;e.setZoom(o),t.preventDefault()}}))},e.getImgZoom=function(){return this.pano.calcDisplayZoom().imgZoom},e.handleContextStatus=function(){this.pano.canvas.addEventListener("webglcontextlost",this.onWebGLContextLost,!1)},e.onWebGLContextLost=function(t){t.preventDefault(),setTimeout((function(){window.location.reload()}),200)},t}();function aa(t,e,n){t.addEventListener(e,n,!1)}var sa=function(t){function e(e,n){var r;(r=t.call(this)||this).panoData=null,r.opts=void 0,r.useAnimation=!1,r.backupUseAnimation=r.useAnimation,r.animationType="",r.fisheye=!1,r.canvas=void 0,r.camera=void 0,r.renderer=void 0,r.gl=void 0,r.scene=void 0,r.cameraNoFix=void 0,r.renders=void 0,r.closeBtn=null,r.navigator=null,r._container=void 0,r._pov={heading:0,pitch:0},r._id=null,r._position=null,r._zoom=2,r._displayZoomResultsCache={},r._svContainer=void 0,r._eventManager=void 0,r._panes=void 0,r.addCloseButton=function(t){var e=r.closeBtn=document.createElement("div");e.className="pano_close",e.style.cssText=["position:absolute","right:10px","top:10px","padding: 5px 8px;","cursor:pointer","border-radius: 4px","font-size: 14px","background-color: rgba(0,0,0,.55)","z-index: 99","color: #fff"].join(";"),e.innerText="关闭",e.title="退出全景",e.onclick=function(){r.hide(),t&&t()},r._svContainer.appendChild(e)},r.getContainer=function(){return r._container},r.getContainerSize=function(){var t=r._container;return new l(t.clientWidth,t.clientHeight)},r.getPanes=function(){return r._panes},r.show=function(){r.opts.visible=!0,w.show(r._svContainer)},r.hide=function(){r.opts.visible=!1,w.hide(r._svContainer)},r.getZoom=function(){return r._zoom},r.setZoom=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t!==r._zoom&&(t>p.MAX_ZOOM&&(t=p.MAX_ZOOM),t<p.MIN_ZOOM&&(t=p.MIN_ZOOM),t!==r._zoom&&(r._zoom=t,r.dispatchEvent(d.ZOOM_CHANGED,{noAnimation:e.noAnimation||!1})))},r.getPov=function(){return r._pov},r.setPov=function(t,e){r.dispatchEvent(d.SET_POV,{pov:t,options:e||{animation:!1}})},r.handlePovChange=function(t){if("object"===i(t)){var e=!1,n=t.heading,o=t.pitch;if("number"!=typeof n||isNaN(n)||(e=!0,n=_(n),r._pov.heading=n),"number"==typeof o&&!isNaN(n)){e=!0;var a=r.opts.minPitch,s=r.opts.maxPitch;o>s&&(o=s),o<a&&(o=a),r._pov.pitch=o}return e}},r.calcDisplayZoom=function(t,e){t=t||r.getContainerSize(),e=e||r.getZoom();var n=t,i=n.width,o=n.height,a=r.opts.maxImageZoom,s=r.opts.minImageZoom,u="".concat(i,"_").concat(o,"_").concat(e);if(r._displayZoomResultsCache[u])return r._displayZoomResultsCache[u];for(var h=r.calcAnglePerPixel(),c=Math.floor(e)+2,l=360/(2*Math.pow(2,c-2)*h);l>512;)c++,l=360/(2*Math.pow(2,c-2)*h);if(c>a){var f=c-a;l*=Math.pow(2,f),c=a}c<s&&(c=s);var d={imgZoom:c,displayTileSize:l=Math.round(l)};return r._displayZoomResultsCache[u]=d,d},r.calcAnglePerPixel=function(){return r.getFov()/r.getContainerSize().height},r.getFov=function(t){return t=t||r.getZoom(),(v.isMobile?r.calcMobileFovy:r.calcPCFovy).call(a(r),t)},r.getVisible=function(){return r.opts.visible},r.setId=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.useAnimation=e.animation||!1,r.fisheye=e.fisheye||!1,r.animationType=e.animationType||"",r.dispatchEvent(d.SET_ID,{id:t})},r.setPosition=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r.useAnimation=e.animation||!1,r.fisheye=e.fisheye||!1,r.animationType=e.animationType||"",r.dispatchEvent(d.SET_POSITION,{point:t})};var o={minImageZoom:p.TILE_MIN_ZOOM,maxImageZoom:p.TILE_MAX_ZOOM,minPitch:p.MIN_PITCH,maxPitch:p.MAX_PITCH,radius:p.RADIUS,tileBaseUrls:p.TILE_BASE_URLS,linksControl:!0,navigationControl:!0,enableScrollWheelZoom:!0,enableCapture:!1,visible:!0};r.opts=Object.assign({},o,n);var s="string"==typeof e?document.querySelector(e):e;if(!s)throw new Error("全景引擎宿主容器不存在");return r._container=s,r._init(),r}c(e,t);var n=e.prototype;return n.getPosition=function(){return this.position},n.setOptions=function(t){var e;for(e in t)if(Object.prototype.hasOwnProperty.call(t,e)){var n=!0;if("object"!==i(t[e])&&(n=t[e]!==this.opts[e]),this.opts[e]=t[e],!n)continue;switch(e){case"linksControl":this.dispatchEvent(d.LINK_VISIBLE_CHANGE,{value:t[e]});break;case"navigationControl":var r=!!t[e],o=this.navigator;r?o.show():o.hide()}}},n.capture=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.canvas){var e=this.canvas,n=t.quality||.8,r=t.type||"image/jpeg",i=e.toDataURL(r,n);return i}},n.addOverlay=function(t){this.dispatchEvent(d.OVERLAY_ADD,t)},n.removeOverlay=function(t){this.dispatchEvent(d.OVERLAY_REMOVE,t)},n.clearOverlays=function(){this.dispatchEvent(d.OVERLAYS_CLEAR)},n.destroy=function(){this.dispatchEvent(d.DESTROY)},n._init=function(){this._createDoms(),this.navigator=function(t){function e(t){this._initialize(t)}return m(e.prototype,{_initialize:function(t){this._pano=t,this.imgPath=t.opts.imgPath||"//api0.map.bdimg.com/images/",this._zoomInEnabled=!0,this._zoomOutEnabled=!0,this._render(),this._bind()},_render:function(){this._container=w.create("div");var t=this._container.style;t.position="absolute",t.left="10px",t.top="10px",t.zIndex=99;var e=this._container;e.innerHTML=this._generateHtml(),v.isPc?(this._panBtnContainer=e.children[2],this._panBtns=[this._panBtnContainer.children[0],this._panBtnContainer.children[1],this._panBtnContainer.children[2],this._panBtnContainer.children[3]],this._svgDirGroup=e.children[1].childNodes[0],this._zoomContainer=e.children[3]):v.isMobile&&(this._zoomContainer=e.children[0]),this._btnZoomIn=this._zoomContainer.children[0],this._btnZoomOut=this._zoomContainer.children[1],v.isMobile&&(this._zoomContainer.style.left=this._zoomContainer.style.top="0",this._zoomContainer.style.width="36px",this._zoomContainer.style.height="78px",this._btnZoomIn.style.width=this._btnZoomOut.style.width="33px",this._btnZoomIn.style.height=this._btnZoomOut.style.height="36px",this._btnZoomOut.style.top="37.5px"),this._pano.getZoom()>=p.MAX_ZOOM&&this._setZoomBtnEnabled("zoomIn",!1),this._pano.getZoom()<=p.MIN_ZOOM&&this._setZoomBtnEnabled("zoomOut",!1),this._pano._svContainer.appendChild(e)},_generateHtml:function(){var t=[];return v.isPc&&(t.push(this._generatePanHtml()),t.push(this._generateDirHtml()),t.push(this._generatePanBtnHtml())),t.push(this._generateZoomContainerHtml()),t.join("")},_generateDirHtml:function(){return'<svg version="1.1" overflow="hidden" width="82px" height="82px" viewBox="0 0 82 82"style="position: absolute; top: 0px; left: 0px;"><g transform="rotate(0, 41, 41)"><rect x="33"y="1" width="14" height="12" rx="4" ry="4" stroke="#868685" stroke-width="1" fill="#f8f8f8"></rect><polyline points="37.5,9.5 37.5,3.5 42.5,9.5 42.5,3.5" stroke-linejoin="bevel" stroke-width="1.5" fill="#f2f4f6" stroke="#868685"></polyline></g></svg>'},_generatePanHtml:function(){return'<div style="position:absolute;top:4px;left:4px;width:74px;height:74px;background:url('+this.imgPath+'st-navictrl.png) no-repeat;-webkit-user-select:none;overflow:hidden"><div></div></div>'},_generatePanBtnHtml:function(){return'<div style="position:absolute;top:0px;left:0;width:82px;height:82px;user-select:none;"><div style="position:absolute;left:32px;top:13px;cursor:pointer;width:17px;height:17px;" title="向上平移"></div><div style="position:absolute;left:14px;top:32px;cursor:pointer;width:17px;height:17px;" title="向左平移"></div><div style="position:absolute;left:51px;top:32px;cursor:pointer;width:17px;height:17px;" title="向右平移"></div><div style="position:absolute;left:33px;top:51px;cursor:pointer;width:17px;height:17px;" title="向下平移"></div></div>'},_generateZoomContainerHtml:function(){var t="background-image:url('"+this.imgPath+"st-navictrl.png');background-repeat:no-repeat;background-position:-74px 0;";return v.isMobile&&(t="background-image:url('"+this.imgPath+"st-navictrl-hd.png');background-repeat:no-repeat;background-position:0 0;background-size:180px 78px;"),'<div style="position:absolute;top:84px;left:30px;width:24px;height:52px;'+t+'-webkit-user-select:none;overflow:hidden"><div style="position:absolute;cursor:pointer;width:22px;height:24px;top:0;left:0;-webkit-user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)" title="放大一级"></div><div style="position:absolute;cursor:pointer;width:22px;height:24px;top:25px;left:0;-webkit-user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)" title="缩小一级"></div><div></div></div>'},_bind:function(){var t=this._pano,e=this;if(v.isPc){aa(this._panBtns[0],"click",(function(){var e=t.getPov();t.setPov({heading:e.heading,pitch:e.pitch+30},{animation:!0})})),aa(this._panBtns[1],"click",(function(){var e=t.getPov();t.setPov({heading:e.heading-45,pitch:e.pitch},{animation:!0})})),aa(this._panBtns[2],"click",(function(){var e=t.getPov();t.setPov({heading:e.heading+45,pitch:e.pitch},{animation:!0})})),aa(this._panBtns[3],"click",(function(){var e=t.getPov();t.setPov({heading:e.heading,pitch:e.pitch-30},{animation:!0})}));for(var n=0;n<this._panBtns.length;n++)aa(this._panBtns[n],"mousedown",(function(t){t.stopPropagation()}));e._mousedown=!1,aa(this._panBtnContainer,"mousedown",(function(n){e._mousedown=!0,e._panBtnContainer.style.cursor="grabbing",e._startHeading=e._calcAngle(n),e._curHeading=t.getPov().heading,n.preventDefault()})),aa(document,"mousemove",(function(n){e._mousedown&&t.setPov({heading:e._curHeading+360-(e._calcAngle(n)-e._startHeading),pitch:t.getPov().pitch})})),aa(document,"mouseup",(function(){e._mousedown&&(e._mousedown=!1,e._panBtnContainer.style.cursor="grab",e._startHeading=null)})),t.addEventListener("position_changed",(function(){var t=360-this.getPov().heading;e._svgDirGroup.setAttribute("transform","rotate("+t+", 41, 41)")})),t.addEventListener("pov_changed",(function(){var t=360-this.getPov().heading;e._svgDirGroup.setAttribute("transform","rotate("+t+", 41, 41)")}))}aa(this._btnZoomIn,"click",(function(){t.setZoom(t.getZoom()+1)})),aa(this._btnZoomOut,"click",(function(){t.setZoom(t.getZoom()-1)})),v.isPc?(aa(this._btnZoomIn,"mousedown",(function(){e._redrawZoomBtn(e._zoomInEnabled,-98)})),aa(this._btnZoomOut,"mousedown",(function(){e._redrawZoomBtn(e._zoomOutEnabled,-122)})),aa(this._btnZoomIn,"mouseup",(function(){e._redrawZoomBtn(e._zoomInEnabled,-74)})),aa(this._btnZoomOut,"mouseup",(function(){e._redrawZoomBtn(e._zoomOutEnabled,-74)}))):v.isMobile&&(aa(this._btnZoomIn,"touchstart",(function(){e._redrawZoomBtn(e._zoomInEnabled,-98)})),aa(this._btnZoomOut,"touchstart",(function(){e._redrawZoomBtn(e._zoomOutEnabled,-122)})),aa(this._btnZoomIn,"touchend",(function(){e._redrawZoomBtn(e._zoomInEnabled,-74)})),aa(this._btnZoomOut,"touchend",(function(){e._redrawZoomBtn(e._zoomOutEnabled,-74)}))),t.addEventListener("zoom_changed",(function(n){t.getZoom()>=p.MAX_ZOOM?e._setZoomBtnEnabled("zoomIn",!1):t.getZoom()<=p.MIN_ZOOM?e._setZoomBtnEnabled("zoomOut",!1):(e._setZoomBtnEnabled("zoomIn",!0),e._setZoomBtnEnabled("zoomOut",!0))}))},_redrawZoomBtn:function(t,e){t&&(v.isMobile&&(e=(e+74)/24*36),this._zoomContainer.style.backgroundPosition=e+"px 0")},show:function(){this._container.style.display=""},hide:function(){this._container.style.display="none"},_calcAngle:function(t){var e=(t=window.event||t).pageX||t.clientX,n=t.pageY||t.clientY,r=this._pano.getContainer().getBoundingClientRect();e=e-r.left-50,n=-(n-r.top-50);var i=Math.atan2(n,e)/Math.PI*180;return i<90?90-i:450-i},_setZoomBtnEnabled:function(t,e){if("zoomIn"===t)if(e){this._zoomInEnabled=!0,this._btnZoomIn.style.cursor="pointer";var n=-74;v.isMobile&&(n=0),this._zoomContainer.style.backgroundPosition=n+"px 0"}else{this._zoomInEnabled=!1,this._btnZoomIn.style.cursor="";var r=-170;v.isMobile&&(r=-144),this._zoomContainer.style.backgroundPosition=r+"px 0"}if("zoomOut"===t)if(e){this._zoomOutEnabled=!0,this._btnZoomOut.style.cursor="pointer";var i=-74;v.isMobile&&(i=0),this._zoomContainer.style.backgroundPosition=i+"px 0"}else{this._zoomOutEnabled=!1,this._btnZoomOut.style.cursor="";var o=-146;v.isMobile&&(o=-108),this._zoomContainer.style.backgroundPosition=o+"px 0"}}}),new e(t)}(this),this._eventManager=new oa(this)},n._createDoms=function(){var t=this._container,e=w.create("div"),n=e.style;n.overflow="hidden",n.position="absolute",n.zIndex="20",n.top=n.left="0px",n.height=n.width="100%",n.backgroundColor="#e5e3df",n.display="none",n.cursor="grab",e.addEventListener("mousedown",(function(){return n.cursor="grabbing"})),e.addEventListener("mouseup",(function(){return n.cursor="grab"})),this._svContainer=e,this._panes={tileLayer:this._createContainer("1"),maskLayer:this._createContainer("2"),linksLayer:this._createContainer("3"),overlayLayer:this._createContainer("4"),effectLayer:this._createContainer("5")},e.appendChild(this._panes.tileLayer),e.appendChild(this._panes.linksLayer),e.appendChild(this._panes.overlayLayer),e.appendChild(this._panes.effectLayer),b()||(e.appendChild(this._panes.maskLayer),this._panes.maskLayer.style.width="".concat(t.clientWidth,"px"),this._panes.maskLayer.style.height="".concat(t.clientHeight,"px"),this._panes.maskLayer.style.overflow="hidden"),t.appendChild(e),"absolute"!==w.getCurrentStyle(t).position&&(t.style.position="relative")},n._createContainer=function(t){var e=w.create("div"),n=e.style;return n.position="absolute",n.top=n.left="0",n.zIndex=t||"0",e},n.calcMobileFovy=function(t){var e=this.getContainerSize(),n=e.width,r=e.height,i=240/Math.pow(2,t),o=n/2/Math.tan(g(i/2)),a=Math.atan2(r/2,o);return 2*y(a)},n.calcPCFovy=function(t){return 90-15*(t-1)},o(e,[{key:"imageZoom",get:function(){return this.calcDisplayZoom().imgZoom}},{key:"panoId",get:function(){return this.panoData?this.panoData.panoId:""}},{key:"panoNorthDir",get:function(){return this.panoData?this.panoData.northDir:0}},{key:"position",get:function(){return this.panoData&&"number"==typeof this.panoData.panoX&&"number"==typeof this.panoData.panoY?new f(this.panoData.panoX,this.panoData.panoY):null}}]),e}(Or),ua={dom:null,anchor:null,width:null,height:null,altitude:2,sphereZ:null,useUV:!1},ha=function(t){function e(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(n=t.call(this)||this).visible=!0,n.worldCoord=void 0,n.pov=void 0,n.id=n.genId(),n._pano=void 0,n.lastPanoPosition=null,n.initialized=!1,n.position=void 0,n.options=void 0,n.position=e,n.options=Object.assign({},ua,r),n.pov=null,n}c(e,t);var n=e.prototype;return n.getPov=function(){return this.pov},n.genId=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;return Number("".concat(Math.random().toString().substr(3,t)).concat(Date.now())).toString(36)},n.init=function(t){t&&!this.initialized&&(this._pano=t,this.lastPanoPosition=this._pano.position,this.worldCoord=this.options.useUV?this.calcCoordsByUV():this.calcCoordsByMC(),this.worldCoord&&(this.initialized=!0,this.add(),this.draw()))},n.calcCoordsByMC=function(){var t=this._pano.position;if(t&&this.position){var e,n=this.position,r=n.lng-t.lng,i=n.lat-t.lat,o=Math.atan2(r,i);o<0&&(o+=2*Math.PI),o=Math.round(y(o));var a=500,s=this.options,u=s.sphereZ,h=s.altitude;null===u?e=25*h:(e=u||0,a=Math.sqrt(Math.pow(r,2)+Math.pow(i,2)+Math.pow(e,2)));var c=y(Math.asin(e/a));c=c>90?90:c<-90?-90:c;var l=_(o+this._pano.panoNorthDir),f=this.radius,d=Math.cos(g(c))*f;d=Math.round(100*d)/100;var p=Math.cos(g(l))*d,v=Math.sin(g(c))*f,m=Math.sin(g(l))*d;return this.pov={heading:o,pitch:c},Vt(p,v,m)}},n.calcCoordsByUV=function(){if(this.position){var t=this.radius,e=this.position,n=xi(e,2),r=n[0],i=n[1],o=2*r*Math.PI,a=(i-.5)*Math.PI,s=Math.cos(a)*Math.cos(o)*t,u=Math.sin(a)*t,h=Math.cos(a)*Math.sin(o)*t;return this.pov={heading:_(y(o)-this._pano.panoNorthDir),pitch:y(a)},Vt(s,u,h)}},n.add=function(){var t=this.options,e=t.width,n=t.height;if(this.dom){var r=this._pano,i=this.dom;i.style.position="absolute",r.getPanes().overlayLayer.appendChild(i),"number"!=typeof e&&(this.options.width=i.clientWidth),"number"!=typeof n&&(this.options.height=i.clientHeight),r.dispatchEvent({type:"onoverlaydomadded",overlay:this})}},n.remove=function(){var t=this.dom;t&&t.parentNode&&t.parentNode.removeChild(t)},n.povToPointGL=function(){if(!this.worldCoord)return null;var t=this._pano,e=t.camera,n=t.getContainerSize(),r=n.width,i=n.height;return po(e,this.worldCoord,r,i)},n.draw=function(){if(this.initialized&&this.visible&&this._pano&&this._pano.panoData&&this.dom){var t=this.lastPanoPosition,e=this._pano.position;t.lng===e.lng&&t.lat===e.lat||(this.lastPanoPosition=e,this.worldCoord=this.options.useUV?this.calcCoordsByUV():this.calcCoordsByMC());var n=this.dom,r=this.povToPointGL();if(n.style.visibility="hidden",r){var i=this.calcAnchor(),o="".concat(r[0]-i.width,"px"),a="".concat(r[1]-i.height,"px");if(isNaN(r[0])||isNaN(r[1]))return;n.style.visibility="visible",n.style.webkitTransform="translate(".concat(o,", ").concat(a,")"),n.style.transform="translate(".concat(o,", ").concat(a,")")}}},n.handleClick=function(){this.dispatchEvent("click")},n.calcAnchor=function(){var t=this.options,e=t.anchor,n=t.width,r=void 0===n?0:n,i=t.height;return e||new l(r/2,(void 0===i?0:i)/2)},n.show=function(){this.visible=!0,this.dom&&(this.dom.style.display="")},n.hide=function(){this.visible=!1,this.dom&&(this.dom.style.display="none")},o(e,[{key:"radius",get:function(){return this._pano?this._pano.opts.radius:0}},{key:"dom",get:function(){return this.options.dom}}]),e}(Or),ca=function(t){function e(e,n){var r=n.position,i=n.altitude,o=void 0===i?2:i,a=n.costomStyle,s=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=document.createElement("div"),r={backgroundColor:"rgba(29, 29, 29, 0.8)",fontSize:"14px",padding:"7px 14px",height:"19px",color:"#fff",whiteSpace:"nowrap",borderRadius:"4px"};return m(n.style,r,e),n.innerText=t,n}(e,void 0===a?{}:a);return t.call(this,r,{dom:s,altitude:o})||this}return c(e,t),e}(ha);t.Converters=mo,t.Engines=Qi,t.EventType=d,t.PanoLabel=ca,t.PanoOverlay=ha,t.PanoramaService=function(){var t=this;this.getPanoById=function(e,n){var r;r="".concat(tt.SERVICE_URL,"?qt=sdata&sid=").concat(e,"&").concat($("/")),t.request(r).then((function(t){n&&n(t)})).catch((function(t){n&&n(null)}))},this.getPanoByLocation=function(e,n,r){var i;i="".concat(tt.SERVICE_URL,"?qt=qsdata&x=").concat(e.lng,"&y=").concat(e.lat).concat(n?"&r="+n:"","&action=1&").concat($("/")),t.request(i).then((function(t){r&&r(t)})).catch((function(t){r&&r(null)}))},this.request=function(t){return T(t,{},{jsonp:"fn"})}},t.Point=f,t.getPanoControl=function(t,e){var n,r,i,o=(e=e||{}).imgPath||"//api.map.baidu.com/images/";function a(e){e.call(this),this.defaultAnchor=t.ControlAnchor.TOP_RIGHT,this.defaultOffset=new t.Size(10,10),this._isOn=!1}return n=a,r=t.Control,(i=Object.create(r.prototype)).constructor=n,n.prototype=i,m(a.prototype,{initialize:function(t){return this._map=t,this._render(),this._bind(),this._container},_render:function(){var t=this,n=w.create("div");n.innerHTML='<span style="position:relative;top:33px;">全景</span>',n.title="进入全景",m(n.style,{width:"49px",height:"51px",color:"#565656",background:'url("'.concat(o,'st-control.png")'),position:"absolute",cursor:"pointer",fontFamily:"arial,sans-serif",fontSize:"13px",textAlign:"center",boxShadow:"0px 0px 3px rgba(0, 0, 0, 0.3)",MozBoxShadow:"0px 0px 3px rgba(0, 0, 0, 0.3)",WebkitBoxShadow:"0px 0px 3px rgba(0, 0, 0, 0.3)"}),this._container=n;var r=this._map.getContainer();r.appendChild(n);var i={visible:!1};e.imgPath&&(i.imgPath=[e.imgPath]),e.tileBaseUrl&&(i.tileBaseUrls=[e.tileBaseUrl]),this._pano=new sa(r,i),this._pano.addCloseButton((function(){t.isMapEnableWheelZoom&&t._map.enableScrollWheelZoom()}));var a=this._scout=w.create("div");m(a.style,{position:"absolute",width:"24px",height:"41px",cursor:"pointer",backgroundImage:'url("'.concat(o,'st-scout.png")'),backgroundRepeat:"no-repeat",backgroundPosition:"-24px 0",overflow:"hidden",display:"none",zIndex:11}),r.appendChild(a);var s=this._infoWindow=w.create("div");m(s.style,{position:"absolute",width:"112px",height:"119px",backgroundImage:'url("'.concat(o,'st-infowindow.gif")'),backgroundRepeat:"no-repeat",backgroundPosition:"0 0",display:"none",cursor:"pointer",zIndex:12});var u=this._thumb=w.create("img");s.appendChild(u),u.src=o+"st-noresult.png",m(u.style,{width:"100px",height:"75px",left:"6px",top:"6px",position:"absolute"});var h=this._stDescription=w.create("div");m(h.style,{position:"absolute",top:"85px",fontFamily:"arial,sans-serif",fontSize:"13px",paddingLeft:"6px"}),s.appendChild(h),r.appendChild(s)},_updateView:function(){var t=this._container.style;this._isOn||this._isOver?(t.backgroundPosition="-49px 0",t.color="#fff"):(t.backgroundPosition="0 0",t.color="#565656")},_bind:function(){var n=this;this._pano.on("dataload",(function(t){var r=t.data;r?(n._currentSvId=r.panoId,e.tileBaseUrl?n._thumb.src="".concat(e.tileBaseUrl,"?&sid=").concat(r.panoId,"&pos=0_0&z=0"):n._thumb.src="//apisv0.bdimg.com/?qt=pdata&sid=".concat(r.panoId,"&pos=0_0&z=0&from=H5&").concat($("/")),n._stDescription.innerHTML=r.roadName):(n._currentSvId=null,n._thumb.src=o+"st-noresult.png",n._stDescription.innerHTML="")}));var r=this;v.isPc&&(this._container.addEventListener("mouseover",(function(){r._isOver=!0,r._updateView()})),this._container.addEventListener("mouseout",(function(){r._isOver=!1,r._updateView()}))),this._container.addEventListener("click",(function(){r._isOn?r._close():r._open()})),this._map.getContainer().addEventListener("mousemove",(function(e){if(r._isOn){var n=(e=window.event||e).pageX||e.clientX,i=e.pageY||e.clientY,a=function(t){for(var e={left:0,top:0};t&&t.offsetParent;)e.left+=t.offsetLeft,e.top+=t.offsetTop,t=t.offsetParent;return e}(r._map.container),s=new qo(n-a.left,i-a.top),u=r._map.pixelToPoint(s);if(""!==r._scout.style.display&&v.isPc&&(r._scout.style.display="",r._infoWindow.style.display=""),r._scout.style.left=s.x-12+"px",r._scout.style.top=s.y-41-2+"px",r._prePixel=r._curPixel,r._curPixel=s,r._prePixel){var h=s.x-r._prePixel.x;h>0?r._scout.style.backgroundPosition="-48px 0":h<0&&(r._scout.style.backgroundPosition="0 0")}r._curPixel.y<170?r._infoStatus=2:r._infoStatus=1,r._curPixel.x<66&&(r._infoStatus=3),r._curPixel.x>r._map.getSize().width-56-10&&(r._infoStatus=4);var c=1===r._infoStatus||2===r._infoStatus?112:126,l=1===r._infoStatus||2===r._infoStatus?119:105;1!==r._infoStatus&&2!==r._infoStatus||(r._infoWindow.style.left=r._curPixel.x-Math.round(c/2)+"px",1===r._infoStatus?(r._infoWindow.style.top=r._curPixel.y-l-42+"px",r._infoWindow.style.backgroundPosition="0 0",r._thumb.style.top="6px",r._thumb.style.bottom="",r._stDescription.style.top="85px",r._stDescription.style.bottom=""):(r._infoWindow.style.top=r._curPixel.y+2+"px",r._infoWindow.style.backgroundPosition="-112px 0",r._thumb.style.top="",r._thumb.style.bottom="6px",r._stDescription.style.top="",r._stDescription.style.bottom="85px"),r._infoWindow.style.width="112px",r._infoWindow.style.height="119px",r._thumb.style.left="6px",r._stDescription.style.left="0"),3!==r._infoStatus&&4!==r._infoStatus||(r._infoWindow.style.top=r._curPixel.y-Math.round(l/2)-20+"px",3===r._infoStatus?(r._infoWindow.style.left=r._curPixel.x+12+"px",r._infoWindow.style.backgroundPosition="0 -119px",r._thumb.style.left="20px",r._stDescription.style.left="14px"):(r._infoWindow.style.left=r._curPixel.x-12-c+"px",r._infoWindow.style.backgroundPosition="-126px -119px",r._thumb.style.left="6px",r._stDescription.style.left="0"),r._infoWindow.style.width="126px",r._infoWindow.style.height="105px"),r._infoWindow.style.backgroundImage='url("'.concat(o,'st-infowindow.gif")'),r._timerId&&(clearTimeout(r._timerId),r._timerId=null),r._timerId=setTimeout((function(){r._currentPoint=u,r._scout.style.backgroundPosition="-24px 0";var e=r._map.lnglatToMercator(u.lng,u.lat);r._pano.setPosition(new t.Point(e[0],e[1]))}),200)}})),this._map.addEventListener("click",(function(t){r._isOn&&v.isMobile&&(r._pano.setPosition(t.point),r._pano.show(),r._close()),r._isOn&&r._currentSvId&&(r._pano.setId(r._currentSvId),r._pano.show(),r._map.config.enableWheelZoom&&(r._map.disableScrollWheelZoom(),r.isMapEnableWheelZoom=!0),r._close())}))},_open:function(){this._isOn||(this._isOn=!0,this._map.addTileLayer(this._panoCoverageLayer),v.isPc&&(this._preDefaultCursor=this._map.getDefaultCursor(),this._preDraggingCursor=this._map.getDraggingCursor(),this._map.setDefaultCursor("pointer"),this._map.setDraggingCursor("pointer"))),this._updateView()},_close:function(){this._isOn&&(this._map.removeTileLayer(this._panoCoverageLayer),v.isPc&&(this._scout.style.display="none",this._infoWindow.style.display="none",this._map.setDefaultCursor(this._preDefaultCursor),this._map.setDraggingCursor(this._preDraggingCursor)),this._isOn=!1),this._updateView()}}),new a(t.Control)},t.getStreetViewCoverageLayer=function(t){var e=new t.TileLayer({transparentPng:!0,dataType:1,cacheSize:32});return e.zIndex=110,e.getTilesUrl=window.PANORAMA_URL?function(t,e){var n=window.PANORAMA_URL+"/tile",r=t.x,i=t.y;return window.BMAPGL_84&&(i=Math.pow(2,e)-i-1),"".concat(n,"?customid=panorama&x=").concat(r,"&y=").concat(i,"&z=").concat(e,"&type=WGS84")}:function(t,e){var n=["//apisv0.bdimg.com/","//apisv1.bdimg.com/"],r=(Math.abs(t.x)+Math.abs(t.y))%n.length;return"".concat(n[r],"?udt=").concat("20150114","&qt=tile&styles=").concat("pl","&x=").concat(t.x,"&y=").concat(t.y,"&z=").concat(e).replace(/-(\d+)/gi,"M$1")+"&"+$("/",{isCounter:!1})},e},t.init=function(t,e){return new sa(t,e)},Object.defineProperty(t,"__esModule",{value:!0})})(Pano={});
window.BMapGL=window.BMapGL||{};(function(bG,fF){var e9=e9||{version:"20150702",emptyFn:function(){}};(function(){e9._log=[];var i=0;var T={};e9.BaseClass=function(kz){T[(this.hashCode=(kz||e9.BaseClass.guid()))]=this};e9.BaseClass.guid=function(){return"mz_"+(i++).toString(36)};e9.BaseClass.create=function(){var kz=new e9.BaseClass();kz.decontrol();return kz};var e=e9.instance=e9.I=function(kz){return T[kz]};e9.BaseClass.prototype.dispose=function(){if(this.hashCode){delete T[this.hashCode]}for(var kz in this){if(typeof this[kz]!="function"){delete this[kz]}}};e9.BaseClass.prototype.getHashCode=function(){if(!this.hashCode){T[(this.hashCode=e9.BaseClass.guid())]=this}return this.hashCode};e9.BaseClass.prototype.decontrol=function(){delete T[this.hashCode]};e9.BaseClass.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"};e9.BaseClass.prototype._wlog=function(kA,kB){var kz=e9._log;if(kz.length>100){kz.reverse().length=50;kz.reverse()}kz[kz.length]="["+kA+"]["+(this._className||"Object")+" "+this.hashCode+"] "+kB}})();Function.prototype.inherits=function(kz,T){var e,kA,kC=this.prototype,kB=function(){};kB.prototype=kz.prototype;kA=this.prototype=new kB();if(typeof(T)=="string"){kA._className=T}for(e in kC){kA[e]=kC[e]}this.prototype.constructor=kC.constructor;kC=kB=null;return kA};e9.BaseEvent=function(e,i){this.type=e;this.returnValue=true;this.target=i||null;this.currentTarget=this.srcElement=null;this.cancelBubble=false;this.domEvent=null};e9.BaseClass.prototype.on=e9.BaseClass.prototype.addEventListener=function(T,i){if(typeof i!=="function"){return this._wlog("error","addEventListener:"+i+" is not a function")}if(!this._listeners){this._listeners={}}var e=this._listeners;if(T.indexOf("on")!==0){T="on"+T}if(typeof e[T]!=="object"){e[T]={}}var kz=i.hashCode||e9.BaseClass.guid();i.hashCode=kz;if(e[T][kz]){this._wlog("warning","repeat key:"+kz)}e[T][kz]=i};e9.BaseClass.prototype.off=e9.BaseClass.prototype.removeEventListener=function(T,i){if(typeof i=="function"){i=i.hashCode}else{if(typeof i!=="string"&&typeof i!=="undefined"){return}}if(!this._listeners){this._listeners={}}if(T.indexOf("on")!=0){T="on"+T}var e=this._listeners;if(!e[T]){return}if(i===undefined){e[T]={};return}if(e[T][i]){delete e[T][i]}};e9.BaseClass.prototype.fire=e9.BaseClass.prototype.dispatchEvent=function(kz){if(!this._listeners){this._listeners={}}var T,e=this._listeners,kA=kz.type;kz.target=kz.srcElement=kz.target||kz.srcElement||this;kz.currentTarget=this;if(typeof this[kA]=="function"){this[kA](kz)}if(typeof e[kA]=="object"){for(T in e[kA]){if(typeof e[kA][T]=="function"){e[kA][T].call(this,kz)}}}return kz.returnValue};e9.BaseEvent.prototype.inherit=function(T){var i=this;this.domEvent=T=window.event||T;i.clientX=T.clientX||T.pageX;i.clientY=T.clientY||T.pageY;i.offsetX=T.offsetX||T.layerX;i.offsetY=T.offsetY||T.layerY;i.screenX=T.screenX;i.screenY=T.screenY;i.ctrlKey=T.ctrlKey||T.metaKey;i.shiftKey=T.shiftKey;i.altKey=T.altKey;return i};e9.Browser=(function(){var T=navigator.userAgent;var kA=0;var e=0;var kB=0;var i=0;var kF=0;var kD=0;var kE=0;var kC=0;var kz=0;var kG=0;if(typeof window.opera==="object"&&/Opera(\s|\/)(\d+(\.\d+)?)/.test(T)){kB=parseFloat(RegExp.$2)}else{if(/OPR(\/(\d+)(\..?)?)/.test(T)){kB=parseInt(RegExp.$2,10)}else{if(/Edge\/((\d+)\.\d+)/.test(T)){kA=parseInt(RegExp.$2,10)}else{if(/MSIE (\d+(\.\d+)?)/.test(T)){e=parseFloat(RegExp.$1)}else{if(T.indexOf("Trident")>-1&&/rv:(\d+(\.\d+)?)/.test(T)){e=parseInt(RegExp.$1,10)}else{if(/Firefox(\s|\/)(\d+(\.\d+)?)/.test(T)){kF=parseFloat(RegExp.$2)}else{if(navigator.vendor==="Netscape"&&/Netscape(\s|\/)(\d+(\.\d+)?)/.test(T)){kE=parseFloat(RegExp.$2)}else{if(T.indexOf("Safari")>-1&&/Version\/(\d+(\.\d+)?)/.test(T)){i=parseFloat(RegExp.$1)}}}}}}}}if(T.indexOf("Trident")>-1&&/Trident\/(\d+(\.\d+)?)/.test(T)){kC=parseInt(RegExp.$1,10)}else{if(!e&&!kA&&T.indexOf("Gecko")>-1&&T.indexOf("KHTML")===-1&&/rv\:(\d+(\.\d+)?)/.test(T)){kz=parseFloat(RegExp.$1)}else{if(!kA&&/chrome\/(\d+(\.\d+)?)/i.test(T)){kD=parseFloat(RegExp.$1)}else{if(!kA&&/AppleWebKit\/(\d+(\.\d+)?)/.test(T)){kG=parseInt(RegExp.$1,10)}}}}var kH={edge:kA,ie:e,firefox:kF,netscape:kE,opera:kB,safari:i,chrome:kD,gecko:kz,trident:kC,webkit:kG};return kH})();window.FeBrowser=e9.Browser;e9.Dom={};e9.Dom.createDom=function(i,e){if(e9.isIE&&e&&e.name){i="<"+i+' name="'+e9.String.escapeHTML(e.name)+'">'}var T=document.createElement(i);if(e){e9.Dom.setProperties(T,e)}return T};e9.Dom.getOffset=function(kz){var kC=e9.Dom.getOwnerDocument(kz);var kB=e9.isGecko>0&&kC.getBoxObjectFor&&e9.Dom.getStyle(kz,"position")=="absolute"&&(kz.style.top===""||kz.style.left==="");var kD={left:0,top:0};var i=(e9.isIE&&!e9.isStrict)?kC.body:kC.documentElement;if(kz==i){return kD}var T=null;var kA;if(kz.getBoundingClientRect){kA=kz.getBoundingClientRect();kD.left=kA.left+Math.max(kC.documentElement.scrollLeft,kC.body.scrollLeft);kD.top=kA.top+Math.max(kC.documentElement.scrollTop,kC.body.scrollTop);kD.left-=kC.documentElement.clientLeft;kD.top-=kC.documentElement.clientTop;if(e9.isIE&&!e9.isStrict){kD.left-=2;kD.top-=2}}else{if(kC.getBoxObjectFor&&!kB){kA=kC.getBoxObjectFor(kz);var e=kC.getBoxObjectFor(i);kD.left=kA.screenX-e.screenX;kD.top=kA.screenY-e.screenY}else{T=kz;do{kD.left+=T.offsetLeft;kD.top+=T.offsetTop;if(e9.isWebkit>0&&e9.Dom.getStyle(T,"position")=="fixed"){kD.left+=kC.body.scrollLeft;kD.top+=kC.body.scrollTop;break}T=T.offsetParent}while(T&&T!=kz);if(e9.isOpera>0||(e9.isWebkit>0&&e9.Dom.getStyle(kz,"position")=="absolute")){kD.top-=kC.body.offsetTop}T=kz.offsetParent;while(T&&T!=kC.body){kD.left-=T.scrollLeft;if(!e9.isOpera||T.tagName!="TR"){kD.top-=T.scrollTop}T=T.offsetParent}}}return kD};e9.Dom.getOwnerDocument=function(e){return e.nodeType==9?e:e.ownerDocument||e.document};e9.Dom.setProperties=function(i,e){e9.each(e,function(kz,T){e9.Dom._setProperty(i,T,kz)})};e9.Dom._setProperty=function(i,e,T){if(e=="style"){i.style.cssText=T}else{if(e=="class"){i.className=T}else{if(e=="for"){i.htmlFor=T}else{if(e in e9.Dom._DIRECT_ATTRIBUTE_MAP){i.setAttribute(e9.Dom._DIRECT_ATTRIBUTE_MAP[e],T)}else{i[e]=T}}}}};e9.Dom._DIRECT_ATTRIBUTE_MAP={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",height:"height",width:"width",usemap:"useMap",frameborder:"frameBorder"};e9.G=function(){for(var T=[],kz=arguments.length-1;kz>-1;kz--){var kA=arguments[kz];T[kz]=null;if(typeof kA=="object"&&kA&&kA.dom){T[kz]=kA.dom}else{if((typeof kA=="object"&&kA&&kA.tagName)||kA==window||kA==document){T[kz]=kA}else{if(typeof kA=="string"&&(kA=document.getElementById(kA))){T[kz]=kA}}}}return T.length<2?T[0]:T};e9.ac=function(e,i){if(!(e=this.G(e))){return}i=this.trim(i);if(!new RegExp("(^| )"+i.replace(/(\W)/g,"\\$1")+"( |$)").test(e.className)){e.className=e.className.split(/\s+/).concat(i).join(" ")}};e9.addClassName=e9.ac;e9.each=function(kB,e){if(typeof e!="function"){return kB}if(kB){if(kB.length===undefined){for(var T in kB){e.call(kB[T],kB[T],T)}}else{for(var kz=0,kA=kB.length;kz<kA;kz++){e.call(kB[kz],kB[kz],kz)}}}return kB};e9.extend=function(kB,kz){if(kB&&kz&&typeof(kz)=="object"){for(var kA in kz){kB[kA]=kz[kA]}var T=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];for(var e=0,i;e<T.length;e++){i=T[e];if(Object.prototype.hasOwnProperty.call(kz,i)){kB[i]=kz[i]}}}return kB};e9.hide=function(){e9.each(arguments,function(e){if(e=e9.G(e)){e.style.display="none"}})};e9.inherit=function(kD,kz,T){var kC=kD.prototype;var kB=function(){};kB.prototype=kz.prototype;var kA=kD.prototype=new kB();if(typeof T=="string"){kA._className=T}for(var e in kC){kA[e]=kC[e]}kD.prototype.constructor=kC.constructor;kC=null;return kA};e9.isIE=0;(function(){if(navigator.userAgent.indexOf("MSIE")>0&&!window.opera){/MSIE (\d+(\.\d+)?)/.test(navigator.userAgent);e9.isIE=parseFloat(RegExp.$1)}})();e9.rc=function(e,i){if(!(e=this.G(e))){return}i=this.trim(i);var T=e.className.replace(new RegExp("(^| +)"+i.replace(/(\W)/g,"\\$1")+"( +|$)","g"),"$2");if(e.className!=T){e.className=T}};e9.removeClassName=e9.rc;e9.show=function(){this.each(arguments,function(e){if(e=e9.G(e)){e.style.display=""}})};e9.trim=function(e){return e.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")};e9.getElementsByClassName=function(e,i){if(e.getElementsByClassName){return e.getElementsByClassName(i)}else{return(function T(kG,kE){if(kE==null){kE=document}var kD=[],kC=kE.getElementsByTagName("*"),kz=kC.length,kF=new RegExp("(^|\\s)"+kG+"(\\s|$)"),kB,kA;for(kB=0,kA=0;kB<kz;kB++){if(kF.test(kC[kB].className)){kD[kA]=kC[kB];kA++}}return kD})(i,e)}};e9.toggleClass=function(e,i){if(e9.hasClass(e,i)){e9.removeClassName(e,i)}else{e9.addClassName(e,i)}};e9.hasClass=function(kz,T){if(!kz||!kz.className||typeof kz.className!="string"){return false}var i=-1;try{i=kz.className==T||kz.className.search(new RegExp("(\\s|^)"+T+"(\\s|$)"))}catch(kA){return false}return i>-1};e9.insertHTML=function(kz,e,T){kz=e9.G(kz);if(kz===null){return kz}var i,kA;if(kz.insertAdjacentHTML){kz.insertAdjacentHTML(e,T)}else{i=kz.ownerDocument.createRange();e=e.toUpperCase();if(e=="AFTERBEGIN"||e=="BEFOREEND"){i.selectNodeContents(kz);i.collapse(e=="AFTERBEGIN")}else{kA=e=="BEFOREBEGIN";i[kA?"setStartBefore":"setEndAfter"](kz);i.collapse(kA)}i.insertNode(i.createContextualFragment(T))}return kz};if(typeof HTMLElement!="undefined"&&HTMLElement.prototype.__lookupGetter__&&!HTMLElement.prototype.__lookupGetter__("children")&&!window.opera){try{HTMLElement.prototype.__defineGetter__("children",function(){for(var T=[],kz=0,kB,kA=0,e=this.childNodes.length;kA<e;kA++){kB=this.childNodes[kA];if(kB.nodeType==1){T[kz++]=kB;if(kB.name){if(!T[kB.name]){T[kB.name]=[]}T[kB.name][T[kB.name].length]=kB}if(kB.id){T[kB.id]=kB}}}return T})}catch(jM){}}if(typeof(HTMLElement)!="undefined"&&!window.opera&&HTMLElement.prototype&&!HTMLElement.prototype.insertAdjacentHTML){HTMLElement.prototype.insertAdjacentHTML=function(i,T){var kz=this.ownerDocument.createRange();kz.setStartBefore(this);kz=kz.createContextualFragment(T);switch(i){case"beforeBegin":this.parentNode.insertBefore(kz,this);break;case"afterBegin":this.insertBefore(kz,this.firstChild);break;case"beforeEnd":this.appendChild(kz);break;case"afterEnd":if(!this.nextSibling){this.parentNode.appendChild(kz)}else{this.parentNode.insertBefore(kz,this.nextSibling)}break}}}if(typeof HTMLElement!="undefined"&&!window.opera){HTMLElement.prototype.contains=function(e){if(!e){return false}if(e==this){return true}while(e=e.parentNode){if(e==this){return true}}return false}}if(!e9.Browser.ie&&typeof Event!="undefined"&&!window.opera){Event.prototype.__defineSetter__("returnValue",function(e){if(!e){this.preventDefault()}return e});Event.prototype.__defineSetter__("cancelBubble",function(e){if(e){this.stopPropagation()}return e})}e9.each=function(kA,kz){if(b0(kz)){for(var T=0,e=kA.length;T<e;T++){if(kz.call(kA,kA[T],T)===false){break}}}return kA};e9.Platform={x11:0,macintosh:0,windows:0,android:0,iphone:0,ipad:0};for(var jK in e9.Platform){if(e9.Platform.hasOwnProperty(jK)){e9.Platform[jK]=new RegExp(jK,"i").test(window.navigator.userAgent)?1:0}}if(typeof(e9.Dom)==="undefined"){e9.Dom={}}e9.Dom.getComputedStyle=function(i,e){var kz=i.nodeType==9?i:i.ownerDocument||i.document,T;if(kz.defaultView&&kz.defaultView.getComputedStyle){T=kz.defaultView.getComputedStyle(i,null);if(T){return T[e]||T.getPropertyValue(e)}}else{if(i.currentStyle){return i.currentStyle[e]||""}}return""};var fW=e9.BaseEvent;var dh=e9.BaseClass;dh.prototype.toString=function(){return this._className||""};e9.on=function(T,i,e){if(!(T=e9.G(T))){return T}i=i.replace(/^on/,"");if(T.addEventListener){T.addEventListener(i,e,false)}else{if(T.attachEvent){T.attachEvent("on"+i,e)}}return T};e9.un=function(T,i,e){if(!(T=e9.G(T))){return T}i=i.replace(/^on/,"");if(T.removeEventListener){T.removeEventListener(i,e,false)}else{if(T.detachEvent){T.detachEvent("on"+i,e)}}return T};e9.hc=function(kz,T){if(!kz||!kz.className||typeof kz.className!="string"){return false}var i=-1;try{i=kz.className==T||kz.className.search(new RegExp("(\\s|^)"+T+"(\\s|$)"))}catch(kA){return false}return i>-1};e9.isEmptyObject=function(T){if(Object.prototype.toString.call(T)==="[object Object]"){for(var e in T){return false}return true}else{return false}};var bZ=window.location.protocol==="http:"?"http:":"https:";var eG={fontFamily:'Arial,Helvetica,"PingFang SC","Hiragino Sans GB",STHeiti,sans-serif',mapStyleNameIdPair:{"default":0,"grayed-out":1},mapHost:bZ+"//map.baidu.com",apiHost:window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]?window._BMapSecurityConfig["serviceHost"]:bZ+"//api.map.baidu.com",apiIMG:bZ+"//api.map.baidu.com/images",staticHost:bZ+"//webmap0.bdimg.com",imgPath:bZ+"//webmap0.bdimg.com/image/api/",tileDomain:[bZ+"//maponline0.bdimg.com",bZ+"//maponline1.bdimg.com",bZ+"//maponline2.bdimg.com",bZ+"//maponline3.bdimg.com"],panoTilePath:"//apisv1.bdimg.com/",rasterTilePath:"/tile/",vectorTilePath:"/pvd/",originTilePath:[bZ+"//pcor.baidu.com"],stylePath:"//maponline0.bdimg.com/sty/",bosPath:bZ+"//mapopen-pub-jsapigl.bj.bcebos.com/assets/images/",getIconSetPath:function(e){var i="map_icons2x/";if(typeof e==="string"&&this.mapStyleNameIdPair[e]>0){i="map_icons2x_"+(this.mapStyleNameIdPair[e]-1)+"/"}return bZ+this.stylePath+i},getMapStyleFiles:function(T){var kA=true;if(typeof T==="string"&&T!=="default"){kA=false}var kB=kA?"":"_"+(this.mapStyleNameIdPair[T]-1);var i=bH();var kz="udt="+i.udt+"&v="+i.ver;var e=bZ+this.stylePath;return[e+"icons_2x"+kB+".js?"+kz,e+"fs"+kB+".js?"+kz,e+"indoor_fs.js?"+kz]},tvc:{ditu:{normal:{version:"088",updateDate:"20230830"},satellite:{version:"009",updateDate:"20230830"},normalTraffic:{version:"081",updateDate:"20230830"},satelliteTraffic:{version:"083",updateDate:"20230830"},mapJS:{version:"104",updateDate:"20230830"},satelliteStreet:{version:"083",updateDate:"20230830"},earthVector:{version:"001",updateDate:"20230830"}},webapp:{high_normal:{version:"001",updateDate:"20230830"},lower_normal:{version:"002",updateDate:"20230830"}},api_for_mobile:{vector:{version:"002",updateDate:"20230830"},vectorIcon:{version:"002",updateDate:"20230830"}}},msv:{mapstyle:{version:"001",updateDate:"20230817"}}};eG.imgResources={blankGIF:eG.staticHost+"/res/litemapapi/v1d1/images/blank.gif?20170501",markerPng:eG.staticHost+"/res/litemapapi/v1d1/images/marker.png?20170501",locPng:eG.staticHost+"/res/litemapapi/v1d1/images/loc.png?20180918",locNewPng:eG.staticHost+"/res/litemapapi/v1d1/images/loc_new.png?20190314",zoomPng:eG.staticHost+"/res/litemapapi/v1d1/images/zoombtn.png?20180918",mapLogoPng:eG.staticHost+"/res/litemapapi/v1d1/images/logo-2x.png?20190226"};var E=eG;var jB="ruler.cur";if(e9.Browser.ie||e9.Browser.edge){e9.extend(E,{distCursor:"url("+E.imgPath+jB+"),crosshair",defaultCursor:"url("+E.imgPath+"openhand.cur),default",draggingCursor:"url("+E.imgPath+"closedhand.cur),move"})}else{if(e9.Browser.firefox){e9.extend(E,{distCursor:"url("+E.imgPath+jB+"),crosshair",defaultCursor:"-moz-grab",draggingCursor:"-moz-grabbing"})}else{if(e9.Browser.chrome||e9.Browser.safari){e9.extend(E,{distCursor:"url("+E.imgPath+jB+") 2 6,crosshair",defaultCursor:"url("+E.imgPath+"openhand.cur) 8 8,default",draggingCursor:"url("+E.imgPath+"closedhand.cur) 8 8,move"});if(e9.Platform.macintosh){E.defaultCursor="-webkit-grab";E.draggingCursor="-webkit-grabbing"}}else{e9.extend(E,{distCursor:"url("+E.imgPath+jB+"),crosshair",defaultCursor:"url("+E.imgPath+"openhand.cur),default",draggingCursor:"url("+E.imgPath+"closedhand.cur),move"})}}}bG=bG||{};bG.version="gl";bG._register=[];bG.register=function(e){this._register[this._register.length]=e};bG.guid=1;bG.getGUID=function(e){return(e||"")+bG.guid++};var eZ=window.BMAP_AUTHENTIC_KEY||"";function V(e,i,kz){var T=new Date();T.setTime(T.getTime()+kz*24*60*60*1000);document.cookie=e+"="+escape(i)+";expires="+T.toGMTString()}function a9(e,i){if(navigator.cookieEnabled){return V(e,i,30)}if(localStorage){return localStorage.setItem(e,i)}if(sessionStorage){return sessionStorage.setItem(e,i)}}bG.getSeckeyCid=function(){var i=+new Date();var e=bZ+"//dlswbr.baidu.com/heicha/mw/abclite-2063-s.js?_t="+i;g3.load(e,i7)};function i7(){if(window.___abvk){a9("SECKEY_ABVK",window.___abvk)}}window.__abbaidu_2063_cb=function(i){var e=JSON.parse(i);a9("BMAP_SECKEY",e.data)};bG.bmapVerifyCbk=function(kA){if(kA&&kA.error!==0){bG=null;BMapGL=null;var kB="百度未授权使用地图API，可能是因为您提供的密钥不是有效的百度地图开放平台密钥，或此密钥未对本应用的百度地图JavaScriptAPI授权。您可以访问如下网址了解如何获取有效的密钥：https://lbs.baidu.com/apiconsole/key#。";switch(kA.error){case 101:kB="您所使用的密钥ak有问题，不支持jsapi服务，可以访问该网址了解如何获取有效密钥：http://lbsyun.baidu.com/apiconsole/key#。";break;case 102:kB="MCODE参数不存在，mobile类型MCODE参数必需，详情查看：http://lbsyun.baidu.com/apiconsole/key#。";break;case 200:kB="APP不存在，AK有误请检查再重试，详情查看：http://lbsyun.baidu.com/apiconsole/key#。";break;case 201:kB="APP被您禁用啦，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。";break;case 202:kB="APP被管理员删除啦，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。";break;case 203:kB="APP类型错误，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。";break;case 210:kB="APP IP校验失败，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。";break;case 220:kB="APP Referer校验失败。请检查该ak设置的白名单与访问所有的域名是否一致。详情查看：http://lbsyun.baidu.com/apiconsole/key#";break;case 230:kB="APP Mcode码校验失败，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。";break;case 240:kB="APP服务被禁用了，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情，或联系我们了解详情。";break;case 250:kB="该用户不存在... 请登录 https://lbs.baidu.com 的控制台，注册成为开发者申请ak吧。";break;case 251:kB="该用户被自己删除啦，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看自己的应用具体详情。";break;case 252:kB="该用户被管理员删除啦，可以访问 http://lbsyun.baidu.com/apiconsole/key# 了解如何获取有效密钥，或请联系我们了解详情。";break;case 260:kB="您所使用的密钥AK不包含该服务呢，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看服务选择情况，或请联系我们了解详情。";break;case 261:kB="您所使用的密钥AK的该服务被禁用啦，可以访问 http://lbsyun.baidu.com/apiconsole/key# 查看服务选择情况，或请联系我们了解详情。";break;case 401:kB="您所使用的AK并发超限了，请登录 http://lbsyun.baidu.com/cashier/quota#/home 了解详情。";break;case 302:kB="您所使用的AK天配额超限了，请登录 http://lbsyun.baidu.com/cashier/quota#/home 了解详情。";break}alert(kB);var T=document.getElementsByClassName("bmap-container");if(T){for(var kz=0;kz<T.length;kz++){var e=T[kz];if(e&&e.firstChild&&e.firstChild.id==="platform"){e.innerText=""}}}}};bG.frequencyCbk=function(e){if(e){window.QTFrequency=e}};bG.verify=function(){if(window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]){var e=E.apiHost+"?qt=verify&v=gl&type=webgl&time="+Date.now()+"&callback="+fF+".bmapVerifyCbk"}else{var e=E.apiHost+"/?qt=verify&v=gl&type=webgl&ak="+eZ+"&time="+Date.now()+"&callback="+fF+".bmapVerifyCbk"}g3.load(e)};bG.frequency=function(){};bG.apiLoad=bG.apiLoad||function(){};function it(i,e){this._size=i;this._cache=[];this._totalGetTimes=0;this._totalHitTimes=0;this._options={clearCallback:null,removeOldCallback:null};e=e||{};for(var T in e){if(e.hasOwnProperty(T)){this._options[T]=e[T]}}}it.prototype.setData=function(T,kz){var e=this._cache;var i=this._size;if(i===0){return}if(e.length>i){this._removeOld()}if(!e[T]){e.push(kz)}e[T]=kz;kz._key_=T};it.prototype.getHitRate=function(){return Math.round(this._totalHitTimes/this._totalGetTimes*1000)/1000};it.prototype.getData=function(i){var e=this._cache[i];if(e){this._totalHitTimes++}this._totalGetTimes++;return e};it.prototype.removeData=function(kA){if(this._options.clearCallback){this._options.clearCallback(this._cache[kA])}var T=this._cache;var kB=T[kA];for(var kz=0,e=T.length;kz<e;kz++){if(T[kz]===kB){T.splice(kz,1);break}}delete T[kA]};it.prototype._removeOld=function(){var e=this._cache;var kA=Math.round(this._size*0.6);for(var kz=0;kz<kA;kz++){var T=e[kz]._key_;if(this._options.clearCallback){this._options.clearCallback(e[T])}delete e[T]}e.splice(0,kA);if(this._options.removeOldCallback){this._options.removeOldCallback()}};it.prototype.clear=function(){var T=this._cache;for(var kA=0,e=T.length;kA<e;kA++){var kz=T[kA]._key_;if(this._options.clearCallback){this._options.clearCallback(T[kz])}delete T[kz]}this._cache=T=[]};it.prototype.forEach=function(kz){var T=this._cache;for(var kB=0,e=T.length;kB<e;kB++){var kA=T[kB]._key_;kz(T[kA])}};it.prototype.getBatch=function(kA){var e=[];for(var kz=0,T=kA.length;kz<T;kz++){if(this.getData(kA[kz])){e[e.length]=this.getData(kA[kz])}}return e};it.prototype.clearExcept=function(kB){var T=this._cache;for(var e=T.length,kA=e-1;kA>=0;kA--){var kz=this._cache[kA]._key_;if(!kB[kz]){T.splice(kA,1);if(this._options.clearCallback){this._options.clearCallback(T[kz])}delete T[kz]}}};it.prototype.getDataCount=function(){return this._cache.length};function jc(){}e9.extend(jc.prototype,{centerAndZoomIn:function(kE,T,kF){var kC=this;if(!kE&&!T){return}kE=kE||this.centerPoint;T=T||this.zoomLevel;T=this._getProperZoom(T).zoom;if(this.mapType===BMAP_EARTH_MAP){if(!this._earth){this.mapType=BMAPGL_NORMAL_MAP;this.temp.originMapType=BMAP_EARTH_MAP;function kD(){kC._earth=new bG.Earth(kC,{showRealSunlight:kC.config.showRealSunlight,showMilkyway:kC.config.showMilkyway,earthBackground:kC.config.earthBackground});kC._proxyEarthEvents();kC._changeEarthMapType(BMAP_EARTH_MAP);e9.extend(kC,bG.EarthView.prototype);if(!kC._navigationCtrl&&kC.config.showControls){kC._navigationCtrl=new bG.NavigationControl3D(kC)}delete kC.temp.originMapType}hl.load("earth",function(){if(bG["FeatureStyle"+kC.config.style]){kD()}else{kC.loadMapStyleFiles(function(){kD()})}})}}this.lastLevel=this.zoomLevel||T;this.zoomLevel=T;var kA=new fW("onload");kA.point=kE;kA.zoom=T;this.centerPoint=this.restrictCenter(new cG(kE.lng,kE.lat));if(this.centerPoint.zoom){this.zoomLevel=this.centerPoint.zoom}this.defaultZoomLevel=this.defaultZoomLevel||this.zoomLevel;this.defaultCenter=this.defaultCenter||this.centerPoint;if(!this.loaded&&!(this.temp.originMapType===BMAP_EARTH_MAP)){var i=this.config.defaultMaxBounds;var kB=new o(i,"baidu",this.mapType);var kz=new hO({mapType:this.mapType,copyright:kB,customLayer:false,baseLayer:true,tileTypeName:"web"});kz._isInnerLayer=true;this.addTileLayer(kz);if(this.mapType===BMAP_SATELLITE_MAP&&this._isHybridShow===true){this._addHybirdMap()}}this.dispatchEvent(kA);this.loaded=true;kF=kF||{};kF.callback&&kF.callback()},_setPlatformPosition:function(kF,kE,kI){kI=kI||{};if(kF===0&&kE===0&&!kI.point){return}if(isNaN(kI.initMapOffsetX)){kI.initMapOffsetX=this.offsetX}if(isNaN(kI.initMapOffsetY)){kI.initMapOffsetY=this.offsetY}var kG=kF+kI.initMapOffsetX;var kD=kE+kI.initMapOffsetY;if(kI.point){var i=this.restrictCenter(kI.point);if(!i.equals(this.centerPoint)){this.centerPoint=i.clone();this.fire(new fW("oncenter_changed"))}}else{var kz=this.offsetX-kG;var e=this.offsetY-kD;var T=this.getZoomUnits();var kC=this.centerPoint.lng;var kB=this.centerPoint.lat;var kA=new cG(kC,kB);this.centerPoint=this.restrictCenter(new cG(kA.lng+kz*T,kA.lat-e*T),T);this.fire(new fW("oncenter_changed"));if(this.zoomLevel<10){kG=this.offsetX-(this.centerPoint.lng-kA.lng)/T;kD=this.offsetY+(this.centerPoint.lat-kA.lat)/T}}this.offsetX=kG;this.offsetY=kD;var kH=this.platform.style;kH.left=kG+"px";kH.top=kD+"px";this.maskLayer.style.left=-kG+"px";this.maskLayer.style.top=-kD+"px";if(kI.dispatchEvent!==false){this.dispatchEvent(new fW("onmoving"))}},zoomTo:function(e,kC,kG){kG=kG||{};kG.zoomCenter=kC;if(kG.noAnimation!==true){this.deepZoomTo(e,kG);return}if(typeof e!=="number"){return}var kA=ev[this.mapType];if(!kA){return}var T=e;e=this._getProperZoom(e).zoom;if(e===this.zoomLevel){var kD=new fW("onzoomexceeded");kD.targetZoom=T;this.dispatchEvent(kD);kG.callback&&kG.callback();return}this.lastLevel=this.zoomLevel;if(kC){this.temp._cPoint=kC;this.temp._cPixel=this.pointToPixelIn(kC)}else{if(this.getInfoWindow()){var kF=this.getInfoWindow().getPoint();this.temp._cPixel=this.pointToPixelIn(kF);this.temp._cPoint=kF}}if(this.config.zoomCenter){kC=this.config.zoomCenter;this.temp._cPoint=kC;this.temp._cPixel=this.pointToPixelIn(kC)}if(kC||this.temp.infoWin&&this.temp.infoWin.isOpen()){var i=this.temp._cPoint;var kE=this.temp._cPixel;var kz=this.getZoomUnits(e);var kB=new cG(i.lng+kz*(this.width/2-kE.x),i.lat-kz*(this.height/2-kE.y));this.centerPoint=this.restrictCenter(kB,kz,e);if(this.centerPoint.zoom){e=this.centerPoint.zoom}}if(kG.fireEvent!==false){this.dispatchEvent(new fW("onzoomstart"))}if(e!==this.zoomLevel){this.zoomLevel=e;this.dispatchEvent(new fW("onzooming"));this.dispatchEvent(new fW("onzoomstartcode"))}if(kG.fireEvent!==false){this.dispatchEvent(new fW("onzoomend"))}if(kG.callback){kG.callback()}},deepZoomMedia:function(e){var i=this;if(!i.temp.isStdCtrlBusy){i.temp.isStdCtrlBusy=true;i.deepZoomTo(i.zoomLevel+e);setTimeout(function(){i.temp.isStdCtrlBusy=false},400)}},deepZoomTo:function(kD,kz){kz=kz||{};var kB=kD-this.zoomLevel;var kA=this._getProperZoom(kD);if(kA.exceeded){var e=new fW("onzoomexceeded");e.targetZoom=kD;this.dispatchEvent(e);return}var i;if(kz.zoomCenter){i=this.pointToPixelIn(kz.zoomCenter)}else{if(this.getInfoWindow()){i=this.pointToPixelIn(this.getInfoWindow().getPoint(),{zoom:this.lastLevel})}else{var i=new fv(this.width/2,this.height/2)}}this.lastLevel=this.zoomLevel;var kC=this.deepZoom||new aH(this);var T=kB>0?1:-1;kC.zoomMap(i,kB,T,null,kz)},flyToIn:function(kE,e){if(e===this.zoomLevel){this.panToIn(kE);return}var kB=this._getProperZoom(e);if(kB.exceeded){var kF=new fW("onzoomexceeded");kF.targetZoom=e;this.dispatchEvent(kF);return}var kD=e-this.zoomLevel;var T=new fv(this.width/2,this.height/2);var i=this.pointToPixelIn(kE);var kC=new jm(i.x-T.x,i.y-T.y);this.lastLevel=this.zoomLevel;if(Math.abs(kD)>=4||Math.abs(kC.width)>this.width||Math.abs(kC.height)>this.height){this.centerAndZoomIn(kE,e);return}var kA=this.deepZoom||new aH(this);var kz=kD>0?1:-1;kA.zoomMap(i,kD,kz,kC)},panToIn:function(i,T){T=T||{};if(!i||i.equals(this.centerPoint)){T.callback&&T.callback();return}var kz=this.pointToPixelIn(i);var e=Math.round(this.width/2);var kA=Math.round(this.height/2);if(Math.abs(e-kz.x)>this.width||Math.abs(kA-kz.y)>this.height||T.noAnimation===true){this._panToIn(e-kz.x,kA-kz.y,i);T.callback&&T.callback()}else{this._panBy(e-kz.x,kA-kz.y,T)}},_panToIn:function(i,e,kz){var T=this.temp;if(T.operating===true){return}if(T.dragAni){T.dragAni.stop();T.dragAni=null;this.dispatchEvent(new fW("onmoveend"))}this.dispatchEvent(new fW("onmovestart"));this._setPlatformPosition(i,e,{point:kz});this.dispatchEvent(new fW("onmoveend"))},panBy:function(i,e,T){T=T||{};i=Math.round(i)||0;e=Math.round(e)||0;if(Math.abs(i)<=this.width&&Math.abs(e)<=this.height&&T.noAnimation!==true){this._panBy(i,e,T)}else{this._panToIn(i,e);T.callback&&T.callback()}},_panBy:function(i,e,kA){if(this.temp.operating===true){return}kA=kA||{};this.dispatchEvent(new fW("onmovestart"));var kz=this;var T=kz.temp;T.pl=kz.offsetX;T.pt=kz.offsetY;if(T.tlPan){T.tlPan.cancel()}if(T.dragAni){T.dragAni.stop();T.dragAni=null;this.dispatchEvent(new fW("onmoveend"))}T.tlPan=new fL({fps:kA.fps||kz.config.fps,duration:kA.duration||kz.config.actionDuration,transition:kA.transition||gR.easeInOutQuad,render:function(kB){this.terminative=kz.temp.operating;if(kz.temp.operating){return}kz._setPlatformPosition(Math.ceil(i*kB),Math.ceil(e*kB),{initMapOffsetX:T.pl,initMapOffsetY:T.pt})},finish:function(kB){kz.dispatchEvent(new fW("onmoveend"));kz.temp.tlPan=false;if(kz.temp.stopArrow===true){kz.temp.stopArrow=false;if(kz.temp.arrow!==0){kz._arrow()}}kA.callback&&kA.callback()}})},getCenterIn:function(){return this.centerPoint},getZoom:function(){return this.zoomLevel},setTilt:function(){},getTilt:function(){return this._tilt},setHeading:function(){},getHeading:function(){return this._heading},restrictCenter:function(kH,i,e){this.isRestrict=false;i=i||this.getZoomUnits();e=e||this.zoomLevel;var kF=this.pixelToPointIn(new fv(this.width,0),{center:kH,zoom:e});var kD=this.pixelToPointIn(new fv(0,this.height),{center:kH,zoom:e});var kI=kH.lng;var kN=kH.lat;if(this.config.restrictBounds!==null&&!this.config.restrictBounds.isEmpty()){var kM=this.config.restrictBounds;var kz=kM.getSouthWest();var kK=kM.getNorthEast();var kG=jv.convertLL2MC(kz);var kB=jv.convertLL2MC(kK);kH.lng=this.calcNewLngByBounds(kI,kD,kF,kG.lng,kB.lng,i);kH.lat=this.calcNewLatByBounds(kN,kD,kF,kG.lat,kB.lat,i);return kH}var kE=this.pixelToPointIn(new fv(0,0),{center:kH,zoom:e});var kA=this.pixelToPointIn(new fv(0,this.height),{center:kH,zoom:e});if(this.zoomLevel<5){if(kE.lat>h4.MAX_LAT&&kA.lat<h4.MIN_LAT){this.isRestrict=true;var T=h4.MAX_LAT-kH.lat;var kC=kH.lat-h4.MIN_LAT;var kL;if(T<kC){kL=T/(this.height/2)}else{kL=kC/(this.height/2)}var kJ=18-r(kL);this.zoomLevel=Math.ceil(kJ);kH.zoom=Math.ceil(kJ);return kH}}if(kE.lat>h4.MAX_LAT){this.isRestrict=true;kH.lat=h4.MAX_LAT-this.height/2*i}else{if(kA.lat<h4.MIN_LAT){this.isRestrict=true;kH.lat=h4.MIN_LAT+this.height/2*i}}return kH}});function h4(e,T){if(typeof e==="string"){e=document.getElementById(e)}dh.call(this);this.container=e;this.width=e.clientWidth;this.height=e.clientHeight;this.offsetX=0;this.offsetY=0;this._setStyle(e);e.unselectable="on";e.innerHTML="";e9.ac(e,"bmap-container");e.appendChild(this.render());this._initDate=new Date();this.platform=e.children[0];this.maskLayer=this.platform.children[0];this._panes={};this.centerPoint=new cG(0,0);this.zoomLevel=0;this._heading=0;this._tilt=0;this._bounds=new ij();this.lastLevel=0;this._lock=false;this._enableTiltZoom=7;this._enableHeadingZoom=7;this.defaultZoomLevel=null;this.defaultCenter=null;this.zoomEventStatus="idle";this.currentOperation=ep.idle;this._setConfig(T);this._initMapRenderType();this._animationInfo={};this._animationInfoUnstopable={};this.suspendLoad=false;this.earthBoundary=true;this._customTileLabels=[];this.areaCustomLoaded=true;this.defaultPoint=new cG(116.418,39.918);if(this._renderType==="webgl"){this._workerMgr=new jS(this);this._featureMgr=new cm();e9.extend(this,F.prototype);this.jobScheduler=new bs(this);this.benchmark=new c7();this._setupWebGLMap();this.deviceInfo={hardwareInfo:{renderer:"",vendor:""}};if(df.ifSupportWebGL._renderer){this.deviceInfo.hardwareInfo.renderer=df.ifSupportWebGL._renderer;this.deviceInfo.hardwareInfo.vendor=df.ifSupportWebGL._vendor}je.setMap(this)}else{e9.extend(this,jc.prototype)}if(!ev[this.config.mapType]){this.config.mapType=BMAPGL_NORMAL_MAP}if(this.config.mapType===BMAP_EARTH_MAP&&!this.config.enableEarth){if(this.forceEnableEarth()===false){this.config.mapType=BMAPGL_NORMAL_MAP}}this.mapType=this.config.mapType;this.preMapType=null;if(this.config.enableEarth){var kB=this.maskLayer.style;kB.opacity=0;kB.background="#000";if(this.config.mapType===BMAP_EARTH_MAP){kB.opacity=1}setTimeout(function(){kB.WebkitTransition=kB.transition="opacity .4s"},100)}this._isHybridShow=this.config.showStreetLayer;this.temp={operating:false,arrow:0,lastDomMoveTime:0,lastLoadTileTime:0,lastMovingTime:0,canKeyboard:false,I:function(i){return e9.I(i)},curSpots:[],curSpotsArray:[],curAreaSpot:null,spotsGuid:1,registerIndex:-1,hoverOnSpot:null,isStdCtrlBusy:false};window.InstanceCore=this.temp.I;this.platform.style.cursor=this.config.defaultCursor;this._bind();if(!bG.BMAP_INSTANCES){bG.BMAP_INSTANCES=1}else{bG.BMAP_INSTANCES+=1}for(var kz=0;kz<bG._register.length;kz++){bG._register[kz](this)}this.temp.registerIndex=kz;var kA=this;if(this._renderType==="webgl"){hl.load("oppcgl",function(){kA._asyncRegister()})}else{hl.load("oppc",function(){kA._asyncRegister()})}if(this.config.mapType==="B_EARTH_MAP"){if(!bG.Earth){hl.load("earth",function(){})}else{kA._syncAndChangeMapType("B_EARTH_MAP")}}}h4.MAX_TILT=87;h4.MAX_DRAG_TILT=73;h4.MAX_DRAG_TILT_L2=50;h4.MIN_TILT=0;h4.MAX_LAT=19431424;h4.MIN_LAT=-16023552;h4.WORLD_SIZE_MC_HALF=20037726.372307256;h4.WORLD_SIZE_MC=h4.WORLD_SIZE_MC_HALF*2;h4.RIGHT_EDGE_POINT=new cG(h4.WORLD_SIZE_MC_HALF,0);h4.LEFT_EDGE_POINT=new cG(-h4.WORLD_SIZE_MC_HALF,0);h4.HIGH_RES_MIN_RATIO=1.2;h4.inherits(dh,"Map");var fD={NORMAL:"B_NORMAL_MAP",EARTH:"B_EARTH_MAP",SATELLITE:"B_STREET_MAP"};bG.MapTypeId=fD;e9.extend(h4.prototype,{render:function(){var e=b6("div",{id:"platform"});var kz=e.style;kz.overflow="visible";kz.position="absolute";kz.zIndex=5;kz.top=kz.left="0px";var i=b6("div",{id:"mask","class":"BMap_mask"});var T=i.style;T.position="absolute";T.top=T.left="0px";T.zIndex="9";T.overflow="hidden";T.WebkitUserSelect="none";T.width=this.width+"px";T.height=this.height+"px";e.appendChild(i);return e},_initMapRenderType:function(){var e=this.config.forceRenderType;if(e==="dom"){this._renderType="dom";return}else{if(e==="canvas"){if(df.isModernBrowser&&!df.ifCanvas2dInBlackList()){this._renderType="canvas";return}else{this._renderType="dom";return}}else{if(e==="webgl"){if(df.ifSupportWebGL()){this._renderType="webgl";return}}}}if(df.ifSupportWebGL()&&df.ifEnableWebGLMap()){this._renderType="webgl";return}if(df.isModernBrowser&&df.ifEnableCanvas2dMap()){this._renderType="canvas";return}this._renderType="dom"},_setConfig:function(i){i=i||{};this.config={bottomOffset:0,clickInterval:200,enableDragging:true,enableRotate:true,enableTilt:true,enableKeyboard:false,enableDblclickZoom:true,enableContinuousZoom:true,enableWheelZoom:false,enableRotateGestures:true,enableTiltGestures:true,enablePinchZoom:true,fixCenterWhenPinch:false,enableAutoResize:true,zoomCenter:null,fps:e9.Browser.ie?30:60,zoomerDuration:240,actionDuration:450,defaultCursor:E.defaultCursor,draggingCursor:E.draggingCursor,overlayMoveCursor:"pointer",coordType:BMAP_COORD_MERCATOR,mapType:BMAPGL_NORMAL_MAP,drawer:BMAP_SYS_DRAWER,enableInertialDragging:true,drawMargin:500,drawMarginGL:500,enableFulltimeSpotClick:false,enableResizeOnCenter:false,isModernBrowser:df.isModernBrowser,forceRenderType:"",textRenderType:null,ratio:gt()>=h4.HIGH_RES_MIN_RATIO?2:1,enableEarth:df.ifEnableEarth(),defaultMaxBounds:new ij(new cG(-21364736,-10616832),new cG(23855104,15859712)),showControls:false,indoorControl:false,showRealSunlight:true,showMilkyway:true,earthBackground:null,showStreetLayer:true,showVectorStreetLayer:false,showVectorLine:false,textureScale:1,minZoom:null,maxZoom:null,earthUseRound:true,earthMinZoom:null,earthMaxZoom:null,earthSun:true,earthClouds:true,earthMarkerShowAllTime:true,earthOpacity:null,earthFixAxis:false,style:"default",showCustomIndoor:true,backgroundColor:null,enableIconClick:false,autoSafeArea:false,ak:null,webgl2:false,restrictCenter:true,restrictBounds:null,smaa:false,preserveDrawingBuffer:false,privateOn:false,privateRegions:null,popRightClick:false,videoMuted:true,overlayTop:false,highRegion:{lineOpt:null,focusOpt:false},forceReload:true,textureSizeHeight:4096*2};for(var T in i){if(i.hasOwnProperty(T)){this.config[T]=i[T];if(T==="fixCenterWhenResize"){this.config.enableResizeOnCenter=i[T]}}}if(i.style){if(i.style["styleId"]&&i.style["styleId"].length<32){this.config.style=i.style["styleId"]}else{this.config.style=i.style}}this._setTextRenderType();this._displayOptions={poi:true,poiText:true,poiIcon:true,overlay:true,layer:true,building:true,indoor:true,street:true,skyColors:["rgba(226, 237, 248, 0)","rgba(186, 211, 252, 1)"],isFlat:false,labelMargin:0,buildingSideGradation:false};if(i.displayOptions){for(var e in i.displayOptions){if(i.displayOptions.hasOwnProperty(e)){this._displayOptions[e]=i.displayOptions[e]}}}this.updateFocusOptions(i.focusOptions,true);if(this.config.restrictCenter===false){this._enableTiltZoom=0;this._enableHeadingZoom=0}},updateFocusOptions:function(e,T){this._spotOptions={open:false,gray:false,involve:1,focus:0,other:7156516};if(e){for(var i in e){if(e.hasOwnProperty(i)){this._spotOptions[i]=e[i]}}}if(this._webglMapScene&&this._webglMapScene._painter){this._webglMapScene._painter._hightLightEnable()}if(!T){this._drawFrame()}},getMinZoom:function(){var T;if(ev[this.mapType][this._renderType]){T=ev[this.mapType][this._renderType].minZoom}else{T=ev[this.mapType].minZoom}if(this.config.minZoom!==null&&this.config.minZoom>=T){T=this.config.minZoom}if(this.mapType==="B_EARTH_MAP"){return T}var i=this.getSize();var e=this.worldSize(T);while(e<i.width){T++;e=this.worldSize(T)}return T},getMaxZoom:function(){var e;if(ev[this.mapType][this._renderType]){e=ev[this.mapType][this._renderType].maxZoom}else{e=ev[this.mapType].maxZoom}if(this.config.maxZoom!==null&&this.config.maxZoom<=e){e=this.config.maxZoom}else{if(this._renderType==="webgl"){e=21}}return e},_drawFrame:function(){if(this._webglMapScene&&this._webglMapScene._painter){this._webglMapScene._painter.draw()}},_setupWebGLMap:function(){var e=this;hl.load("mapgl",function(){e._asyncRegister()})},_setStyle:function(i){var e=i.style;e.overflow="hidden";if(cq(i).position!=="absolute"){e.position="relative"}e.backgroundImage="url("+E.imgPath+"bg.png)";e.textAlign="left";e.touchAction=e.MSTouchAction="none"},_bind:function(){var e=this;if(e._renderType!=="webgl"){e._watchSize=function(){var T=e.getContainerSize();if(e.width!==T.width||e.height!==T.height){var kC=(T.width-e.width)/2;var kE=(T.height-e.height)/2;var kz=e.getZoomUnits();var kB=e.centerPoint;if(kB&&!e.config.enableResizeOnCenter){e.centerPoint=new cG(kB.lng+kC*kz,kB.lat-kE*kz)}e.maskLayer.style.width=(e.width=T.width)+"px";e.maskLayer.style.height=(e.height=T.height)+"px";var kA=new fW("onresize");kA.size=T;e.dispatchEvent(kA);e.fire(new fW("onsize_changed"));var i=parseInt(e.platform.style.left,10)||0;var kD=parseInt(e.platform.style.top,10)||0;if(e.currentOperation!=="undefined"&&e.currentOperation!==ep.idle&&(e.offsetX!==i||e.offsetY!==kD)){e._setPlatformPosition(i,kD)}}}}else{e._watchSize=function(){var i=e.getContainerSize();if(e.width!==i.width||e.height!==i.height){var kz=e.getSize();e.maskLayer.style.width=(e.width=i.width)+"px";e.maskLayer.style.height=(e.height=i.height)+"px";if(gt()!==e.config.ratio){e.config.ratio=gt()}var kA=new fW("onresize");kA.size=i;e.dispatchEvent(kA);var T=new fW("onsize_changed");T.size=i;T.oldSize=kz;e.fire(T)}}}if(e.config.enableAutoResize){e.temp.autoResizeTimer=setInterval(e._watchSize,16)}this.on("size_changed",function(){var i=e.getMinZoom();if(e.zoomLevel<i){e.setZoomIn(i,{noAnimation:true})}});this.on("zoom_changed",function(){this.dispatchEvent(new fW("onzooming"))})},addControl:function(e){if(e&&b0(e._i)){e._i(this);this.dispatchEvent(new fW("onaddcontrol",e))}},removeControl:function(e){if(e&&b0(e.remove)){e.remove();this.dispatchEvent(new fW("onremovecontrol",e))}},hideEarthBoundary:function(){this.earthBoundary=false},showEarthBoundary:function(){this.earthBoundary=true},addContextMenu:function(i,e){if(i){i.initialize(this,e);this.dispatchEvent(new fW("onaddcontextmenu",i))}},removeContextMenu:function(e){if(e){this.dispatchEvent(new fW("onremovecontextmenu",e));e.remove()}},addDistrictLayer:function(e){if(e){e.initialize(this)}},removeDistrictLayer:function(e){if(e){e.removeDistrict(this,e)}},addCustomHtmlLayer:function(e){if(e){e.initialize(this)}},removeCustomHtmlLayer:function(e){if(e){e.removeLayer(e)}},addParkingSpot:function(e){if(e){e.initialize(this)}},removeParkingSpot:function(e){if(e){e.removeParkingSpot()}},addOverlay:function(i){if(i&&b0(i._i)){var T=new fW("onbeforeaddoverlay",i);T.overlay=i;this.dispatchEvent(T);i._i(this);T=new fW("onaddoverlay",i);T.overlay=i;this.dispatchEvent(T)}},removeOverlay:function(i){if(i&&b0(i.remove)){if(i instanceof cs){if(this.stencil){this.stencil=null}}var T=new fW("onremoveoverlay",i);T.overlay=i;i.remove();this.dispatchEvent(T)}},addFocusMask:function(e){if(e instanceof i1){je.addFocusMask(e)}if(e instanceof Array){for(var T=0;T<e.length;T++){if(e[T] instanceof i1){je.addFocusMask(e[T])}}}this._drawFrame()},removeFocusMask:function(e){if(e instanceof i1){je.removeFocusMask(e)}if(e instanceof Array){for(var T=0;T<e.length;T++){if(e[T] instanceof i1){je.removeFocusMask(e[T])}}}this._drawFrame()},clearFocusMasks:function(){je.removeFocusMask();this._drawFrame()},clearOverlays:function(){this.dispatchEvent(new fW("onclearoverlays"))},addTileLayer:function(kA){if(!kA){return}if(kA instanceof dB||kA instanceof ek){if(kA.layer){kA=kA.layer}else{return}}for(var kz=0,e=this.tileMgr.tileLayers.length;kz<e;kz++){var T=this.tileMgr.tileLayers[kz];if(T===kA||T.getMapType()===kA.getMapType()){return}}kA.initialize(this);this.dispatchEvent(new fW("onaddtilelayer",kA))},removeTileLayer:function(e){if(e){if(e instanceof dB||e instanceof ek){if(e.layer){e=e.layer}else{return}}e.remove();this.dispatchEvent(new fW("onremovetilelayer",e))}},addNormalLayer:function(e){if(!e||!(e instanceof cv)){return}this.dispatchEvent(new fW("onaddnormallayer",e))},removeNormalLayer:function(e){if(e&&e instanceof cv){this.dispatchEvent(new fW("onremovenormallayer",e))}},addGeoJSONLayer:function(e){if(e&&e instanceof aQ){e.init(this)}},removeGeoJSONLayer:function(e){if(e&&e instanceof aQ){e.remove()}},getTileLayer:function(e){if(this.tileMgr){return this.tileMgr.getTileLayer(e)}return null},setMapType:function(e){var i=this;if(this.mapType===e||this._mapTypeChanging){return}if(e===BMAP_EARTH_MAP&&!this.config.enableEarth){return}if(this._earth&&this._earth.getLock()){return}this._mapTypeChanging=true;this.preMapType=this.mapType;this._boundsInPreMapType=this.getBoundsIn();if(this.preMapType===BMAP_SATELLITE_MAP){this._preStreetLayerShow=this._isHybridShow}if(e===BMAP_EARTH_MAP){if(i.config.earthOpacity!==null){i._webglPainter&&(i._webglPainter._canvas.style.opacity=0)}if(!bG.Earth){hl.load("earth",function(){i._syncAndChangeMapType(e)});return}i._syncAndChangeMapType(e)}else{if(this.preMapType!==BMAP_EARTH_MAP){this._changeFlatMapType(e);this._mapTypeChanging=false}else{this._setMapTypeStatus(e,function(T,kz){var kA=i._earth.getEarthCanvas();i._changeFlatMapType(e,this.preMapType);if(i._mapTypeChangAni){i._mapTypeChangAni.stop()}i._mapTypeChangAni=dx.start({el:kA,style:"opacity",startValue:1,endValue:0,duration:200,callback:function(){i._mapTypeChangAni=null;i._mapTypeChanging=false;if(i.config.earthOpacity!==null){i._webglPainter&&(i._webglPainter._canvas.style.opacity=1)}}});T=jv.convertLL2MC(T);if(i._renderType==="webgl"){e9.extend(i,F.prototype);i.setCenterIn(T,{noAnimation:true});i.setZoomIn(kz,{noAnimation:true})}else{e9.extend(i,jc.prototype);i.centerAndZoomIn(T,kz)}})}}},_changeFlatMapType:function(kC){if(!kC||!ev[kC]){return}var kK=this.preMapType;this.mapType=kC;var kz=this.getTileLayer(kK);if(kz){this.removeTileLayer(kz)}else{if(this.tileMgr.tileLayers.length){var kJ=this.getTileLayer("B_NORMAL_MAP");if(kJ){this.removeTileLayer(kJ)}else{kJ=this.getTileLayer("B_SATELLITE_MAP");kJ&&this.removeTileLayer(kJ)}}}this._preStreetLayerShow=this.config.showStreetLayer;if(kK===BMAP_SATELLITE_MAP&&this.config.showVectorStreetLayer){this._removeHybirdVectorMap()}else{if(kK===BMAP_SATELLITE_MAP&&this._preStreetLayerShow){this._removeHybirdMap()}}if(this.mapType!==BMAP_EARTH_MAP||this._renderType!=="webgl"||this.baseLayerAdded!==true){if(kC!==BMAP_NONE_MAP){var T=new ij(new cG(-21364736,-10616832),new cG(23855104,15859712));var kH=new o(T,"baidu",kC);var kA=new hO({mapType:this.mapType,copyright:kH,dataType:this.mapType===BMAP_SATELLITE_MAP?gW:h2,customLayer:this.mapType===BMAP_SATELLITE_MAP,baseLayer:true,transparentPng:false,tileTypeName:this.mapType===BMAP_SATELLITE_MAP?"web":"na"});kA._isInnerLayer=true;kA.setZIndex(0);this.addTileLayer(kA);if(this._renderType==="webgl"&&!this.baseLayerAdded){this.baseLayerAdded=true}}if(this.mapType===BMAP_NONE_MAP){hP.sendMessage(a1(4,3,15),["layer","blank"])}else{if(this.mapType===BMAP_SATELLITE_MAP){hP.sendMessage(a1(4,3,2),["layer","raster"])}else{hP.sendMessage(a1(4,3,1,1),["layer","vector","normal"])}}}if(kC===BMAP_SATELLITE_MAP){this._featureMgr.clearLabelOverlayData();this._featureMgr.setLabelData([]);if(this.config.showVectorStreetLayer){this._addHybirdVectorMap()}else{if(this._preStreetLayerShow===true||typeof this._preStreetLayerShow==="undefined"){this._addHybirdMap()}}}var kE=this.tileMgr.tileLayers;for(var kD=0,kB=kE.length;kD<kB;kD++){var kF=kE[kD];var kI=kF.tilesDiv;if(!kI){continue}if(!kF._isInnerLayer&&kI.style.visibility==="hidden"){kI.style.visibility=""}}var kG=new fW("onmaptypechange");kG.zoomLevel=this.zoomLevel;kG.mapType=kC;kG.exMapType=kK;this.dispatchEvent(kG)},showStreetLayer:function(e){if(e){this.hideVectorStreetLayer()}e?this._addHybirdMap():this._removeHybirdMap()},showVectorStreetLayer:function(){this.hideStreetLayer();this.hideVectorStreetLayer();this.config.showVectorStreetLayer=true;if(this.mapType===BMAP_SATELLITE_MAP||this.mapType===BMAP_NONE_MAP){this._addHybirdVectorMap()}},hideStreetLayer:function(e){this._hideStreetLayerOptions=e;this._removeHybirdMap(e)},hideVectorStreetLayer:function(){this.config.showVectorStreetLayer=false;if(this.mapType===BMAP_SATELLITE_MAP||this.mapType===BMAP_NONE_MAP){this._removeHybirdVectorMap()}},_addHybirdVectorMap:function(){var e=new hO({mapType:"B_NORMAL_MAP",dataType:h2,customLayer:false,baseLayer:false,transparentPng:true,tileTypeName:"na"});e._isInnerLayer=true;e.setZIndex(1);this.addTileLayer(e)},_removeHybirdVectorMap:function(){var kA=this.tileMgr.tileLayers;for(var kz=0,e=kA.length;kz<e;kz++){var T=kA[kz];if(T._isInnerLayer&&T.mapType==="B_NORMAL_MAP"){this.removeTileLayer(T)}}},_addHybirdMap:function(){this._isHybridShow=true;if(this.mapType==="B_EARTH_MAP"){if(this._earth){this._earth.showStreetLayer()}return}if(this._hybridTileLayer){this.addTileLayer(this._hybridTileLayer);var kC=new fW("onstreetlayer_show");this.dispatchEvent(kC);return}var kA=new ij(new cG(-21364736,-10616832),new cG(23855104,15859712));var T=new o(kA,"",BMAP_HYBRID_MAP);var i=new hO({copyright:T,transparentPng:true,pack:true,tileTypeName:"web"});i._isInnerLayer=true;var kz=this.isCanvasMap();i.getTilesUrl=function(kD,kJ){var kH=ev.B_STREET_MAP;var kI=ka("ditu","satelliteStreet");var kE=kI.ver;var e=kI.udt;var kG=fc.calcLoopParam(kD.x,kJ).col;var kF=kH.tileUrls[Math.abs(kD.x+kD.y)%kH.tileUrls.length]+"?qt=vtile&x="+(kG+"").replace(/-/gi,"M")+"&y="+(kD.y+"").replace(/-/gi,"M")+"&z="+kJ+"&styles=sl&v="+kE+"&udt="+e+"&scaler="+gt()+"&showtext="+(kz?0:1);return kF};this._isHybridShow=true;this.addTileLayer(i);this._hybridTileLayer=i;var kB=new fW("onstreetlayer_show");this.dispatchEvent(kB)},_removeHybirdMap:function(i){this._isHybridShow=false;if(this.mapType==="B_EARTH_MAP"){if(this._earth){this._earth.hideStreetLayer(i)}return}if(this._hybridTileLayer){this.removeTileLayer(this._hybridTileLayer);var T=new fW("onstreetlayer_hide");this.dispatchEvent(T)}},isStreetLayerShow:function(){return this._isHybridShow},getTileId:function(e,kB){var kz=ev[this.mapType];if(typeof kz!=="object"){return null}var T=kz.baseUnits*Math.pow(2,(kz.zoomLevelBase-kB));var kA=parseInt(e.lng/T,10);var i=parseInt(e.lat/T,10);return{row:kA,column:i,level:kB}},reset:function(){this.centerAndZoomIn(this.defaultCenter,this.defaultZoomLevel,true)},setOptions:function(i){i=i||{};var kA=this;for(var kz in i){if(i.hasOwnProperty(kz)){var T=true;if(typeof i[kz]!=="object"){T=i[kz]!==this.config[kz]}this.config[kz]=i[kz];if(kz==="fixCenterWhenResize"){this.config.enableResizeOnCenter=i[kz]}if(!T){continue}switch(kz){case"style":case"styleUrl":var e={os:i.style.os,sv:i.style.sv};if(kz==="style"&&i.styleUrl){break}this.fire(new fW("onstyle_willchange"));this.loadMapStyleFiles(function(){var kB=new fW("onlayer_update");kB.name="na";kA.fire(kB)},e);break;case"enableAutoResize":if(i[kz]===true){this.enableAutoResize()}else{this.disableAutoResize()}break;case"displayOptions":this.setDisplayOptions(i[kz]);break}}}},setPrivateStatus:function(i){if(typeof i==="boolean"){if(this.config.privateOn!==i){this.config.privateOn=i;var e=new fW("onlayer_update");e.name="na";this.fire(e)}}},getPrivateStatus:function(){return this.config.privateOn},setPrivateRegions:function(kA){if(kA&&kA instanceof Array){var kz=true;for(var T=0;T<kA.length;T++){if(kA[T] instanceof cV){continue}else{kz=false;break}}if(kz){this.config.privateRegions=kA;var e=new fW("onlayer_update");e.name="na";this.fire(e)}}},getPrivateRegions:function(){if(!this.config.privateRegions){return null}else{return this.config.privateRegions}},enableDragging:function(){this.config.enableDragging=true},disableDragging:function(){this.config.enableDragging=false},enableInertialDragging:function(){this.config.enableInertialDragging=true},disableInertialDragging:function(){this.config.enableInertialDragging=false},enableScrollWheelZoom:function(){this.config.enableWheelZoom=true},disableScrollWheelZoom:function(){this.config.enableWheelZoom=false},enableContinuousZoom:function(){this.config.enableContinuousZoom=true},disableContinuousZoom:function(){this.config.enableContinuousZoom=false},enableResizeOnCenter:function(){this.config.enableResizeOnCenter=true},disableResizeOnCenter:function(){this.config.enableResizeOnCenter=false},enableDoubleClickZoom:function(){this.config.enableDblclickZoom=true},disableDoubleClickZoom:function(){this.config.enableDblclickZoom=false},enableKeyboard:function(){this.config.enableKeyboard=true},disableKeyboard:function(){this.config.enableKeyboard=false},getSize:function(){return new jm(this.width,this.height)},enablePinchToZoom:function(){this.config.enablePinchZoom=true},disablePinchToZoom:function(){this.config.enablePinchZoom=false},enableRotateGestures:function(){this.config.enableRotateGestures=true},disableRotateGestures:function(){this.config.enableRotateGestures=false},enableTilt:function(){this.config.enableTilt=true},disableTilt:function(){this.config.enableTilt=false},enableRotate:function(){this.config.enableRotate=true},disableRotate:function(){this.config.enableRotate=false},enableAutoResize:function(){this.config.enableAutoResize=true;this._watchSize();if(!this.temp.autoResizeTimer){this.temp.autoResizeTimer=setInterval(this._watchSize,16)}},disableAutoResize:function(){this.config.enableAutoResize=false;if(this.temp.autoResizeTimer){clearInterval(this.temp.autoResizeTimer);this.temp.autoResizeTimer=null}},checkResize:function(){this._watchSize()},resize:function(){this._watchSize()},getContainerSize:function(){return new jm(this.container.clientWidth,this.container.clientHeight)},_getProperZoom:function(T){if(!T){T=this.zoomLevel}var i=this.getMinZoom();var e=this.getMaxZoom();var kz=false;if(T<i){kz=true;T=i}if(T>e){kz=true;T=e}if(this._renderType!=="webgl"){T=Math.round(T)}return{zoom:T,exceeded:kz}},getContainer:function(){return this.container},getZoomUnits:function(T){if(this.mapType===BMAP_EARTH_MAP){return Math.pow(2,18-this._earth.getImageZoom())}var e=ev[this.mapType];if(typeof e!=="object"){return null}var i=T||this.zoomLevel;return Math.pow(2,(e.zoomLevelBase-i))},pointToPixelIn:function(kI,kK){if(!kI){return}kK=kK||{};if(this.mapType===BMAP_EARTH_MAP){var kz;if(!kI._llPt){kz=jv.convertMC2LL(kI);kI._llPt=kz}kz=kI._llPt;var kE=null;var T=null;if(typeof kK.zoom==="number"){var kH=this._earth;var kJ=kH._getEarthZoomByImgZoom(kK.zoom);if(kJ<=3){kE=kH._generateTmpPMatrix(kJ)}T=kH._generateTmpMVMatrix(kH.getCenter(),kJ)}var kA=this._earth.fromLatLngToPixel(kz,{useRound:false,isCalcOnBack:true,matrixInfo:{modelViewMatrix:T,projectionMatrix:kE}});return kA}if((this._heading%360===0&&this._tilt===0)||!this._webglMapCamera){var kG=this.getZoomUnits(kK.zoom);var kC=kK.center||this.centerPoint;var i=this.width/2;var kB=this.height/2;var kF=(kI.lng-kC.lng)/kG+i;var kD=(kC.lat-kI.lat)/kG+kB;if(kK.useRound!==false){kF=Math.round(kF);kD=Math.round(kD)}return new fv(kF,kD)}var e=this._webglMapCamera.fromMCToScreenPixel(kI.lng,kI.lat,kK);if(kK.useRound===false){return e}e.x=Math.round(e.x);e.y=Math.round(e.y);return e},pixelToPointIn:function(e,kG){if(!e){return}kG=kG||{};if(this.mapType===BMAP_EARTH_MAP){if(typeof kG.zoom==="number"){var kE=this._earth;var kB=null;var T=null;var kF=kE._getEarthZoomByImgZoom(kG.zoom);if(kF<=3){kB=kE._generateTmpPMatrix(kF)}T=kE._generateTmpMVMatrix(kE.getCenter(),kF)}var i=this._earth.fromPixelToLatLng(e,{matrixInfo:{modelViewMatrix:T,projectionMatrix:kB}});if(i===null){return null}return jv.convertLL2MC(i)}if((this._heading%360!==0||this._tilt>0)&&this._webglMapCamera){return this._webglMapCamera.fromScreenPixelToMC(e.x,e.y,kG)}var kC=kG.center||this.centerPoint;var kD=this.getZoomUnits(kG.zoom);var kA=kC.lng+kD*(e.x-this.width/2);var kz=kC.lat-kD*(e.y-this.height/2);return new cG(kA,kz)},pointToOverlayPixelIn:function(e,kz){kz=kz||{};var T=this.pointToPixelIn(e,{zoom:kz.zoom,center:kz.center,forLabel:true,frustumTest:true,useRound:kz.useRound});if(!T){return}if(kz.fixPosition&&this.mapType!=="B_EARTH_MAP"){var kA=this.getSize();var i=this.worldSize(kz.zoom);if(T.x>kA.width){while(T.x>kA.width){T.x-=i}}else{if(T.x<0){while(T.x<0){T.x+=i}}}}if(this._renderType==="webgl"){return T}T.x-=this.offsetX;T.y-=this.offsetY;return T},overlayPixelToPointIn:function(i,e){if(!i){return}var T=i.clone();if(this._renderType!=="webgl"){T.x+=this.offsetX;T.y+=this.offsetY}return this.pixelToPointIn(T,e)},getProjection:function(){return new jv()},lnglatToMercator:function(e,kz){var i=new cG(e,kz);var T=jv.convertLL2MC(i);return[T.lng,T.lat]},mercatorToLnglat:function(i,e){if(isNaN(i)||isNaN(e)){return[]}i=parseFloat(i);e=parseFloat(e);var kz=new cG(i,e);var T=jv.convertMC2LL(kz);return[T.lng,T.lat]},getBoundsIn:function(){if(!this._bounds){return}var kM=arguments[0];if(this.mapType===BMAP_EARTH_MAP&&this._earth){var kG=this._earth.getCustomBounds();if(!kG){return this.config.defaultMaxBounds}var kF=kG.getSouthWest();var e=kG.getNorthEast();if(kF.lng>e.lng){e.lng=180}var k3=jv.convertLL2MC(kF);var kT=jv.convertLL2MC(e);var kJ=this.config.defaultMaxBounds;var kS=Math.max(k3.lng,kJ.sw.lng);var kR=Math.max(k3.lat,kJ.sw.lat);var kL=Math.min(kT.lng,kJ.ne.lng);var kK=Math.min(kT.lat,kJ.ne.lat);var kO=new ij(new cG(kS,kR),new cG(kL,kK));kO.pointBottomLeft=new cG(kS,kR);kO.pointBottomRight=new cG(kL,kR);kO.pointTopLeft=new cG(kS,kK);kO.pointTopRight=new cG(kL,kK);kO.setMinMax();kO.makeNormalizedPoint(this._earth.getHeading());return kO}kM=kM||{};var kA=kM.margins||[0,0,0,0];var kY=this.pixelToPointIn({x:kA[3],y:this.height-kA[2]},kM);var k2=this.pixelToPointIn({x:this.width-kA[1],y:kA[0]},kM);var kQ=typeof kM.heading==="number"?kM.heading:(this._heading%360);var T=typeof kM.tilt==="number"?kM.tilt:this._tilt;var kI=this._webglMapCamera;if((kQ===0&&T===0)||!kI){this._bounds.setSouthWest(kY);this._bounds.setNorthEast(k2);this._bounds.pointBottomLeft=kY;this._bounds.pointBottomRight=new cG(k2.lng,kY.lat);this._bounds.pointTopRight=k2;this._bounds.pointTopLeft=new cG(kY.lng,k2.lat);this._bounds.setMinMax();this._bounds.makeNormalizedPoint(kQ);return this._bounds}var kP=this.pixelToPointIn({x:kA[3],y:kA[0]},kM);var kz=kI.getPosition();var k4=Math.sqrt(Math.pow(kP.lng-kz[0],2)+Math.pow(kP.lat-kz[1],2));var kZ=this.getZoomUnits();var k6=k4/kZ;var kW=kI._frustumSideLen;var kE=kI._fovy;if(k6>kW||(90-T)<kE/2){var k5=[kP.lng-kz[0],kP.lat-kz[1]];if((90-T)<kE/2){k5[0]=-k5[0];k5[1]=-k5[1]}var kX=kW*kZ;var kD=[k5[0]/k4*kX+kz[0],k5[1]/k4*kX+kz[1]];var kU=[k2.lng-kz[0],k2.lat-kz[1]];if((90-T)<kE/2){kU[0]=-kU[0];kU[1]=-kU[1]}var kB=[kU[0]/k4*kX+kz[0],kU[1]/k4*kX+kz[1]];kP.lng=kD[0];kP.lat=kD[1];k2.lng=kB[0];k2.lat=kB[1]}var kN=this.pixelToPointIn({x:this.width-kA[1],y:this.height-kA[2]},kM);var kV=[kY,k2,kP,kN];var k1=kV[0].lng;var k7=kV[0].lat;var kC=kV[0].lng;var kH=kV[0].lat;for(var k0=1;k0<4;k0++){if(kV[k0].lng<k1){k1=kV[k0].lng}if(kV[k0].lng>kC){kC=kV[k0].lng}if(kV[k0].lat<k7){k7=kV[k0].lat}if(kV[k0].lat>kH){kH=kV[k0].lat}}this._bounds.setSouthWest(new cG(k1,k7));this._bounds.setNorthEast(new cG(kC,kH));this._bounds.pointTopLeft=kP;this._bounds.pointTopRight=k2;this._bounds.pointBottomRight=kN;this._bounds.pointBottomLeft=kY;this._bounds.makeNormalizedPoint(kQ);this._bounds.setMinMax();return this._bounds},isLoaded:function(){return !!this.loaded},_getBestLevel:function(i,kI){var kB=0;if(this._renderType==="webgl"&&!b5()){kB=100}var kC=kI.margins||[10,10,10,10];var kz=kI.zoomFactor||0;var kD=kC[1]+kC[3];var kA=kC[0]+kC[2];var e=this.getMinZoom();var kH=this.getMaxZoom();var kG=i.toSpan();var kF=kG.width/(this.width-kD-kB);var kE=kG.height/(this.height-kA-kB);var T=18-r(Math.max(kF,kE));if(T<e){T=e}if(T>kH){T=kH}T+=kz;if(this._renderType!=="webgl"){T=Math.floor(T)}return T},getViewportIn:function(kI,kA){if(this.mapType===BMAP_EARTH_MAP){kI=kI||[];var kC=[];for(var kJ=0;kJ<kI.length;kJ++){if(!kI[kJ]){continue}kC.push(jv.convertMC2LL(kI[kJ]))}var kK=this._earth.getViewportIn(kC,kA);var kz=kK.center;var kG=kK.zoom;var kO=jv.convertLL2MC(kz);return{center:kO,zoom:kG}}var kE={center:this.getCenterIn(),zoom:this.getZoom()};if(!kI||kI.length===0){return kE}kA=kA||{};var kD;if(kI instanceof ij){kD=kI}else{var kB=kI;kD=new ij();for(var kH=kB.length-1;kH>=0;kH--){kD.extend(kB[kH])}if(kD.isEmpty()){return kE}}var kN=kD.getCenter();var e=this._getBestLevel(kD,kA);if(kA.margins){var T=kA.margins;var kM=(T[1]-T[3])/2;var kF=(T[0]-T[2])/2;var kL=this.getZoomUnits(e);kN.lng=kN.lng+kL*kM;kN.lat=kN.lat+kL*kF}return{center:kN,zoom:e}},setViewportIn:function(kz,kA){if(this.mapType===BMAP_EARTH_MAP){var kE;if(kz&&kz.center){var T=jv.convertMC2LL(kz.center);var kC=this._earth._getEarthZoomByImgZoom(kz.zoom,T);kE={center:T,zoom:kC}}else{kE=[];for(var kB=0;kB<kz.length;kB++){var kD=jv.convertMC2LL(kz[kB]);kE[kB]=new cA(kD.lat,kD.lng)}}this._earth.setViewportIn(kE,kA);return}var e;if(kz&&kz.center){e=kz}else{e=this.getViewportIn(kz,kA)}kA=kA||{};if(this._renderType==="webgl"){this.centerAndZoomIn(e.center,e.zoom,kA);return}if(e.zoom===this.zoomLevel&&kA.enableAnimation!==false){this.panToIn(e.center,{duration:200,callback:kA.callback})}else{this.centerAndZoomIn(e.center,e.zoom,kA)}},addSpots:function(T,i){if(!T||T.length===0){return}i=i||{};var kB=i.zIndex||0;var kA=typeof i.enableMultiResponse==="undefined"?true:!!i.enableMultiResponse;this.spotsPool=this.spotsPool||{};var e="sp"+(this.temp.spotsGuid++);this.spotsPool[e]={spots:T.slice(0),zIndex:kB,enableMultiResponse:kA};var kz=this;hl.load("hotspot",function(){kz._asyncRegister()});return e},getSpots:function(e){return this.spotsPool[e]&&this.spotsPool[e].spots||[]},removeSpots:function(e){if(!e||!this.spotsPool[e]){return}delete this.spotsPool[e]},clearSpots:function(){delete this.spotsPool},getIconByClickPosition:function(i){if(!this.config.enableIconClick||!this._spotsMgr){return null}var e=this._spotsMgr.getSpotsByScreenPosition(i);if(e[0]&&e[0].userdata){var T=e[0].userdata;return{name:T.name,uid:T.uid,position:T.iconPoint||e[0].pt}}return null},setBounds:function(e){ev[this.mapType].bounds=e.clone()},getCoordType:function(){return this.config.coordType},getPanes:function(){return this._panes},getInfoWindow:function(){if(this.temp.infoWin&&this.temp.infoWin.isOpen()){return this.temp.infoWin}return null},getDistanceIn:function(kA,e){if(!kA||!e){return}if(kA.equals(e)){return 0}if(this.mapType===BMAP_EARTH_MAP){var kz=jv.convertMC2LL(kA);var T=jv.convertMC2LL(e);return this._earth.getDistance(kz,T)}var i=jv.getDistanceByMC(kA,e);return i},getOverlays:function(){var kB=[];var kC=this._overlays;var kA=this._customOverlays;if(kC){for(var kz in kC){if(kC[kz] instanceof eM){kB.push(kC[kz])}}}if(kA){for(var T=0,e=kA.length;T<e;T++){kB.push(kA[T])}}return kB},getMapType:function(){return this.mapType},getMapCoordType:function(){return this.coordType},_asyncRegister:function(){for(var e=this.temp.registerIndex;e<bG._register.length;e++){if(bG._register[e] instanceof Function){bG._register[e](this)}}this.temp.registerIndex=e},setDefaultCursor:function(e){this.config.defaultCursor=e;if(this.platform){this.platform.style.cursor=this.config.defaultCursor}},getDefaultCursor:function(){return this.config.defaultCursor},setOverlayMoveCursor:function(e){this.config.overlayMoveCursor=e},getOverlayMoveCursor:function(){return this.config.overlayMoveCursor},setDraggingCursor:function(e){this.config.draggingCursor=e},getDraggingCursor:function(){return this.config.draggingCursor},_syncAndChangeMapType:function(e){hP.sendMessage(a1(4,250),["earth",""]);var i=this;if(i._renderType==="webgl"&&i.getTilt()>h4.MAX_DRAG_TILT_L2){i.setTilt(h4.MAX_DRAG_TILT_L2,{callback:function(){i._changeEarthMapType(e)}})}else{i._changeEarthMapType(e)}},_changeEarthMapType:function(T){var kz=this;var kC=kz.tileMgr.tileLayers;if(this._mapTypeChangAni){this._mapTypeChangAni.stop()}var kB;if(this._earth){kB=this._earth.getEarthCanvas()}if(!this._earth){this.maskLayer.style.opacity=1;this.maskLayer.style.zIndex=999;this.maskLayer.style.background="#000"}this._mapTypeChangAni=new fL({duration:400,render:function(e){if(!kz._earth){return}kB.style.opacity=e},finish:function(){for(var e=kC.length-1,kD=e;kD>=0;kD--){var kF=kC[kD].tilesDiv;if(kF){kF.style.visibility="hidden"}if(kC[kD]._isInnerLayer&&kz._renderType!=="webgl"){kz.removeTileLayer(kC[kD])}}kz._mapTypeChangAni=null;kz._mapTypeChanging=false;function kE(){var kJ=kz.getZoom()-2;var kK=kz.getCenterIn();var kH=jv.convertMC2LL(kK);kz._earth=new bG.Earth(kz,{center:kH,zoom:kJ,showRealSunlight:kz.config.showRealSunlight,showMilkyway:kz.config.showMilkyway,earthBackground:kz.config.earthBackground});if(kz.config&&kz.config.earthMaxZoom&&kz._earth){kz._earth.setMaxZoom(kz.config.earthMaxZoom)}if(kz.config&&kz.config.earthMinZoom&&kz._earth){kz._earth.setMinZoom(kz.config.earthMinZoom)}kz._proxyEarthEvents();var kG=kz.mapType;kz.mapType=T;var kI=new fW("onmaptypechange");kI.zoomLevel=this.zoomLevel;kI.mapType=T;kI.exMapType=kG;kz.dispatchEvent(kI);kz._setMapTypeStatus(T);e9.extend(kz,bG.EarthView.prototype);if(!kz._navigationCtrl&&kz.config.showControls){kz._navigationCtrl=new fb(kz)}}if(!kz._earth){if(bG["FeatureStyle"+kz.config.style]){kE()}else{kz.loadMapStyleFiles(function(){kE()})}}if(parseInt(kz.maskLayer.style.opacity,10)===1){setTimeout(function(){kz.maskLayer.style.zIndex=9;kz.maskLayer.style.opacity=0},1000)}}});if(!this._earth){return}var i=this.mapType;this.mapType=T;var kA=new fW("onmaptypechange");kA.zoomLevel=this.zoomLevel;kA.mapType=T;kA.exMapType=i;this.dispatchEvent(kA);kz._setMapTypeStatus(T);e9.extend(kz,bG.EarthView.prototype)},getMapStyleId:function(){if(typeof this.config.style==="string"){return this.config.style}return this.config.mapStyleId||"custom"},getAreaStyleId:function(){return this.config.areaStyleId||"areaStyle"},_printLog:function(e){var i;switch(e){case"mapvgl":i=249;break;case"mapvthree":i=248;break;case"bmapdraw":i=247;break;default:break}if(i){hP.sendMessage(a1(4,i),[e])}},_setMapTypeStatus:function(T){var kD=arguments[1];if(T===BMAP_EARTH_MAP){var kB=this._earth.getEarthCanvas();if(kB){kB.style.display=""}var kE={noAnimation:true};if(this.earthMinZoom){this._earth.setMinZoom(this.earthMinZoom);this.earthMinZoom=undefined}if(this.earthMaxZoom){this._earth.setMaxZoom(this.earthMaxZoom);this.earthMaxZoom=undefined}this._earth.setCenter(jv.convertMC2LL(this.centerPoint),kE);this._earth.setImageZoom(this.zoomLevel,kE);this._earth.setTilt(this.getTilt(),kE);this._earth.setHeading(this.getHeading(),kE)}else{if(this.preMapType===BMAP_EARTH_MAP&&this._earth){var kC=this._earth;var kz=kC.getMapZoom();var kA=kC._imageRawZoom||kz;var i=kA-kz;var e=kC.getCenter();if(this._renderType==="webgl"){this._tilt=kC.getTilt();if(this.zoomLevel>7){this._heading=kC.getHeading();kD&&kD(e,kz);return}if(kC.getHeading()!==0){kC.setTilt(this.getTilt());kC.setHeading(this.getHeading(),{callback:function(){kD&&kD(e,kz)}})}else{kD&&kD(e,kz)}return}if(i<0.1&&kC.getTilt()===0&&kC.getHeading()===0){kD&&kD(e,kz);return}kC.setTilt(0);kC.setHeading(0);kC.setZoom(kC.getZoom()-i,{callback:function(){kD&&kD(e,kz)}})}}},_proxyEarthEvents:function(){var kA=this;var kB=this._earth;kB.on("tilesload",function(i){kA.fire(i)});kB.on("centerandzoom",function(i){kA.dispatchEvent(new fW("onmoveend"));kA.dispatchEvent(new fW("onzoomend"))});function kz(i){kA.fire(i)}var e=["zoomstart","zoomend","tilesload","sunlighttime_change","sunlighttime_clear","centerandzoom","animation_start","animation_stop","movestart","moveend","moving","dragstart","dragend","dragging"];for(var T=0;T<e.length;T++){kB.on(e[T],kz)}},forceEnableEarth:function(){this.config.forceEnableEarth=true;this.config.enableEarth=df.ifEnableEarth(true);this.dispatchEvent(new fW("forceenableearth"));return this.config.enableEarth},setLock:function(e){if(this.mapType===BMAP_EARTH_MAP){this._earth.setLock(e)}this._lock=e},getLock:function(){if(this.mapType===BMAP_EARTH_MAP){return this._earth.getLock()}return this._lock},getEarth:function(){return this._earth},isSupportEarth:function(){return this.config.enableEarth},isCanvasMap:function(){return !!(this._renderType==="canvas"&&this.getMapType()!=="B_EARTH_MAP")},getCanvasMapCoordByUid:function(kA){if(this._renderType==="webgl"){var kB=this.tileMgr.tileLayers;for(var kz=0;kz<kB.length;kz++){if(kB[kz].labelProcessor){return kB[kz].labelProcessor.getLabelByUid(kA,"")}}return null}var e=this.canvas2dMapMgr._labelClick;var T=e.findLabelByUid(kA);return T?new cG(T.iconPos.geoX,T.iconPos.geoY):null},loadBizData:function(i){var e=new fW("onloadbizdata");e.data=i;this.dispatchEvent(e)},unloadBizData:function(){var e=new fW("onunloadbizdata");this.dispatchEvent(e)},zoomIn:function(e){this.setZoomIn(this.zoomLevel+1,{zoomCenter:e})},zoomOut:function(e){this.setZoomIn(this.zoomLevel-1,{zoomCenter:e})},setMaxZoom:function(e){if(this._renderType==="webgl"){this.config.maxZoom=e<=25?e:25}else{this.config.maxZoom=e<=19?e:19}},setEarthMaxZoom:function(i){var e=i<=this.getMaxZoom()-2?i:this.getMaxZoom()-2;if(this.mapType==="B_EARTH_MAP"){this._earth.setMaxZoom(e);this.earthMaxZoom=undefined;return}this.earthMaxZoom=e},setMinZoom:function(e){this.config.minZoom=e>=3?e:3},setEarthMinZoom:function(e){var i=e-2>=1?e-2:1;if(this.mapType==="B_EARTH_MAP"){this._earth.setMinZoom(i);this.earthMinZoom=undefined;return}this.earthMinZoom=i},setCenterIn:function(e,i){i=i?i:{};i.tilt=i.tilt?i.tilt:this.getTilt();i.heading=i.heading?i.heading:this.getHeading();this.panToIn(e,i)},getRenderType:function(){return this._renderType},getSolarInfo:function(kz){kz=kz||this._initDate;var T=fI(kz);var e=jv.convertLL2MC(new cG(T[0],T[1]));var kH=e.latLng;var kC=bG.Projection.convertMC2LL(this.centerPoint);var kE=kz.getUTCHours();var kG=kE+24*kC.lng/360;var kF=kG-12;var kD=kF*60*0.25;var kB=Math.asin(Math.sin(iW(kC.lat))*Math.sin(iW(kH.lat))+Math.cos(iW(kC.lat))*Math.cos(iW(kH.lat))*Math.cos(iW(kD)));var kA=Math.asin(Math.sin(iW(kD))*Math.cos(iW(kH.lat))/Math.cos(kB));var i="north";if(kC.lat<kH.lat){i="south"}return{zenith:e,solarAltitude:kB,solarAzimuth:kA,centerPosition:i,position:e}},setDisplayOptions:function(T){if(!T){return}for(var e in this._displayOptions){if(this._displayOptions.hasOwnProperty(e)){if(typeof T[e]==="boolean"||(e==="skyColors"&&typeof T.skyColors==="object")||(e==="labelMargin"&&typeof T.labelMargin==="number")){this._displayOptions[e]=T[e]}}}var i=this.getMapType();if(i===fD.NORMAL){this.fire(new fW("ondisplayoptions_changed"))}else{if(i===fD.EARTH&&this._earth){this._earth.fire(new fW("ondisplayoptions_changed"))}}},getHorizonPosY:function(e){if(!e||!this._webglMapCamera){return null}var i=this._webglMapCamera.fromMCToScreenPixel(e.lng,e.lat,{heading:0});return i.y},getIndoorInfo:function(){if(!this._indoorMgr){return}return this._indoorMgr.getData()},showIndoor:function(e,T){if(this.map&&this.map.parking){this.map.parking.currentUid=e;this.map.parking.currentFloor=T}var i=new fW("onindoor_status_changed");i.uid=e;i.floor=T;this.fire(i)},addAreaSpot:function(e,T){if(!e||e.length===0){return}T=T||{};this.areaSpots=this.areaSpots||{};var i=T.id||("sp"+(this.temp.spotsGuid++));this.areaSpots[i]={spot:e,userData:T.userData};var kz=this;hl.load("hotspot",function(){kz._asyncRegister()});return i},getAreaSpot:function(e){if(this.areaSpots&&this.areaSpots[e]){return this.areaSpots[e]}return null},removeAreaSpot:function(e){if(!e||!this.areaSpots[e]){return}delete this.areaSpots[e]},clearAreaSpots:function(){this.areaSpots={}},resetSpotStatus:function(){this.fire(new fW("onspot_status_reset"))},hightlightSpotByUid:function(e,T){var i=new fW("onspot_highlight");i.uid=e;i.tilePosStr=T;this.fire(i)},setZoomIn:function(i,e){e=e||{};this.zoomTo(i,e.zoomCenter||null,e)},restrictBounds:function(e){if(e instanceof ij){this.config.restrictBounds=e;this.restrictCenter(this.getCenterIn());this.fire(new fW("oncenter_changed"))}},getCurrentMaxTilt:function(){var e=this.zoomLevel;if(this.mapType==="B_EARTH_MAP"){return h4.MAX_DRAG_TILT_L2}if(this.config.restrictCenter===false){return h4.MAX_DRAG_TILT}if(e>=19){return h4.MAX_DRAG_TILT}else{if(e<=18){if(e<this._enableTiltZoom){if(e>=this._enableTiltZoom-2){return(1-(this._enableTiltZoom-e)/2)*h4.MAX_DRAG_TILT_L2}return 0}return h4.MAX_DRAG_TILT_L2}else{return(h4.MAX_DRAG_TILT-h4.MAX_DRAG_TILT_L2)*(e-18)+h4.MAX_DRAG_TILT_L2}}},worldSize:function(i){var e=i||this.zoomLevel;return h4.WORLD_SIZE_MC/this.getZoomUnits(e)},setTrafficOn:function(e){if(e&&Number(e)>1){j0.setZIndex(Number(e))}hP.sendMessage(a1(4,3,3),["layer","traffic"]);this.addTileLayer(j0)},setTrafficOff:function(){this.removeTileLayer(j0)},showOverlayContainer:function(){this.setDisplayOptions({overlay:true})},hideOverlayContainer:function(){this.setDisplayOptions({overlay:false})},addLabelsToMapTile:function(kC,kB){hP.sendMessage(a1(4,1,4),["instance","custom_label"]);for(var kz=0;kz<kC.length;kz++){if(typeof kC[kz].type==="undefined"){kC[kz].type="fixed"}if(typeof kC[kz].rank!=="number"){kC[kz].rank=50000}kC[kz].pt=kC[kz].position;kC[kz].custom=true;kC[kz].processedInZoom=0;var T=false;for(var e=0;e<this._customTileLabels.length;e++){if(this._customTileLabels[e].uid===kC[kz].uid){T=true;break}}if(!T){this._customTileLabels.push(kC[kz])}}var kA=new fW("onadd_tile_labels");if(kB&&kB instanceof ek){kA.data=kC;kA.index=kB.layer.drawIndex;kA.model="mvt"}this.dispatchEvent(kA)},removeLabelsFromMapTile:function(kA,kz,T){var kC=new fW("onremove_tile_labels");if(kz&&T){kC.data=kA;kC.index=kz;kC.model=T}else{for(var kB=0;kB<kA.length;kB++){for(var e=0;e<this._customTileLabels.length;e++){if(this._customTileLabels[e].uid===kA[kB]){this._customTileLabels.splice(e,1);break}}}}this.dispatchEvent(kC)},clearLabels:function(T,i){var e=new fW("onclear_labels");if(T&&i){e.data=[];e.index=T;e.model=i}else{this._customTileLabels.length=0}this.dispatchEvent(e)},loadMapStyleFiles:function(kB,e){this.customLoaded=false;var T=this.config.style;var kA=this.config.styleUrl;var kz=this;this._setTextRenderType();if(typeof T==="string"&&!kA){if(bG["FeatureStyle"+T]){this.customLoaded=true;kz.fire(new fW("onstyle_loaded"));kB();return}bG["FeatureStyle"+T]=window.FeatureStyle;bG["iconSetInfo"+T]=window.iconSetInfo_high;bG.indoorStyle=window.indoorStyle;g3.load(E.getMapStyleFiles(T),function(){if(kz.config.style===T){bG["FeatureStyle"+T]=window.FeatureStyle;bG["iconSetInfo"+T]=window.iconSetInfo_high;bG.indoorStyle=window.indoorStyle;kz.customLoaded=true;kz.fire(new fW("onstyle_loaded"));kB()}})}else{hP.sendMessage(a1(4,1,2),["instance","custom_style"]);var i=T;w.init(kz);w.getStyleJson(i,function(kD){var kJ=window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]?"":eZ;var kL=bG.getGUID("custom");var kI=kz.config.mapStyleId||0;delete bG["customStyleInfo_"+kI];delete bG["FeatureStyle"+kI];kz.config.mapStyleId=kL;var kG={};e9.extend(kG,kD);var kE=Math.floor(kz.getZoom());var kH;window["styleCbk_"+kL]=function(kM,kN){if(kN!==kH||!bG["customStyleInfo_"+kL]){return}if(typeof kM==="string"){kM=JSON.parse(kM)}w.onStyleDataBack(kM,kE,kL,kG,kJ,bG["customStyleInfo_"+kL]);kz.customLoaded=true;kz.fire(new fW("onstyle_loaded"));kB()};bG["customStyleInfo_"+kL]={zoomRegion:{},zoomStyleBody:[],zoomFrontStyle:{}};var kK=w.getStyleUrl(kD,kJ,"styleCbk_"+kL,kE,e,bG["customStyleInfo_"+kL]);var kC=kK.split("?")[0];kH=kK.split("?")[1];if(kA){kC=kA;kH=kC.split("?")[1]}if(!bG.iconSetInfoCustom){var kF=E.getMapStyleFiles("default");if(kz.config.showCustomIndoor){kF.splice(1,1)}else{kF.splice(1,2)}g3.load(kF,function(){bG.iconSetInfoCustom=window.iconSetInfo_high;bG.indoorStyle=window.indoorStyle;if(kC.indexOf("jsonp")>"-1"){g3.load(kC)}else{if(bG["customStyleInfo_"+kL]){bG["customStyleInfo_"+kL].xhr=ir.post(kC,kH,window["styleCbk_"+kL],function(){kz.fire(new fW("onstyle_loaded_error"))},function(){kz.fire(new fW("onstyle_loaded_timeout"))})}}})}else{if(kC.indexOf("jsonp")>"-1"){g3.load(kC)}else{if(bG["customStyleInfo_"+kL]){bG["customStyleInfo_"+kL].xhr=ir.post(kC,kH,window["styleCbk_"+kL],function(){kz.fire(new fW("onstyle_loaded_error"))},function(){kz.fire(new fW("onstyle_loaded_timeout"))})}}}})}},getFeatureStyleTags:function(){var e=[];var kA=Object.keys(bG);for(var kz=0;kz<kA.length;kz++){var T=kA[kz];if(T.indexOf("FeatureStyle")>-1&&bG[T]){e.push(T)}}return e},setCopyrightOffset:function(kz,i){var T=new fW("oncopyrightoffsetchange",{logo:kz,cpy:i});this.dispatchEvent(T)},_setTextRenderType:function(e){if(e){this.config.textRenderType=e;return}if(this.config.textRenderType!==null){return}if(b5()){this.config.textRenderType="canvas"}else{if(typeof this.config.style==="string"){this.config.textRenderType="image"}else{this.config.textRenderType="canvas"}}},destroy:function(){this._destroyed=true;this.disableAutoResize();this.fire(new fW("ondestroy"));var e=this.config.mapStyleId||0;delete bG["customStyleInfo_"+e];delete bG["FeatureStyle"+e];bG.BMAP_INSTANCES&&(bG.BMAP_INSTANCES-=1);if(!bG.BMAP_INSTANCES){this.destroyStyle()}this.config={};this.clearSpots();this._webGLStateId&&d5.WebGLState.remove(this._webGLStateId);this.container.onselectstart=null;this.container.style.backgroundImage="";this.maskLayer=null;this.platform=null;hP.kill();je.kill();var i=this;setTimeout(function(){i._listeners=null;i._bounds=null;i.tileLabels=[];i._overlayMgrGL=null;i._overlayMgr=null;i._mapIcon=null;if(i._mouse){i._mouse._drag=null;i._mouse=null}i.deepZoom=null;i.tileMgr=null;i.indexToRgb=null;i.toFormatCoords=null;i._webglMapCamera=null;i._normalLayerMgr=null;i._webglPainter=null;i._webglMapScene=null;i._indoorMgr=null;if(i._renderType==="webgl"){i._spotsMgr=null;i._workerMgr=null;i.jobScheduler=null;i.benchmark=null;i._featureMgr=null;i._labelProcessor=null;i._customLabelMgr=null}if(i.cpyCtrl){i.cpyCtrl._map=null;i.cpyCtrl=null}i.logoCtrl=null;i._spotDataOnCanvas=null;i._navigationCtrl=null;i.container.innerHTML="";if(!bG.BMAP_INSTANCES){window.FeatureStyle=null;window.iconSetInfo_high=null;window.indoorStyle=null;window._indoorMgr=null}},600)},destroyStyle:function(){var e=[];var kA=Object.keys(bG);for(var kz=0;kz<kA.length;kz++){var T=kA[kz];if(T.indexOf("FeatureStyle")>-1||T.indexOf("iconSetInfo")>-1||T.indexOf("indoorStyle")>-1){e.push(T)}}for(var kz=0;kz<e.length;kz++){delete bG[e[kz]]}},centerAndZoom:function(e,kD,T){if(Object.prototype.toString.call(kD)!=="[object Undefined]"){kD=parseInt(kD,10)}if(typeof e==="string"){var kA=this;var kC=new bo();var kz=new cG(120.139406,30.259097);kC.getPoint(e,function(kE){if(kE&&kE.lng&&kE.lat){e=kE;var kF=jv.convertLL2MC(e);kA.centerAndZoomIn(kF,kD,T)}else{var kF=jv.convertLL2MC(kz);kA.centerAndZoomIn(kF,kD,T);console.error("您好，城市名初始化地图使用地址解析服务，请检查该服务是否已超配额。")}},e)}else{if(this.config.coordType===BMAP_COORD_GCJ02){var kB=iP(e,3);var i=jv.convertLL2MC(kB)}else{var i=jv.convertLL2MC(e)}this.centerAndZoomIn(i,kD,T)}},pointToPixel:function(e,T){var i=jv.convertLL2MC(e);var kz={};e9.extend(kz,T);if(kz&&kz.center){kz.center=jv.convertLL2MC(kz.center)}return this.pointToPixelIn(i,kz)},pixelToPoint:function(T,i){var kz={};e9.extend(kz,i);if(kz&&kz.center){kz.center=jv.convertLL2MC(kz.center)}var e=this.pixelToPointIn(T,kz);return jv.convertMC2LL(e)},pointToOverlayPixel:function(e,T){var i=jv.convertLL2MC(e);var kz={};e9.extend(kz,T);if(kz&&kz.center){kz.center=jv.convertLL2MC(kz.center)}return this.pointToOverlayPixelIn(i,kz)},overlayPixelToPoint:function(T,i){var kz={};e9.extend(kz,i);if(kz&&kz.center){kz.center=jv.convertLL2MC(kz.center)}var e=this.overlayPixelToPointIn(T,kz);return jv.convertMC2LL(e)},setViewport:function(T,kz){var e;if(T&&T.center){e={};e9.extend(e,T);e.center=jv.convertLL2MC(e.center)}else{e=[];for(var kA=0;kA<T.length;kA++){e[kA]=jv.convertLL2MC(T[kA])}}this.setViewportIn(e,kz)},getViewport:function(kB,kz){var T;if(kB&&kB.length){T=[];for(var kA=0;kA<kB.length;kA++){T[kA]=jv.convertLL2MC(kB[kA])}}else{if(kB instanceof ij){T=new ij(jv.convertLL2MC(kB.getSouthWest()),jv.convertLL2MC(kB.getNorthEast()));T.setMinMax()}}var e=this.getViewportIn(T,kz);e.center=jv.convertMC2LL(e.center);return e},getDistance:function(kA,T){var i=jv.convertLL2MC(kA);var kz=jv.convertLL2MC(T);var e=this.getDistanceIn(i,kz);return e},setCenter:function(e,T){if(typeof e==="string"){var kz=this;var kB=new bo();kB.getPoint(e,function(kC){if(kC){e=kC}else{e=kz.defaultPoint;console.error("您好，城市名初始化地图使用地址解析服务，请检查该服务是否已超配额。")}var kD=jv.convertLL2MC(e);kz.setCenterIn(kD,T)},e)}else{if(this.config.coordType===BMAP_COORD_GCJ02){var kA=iP(e,3);var i=jv.convertLL2MC(kA)}else{var i=jv.convertLL2MC(e)}this.setCenterIn(i,T)}},setZoom:function(T,e){var i={};e9.extend(i,e);if(i&&i.zoomCenter){i.zoomCenter=jv.convertLL2MC(i.zoomCenter)}this.setZoomIn(T,i)},flyTo:function(e,kA,T){if(this.config.coordType===BMAP_COORD_GCJ02){var kz=iP(e,3);var i=jv.convertLL2MC(kz)}else{var i=jv.convertLL2MC(e)}this.flyToIn(i,kA,T)},panTo:function(e,T){var i=jv.convertLL2MC(e);this.panToIn(i,T)},getCenter:function(){var e=this.getCenterIn();if(this.config.coordType===BMAP_COORD_GCJ02){var i=jv.convertMC2LL(e);return eS(i)}return jv.convertMC2LL(e)},getBounds:function(){var e=this.getBoundsIn();var i=new ij(jv.convertMC2LL(e.getSouthWest()),jv.convertMC2LL(e.getNorthEast()));return i},setMapStyleV2:function(e){if(typeof e==="string"){this._setTextRenderType("image")}else{this._setTextRenderType("canvas")}this.setOptions({style:e})},startViewAnimation:function(T){var e=T._options.delay;var i=this;setTimeout(function(){T._start(i)},e)},pauseViewAnimation:function(e){e._pause(this)},continueViewAnimation:function(e){e._continue(this)},cancelViewAnimation:function(e){e._cancel(this)},getMapScreenshot:function(){return this._webglMapScene._painter._canvas.toDataURL()},setCustomArea:function(i){this.fire(new fW("onstyle_willchange"));this.areaCustomLoaded=false;var T=i.style;var kz=this;w.getStyleJson(T,function(kB){var kG=window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]?"":eZ;var kI=bG.getGUID("customArea");kz.config.areaStyleId=kI;var kE={};e9.extend(kE,kB);var kC=Math.floor(kz.getZoom());var kF;window["styleCbk_"+kI]=function(kK,kL){if(kL!==kF||!bG["customStyleInfo_"+kI]){return}if(typeof kK==="string"){kK=JSON.parse(kK)}w.onStyleDataBack(kK,kC,kI,kE,kG,bG["customStyleInfo_"+kI]);kz.areaCustomLoaded=true;kz.fire(new fW("onstyle_loaded"));var kJ=new fW("onlayer_update");kJ.name="na";kz.fire(kJ)};bG["customStyleInfo_"+kI]={zoomRegion:{},zoomStyleBody:[],zoomFrontStyle:{}};var kH=w.getStyleUrl(kB,kG,"styleCbk_"+kI,kC,"",bG["customStyleInfo_"+kI]);var kA=kH.split("?")[0];kF=kH.split("?")[1];var kD=E.getMapStyleFiles("default");if(kA.indexOf("jsonp")>"-1"){g3.load(kA)}else{bG["customStyleInfo_"+kI].xhr=ir.post(kA,kF,window["styleCbk_"+kI])}});var e={};if(i.area){e.area=i.area.map(function(kA){return jv.convertLL2MC(kA)})}e.customArea=true;this._workerMgr.setWorkerConfig(e)}});window.BMAP_NORMAL_MAP="B_NORMAL_MAP";window.BMAPGL_NORMAL_MAP="B_NORMAL_MAP";window.BMAP_SATELLITE_MAP="B_SATELLITE_MAP";window.BMAP_HYBRID_MAP="B_STREET_MAP";window.BMAP_EARTH_MAP="B_EARTH_MAP";window.BMAP_NONE_MAP="B_NONE_MAP";window.BMAP_COORD_MERCATOR=1;window.BMAP_COORD_GCJ02=2;window.BMAP_SYS_DRAWER=0;window.BMAP_SVG_DRAWER=1;window.BMAP_VML_DRAWER=2;window.BMAP_CANVAS_DRAWER=3;var w={environment:"jsapi",map:null,ontilesloaded:false,onstyle_loaded:false,init:function(i){var e=this;e.map=i;this.changeCopyright();this.setEnvironment(e.map.config.style);this.resetEventListener()},resetEventListener:function(){var e=this;this.ontilesloaded=false;this.onstyle_loaded=false;e.map.addEventListener("ontilesloaded",e.checkLoadedStatus);e.map.addEventListener("onstyle_loaded",e.checkLoadedStatus)},checkLoadedStatus:function(i){w[i.type]=true;if(w.ontilesloaded&&w.onstyle_loaded){this.dispatchEvent(new fW("onstylechangetilesloaded"));this.removeEventListener("ontilesloaded",w.checkLoadedStatus);this.removeEventListener("onstyle_loaded",w.checkLoadedStatus)}},changeCopyright:function(){var e=this;if(e.map.cpyCtrl){e.map.cpyCtrl.hide();if(e.environment!=="customEditor"){e.map.setCopyrightOffset(new jm(1,1))}}else{e.map.addEventListener("oncopyrightaddend",function(){e.map.cpyCtrl.hide();if(e.environment!=="customEditor"){e.map.setCopyrightOffset(new jm(1,1))}})}},setEnvironment:function(e){if(e.customEditor){this.environment="customEditor";a2.map=this.map}else{if(e.sharing){this.environment="sharing"}else{if(e.preview){this.environment="preview"}else{this.environment="jsapi"}}}},getStyleJson:function(kz,kB){var kA=this;if(kz.styleJson){kB&&kB(kz.styleJson)}else{if(kz.styleId){var i=kz.styleId;var e=(Math.random()*100000).toFixed(0);bG["_cbk_si_phpui"+e]=function(kD){var kC=[];if(kD.result&&kD.result["error"]===0&&kD.content&&kD.content["status"]===0){kC=kA.parseJson(kD.content["data"]["json"]);kB&&kB(kC)}else{kB&&kB("default")}};bG["_cbk_si_api"+e]=function(kD){var kC=[];if(kD.status===0){if(kD.info){kC=kA.parseJson(kD.info["json"])}else{kC=kA.parseJson(kD.data["json"])}kB&&kB(kC)}else{kB&&kB("default")}};var T="";switch(this.environment){case"jsapi":if(window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]){T=window._BMapSecurityConfig["serviceHost"]+"?qt=custom_map&v=3.0&style_id="+i+"&type=publish"}else{T=eG.apiHost+"/?qt=custom_map&v=3.0&style_id="+i+"&type=publish&ak="+eZ}T+="&callback="+fF+"._cbk_si_phpui"+e;break;case"sharing":T+="/apiconsole/custommap/getSharingJson";T+="?styleid="+i+"&type=edit";T+="&ck="+fF+"._cbk_si_api"+e;break;case"preview":T+="/apiconsole/custommap/getJson";T+="?styleid="+i+"&type=edit";T+="&ck="+fF+"._cbk_si_api"+e;break}g3.load(T)}else{kB&&kB("default")}}},parseJson:function(T){if(T===null||T===""){return[]}var i={t:"featureType",e:"elementType",v:"visibility",c:"color",o:"opacity",l:"lightness",s:"saturation",w:"weight",z:"level",h:"hue",f:"fontsize",zri:"curZoomRegionId",zr:"curZoomRegion",i:"image"};var kA={all:"all",g:"geometry","g.f":"geometry.fill","g.s":"geometry.stroke",l:"labels","l.t.f":"labels.text.fill","l.t.s":"labels.text.stroke","l.t":"labels.text","l.i":"labels.icon","g.tf":"geometry.topfill","g.sf":"geometry.sidefill",t:"texture"};var kz=T.split(",");var e=kz.map(function(kE){var kD=kE.split("|").map(function(kK){var kI=i[kK.split(":")[0]];var kH=kA[kK.split(":")[1]]?kA[kK.split(":")[1]]:kK.slice(kK.indexOf(":")+1,kK.length);switch(kH){case"poi":kH="poilabel";break;case"districtlabel":kH="districtlabel";break}var kJ={};kJ[kI]=kH;return kJ});var kB=kD[0];var kG=1;if(kD[1]["elementType"]){kG=2;e9.extend(kB,kD[1])}var kF={};for(var kC=kG;kC<kD.length;kC++){e9.extend(kF,kD[kC])}return e9.extend(kB,{stylers:kF})});return e},getStyleUrl:function(i,kC,kA,T,kz,kE){this.styleJson=i;if(window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]){var e=window._BMapSecurityConfig["serviceHost"]+"custom/v2/mapstyle?version="+4+"&qt=custom_v2&is_all=true&is_new=1&"}else{var e=E.apiHost+"/custom/v2/mapstyle?version="+4+"&ak="+kC+"&qt=custom_v2&is_all=true&is_new=1&"}var kD=this.styleJson2styleStringV2(i,T,kE);e+="styles="+encodeURIComponent(kD);if(kz&&kz.os&&kz.sv){e+="&os="+kz.os+"&sv="+kz.sv}var kB=new Date()["getTime"]();e+="&timeStamp="+kB;e+=jI()(e);return e},styleJson2styleStringV2:function(e,kH,kD){var kI={featureType:"t",elementType:"e",visibility:"v",color:"c",opacity:"o",lightness:"l",saturation:"s",weight:"w",level:"z",hue:"h",fontsize:"f",image:"i"};var kJ={all:"all",geometry:"g","geometry.fill":"g.f","geometry.stroke":"g.s",labels:"l","labels.text.fill":"l.t.f","labels.text.stroke":"l.t.s","labels.text":"l.t","labels.icon":"l.i","geometry.topfill":"g.tf","geometry.sidefill":"g.sf",texture:"t"};var kK=[];for(var kz=this.map.getMinZoom();kz<=this.map.getMaxZoom();kz++){kD.zoomFrontStyle[kz]={}}kD.zoomFrontStyle.main={};var T=false;for(var kz=0;!!e[kz];kz++){var kG=e[kz];if(this.isOnlyZoomStyler(kG)){continue}kH=this.getFrontZoom(kG,kH);if((kG.featureType==="land"||kG.featureType==="all"||kG.featureType==="background")&&typeof kG.elementType==="string"&&(kG.elementType==="geometry"||kG.elementType==="texture"||kG.elementType==="geometry.fill"||kG.elementType==="all")&&kG.stylers&&!T){if(kG.stylers["color"]){kD.bmapLandColor=kG.stylers["color"]}if(kG.stylers["image"]){kD.bmapLandFillTexture=kG.stylers["image"]}if(kG.stylers["opacity"]){kD.bmapLandColor=kG.stylers["opacity"]}if(kG.stylers["visibility"]&&kG.stylers["visibility"]==="off"){kD.bmapLandColor="#00000000"}if(kG.featureType==="land"){T=true}}if(kG.featureType==="building"&&typeof kG.elementType==="string"&&kG.elementType==="geometry.fill"){kD.buildingFill=true}if(kG.featureType==="roadarrow"&&kG.elementType==="labels.icon"&&kG.stylers){var kE=kG.stylers["visibility"];kD.zoomFrontStyle[kH]["bmapRoadarrowVisibility"]=kE}var kA={};e9.extend(kA,kG);var kC=kA.stylers;delete kA.stylers;e9.extend(kA,kC);var kB=[];for(var kF in kI){if(kA[kF]){if(this.isEditorZoomKeys(kF)){continue}if(kF==="elementType"){kB.push(kI[kF]+":"+kJ[kA[kF]])}else{if(kF==="image"){kB.push(kI[kF]+":"+encodeURIComponent(encodeURIComponent(kA[kF])))}else{switch(kA[kF]){case"poilabel":kA[kF]="poi";break;case"districtlabel":kA[kF]="label";break}kB.push(kI[kF]+":"+kA[kF])}}}}if(kB.length>2){kK.push(kB.join("|"))}}return kK.join(",")},getFrontZoom:function(i,e){var T=i.stylers["level"];if(T===undefined){return"main"}else{return parseInt(T,10)}},isZoomConfig:function(e){var i=e.stylers["level"];if(i===undefined){return false}else{return true}},isOnlyZoomStyler:function(e){var i={};e9.extend(i,e.stylers);delete i.curZoomRegionId;delete i.curZoomRegion;delete i.level;if(e9.isEmptyObject(i)){return true}else{return false}},isSelectZoom:function(i,e){var T=i.stylers["level"];if(T===undefined){return true}else{if(T===e+""){return true}else{return false}}},isEditorZoomKeys:function(e){var i={curZoomRegionId:true,curZoomRegion:true};if(i[e]){return true}else{return false}},getZoomRegion:function(e,i){var kz=e.stylers["level"];var T={};e9.extend(T,i);if(kz===undefined){return T}else{T[parseInt(kz,10)]=true;return T}},onStyleDataBack:function(kA,e,i,kz,kC,T){if(kA.status!==0){return}if(kA.data.style.length===3){if(!T.baseFs){T.baseFs=kA.data.style}bG.StyleBody=kA.data.style[2]}else{bG.StyleBody=kA.data.style}var kB=T.baseFs;bG["FeatureStyle"+i]=kB;this.updateFrontFeatureStyle(T)},updateFrontFeatureStyle:function(T){if(T.zoomFrontStyle.main["bmapRoadarrowVisibility"]){for(var e=this.map.getMinZoom();e<=this.map.getMaxZoom();e++){if(!T.zoomFrontStyle[e]["bmapRoadarrowVisibility"]){T.zoomFrontStyle[e]["bmapRoadarrowVisibility"]=T.zoomFrontStyle.main["bmapRoadarrowVisibility"]}}}}};var a2={map:null,labelCache:{},calcDrawMc:function(T,i,e){var kz=[];switch(i){case"fill":kz=this.calcFill(T,e);break;case"line":break;case"building3d":kz=this.calcBuilding3d(T,e);break}return kz},calcFill:function(kA,T){var kB=[];for(var kz=0;kz<kA.length;kz=kz+5){var e=this.coordToMc({x:kA[kz],y:kA[kz+1]},T.row,T.col,T.mercatorSize,T.baseTileSize);kB.push(e[0],e[1])}return kB},calcLine:function(kA,T){var kB=[];var kC=new Int16Array(kA.buffer);for(var kz=0;kz<kC.length;kz=kz+10){var e=this.coordToMc({x:kC[kz]/10,y:kC[kz+1]/10},T.row,T.col,T.mercatorSize,T.baseTileSize);kB.push(e[0],e[1])}return kB},calcBuilding3d:function(kB,T){var kC=[];var kz={};for(var kA=0;kA<kB.length/2;kA=kA+7){if(kB[kA]===kB[kA-7]&&kB[kA+1]===kB[kA-6]){continue}if(kz[kB[kA].toString()+kB[kA+1].toString()]){continue}kz[kB[kA].toString()+kB[kA+1].toString()]=true;var e=this.coordToMc({x:kB[kA],y:kB[kA+1]},T.row,T.col,T.mercatorSize,T.baseTileSize);kC.push(e[0],e[1])}return kC},coordToMc:function(kA,kz,e,i,T){return[kA.x*(i/T)+e*i,kA.y*(i/T)+kz*i]},addDrawIntoAreaSpots:function(e,kA){if(w.environment!=="customEditor"){return}if(!kA.styleIds){return}for(var T=0;T<kA.styleIds.length;T++){var kD=0;if(T>0){kD=kA.verticesLength[T-1]}end=kA.verticesLength[T];var kB=[];var kz="";if(kA.vertex){kB=kA.vertex;kz="building3d"}else{if(kA.data[0]){kB=kA.data[0];kz=kA.type}else{continue}}var kC=this.calcDrawMc(kB.slice(kD,end),kz,e);this.map.addAreaSpot(kC,{userData:{styleId:kA.styleIds[T],type:"mapstyle"}})}},addLabelIntoAreaSpots:function(e){if(w.environment!=="customEditor"){return}for(var kA=0;kA<e.length;kA++){var kB=e[kA];for(var kz=0;kz<kB.fixedLabel.length;kz++){var T=kB.fixedLabel[kz];if(!T._mcBds){continue}var kC=[T._mcBds[0].lng,T._mcBds[0].lat,T._mcBds[0].lng,T._mcBds[1].lat,T._mcBds[1].lng,T._mcBds[1].lat,T._mcBds[1].lng,T._mcBds[0].lat];if(!this.labelCache[kC.join()]){this.labelCache[kC.join()]=true;this.map.addAreaSpot(kC,{userData:{styleId:T.styleId,type:"mapstyle",name:T.name}})}}}}};function cu(i,e,kz,T){this.cx=3*i;this.bx=3*(kz-i)-this.cx;this.ax=1-this.cx-this.bx;this.cy=3*e;this.by=3*(T-e)-this.cy;this.ay=1-this.cy-this.by;this.p1x=i;this.p1y=T;this.p2x=kz;this.p2y=T}cu.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e};cu.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e};cu.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx};cu.prototype.solveCurveX=function(e,kE){if(typeof kE==="undefined"){kE=0.000001}var kD;var kC;var kA;var T;var kz;for(kA=e,kz=0;kz<8;kz++){T=this.sampleCurveX(kA)-e;if(Math.abs(T)<kE){return kA}var kB=this.sampleCurveDerivativeX(kA);if(Math.abs(kB)<0.000001){break}kA=kA-T/kB}kD=0;kC=1;kA=e;if(kA<kD){return kD}if(kA>kC){return kC}while(kD<kC){T=this.sampleCurveX(kA);if(Math.abs(T-e)<kE){return kA}if(e>T){kD=kA}else{kC=kA}kA=(kC-kD)*0.5+kD}return kA};cu.prototype.solve=function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))};var gR={};function fL(T){var e={duration:1000,fps:30,delay:0,transition:gR.linear,dropLastAnimation:false};if(T){for(var kz in T){e[kz]=T[kz]}}if(T.beginTime){this._beginTime=T.beginTime}this._callbacks=[];this._options=e;if(e.delay){var kA=this;setTimeout(function(){kA._doStart()},e.delay)}else{this._doStart()}this._pauseTime=0}fL.INFINITE="INFINITE";fL.prototype._doStart=function(){if(this._isPausing){var e=performance.now()||new Date().getTime();this._pauseTime+=e-this._isPausing;this._isPausing=undefined}if(window.requestAnimationFrame){var i=this;i._timer=window.requestAnimationFrame(function(T){i._loop(T)})}else{this._beginTime=new Date().getTime();if(this._options.duration===fL.INFINITE){this._endTime=null}else{this._endTime=this._beginTime+this._options.duration}this._loop()}};fL.prototype._loop=function(kz){var kC=this;kz=kz||new Date().getTime();kz=kz-this._pauseTime;if(!this._beginTime){this._beginTime=kz}if(!this._endTime&&typeof this._options.duration==="number"){this._endTime=this._beginTime+this._options.duration}if(kC._endTime!==null&&kz>=kC._endTime){if(kC._options.dropLastAnimation===false){kC._options.render(kC._options.transition(1),1,kz)}if(typeof kC._options.finish==="function"){kC._options.finish(kz,this)}for(var kB=0,e=kC._callbacks.length;kB<e;kB++){kC._callbacks[kB]()}return}var kA;if(typeof kC._options.duration==="number"){kA=(kz-kC._beginTime)/kC._options.duration;kC.schedule=kC._options.transition(kA)}else{kA=kz-kC._beginTime;kC.schedule=0}kC._options.render(kC.schedule,kA,kz);if(!kC.terminative){if(window.requestAnimationFrame){kC._timer=requestAnimationFrame(function T(i){kC._loop(i)})}else{kC._timer=setTimeout(function(){kC._loop()},1000/kC._options.fps)}}};fL.prototype.stop=function(i,e){this.terminative=true;if(this._timer){if(window.cancelAnimationFrame){cancelAnimationFrame(this._timer)}else{clearTimeout(this._timer)}this._timer=null;if(typeof this._options.onStop==="function"){this._options.onStop(e)}}if(i){this._endTime=this._beginTime;this._loop()}};fL.prototype.pause=function(){if(!this._isPausing){this.stop();this.terminative=undefined;this._isPausing=performance.now()||new Date().getTime()}};fL.prototype.cancel=function(){this.stop()};fL.prototype.append=function(e){this._callbacks.push(e);return this};gR={_p1:1,_p2:1*1.525,linear:function(e){return e},reverse:function(e){return 1-e},easeInQuad:function(e){return e*e},easeInCubic:function(e){return Math.pow(e,3)},easeInBiquad:function(e){return Math.pow(e,4)},easeInBack:function(e){return e*e*((gR._p1+1)*e-gR._p1)},easeOutQuad:function(e){return -(e*(e-2))},easeOutCubic:function(e){return Math.pow((e-1),3)+1},easeOutBiquad:function(e){return 1-Math.pow((e-1),4)},easeOutBack:function(e){return((e=e-1)*e*((gR._p1+1)*e+gR._p1)+1)},easeInOutQuad:function(e){if(e<0.5){return e*e*2}else{return -2*(e-2)*e-1}},easeInOutCubic:function(e){if(e<0.5){return Math.pow(e,3)*4}else{return Math.pow(e-1,3)*4+1}},easeInOutBiquad:function(e){if(e<0.5){return Math.pow(e,4)*8}else{return 1-(Math.pow(e-1,4)*8)}},easeInOutSine:function(e){return(1-Math.cos(Math.PI*e))/2}};gR.ease=(function(){var e=new cu(0.4,0,0.6,1);return function(i){return e.solve(i)}})();gR["ease-in"]=gR.easeInQuad;gR["ease-out"]=gR.easeOutQuad;var dx={start:function(kF){var kz=kF.el;var e=kF.style;var i=kF.startValue;var kC=kF.endValue;var kA=kF.duration||1400;var kB=kF.transition||gR.linear;var kE=kF.callback;var kD=kC-i;var T=kF.unit||"";return new fL({fps:60,duration:kA,transition:kB,render:function(kG){kz.style[e]=i+kD*kG+T},finish:function(){kE&&kE()}})}};function s(kA,T){dh.call(this);this.keyframes=kA;var e={duration:1000,delay:0,transition:gR.linear,interation:1};if(T){for(var kz in T){e[kz]=T[kz]}}this._options=e}s.inherits(dh,"ViewAnimation");s.prototype._start=function(kB){var T=this;T.map=kB;var kA=new fW("onanimationstart");T.dispatchEvent(kA);this._initStatus(T.map);var kz=this._options.duration;var i=this._options.interation;var kC=this._options.transition;var kD=0;T.poiStatus=T.map._displayOptions.poi;if(T.poiStatus){T.map.setDisplayOptions({poi:false})}T.map.viewAnimationTime=new Date().getTime();this.animation=new fL({duration:kz,transition:kC,start:function(e){},render:function(kE,e){if(kE===0){T._initStatus(T.map)}else{T._setViewByRate(kE)}},finish:function(kF,kE){if(++kD<i||i==="INFINITE"){var kG=new fW("onanimationiterations");T.dispatchEvent(kG);delete kE._beginTime;delete kE._endTime;kE._doStart()}else{var kG=new fW("onanimationend");T.dispatchEvent(kG);delete T.map.viewAnimationTime;T.map.setDisplayOptions({poi:T.poiStatus})}}})};s.prototype._getTotalDuration=function(e,i){if(e===fL.INFINITE){return fL.INFINITE}else{return e*i}};s.prototype._initStatus=function(e){if(this.keyframes[0]){e.setCenter(this.keyframes[0].center,{noAnimation:true});e.setZoom(this.keyframes[0].zoom,{noAnimation:true});e.setTilt(this.keyframes[0].tilt,{noAnimation:true});e.setHeading(this.keyframes[0].heading,{noAnimation:true})}};s.prototype._setViewByRate=function(kz){for(var e=0;e<this.keyframes.length-1;e++){var kA=this.keyframes[e];var T=this.keyframes[e+1];if(kz>=kA.percentage&&kz<T.percentage){this.map.setHeading(this._getHeadingDelta(kA,T,kz),{noAnimation:true});this.map.setTilt(this._getTiltDelta(kA,T,kz),{noAnimation:true});this.map.setCenter(this._getCenterDelta(kA,T,kz),{noAnimation:true});this.map.setZoom(this._getZoomDelta(kA,T,kz),{noAnimation:true})}}};s.prototype._getHeadingDelta=function(T,i,e){var kA=(e-T.percentage)/(i.percentage-T.percentage);var kz=T.heading+(i.heading-T.heading)*kA;return kz};s.prototype._getTiltDelta=function(T,i,e){var kA=(e-T.percentage)/(i.percentage-T.percentage);var kz=T.tilt+(i.tilt-T.tilt)*kA;return kz};s.prototype._getCenterDelta=function(T,i,e){var kA=(e-T.percentage)/(i.percentage-T.percentage);var kz=T.center.add(i.center.sub(T.center).mult(kA));return kz};s.prototype._getZoomDelta=function(kz,T,i){var kA=(i-kz.percentage)/(T.percentage-kz.percentage);var e=kz.zoom+(T.zoom-kz.zoom)*kA;return e};s.prototype._pause=function(e){this.animation.pause()};s.prototype._continue=function(e){this.animation._doStart()};s.prototype._cancel=function(T){T.setDisplayOptions({poi:this.poiStatus});this.animation.cancel();delete T.viewAnimationTime;var i=new fW("onanimationcancel");this.dispatchEvent(i)};var cR=undefined;var fG={is64Bit:function(){if(/Windows/.test(navigator.userAgent)){if(/Win64; x64/.test(navigator.userAgent)){return true}else{if(/WOW64/.test(navigator.userAgent)){return true}else{return false}}}return true},isIOS112:function ba(e){return/11_2/.test(navigator.userAgent)},canUseWebAssembly:function(i){if(cR!==undefined){i&&i(cR);return}if(window.WebAssembly&&this.is64Bit()){if(window.disableWebAssembly===true){cR=false;i&&i(cR)}else{if(!cC()){cR=true;i&&i(cR)}else{if(this.isIOS112()){cR=false;i&&i(cR)}else{var e=new Uint8Array([0,97,115,109,1,0,0,0,1,133,128,128,128,0,1,96,0,1,127,3,130,128,128,128,0,1,0,4,132,128,128,128,0,1,112,0,0,5,131,128,128,128,0,1,0,1,6,129,128,128,128,0,0,7,145,128,128,128,0,2,6,109,101,109,111,114,121,2,0,4,109,97,105,110,0,0,10,138,128,128,128,0,1,132,128,128,128,0,0,65,42,11]);WebAssembly.instantiate(e).then(function(T){cR=true;i&&i(cR)},function(T){cR=false;i&&i(cR)})}}}}else{cR=false;i&&i(cR)}}};var aL={};bG.Utils=aL;function kq(e){return e.style}function il(i){if(e9.Browser.ie>0){i.unselectable="on";i.selectstart=function(){return false};i.onmousedown=function(T){T.preventDefault();return false}}else{var e=kq(i);e.MozUserSelect="none";e.WebkitUserSelect="none";i.addEventListener("mousedown",function(T){T.preventDefault()},false)}}function aV(e){return e&&e.parentNode&&e.parentNode.nodeType!==11}function bS(i,e){if(!i){return null}i.insertAdjacentHTML("beforeEnd",e);return i.lastChild}function f1(T,i){var kz=document.createElement("div");kz.innerHTML=i;var e=kz.childNodes[0];return T.parentNode.insertBefore(e,T)}function al(i){i=i||window.event;i.stopPropagation?i.stopPropagation():i.cancelBubble=true}function d(i){i=i||window.event;i.preventDefault?i.preventDefault():i.returnValue=false;return false}function hH(i){al(i);return d(i)}function ha(){var e=document.documentElement;var i=document.body;if(e&&(e.scrollTop||e.scrollLeft)){return[e.scrollTop,e.scrollLeft]}else{if(i){return[i.scrollTop,i.scrollLeft]}else{return[0,0]}}}function iJ(kA){if(!kA){return}kA.onload=kA.onerror=null;var T=kA.attributes,kz,e,kB;if(T){e=T.length;for(kz=0;kz<e;kz+=1){kB=T[kz].name;if(typeof kA[kB]==="function"){kA[kB]=null}}}T=kA.children;if(T){e=T.length;for(kz=0;kz<e;kz+=1){iJ(kA.children[kz])}}}function f4(i,kC,kB){var kA=kC.lng-kB.lng;var kz=kC.lat-kB.lat;if(kA===0){return Math.abs(i.lng-kC.lng)}if(kz===0){return Math.abs(i.lat-kC.lat)}var T=kz/kA;var e=kC.lat-T*kC.lng;return Math.abs(T*i.lng-i.lat+e)/Math.sqrt(T*T+1)}function cr(i,e){if(!i||!e){return}return Math.round(Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2)))}function eF(i,e){if(!i||!e){return 0}return Math.round(Math.sqrt(Math.pow(i.lng-e.lng,2)+Math.pow(i.lat-e.lat,2)))}function fV(kE,T,kA){var kB=(kA.lng-T.lng)*(kE.lng-T.lng)+(kA.lat-T.lat)*(kE.lat-T.lat);if(kB<=0){return eF(kE,T)}var e=(kA.lng-T.lng)*(kA.lng-T.lng)+(kA.lat-T.lat)*(kA.lat-T.lat);if(kB>=e){return eF(kE,kA)}var i=kB/e;var kD=T.lng+(kA.lng-T.lng)*i;var kC=T.lat+(kA.lat-T.lat)*i;const kz={lng:kD,lat:kC};return eF(kE,kz)}function fm(T,i){var e=Math.round((T.x+i.x)/2);var kz=Math.round((T.y+i.y)/2);return new fv(e,kz)}function jG(e,T){var i=[];T=T||function(kA){return kA};for(var kz in e){i.push(kz+"="+T(e[kz]))}return i.join("&")}function b6(T,i,kB){var kC=document.createElement(T);if(kB){kC=document.createElementNS(kB,T)}i=i||{};for(var kz in i){var kA={"for":"htmlFor","class":"cssClass"}[kz]||kz;if(kz==="style"){kC.style.cssText=i[kz];continue}if(kz==="class"){e9.ac(kC,i[kz]);continue}if(kC.setAttribute){kC.setAttribute(kA,i[kz])}else{try{kC[kA]=i[kz]}catch(kC){}}}return kC}function cq(e){if(e.currentStyle){return e.currentStyle}else{if(e.ownerDocument&&e.ownerDocument.defaultView){return e.ownerDocument.defaultView.getComputedStyle(e,null)}}}function b0(e){return typeof e==="function"}function gs(e){return e===void 0}function jX(e,i){return Object.prototype.hasOwnProperty.call(e,i)}function h(kA,kB){if(gs(kA.length)){for(var kz in kA){if(jX(kA,kz)){kB.call(null,kz,kA[kz])}}}else{var T=kA.length;if(T){for(var e=0;e<T;e++){kB.call(null,e,kA[e])}}}}function au(i,e){if(!e){return i}h(e,function(T,kz){i[T]=kz});return i}var hp="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function du(kA){var T="";var kH;var kF;var kD="";var kG;var kE;var kC;var kB="";var kz=0;var e=/[^A-Za-z0-9+/=]/g;if(!kA||e.exec(kA)){return kA}kA=kA.replace(/[^A-Za-z0-9+/=]/g,"");do{kG=hp.indexOf(kA.charAt(kz++));kE=hp.indexOf(kA.charAt(kz++));kC=hp.indexOf(kA.charAt(kz++));kB=hp.indexOf(kA.charAt(kz++));kH=(kG<<2)|(kE>>4);kF=((kE&15)<<4)|(kC>>2);kD=((kC&3)<<6)|kB;T=T+String.fromCharCode(kH);if(kC!==64){T=T+String.fromCharCode(kF)}if(kB!==64){T=T+String.fromCharCode(kD)}kH=kF=kD="";kG=kE=kC=kB=""}while(kz<kA.length);return T}function jE(e){return btoa(encodeURIComponent(e))}function gb(e){return decodeURIComponent(atob(e))}(function(e){if(!e.Utils){e.Utils={}}var i=e.Utils;i.format=(function(){function T(kC,kB,kD){var kA=kD[+kB];return typeof(kA)==="function"?kA(kB):kA}function kz(kC,kB,kD){var kF=kB;var kG=[];var kA=kB.split(":");if(kA.length===2){kF=kA[0];kG.push(kA[1])}var kE=typeof(kD[kF]);if(kE==="function"){return kD[kF].apply(undefined,kG)}else{if(kE==="undefined"){return kC}else{return String(kD[kF])}}}return function(kA,kB){var kD=kB.splice?T:kz;var kC=kA.splice?kA.join(""):kA;return kC.replace(/{([a-zA-Z0-9_$:.]+)}/g,function(kF,kE){return kD(kF,kE,kB)})}})();i.ErrorMonitor=function(kz,T,kA){};fG.canUseWebAssembly(function(T){i.canUseWebAssembly=T})})(bG);function b5(){return(cC()||ic()||fo())}function cC(){var e=navigator.userAgent;if(e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1){return true}return false}function ic(){var e=navigator.userAgent;if(e.indexOf("Android")>-1){return true}return false}function fo(){var e=navigator.userAgent;if(e.indexOf("Harmony")>-1){return true}return false}function iW(e){return e*Math.PI/180}function fl(e){return e/Math.PI*180}function bK(e,kA){var kz=Math.pow(10,kA);if(typeof e==="number"){return Math.round(e*kz)/kz}for(var T=0;T<e.length;T++){e[T]=bK(e[T],kA)}return e}function ck(T,i,e){if(T<i){T=i}else{if(T>e){T=e}}return T}function eq(e,i){while(e<0){e+=i}return e%i}function h9(i,e){return(i>=0&&e>=0)||(i<0&&e<0)}function O(i){if(i._gl){return i._gl}var e={alpha:true,antialias:false,failIfMajorPerformanceCaveat:false,preserveDrawingBuffer:false,stencil:false};var T=i.getContext("webgl",e)||i.getContext("experimental-webgl",e);i._gl=T;return T}function iT(kz,T){for(var e=0;e<T.length;e++){e9.on(kz,T[e],al)}}function e3(i,T,e){T[e]=i.getUniformLocation(T,e)}function b8(kA,kB,e,T,i){var kz="";switch(i){case"mat4":kA.uniformMatrix4fv(kB[e],false,T);return;case"v3":kz="uniform3fv";break;case"f":kz="uniform1f";break;case"i":kz="uniform1i";break}if(kz===""){throw"error"}kA[kz](kB[e],T)}function hU(kH,e){while(kH<0){kH+=360}kH=kH%360;var kz=e.width;var kG=e.height;var kC=kz;var T=kG;if(kH<90){var i=Math.sin(iW(kH))*kz;var kE=Math.sin(iW(kH))*kG;var kF=Math.cos(iW(kH))*kz;var kB=Math.cos(iW(kH))*kG;var kC=Math.ceil(kF+kE);var T=Math.ceil(i+kB)}else{if(kH<180){var kH=kH-90;var i=Math.sin(iW(kH))*kz;var kE=Math.sin(iW(kH))*kG;var kF=Math.cos(iW(kH))*kz;var kB=Math.cos(iW(kH))*kG;var kC=Math.ceil(i+kB);var T=Math.ceil(kF+kE)}else{if(kH<270){var kH=kH-180;var i=Math.sin(iW(kH))*kz;var kE=Math.sin(iW(kH))*kG;var kF=Math.cos(iW(kH))*kz;var kB=Math.cos(iW(kH))*kG;var kC=Math.ceil(kF+kE);var T=Math.ceil(i+kB)}else{var kH=kH-270;var i=Math.sin(iW(kH))*kz;var kE=Math.sin(iW(kH))*kG;var kF=Math.cos(iW(kH))*kz;var kB=Math.cos(iW(kH))*kG;var kC=Math.ceil(i+kB);var T=Math.ceil(kF+kE)}}}var kD=kC-kz;var kA=T-kG;return[0-kD/2,0-kA/2,kz+kD/2,kG+kA/2]}function cj(e){if(e.toDataURL()===cj._blankData){return true}return false}function Y(kA,kz,T){var i=[T.lng-kA.lng,T.lat-kA.lat];var e=[kz.lng-kA.lng,kz.lat-kA.lat];return i[0]*e[1]-i[1]*e[0]}function jj(kB,kA,T){var e;var kC;var kz;var i;if(kB.lng<kA.lng){e=kB.lng;kz=kA.lng}else{e=kA.lng;kz=kB.lng}if(kB.lat<kA.lat){kC=kB.lat;i=kA.lat}else{kC=kA.lat;i=kB.lat}if(T.lng<e||T.lng>kz||T.lat<kC||T.lat>i){return false}return true}function ju(kD,kC,kB,kz){var kA=Y(kB,kz,kD);var T=Y(kB,kz,kC);var i=Y(kD,kC,kB);var e=Y(kD,kC,kz);if(kA*T<0&&i*e<0){return true}else{if(kA===0&&jj(kB,kz,kD)){return true}else{if(T===0&&jj(kB,kz,kC)){return true}else{if(i===0&&jj(kD,kC,kB)){return true}else{if(e===0&&jj(kD,kC,kz)){return true}else{return false}}}}}}function hX(T,i){var e=i.parentNode;if(e.lastChild===i){e.appendChild(T)}else{e.insertBefore(T,i.nextSibling)}}function d2(kF,kG){if(kG===0){return kF}var kE=0;var kC=0;if(!kF){throw"异常"}if(kF.length===0){return[]}for(var kA=1,T=kF.length-1;kA<T;kA++){var kD=f4(kF[kA],kF[0],kF[kF.length-1]);if(kD>kE){kC=kA;kE=kD}}var e=[];if(kE>=kG){var kI=kF.slice(0,kC);var kH=kF.slice(kC,kF.length);var kB=d2(kI,kG);var kz=d2(kH,kG);for(var kA=0,T=kB.length;kA<T;kA++){e.push(kB[kA])}for(var kA=0,T=kz.length;kA<T;kA++){e.push(kz[kA])}}else{e.push(kF[0]);e.push(kF[kF.length-1])}return e}function r(e){if(Math.log2){return Math.log2(e)}return Math.log(e)/Math.LN2}function dl(T,i,e){return Math.min(e,Math.max(i,T))}function at(e,i){if(!i){return e}var kB=i[0];var kA=i[1];var kz=i[2];var T=i[3];var kD=[];var kC=[];kD[0]=T*e[0]+kz*e[2];kD[1]=e[1];kD[2]=-kz*e[0]+T*e[2];kC[0]=kD[0];kC[1]=kA*kD[1]-kB*kD[2];kC[2]=kB*kD[1]+kA*kD[2];return kC}var p=Math.PI/180;var g2=180/Math.PI;function fI(T){var i=(T-Date.UTC(2000,0,1,12))/86400000/36525;var e=(d3.utcDay.floor(T)-T)/86400000*360-180;return[e-fy(i)*g2,d9(i)*g2]}function fy(kz){var kA=bx(kz);var i=eh(kz);var T=iR(kz);var kB=Math.tan(iQ(kz)/2);kB*=kB;return kB*Math.sin(2*T)-2*kA*Math.sin(i)+4*kA*kB*Math.sin(i)*Math.cos(2*T)-0.5*kB*kB*Math.sin(4*T)-1.25*kA*kA*Math.sin(2*i)}function d9(e){return Math.asin(Math.sin(iQ(e))*Math.sin(bC(e)))}function bC(e){return kk(e)-(0.00569+0.00478*Math.sin((125.04-1934.136*e)*p))*p}function kk(e){return iR(e)+jz(e)}function eh(e){return(357.52911+e*(35999.05029-0.0001537*e))*p}function iR(i){var e=(280.46646+i*(36000.76983+i*0.0003032))%360;return(e<0?e+360:e)/180*Math.PI}function jz(i){var e=eh(i);return(Math.sin(e)*(1.914602-i*(0.004817+0.000014*i))+Math.sin(e+e)*(0.019993-0.000101*i)+Math.sin(e+e+e)*0.000289)*p}function iQ(e){return dD(e)+0.00256*Math.cos((125.04-1934.136*e)*p)*p}function dD(e){return(23+(26+(21.448-e*(46.815+e*(0.00059-e*0.001813)))/60)/60)*p}function bx(e){return 0.016708634-e*(0.000042037+1.267e-7*e)}function gt(){return window.devicePixelRatio||1}function i3(T){var i;var e;var kz;if(T>=0){kz=Math.floor(T/65536)*65536;i=kz;e=T-kz}else{kz=Math.floor(-T/65536)*65536;i=-kz;e=T+kz}return[i,e]}function cN(e){if(e.lng>=0&&e.lat>=0){return new cG(e.lng-10000000,e.lat-6000000)}if(e.lng>=0&&e.lat<0){return new cG(e.lng-10000000,e.lat+6000000)}if(e.lng<0&&e.lat>=0){return new cG(e.lng+10000000,e.lat-6000000)}if(e.lng<0&&e.lat<0){return new cG(e.lng+10000000,e.lat+6000000)}}var ix=null;if(window.performance&&window.performance.now){ix=function(){return performance.now()}}else{if(Date.now){ix=function(){return Date.now()}}else{ix=function(){return(new Date).getTime()}}}function h8(kz,e,i){var T="mouseWheel";if(e9.Platform.macintosh){if(!isNaN(kz)&&(kz<10||kz!==120)&&(e%1===0&&e<5)){T="padScroll"}if(e9.Browser.firefox&&(e%1===0&&e<5&&i===0)){T="padScroll"}}if(e9.Browser.safari&&kz===12){T="mouseWheel"}return T}function bT(kI,kD){var kH=kI[0];var kG=kI[1];var kz=false;for(var kC=0,kB=kD.length-2;kC<kD.length;kC+=2){var kF=kD[kC];var kA=kD[kC+1];var kE=kD[kB];var T=kD[kB+1];var e=((kA>kG)!==(T>kG))&&(kH<(kE-kF)*(kG-kA)/(T-kA)+kF);if(e){kz=!kz}kB=kC}return kz}function aw(kA,kC){kC=kC||[];var e=kC.length;var T=0;var kB=false;for(var kz=0;kz<e;kz++){T=(kz===e-1)?0:T+1;if((kC[kz].lat!==kC[T].lat)&&(((kA.lat>=kC[kz].lat)&&(kA.lat<kC[T].lat))||((kA.lat>=kC[T].lat)&&(kA.lat<kC[kz].lat)))&&(kA.lng<(kC[T].lng-kC[kz].lng)*(kA.lat-kC[kz].lat)/(kC[T].lat-kC[kz].lat)+kC[kz].lng)){kB=!kB}}return kB}function d0(T,e,i,kz){kz=kz||0.4;if(T>i){T=Math.pow(T-i+1,kz)+i-1}else{if(T<e){T=e-Math.pow(e-T+1,kz)+1}}return T}function e5(kD){var kB="";for(var T=0;T<kD.length;T++){var kE=kD.charCodeAt(T)<<1;var e=kE.toString(2);var kA=e.length;var kH=e;if(kA<8){kH="00000000"+e;kH=kH.substr(e.length,8)}kB+=kH}var kF=5-kB.length%5;var kz=[];for(var T=0;T<kF;T++){kz[T]="0"}kB=kz.join("")+kB;var kG=[];for(var T=0;T<kB.length/5;T++){var kE=kB.substr(T*5,5);var kC=parseInt(kE,2)+50;kG.push(String.fromCharCode(kC))}return kG.join("")+kF.toString()}function ka(T,i){var e=bG.TILE_VERSION||window.TILE_VERSION;if(!e||!e[T]||!e[T][i]||!e[T][i].version||!e[T][i].updateDate){e=E.tvc}return{ver:e[T][i].version,udt:e[T][i].updateDate}}function bH(){var e=bG.MSV||window.MSV;if(!e||!e.mapstyle||!e.mapstyle.updateDate||!e.mapstyle.version){e=E.msv}return{ver:e.mapstyle.version,udt:e.mapstyle.updateDate}}function dI(e,kA){var kz=e.slice(0);for(var T=0;T<kz.length;T++){kz[T]+=kA}return kz}var hj=null;function hz(e){if(hj){return}e.fire(new fW("onloadtile"));hj=setTimeout(function(){hj=null},1000)}function aO(){if(G("//map.baidu.com")||G("//maps.baidu.com")||G("//ditu.baidu.com")){return true}return false}aL.inMapHost=aO();if(typeof window._inMapHost==="boolean"){aL.inMapHost=window._inMapHost}function G(i){var T=window.location;var e=document.createElement("a");e.href=i;return e.hostname===T.hostname&&e.port===T.port&&e.protocol===T.protocol}var d8=[72.685732,0.193351,136.10888,54.392257];var e8=[72.6892532,0.1939743381,136.1168614,54.392257];var v=[72.69566833,0.1999420909,136.1232863,54.39791217];var iS=158;var dw=[98.789081,122.948721,107.857301,118.082148,119.126627,128.021934,79.939914,99.021873,119.912937,122.084572,127.906381,130.933385,106.496057,108.066113,119.818772,126.367919,111.789929,119.311401,100.742164,102.220151,99.853589,100.781289,97.522631,98.834615,99.092638,99.892947,122.905967,123.761867,123.716213,125.494726,123.723977,124.755034,125.475833,126.398284,125.471687,126.065118,130.817003,133.605851,127.900156,128.656536,128.646633,129.625389,132.88057,134.104549,117.365548,119.230813,116.073074,117.416898,114.406274,116.123791,116.479038,119.591534,110.566812,111.851324,74.465162,79.993155,82.858046,91.345214,85.71485,98.969834,127.651377,129.532029,129.462275,130.209769,133.716214,134.731053,134.366834,135.103133,130.854579,131.32966,115.499125,117.530421,115.765224,116.734157,108.524336,110.601747,121.351282,124.612037,126.151954,127.332751,91.273562,95.604179,79.87318,82.935667,76.413314,78.336484,78.275229,79.993668,83.956612,85.725267,85.500637,89.346601,97.990127,98.94176,106.641956,108.599215,111.386259,111.810312,111.578597,111.803167,115.99273,117.010413,116.24461,116.675246,119.422198,119.909078,120.646056,121.38098,120.335038,120.662183,124.579855,125.773243,126.207803,126.774849,95.565331,102.037736,95.576121,96.158028,95.556699,97.799055,91.296205,93.348146,93.321994,94.690522,89.339313,90.540241,82.263039,82.882528,78.335615,80.023512,76.623947,78.352608,73.495149,74.48155,74.846872,76.479412,91.560058,94.871116,88.759515,89.235995,83.237883,83.965264,82.292123,83.246813,81.876477,83.253307,80.75212,81.463265,86.463409,88.267232,102.199623,104.225963,112.153727,116.823265,108.965663,113.021145,111.166575,117.972799];var dv=[22.548416,42.276971,17.227969,22.7346,41.292761,50.741667,30.365133,42.324913,21.701924,22.69335,42.4176,48.936335,21.429059,22.648399,50.650499,52.914825,42.20449,45.199078,21.13391,22.568612,21.441033,22.583349,23.73862,25.298628,22.00409,22.563095,38.97849,41.338631,40.287973,41.330108,39.732801,40.343252,40.966852,41.323446,40.719312,41.05937,44.869472,48.009884,41.336325,42.443362,42.008104,42.434713,45.873151,48.205746,45.132322,46.784582,45.133383,46.392803,45.148771,45.740273,47.478161,50.064393,42.216229,43.461282,37.014302,40.662281,42.219985,47.31417,27.726965,30.466651,48.911271,49.642488,48.831706,49.434487,46.941762,48.37425,47.651781,48.463782,42.851964,44.905396,47.598273,48.438467,48.409141,48.901651,42.22756,42.906402,52.821047,53.578094,50.701837,51.654278,42.292419,44.392214,42.295918,45.385017,34.680866,37.027803,30.743515,37.066586,28.245649,30.406053,47.270872,48.497371,25.238932,27.778469,42.215754,42.540416,43.427677,44.689208,44.685587,44.994131,48.878657,49.318659,49.281099,49.624515,50.710468,51.306809,52.90717,53.331981,52.903016,53.107959,52.900867,53.250033,51.638073,52.400678,42.229657,42.691928,43.061242,43.891083,42.663095,43.074222,44.37174,45.180155,44.375135,44.974219,47.3035,48.053221,45.352401,46.807875,40.563053,42.040289,40.581871,41.405172,38.516328,40.178756,35.790476,37.02337,26.825605,27.761303,27.197399,27.74932,29.147561,30.37813,29.570893,30.062042,30.045026,30.380952,29.998038,30.385203,48.487385,49.16832,22.395733,22.598229,7.441114,11.501436,3.767491,9.000793,12.642067,17.406563];var cg=[98.795985,122.960792,107.867379,118.093451,119.139658,128.035888,79.948212,99.029524,119.923388,122.094977,127.918527,130.94789,106.50606,108.076783,119.8329,126.382207,111.803567,119.324928,100.749858,102.227985,99.860885,100.788921,97.529435,98.841564,99.100017,99.90035,122.917416,123.774367,123.728314,125.507211,123.736065,124.767299,125.488463,126.410675,125.484326,126.07764,130.830784,133.620042,127.912178,128.668957,128.658937,129.638599,132.894179,134.119086,117.379378,119.244569,116.086736,117.431212,114.420233,116.137458,116.492775,119.605527,110.579401,111.86488,74.468228,80.001908,82.867432,91.353788,85.721075,98.976964,127.664757,129.546833,129.476893,130.22449,133.730358,134.745235,134.381034,135.1178,130.868117,131.34409,115.513245,117.544751,115.779271,116.748045,108.536254,110.614326,121.365534,124.626434,126.165992,127.347013,91.281869,95.611754,79.879648,82.945041,76.413314,78.345207,78.275229,80.002329,83.956612,85.734098,85.510186,89.356499,97.997001,98.948845,106.653208,108.610811,111.400183,111.824179,111.592224,111.817136,116.00682,117.024631,116.258574,116.689291,119.436876,119.922961,120.659806,121.395479,120.349116,120.676014,124.59389,125.787788,126.221756,126.788962,95.572955,102.046581,95.583772,96.165551,95.564318,97.806095,91.30446,93.356438,93.330319,94.698145,89.349129,90.548677,82.268802,82.892025,78.335615,80.032266,76.625755,78.361413,73.498248,74.490992,74.846872,76.488771,91.563521,94.878444,88.768214,89.244787,83.247076,83.974127,82.29595,83.256003,81.885315,83.26249,80.760619,81.472404,86.470983,88.276988,102.207537,104.234614,112.164795,116.833667,108.965663,113.032246,111.166575,117.983363];var ce=[22.551183,42.284787,17.227969,22.738314,41.300981,50.749638,30.368087,42.332701,21.705055,22.696452,42.426047,48.944674,21.432184,22.651387,50.657409,52.92296,42.212192,45.206905,21.137031,22.57186,21.444502,22.586566,23.741571,25.301472,22.006806,22.56637,38.985114,41.346531,40.295617,41.338581,39.740021,40.351012,40.974644,41.331562,40.726852,41.067192,44.877158,48.018285,41.344597,42.451798,42.016305,42.443235,45.880906,48.214001,45.140027,46.792775,45.141083,46.400433,45.156418,45.748281,47.485889,50.071879,42.223667,43.469487,37.019867,40.668675,42.226823,47.321605,27.72944,30.469853,48.919002,49.650614,48.840188,49.443166,46.949801,48.382798,47.660603,48.472692,42.859946,44.913298,47.605896,48.445914,48.41698,48.909667,42.23507,42.914193,52.8281,53.585952,50.709311,51.662219,42.29968,44.399225,42.302746,45.391958,34.680866,37.03377,30.743515,37.07228,28.245649,30.408935,47.277693,48.504255,25.241528,27.780726,42.223363,42.548418,43.435888,44.696952,44.693193,45.00187,48.886267,49.326755,49.288642,49.632304,50.717486,51.314369,52.914204,53.33964,52.910094,53.115926,52.908382,53.258095,51.64533,52.408305,42.236825,42.699126,43.068466,43.898632,42.670403,43.082219,44.379045,45.187742,44.382336,44.981379,47.310362,48.06019,45.359099,46.814439,40.569751,42.047741,40.587956,41.41263,38.519192,40.185033,35.790476,37.029005,26.825605,27.763896,27.199658,27.751649,29.150192,30.381073,29.573886,30.065162,30.047775,30.384089,30.001277,30.388525,48.494118,49.173841,22.398528,22.601198,7.441114,11.505968,3.767491,9.005209,12.642067,17.410886];var ag=95;var db=[110.3961374,105.0743788,96.8991824,95.61810411,93.82412598,91.3892353,91.38931858,89.08325955,87.22469808,86.26278402,85.17353,85.23741211,82.86627441,81.90481038,79.59687147,80.39829237,79.93319363,77.80279948,75.2557704,73.49357829,73.1892532,73.87758816,74.4064738,74.10215224,75.46409695,76.77739692,78.28299615,78.15499485,78.37920654,78.89145345,79.69282199,81.19938178,81.80830295,83.89093424,85.94149523,87.86447266,89.03414958,90.05918132,91.10026937,92.15733832,93.74361735,95.82597331,97.95655545,97.12363037,98.2129739,99.2068571,101.6587874,102.5239084,102.2356106,105.0249238,106.0992342,107.8617093,111.6439372,109.591869,112.284586,117.7961157,118.9495128,114.2076584,118.693565,123.1475225,122.730705,120.9361393,123.4207441,122.3787782,122.1385425,121.5904281,121.1773763,120.6805404,120.2483355,122.795807,122.8759077,121.3060262,122.1392177,123.7418799,126.4177599,128.5647409,129.7194884,131.2259136,131.9950494,133.6289931,135.6168614,131.3875545,130.8743365,128.6303223,126.0997773,124.4015375,122.22161,119.6586483,119.7866827,118.5685878,116.5177976,114.819101,119.0812964,116.453265,111.7431171];var c9=[43.2190351,42.38053385,43.17417589,44.42226915,45.09863634,45.56708116,47.33599718,48.68832709,49.62448486,48.9482175,48.4800472,47.33564399,47.43948676,46.03452067,45.20221788,43.34563043,42.32965739,41.39690972,40.82972331,39.95567654,39.25892877,38.36098768,38.05441569,37.16878445,36.38899414,35.36126817,34.30953451,32.58503879,31.56975694,30.77800266,30.43559814,29.7744892,30.0931977,28.71103299,27.70739665,27.5775472,27.01096137,27.77857883,27.50707954,26.50328315,26.70387804,27.95548557,27.29428901,23.64685493,23.62310601,21.67493381,20.77751465,21.32070991,22.1824113,22.31232964,22.51316054,16.80037679,13.19749864,0.6939743381,1.541660428,10.50208252,15.58926975,17.89090007,19.94928467,22.18490153,25.37285292,25.61456434,30.62532552,31.08099284,31.89238173,32.50092692,32.80325765,34.25546956,35.15486138,36.90170139,37.8348272,37.941604,38.6480797,38.96797201,40.98146918,41.25573296,42.07218153,42.49132813,44.65259766,44.69330702,48.62286865,48.09383952,49.19628499,50.03402317,53.27678901,53.62976345,53.89420546,52.98933322,52.01872884,50.23210259,50.18807048,47.49769857,47.34362712,46.50502143,45.24770128];var eQ=[98.7895,122.954182,107.860913,118.087007,119.133165,128.029533,79.941749,99.023087,119.916883,122.08841,127.912143,130.941471,106.499502,108.070244,119.826245,126.375818,111.797006,119.318387,100.743285,102.221517,99.854448,100.782445,97.522928,98.835028,99.093518,99.893783,122.910927,123.767769,123.721954,125.50077,123.729657,124.760724,125.481902,126.404079,125.477737,126.071019,130.824331,133.613395,127.905767,128.662524,128.652527,129.6321,132.887552,134.11249,117.37297,119.237999,116.080154,117.424589,114.413586,116.130948,116.486264,119.598927,110.5728,111.858437,74.465162,79.995337,82.860821,91.347291,85.716024,98.970481,127.658331,129.540202,129.470528,130.21808,133.723748,134.738785,134.374555,135.111443,130.861475,131.337438,115.506627,117.538123,115.772783,116.741632,108.529656,110.60782,121.358945,124.619773,126.159424,127.340582,91.275275,95.605228,79.874427,82.938601,76.413314,78.338763,78.275229,79.995765,83.956612,85.727511,85.503554,89.349858,97.990418,98.942257,106.646704,108.604437,111.393667,111.817723,111.585811,111.810645,116.000232,117.018216,116.252108,116.682705,119.430384,119.916417,120.653168,121.38883,120.342727,120.669383,124.587426,125.781376,126.215282,126.782323,95.566367,102.040026,95.577158,96.159009,95.557772,97.799728,91.298032,93.350057,93.323794,94.691771,89.342471,90.542019,82.264229,82.885485,78.335615,80.025844,76.623947,78.355027,73.495149,74.484473,74.846872,76.482208,91.560117,94.871859,88.761692,89.23822,83.240549,83.967602,82.292367,83.2495,81.878825,83.256003,80.75421,81.465955,86.465421,88.270356,102.201019,104.228033,112.158282,116.827153,108.965663,113.025767,111.166575,117.97687];var eP=[22.545421,42.279053,17.226272,22.731982,41.294917,50.743316,30.361986,42.326603,21.699185,22.690751,42.419757,48.938435,21.426505,22.64567,50.651745,52.916705,42.20641,45.201064,21.131326,22.565685,21.438288,22.580379,23.735785,25.295582,22.001087,22.560315,38.979333,41.340757,40.28938,41.332289,39.734164,40.344718,40.968803,41.325813,40.721073,41.061503,44.871533,48.012179,41.338366,42.445601,42.010343,42.436934,45.875217,48.208327,45.134237,46.786509,45.135376,46.394665,45.150734,45.742257,47.480099,50.065931,42.217982,43.46329,37.014057,40.662848,42.221079,47.315558,27.723432,30.46385,48.913298,49.644555,48.83396,49.436824,46.944059,48.376613,47.654503,48.466331,42.854333,44.907682,47.600253,48.440245,48.410926,48.903468,42.229292,42.908294,52.822466,53.58012,50.703491,51.656037,42.29378,44.393379,42.296912,45.385809,34.679282,37.027699,30.740622,37.066377,28.241967,30.403134,47.271949,48.49848,25.235818,27.774976,42.217425,42.542102,43.429763,44.691016,44.687044,44.995758,48.880431,49.320551,49.282865,49.626267,50.711607,51.308382,52.908547,53.333963,52.904419,53.109706,52.902338,53.251938,51.639701,52.402205,42.231045,42.693581,43.062756,43.892771,42.664519,43.075927,44.372942,45.1815,44.376327,44.975476,47.304623,48.054453,45.353174,46.808493,40.563653,42.041556,40.582164,41.4064,38.51618,40.179105,35.789745,37.023144,26.825402,27.757641,27.193806,27.745766,29.144229,30.375186,29.567889,30.059102,30.041938,30.378006,29.995047,30.382338,48.48834,49.169021,22.392816,22.595333,7.439914,11.500161,3.766676,9.000793,12.640512,17.406563];var fU=3000;var g9=0.00002;var g8=0.000003;var jg=0.0174532925194;var h0=0.0065;var hZ=0.006;var dR=40000;var fH=0;var jA=1;var aB=2;var io=3;var fA=4;var hD=1e-10;var iY=6370996.81;var fY=100000000;function hM(T,kA,i,kz){var e=arguments.length;this.ll={};this.ru={};if(e===0){}else{if(e===4){this.normalize(T,kA,i,kz)}}}hM.prototype.contains=function(e){if(e.lng>this.ll.lng&&e.lng<this.ru.lng&&e.lat>this.ll.lat&&e.lat<this.ru.lat){return io}if(Math.abs(e.lng-this.ll.lng)<hD||Math.abs(e.lng-this.ru.lng)<hD||Math.abs(e.lat-this.ll.lat)<hD||Math.abs(e.y-this.ru.lat)>hD){return aB}return fH};hM.prototype.normalize=function(i,kz,e,T){if(i>e){this.ll.lng=e;this.ru.lng=i}else{this.ll.lng=i;this.ru.lng=e}if(kz>T){this.ll.lat=T;this.ru.lat=kz}else{this.ll.lat=kz;this.ru.lat=T}};function eH(i,kz,e,T){this.sp={lng:i,lat:kz};this.ep={lng:e,lat:T};this.mbr=new hM(i,kz,e,T)}function iz(kz,e,kB,kA){for(var T=0;T<kA;T=T+2){if(kz.lng>=e[T]&&kz.lng<=e[T+1]&&kz.lat>=kB[T]&&kz.lat<=kB[T+1]){return true}}return false}function gz(kE){var i=kE.lng;var kD=kE.lat;var kz=Math.sqrt(i*i+kD*kD);var kB=Math.atan2(kD,i);var T=kz+gL(kD);var kA=kB+gK(i);var e=T*Math.cos(kA);var kC=T*Math.sin(kA);return{lng:e+h0,lat:kC+hZ}}function a5(kE){var i=kE.lng-h0;var kD=kE.lat-hZ;var kz=Math.sqrt(i*i+kD*kD);var kB=Math.atan2(kD,i);var T=kz-gL(kD);var kA=kB-gK(i);var e=T*Math.cos(kA);var kC=T*Math.sin(kA);return{lng:e,lat:kC}}function gL(e){return Math.sin(e*fU*jg)*g9}function gK(e){return Math.cos(e*fU*jg)*g8}function av(T,i,e){return((i.lng-T.lng)*(e.lat-T.lat)-(e.lng-T.lng)*(i.lat-T.lat))}function h5(i,e){return Math.abs(i-e)<=hD}function gS(kz,T){var i=kz.lat*jg;var kE=kz.lng*jg;var e=T.lat*jg;var kD=T.lng*jg;var kB=Math.cos(i)*Math.cos(e);var kA=Math.cos(kE)*Math.cos(kD);var kG=Math.sin(i)*Math.sin(e);var kF=Math.sin(kE)*Math.sin(kD);var kH=kB*kA+kB*kF+kG;if(kH<-1){kH=-1}else{if(kH>1){kH=1}}var kC=Math.acos(kH)*iY;return kC}function l(kD,kC){var i=kD.lat*jg;var e=kC.lat*jg;var kz=kD.lng*jg;var T=kC.lng*jg;var kB=i-e;var kA=kz-T;var kE=Math.sin(kB/2)*Math.sin(kB/2)+Math.cos(i)*Math.cos(e)*Math.sin(kA/2)*Math.sin(kA/2);return 2*Math.asin(Math.sqrt(kE))*iY}function gQ(kE,T){var kG=bI(kE,T);var kF=180;var kD=90;var kC=-180;var kA=-90;var kB=T.sp;var kz=T.ep;kF=kB.lng<kz.lng?kB.lng:kz.lng;kD=kB.lat<kz.lat?kB.lat:kz.lat;kC=kB.lng<kz.lng?kB.lng:kz.lng;kA=kB.lat<kz.lat?kB.lat:kz.lat;if(kG.lng<=kC&&kG.lng>=kF&&kG.lng<=kA&&kG.lat>=kD){return gS(kE,kG)}else{var i=l(kE,T.sp);var e=l(kE,T.ep);return i<e?i:e}}function a7(i,e){}function bM(i,kz,e,T){return Math.sqrt((i-e)*(i-e)+(kz-T)*(kz-T))}function bI(kK,kC){var kB=kK.lng;var kJ=kK.lat;var kA=kC.sp.lng;var kI=kC.sp.lat;var T=kC.ep.lng;var kG=kC.ep.lat;var kH=kG-kI;var kF=kA-T;if(h5(kH,0)&&h5(kF,0)){return kC.sp}var kE=T*kI-kA*kG;var kD=kF*kB-kH*kJ;var e=kH*kH-kF*kF;var kz=kF*kD-kH*kE;var i=kH*kD+kF*kE;return{lng:kz/e,lat:-i/e}}function bQ(kz){var T=0;for(var e=0;e<ag;++e){if(c9[e]<=kz.lat){if(c9[(e+1)%ag]>kz.lat){if(av({lng:db[e],lat:c9[e]},{lng:db[(e+1)%ag],lat:c9[(e+1)%ag]},kz)>0){++T}}}else{if(c9[(e+1)%ag]<=kz.lat){if(av({lng:db[e],lat:c9[e]},{lng:db[(e+1)%ag],lat:c9[(e+1)%ag]},kz)<0){--T}}}}return T===0?fH:io}function ke(kz){var kC={};if(kz.lng<e8[0]-0.4||kz.lat<e8[1]-0.4||kz.lng>e8[2]+0.4||kz.lat>e8[3]+0.4){kC.lng=kz.lng;kC.lat=kz.lat;return kC}else{if(iz(kz,eQ,eP,iS)){kC=gz(kz);return kC}}var e=0;var kF=dR;var T=0;var kD=new hM();var kE=1;if(bQ(kz)===fH){for(var kB=0;kB<ag;++kB){var kA=new eH(db[kB],c9[kB],db[(kB+1)%ag],c9[(kB+1)%ag]);kD.ll.lng=kA.mbr.ll.lng-0.5;kD.ll.lat=kA.mbr.ll.lat-0.5;kD.ru.lng=kA.mbr.ru.lng+0.5;kD.ru.lat=kA.mbr.ru.lat+0.5;if(kD.contains(kz)===fH){continue}T=gQ(kz,kA);if(T<kF){kF=T}}if(kF<dR){e=(dR-kF)/dR;kE=2}}else{kE=3;e=1}var kG=gz(kz);kC={lng:kz.lng+(kG.lng-kz.lng)*e,lat:kz.lat+(kG.lat-kz.lat)*e};return kC}function fa(i){var T={};if(i.lng<v[0]-0.4||i.lat<v[1]-0.4||i.lng>v[2]+0.4||i.lat>v[3]+0.4){T.lng=i.lng;T.lat=i.lat;return T}else{if(iz(i,cg,ce,iS)){T=a5(i);return T}}var e=ke(i);if(i.lng===e.lng&&i.lat===e.lng){T.lng=i.lng;T.lat=i.lat;return T}return decryptPt1(i,ke)}function iP(i,e){if(e===3&&i instanceof cG){var T=ke(i);return new cG(T.lng,T.lat)}else{return i}}function eS(i,e){if(e===3&&i instanceof cG){var T=fa(i);return new cG(T.lng,T.lat)}else{if(e===5&&i instanceof cG){return new cG(i.lng,i.lat)}else{return i}}}function q(kB){if(!kB){kB={}}var kC=JSON.stringify(kB);var kA=0,T,kz,e;if(kC.length===0){return kA}for(T=0,e=kC.length;T<e;T++){kz=kC.charCodeAt(T);kA=((kA<<5)-kA)+kz;kA|=0}return kA}function dc(){var i=new Date().getTime();var e="xxxyxxxy".replace(/[xy]/g,function(kz){var T=(i+Math.random()*16)%16|0;i=Math.floor(i/16);return(kz=="x"?T:(T&3|8)).toString(16)});return e}function bj(e,i){return Math.atan2(i,e)*180/Math.PI}function dt(kC,T,i){var e=[],kB=[];e[0]=kC[0]-T[0];e[1]=kC[1]-T[1];kB[0]=i[0]-T[0];kB[1]=i[1]-T[1];var kA=e[0]*kB[0]+e[1]*kB[1];var kz=Math.sqrt((e[0]*e[0])+(e[1]*e[1]))*Math.sqrt(kB[0]*kB[0])+Math.sqrt(kB[1]*kB[1]);return Math.acos(kA/kz)/Math.PI*180}function g4(kD,T,i){var e=[],kC=[];e[0]=kD[0]-T[0];e[1]=kD[1]-T[1];kC[0]=i[0]-T[0];kC[1]=i[1]-T[1];var kA=e[0]*kC[1]-e[1]*kC[0];var kB=e[0]*kC[0]+e[1]*kC[1];var kz=Math.atan2(kA,kB);return kz*180/Math.PI}var b9=0;function gi(){return b9++}function bp(i,kB){var T=i.toLowerCase();var kz=T.lastIndexOf("?");var e=T.lastIndexOf("#");var kA=Math.max(kz,e);if(kA===-1){return i+"?"+kB}return i+"&"+kB}function a1(i,e,T,kz){return(i||0)<<24|(e||0)<<16|(T||0)<<8|(kz||0)}function gG(kA){if(kA instanceof Array&&kA.length>=3){var kz=kA[0]||0;var T=kA[1]||0;var e=kA[2]||0;var i=kA[3]||1}else{var kz=(kA)&255;var T=(kA>>8)&255;var e=(kA>>16)&255;var i=(kA>>24)&255}if(!kA){return 0}return kz+T*256+e*65536-1}function k(e){var i=true;var T=e.charAt(0);switch(T){case"\n":return"\\n";break;case"\r":return"\\r";break;case"'":return"\\'";break;case'"':return'\\"';break;case"&":return"\\&";break;case"\\":return"\\\\";break;case"\t":return"\\t";break;case"\b":return"\\b";break;case"\f":return"\\f";break;case"/":return"\\x2F";break;case"<":return"\\x3C";break;case">":return"\\x3E";break;default:i=false;break}if(!i){return e}}function b(kA){var T=kA;var kz="";var e=0;for(e=0;e<T.length;e++){kz=kz+k(T.charAt(e))}return kz}function bb(){if(!URL){return{origin:""}}try{var kz=window.location.href;var i=new URL(kz);return i}catch(T){return{origin:""}}}function jI(){var T=function(kN,kM){var kL={"\x6c\x78\x61\x78\x78":"\x78\x65\x61","\x61\x65\x65\x6d\x78":"\x61\x65\x61\x69","\x64\x64\x61\x78\x6d":function(kV,kU){return kV(kU)},"\x68\x6d\x61\x65\x61":"\x64\x61\x65","\x78\x65\x64\x65\x63":"\x6d\x64\x61","\x63\x61\x61\x78\x61":function(kV,kU){return kV+kU},"\x63\x61\x61\x68\x69":function(kV,kU){return kV(kU)},"\x6c\x61\x65\x78\x6d":function(kW,kV,kU){return kW(kV,kU)},"\x78\x69\x61\x61\x63":function(kU,kV){return kU(kV)},"\x65\x6d\x6c\x69\x65":function(kV,kU){return kV(kU)},"\x68\x6c\x65\x61\x61":function(kV,kU){return kV+kU},"\x64\x63\x61\x61\x68":function(kV,kU){return kV(kU)},"\x69\x61\x6d\x6c\x6d":function(kV,kU){return kV<kU}};var kK="\x31\x2e\x31\x2e\x32";function kJ(kW,kV){var kU=kL["\x6c\x78\x61\x78\x78"];while(kU!==kL["\x61\x65\x65\x6d\x78"]){switch(kU){case"\x61\x69\x6c":return kX;case"\x6d\x64\x61":for(var k0=0;k0<kY;k0++){var kZ=kL["\x64\x64\x61\x78\x6d"](kV,kW[k0]);kX["\x70\x75\x73\x68"](kZ)}kU="\x61\x69\x6c";break;case"\x78\x65\x61":var kY=kW["\x6c\x65\x6e\x67\x74\x68"];kU=kL["\x68\x6d\x61\x65\x61"];break;case kL["\x68\x6d\x61\x65\x61"]:var kX=[];kU=kL["\x78\x65\x64\x65\x63"];break}}}var kI,kH,kG,kF,kE,kD=decodeURIComponent,kC="\x43\x68\x61\x72",kB="";var kA=[T];kI="\x64\x65";kH="\x66\x72";kG="\x6f";kE=kL["\x63\x61\x61\x78\x61"](kH+kG,"\x6d");kF=kL["\x68\x6c\x65\x61\x61"]("\x43\x6f",kI);var kz=function(kU){return kL["\x63\x61\x61\x78\x61"](kU,kB)["\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72"][kE+kC+kF](kU)};var kT=function(kU){var kV={"\x65\x61\x6c\x68\x69":function(kX,kW){return kL["\x63\x61\x61\x68\x69"](kX,kW)}};return kL["\x6c\x61\x65\x78\x6d"](kJ,kU,function(kW){return kV["\x65\x61\x6c\x68\x69"](kz,kW)})};var kP=kT["\x63\x61\x6c\x6c"](kz,[39,34,37,96,60,120,97,65,98,66,99,67,100,68,101,69,102,70,103,110,109,111,112,48,49,50,51,52,53,54,55,56,57]);var kO=kJ([28782,27702,26416,25167,24183],function(kU){return kL["\x78\x69\x61\x61\x63"](kD,kU)});var kS=kT["\x63\x61\x6c\x6c"](kO,[22354,22749,24415,23346,22257,22688,24306,25174,23595,25547,22984,25690,22212,27547,21594,27210,23090,29193,22394,29368,29532,29459,29530,24146,24500,26352,27441,28788,29370,27673,26925,25249,24430]),kR={};kO=kL["\x64\x63\x61\x61\x68"](kT,kO);var kQ=new RegExp(kO["\x6a\x6f\x69\x6e"]("\x7c"));for(var kI=0;kL["\x69\x61\x6d\x6c\x6d"](kI,kP["\x6c\x65\x6e\x67\x74\x68"]);kI++){kR[kS[kI]]=kP[kI]}kM=kL["\x6c\x61\x65\x78\x6d"](kJ,kM["\x73\x70\x6c\x69\x74"](kB),function(kU){return kR[kU]||kU})["\x6a\x6f\x69\x6e"](kB);return kJ(kM["\x73\x70\x6c\x69\x74"](kQ),function(kU){return kL["\x65\x6d\x6c\x69\x65"](kD,kU)})}(this,"\x6c\u545a\u72b8\u577a\x74\x68\u624f\u545a\u735c\u5ef2\u735c\u545a\u6c36\x69\u5ef2\u545a\u545a\u58a0\u5e77\u56c4\u58a0\u59c8\x6c\x69\u6c36\u545a\u56c4\u58a0\u59c8\u545a\u6c36\u56c4\u56c4\u545a\u545a\u59c8\u5e77\x73\x75\u5c2b\x73\x74\x72\u624f\u59c8\u58a0\u56c4\u5ef2\u735c\u624f\x69\u72b8\u56c4\u545a\u58a0\x4f\u5a32\u6c36\x68\u58a0\u545a\u545a\u735c\u5e77\u58a0\x6c\u545a\x6c\x6c\u5e77\x68\u5ef2\u5ef2\u6c36\u735c\u545a\u735c\u6730\x48\u5e52\u6256\u5f6e\x50\u62a1\x50\u692d\x59\u6c19\u6256\u63cb\x51\x4f\u5e52\u706e\u59c8\x69\x6c\u6c36\x6c\u58a0\u59c8\u706e\u545a\u5ef2\u5ef2\u624f\u7209\u72ba\x4c\u66f0\x4f\u6c19\x52\u6c19\u6256\u6b9b\u62a1\u5f6e\u5f6e\u5e52\x4f\u5e77\u56c4\x6c\u545a\u56c4\x69\u6730\u59c8\u545a\u545a\u545a\u706e\u545a\u58a0\x6c\u5ef2\u735c\u6730\u5f5f\u66f0\u6c19\x73\x69\u577a\u72b8\u5f5f\u6b31\u6b9b\u6730\x73\x75\u5c2b\x73\x74\x72\x69\u72b8\u577a\u706e\u5ef2\u58a0\u545a\x6c\u56c4");(function(kB,kA){var kz=function(kC){while(--kC){kB.push(kB.shift())}};kz(++kA)}(T,491));var i=function(kB,kA){kB=kB-0;var kz=T[kB];return kz};function e(kE){var kD={"\x64\x6c\x65\x64\x69":function(kH,kG){return kH!==kG},"\x65\x78\x6c\x61\x6d":i("0x0"),"\x61\x78\x65\x6c\x64":function(kG,kH){return kG-kH},"\x65\x6d\x61\x6d\x65":i("0x1"),"\x69\x61\x65\x65\x78":i("0x2"),"\x64\x78\x63\x6c\x69":i("0x3"),"\x65\x64\x78\x63\x65":i("0x4"),"\x64\x68\x63\x6d\x68":function(kH,kG){return kH(kG)},"\x64\x64\x65\x65\x63":function(kH,kG){return kH(kG)},"\x63\x78\x64\x61\x6d":function(kH,kG){return kH+kG},"\x68\x78\x65\x65\x6d":i("0x5"),"\x78\x6c\x65\x6c\x6c":i("0x6")};var kC=i("0x5");while(kD[i("0x7")](kC,i("0x8"))){switch(kC){case kD[i("0x9")]:return i("0xa")+kA[i("0xb")](kD[i("0xc")](kA[i("0xd")],12));case kD[i("0xe")]:var kB=kD[i("0xf")];kC=kD[i("0x10")];break;case kD[i("0x11")]:var kA=kD["\x64\x68\x63\x6d\x68"](md5,kD[i("0x12")](md5,kz+kF)+kB);kC=kD[i("0x9")];break;case kD[i("0x10")]:var kz=kE[i("0x13")](kD[i("0x14")](kE[i("0x15")]("\x3f"),1));kC=i("0x4");break;case kD[i("0x16")]:var kF=kD[i("0x17")];kC=kD["\x65\x6d\x61\x6d\x65"];break}}}return e}function hl(){}e9.extend(hl,{Request:{INITIAL:-1,WAITING:0,LOADED:1,COMPLETED:2},Dependency:{poly:["marker"],layer:["poly"],hotspot:["poly"],infowindow:["marker","hotspot"],simpleInfowindow:["marker"],tools:["marker","poly"],mapgl:["glcommon","poly"],earth:["glcommon"],control:["scommon"],scommon:[],localSearch:["scommon"],otherSearch:["scommon"],route:["scommon"],buslineSearch:["route"],autocomplete:["scommon"],mvtParse:["marker","poly","style"]},MD5Mapping:{control:"ukmgac",marker:"l2iycb",poly:"nnsepm",layer:"$layer$",infowindow:"2yoep5",simpleInfowindow:"agebzw",hotspot:"apaimc",menu:"1s23eu",tools:"lsimi5",oppc:"l2jnc5",oppcgl:"thx3az",mapgl:"gc2jo4",markeranimation:"04w4lb",earth:"kk34sk",glcommon:"4ssg4y",localSearch:"d1yvcd",scommon:"3g3lml",otherSearch:"va0k22",route:"4iuut5",buslineSearch:"ohad2i",autocomplete:"qg5tli",style:"gv25kx",mvtParse:"2prmgu"},Config:{baseUrl:window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]?window._BMapSecurityConfig["serviceHost"]+"/getmodules?v=1.0&type=webgl":E.apiHost+"/getmodules?v=1.0&type=webgl",jsModPath:(aL.inMapHost?"":E.mapHost)+"/res/newui/",timeout:5000},delayFlag:false,Module:{modules:{},modulesNeedToLoad:[]},_getMd5ModsStr:function(kB){var kA=[];for(var kD=0,T=kB.length;kD<T;kD++){var kC=kB[kD];var e=this.MD5Mapping[kC];var kz="$"+kC+"$";if(e!==kz){kA.push(kC+"_"+e)}}return kA.join(",")},load:function(i,kB,kz){var e=this.getModuleInfo(i);if(e.status===this.Request.COMPLETED){if(kz===true){kB()}}else{if(e.status===this.Request.INITIAL){this.combine(i);this.addToLoadQueue(i);var T=this;if(T.delayFlag===false){T.delayFlag=true;setTimeout(function(){var kC=T.Config.baseUrl+"&mod="+T._getMd5ModsStr(T.Module.modulesNeedToLoad);g3.load(kC);T.Module.modulesNeedToLoad.length=0;T.delayFlag=false},1)}e.status=this.Request.WAITING;function kA(kE){var kD=T.getModuleInfo(i);if(kD.status!==T.Request.COMPLETED){if(window.map&&window.map.fire){var kC=new fW("onmod_timeout");kC.timeout=kE/1000;kC.moduleName=i;window.map.fire(kC)}}}setTimeout(kA,this.Config.timeout,this.Config.timeout);setTimeout(kA,this.Config.timeout*2,this.Config.timeout*2)}if(kB){e.callbacks.push(kB)}}},combine:function(e){if(e&&this.Dependency[e]){var kz=this.Dependency[e];for(var T=0;T<kz.length;T++){this.combine(kz[T]);if(!this.Module.modules[kz[T]]){this.addToLoadQueue(kz[T])}}}},addToLoadQueue:function(e){var i=this.getModuleInfo(e);if(i.status===this.Request.INITIAL){i.status=this.Request.WAITING;this.Module.modulesNeedToLoad.push(e)}},run:function(T,kz){var kD=this.getModuleInfo(T);var kG=this.Dependency[T];if(kG){for(var kB=0;kB<kG.length;kB++){var kC=this.getModuleInfo(kG[kB]);if(kC.status!==this.Request.COMPLETED){kC.modsNeedToRun.push({name:T,code:kz});return}}}try{eval(kz)}catch(kE){return}kD.status=this.Request.COMPLETED;for(var kB=0,kA=kD.callbacks.length;kB<kA;kB++){kD.callbacks[kB]()}kD.callbacks.length=0;for(kB=0;kB<kD.modsNeedToRun.length;kB++){var kF=kD.modsNeedToRun[kB];this.run(kF.name,kF.code)}kD.modsNeedToRun.length=0},getModuleInfo:function(i){var e;if(!this.Module.modules[i]){this.Module.modules[i]={status:this.Request.INITIAL,callbacks:[],modsNeedToRun:[]}}e=this.Module.modules[i];return e}});window._jsload=function(kA,kB){var i=hl.getModuleInfo(kA);i.status=hl.Request.LOADED;if(kB!==""){hl.run(kA,kB)}else{if(window.map&&window.map.fire){var e=new fW("ongetmodules_fail");e.moduleName=kA;window.map.fire(e)}var T=document.createElement("script");var kz=hl.MD5Mapping[kA];T.src=hl.Config.jsModPath+kA+"_"+kz+".js";document.getElementsByTagName("head")[0].appendChild(T)}};function c7(){this._timeData={}}var bE;if(typeof window!=="undefined"){bE=window}else{bE=self}c7.prototype.mark=function(e){this._timeData[e]=this._getTime()};c7.prototype.getMark=function(e){return this._timeData[e]};c7.prototype.getTime=function(i,e){return parseFloat((this._timeData[e]-this._timeData[i]).toFixed(2))};c7.prototype.print=function(){};c7.prototype.clear=function(){this._timeData={}};if(bE.performance&&bE.performance.now){c7.prototype._getTime=function(){return performance.now()}}else{c7.prototype._getTime=function(){return Date.now()}}!function(i,T){T(i.d3=i.d3||{})}(window,function(lc){function lu(lB,lC,T,lA){function e(i){return lB(i=new Date(+i)),i}return e.floor=e,e.ceil=function(i){return lB(i=new Date(i-1)),lC(i,1),lB(i),i},e.round=function(i){var lD=e(i),lE=e.ceil(i);return lE-i>i-lD?lD:lE},e.offset=function(i,lD){return lC(i=new Date(+i),null==lD?1:Math.floor(lD)),i},e.range=function(lE,i,lD){var lF=[];if(lE=e.ceil(lE),lD=null==lD?1:Math.floor(lD),!(i>lE&&lD>0)){return lF}do{lF.push(new Date(+lE))}while(lC(lE,lD),lB(lE),i>lE);return lF},e.filter=function(i){return lu(function(lD){for(;lB(lD),!i(lD);){lD.setTime(lD-1)}},function(lD,lE){for(;--lE>=0;){for(;lC(lD,1),!i(lD);){}}})},T&&(e.count=function(i,lD){return le.setTime(+i),li.setTime(+lD),lB(le),lB(li),Math.floor(T(le,li))},e.every=function(i){return i=Math.floor(i),isFinite(i)&&i>0?i>1?e.filter(lA?function(lD){return lA(lD)%i===0}:function(lD){return e.count(0,lD)%i===0}):e:null}),e}function lj(e){return lu(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,T){i.setDate(i.getDate()+7*T)},function(i,T){return(T-i-(T.getTimezoneOffset()-i.getTimezoneOffset())*ld)/lr})}function lb(e){return lu(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,T){i.setUTCDate(i.getUTCDate()+7*T)},function(i,T){return(T-i)/lr})}var le=new Date,li=new Date,lp=lu(function(){},function(i,T){i.setTime(+i+T)},function(i,T){return T-i});lp.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?lu(function(i){i.setTime(Math.floor(i/e)*e)},function(i,T){i.setTime(+i+T*e)},function(i,T){return(T-i)/e}):lp:null};var ly=lp.range,lw=1000,ld=60000,lt=3600000,ll=86400000,lr=604800000,kF=lu(function(e){e.setTime(Math.floor(e/lw)*lw)},function(i,T){i.setTime(+i+T*lw)},function(i,T){return(T-i)/lw},function(e){return e.getUTCSeconds()}),lv=kF.range,lk=lu(function(e){e.setTime(Math.floor(e/ld)*ld)},function(i,T){i.setTime(+i+T*ld)},function(i,T){return(T-i)/ld},function(e){return e.getMinutes()}),kN=lk.range,k7=lu(function(i){var T=i.getTimezoneOffset()*ld%lt;0>T&&(T+=lt),i.setTime(Math.floor((+i-T)/lt)*lt+T)},function(i,T){i.setTime(+i+T*lt)},function(i,T){return(T-i)/lt},function(e){return e.getHours()}),lq=k7.range,kX=lu(function(e){e.setHours(0,0,0,0)},function(i,T){i.setDate(i.getDate()+T)},function(i,T){return(T-i-(T.getTimezoneOffset()-i.getTimezoneOffset())*ld)/ll},function(e){return e.getDate()-1}),kE=kX.range,kU=lj(0),kW=lj(1),kA=lj(2),kS=lj(3),kH=lj(4),la=lj(5),lh=lj(6),kC=kU.range,k9=kW.range,kL=kA.range,k6=kS.range,lm=kH.range,k8=la.range,lx=lh.range,lo=lu(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(i,T){i.setMonth(i.getMonth()+T)},function(i,T){return T.getMonth()-i.getMonth()+12*(T.getFullYear()-i.getFullYear())},function(e){return e.getMonth()}),lz=lo.range,kR=lu(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(i,T){i.setFullYear(i.getFullYear()+T)},function(i,T){return T.getFullYear()-i.getFullYear()},function(e){return e.getFullYear()});kR.every=function(e){return isFinite(e=Math.floor(e))&&e>0?lu(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,T){i.setFullYear(i.getFullYear()+T*e)}):null};var kK=kR.range,lf=lu(function(e){e.setUTCSeconds(0,0)},function(i,T){i.setTime(+i+T*ld)},function(i,T){return(T-i)/ld},function(e){return e.getUTCMinutes()}),kZ=lf.range,kY=lu(function(e){e.setUTCMinutes(0,0,0)},function(i,T){i.setTime(+i+T*lt)},function(i,T){return(T-i)/lt},function(e){return e.getUTCHours()}),kV=kY.range,kT=lu(function(e){e.setUTCHours(0,0,0,0)},function(i,T){i.setUTCDate(i.getUTCDate()+T)},function(i,T){return(T-i)/ll},function(e){return e.getUTCDate()-1}),kQ=kT.range,kP=lb(0),kO=lb(1),kM=lb(2),kJ=lb(3),kI=lb(4),kD=lb(5),kB=lb(6),kz=kP.range,k5=kO.range,ls=kM.range,lg=kJ.range,ln=kI.range,k4=kD.range,k3=kB.range,k2=lu(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(i,T){i.setUTCMonth(i.getUTCMonth()+T)},function(i,T){return T.getUTCMonth()-i.getUTCMonth()+12*(T.getUTCFullYear()-i.getUTCFullYear())},function(e){return e.getUTCMonth()}),k1=k2.range,kG=lu(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(i,T){i.setUTCFullYear(i.getUTCFullYear()+T)},function(i,T){return T.getUTCFullYear()-i.getUTCFullYear()},function(e){return e.getUTCFullYear()});kG.every=function(e){return isFinite(e=Math.floor(e))&&e>0?lu(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,T){i.setUTCFullYear(i.getUTCFullYear()+T*e)}):null};var k0=kG.range;lc.timeInterval=lu,lc.timeMillisecond=lp,lc.timeMilliseconds=ly,lc.utcMillisecond=lp,lc.utcMilliseconds=ly,lc.timeSecond=kF,lc.timeSeconds=lv,lc.utcSecond=kF,lc.utcSeconds=lv,lc.timeMinute=lk,lc.timeMinutes=kN,lc.timeHour=k7,lc.timeHours=lq,lc.timeDay=kX,lc.timeDays=kE,lc.timeWeek=kU,lc.timeWeeks=kC,lc.timeSunday=kU,lc.timeSundays=kC,lc.timeMonday=kW,lc.timeMondays=k9,lc.timeTuesday=kA,lc.timeTuesdays=kL,lc.timeWednesday=kS,lc.timeWednesdays=k6,lc.timeThursday=kH,lc.timeThursdays=lm,lc.timeFriday=la,lc.timeFridays=k8,lc.timeSaturday=lh,lc.timeSaturdays=lx,lc.timeMonth=lo,lc.timeMonths=lz,lc.timeYear=kR,lc.timeYears=kK,lc.utcMinute=lf,lc.utcMinutes=kZ,lc.utcHour=kY,lc.utcHours=kV,lc.utcDay=kT,lc.utcDays=kQ,lc.utcWeek=kP,lc.utcWeeks=kz,lc.utcSunday=kP,lc.utcSundays=kz,lc.utcMonday=kO,lc.utcMondays=k5,lc.utcTuesday=kM,lc.utcTuesdays=ls,lc.utcWednesday=kJ,lc.utcWednesdays=lg,lc.utcThursday=kI,lc.utcThursdays=ln,lc.utcFriday=kD,lc.utcFridays=k4,lc.utcSaturday=kB,lc.utcSaturdays=k3,lc.utcMonth=k2,lc.utcMonths=k1,lc.utcYear=kG,lc.utcYears=k0,Object.defineProperty(lc,"__esModule",{value:!0})});function fj(e){this._elemType=e;this._objCollection={}}fj.prototype.get=function(){var i=null;for(var e in this._objCollection){if(this._objCollection[e]&&this._objCollection[e]._free===true){this._objCollection[e]._free=false;return this._objCollection[e]}}i=b6(this._elemType);e=bG.getGUID("obj_pool_");this._objCollection[e]=i;return i};fj.prototype.free=function(e){if(!e){return}e._free=true;if(e.tagName.toLowerCase()==="img"){e.src="";e.crossOrigin=null;e.onload=e.onerror=null}};fj.prototype.clear=function(){for(var e in this._objCollection){if(this._objCollection[e]&&this._objCollection[e].tagName.toLowerCase==="img"){this._objCollection[e].onload=this._objCollection[e].onerror=null}}this._objCollection={}};var ir={get:function(i,kA,e,T){var kz=new XMLHttpRequest();kz.open("GET",i,true);kz.timeout=10000;kz.ontimeout=function(){T&&T()};kz.onreadystatechange=function(kB){if(this.readyState===4){if(this.status===200){kA&&kA(kz.responseText)}else{e&&e()}}};kz.send()},post:function(i,kB,kA,e,T){var kz=new XMLHttpRequest();kz.open("POST",i,true);kz.setRequestHeader("Content-type","application/x-www-form-urlencoded");kz.timeout=10000;kz.ontimeout=function(){T&&T()};kz.onreadystatechange=function(kC){if(this.readyState===4){if(this.status===200){kA&&kA(kz.responseText,kB)}else{e&&e()}}};kz.send(kB);return kz}};var g3=(function(e){function i(kB,T,kA){if(kB.indexOf("v=")===-1){kB+="&v=gl"}var kz=b6("script",{src:kB,type:"text/javascript",charset:"utf-8"});if(kz.addEventListener){kz.addEventListener("load",function(kD){var kC=kD.target;kC.parentNode.removeChild(kC);T&&T()},false);kz.addEventListener("error",function(kD){if(kD){var kC=kD.target;kC&&kC.parentNode&&kC.parentNode.removeChild(kC)}kA&&kA(null)},false)}else{if(kz.attachEvent){kz.attachEvent("onreadystatechange",function(kD){var kC=window.event.srcElement;if(kC&&(kC.readyState==="loaded"||kC.readyState==="complete")){kC.parentNode.removeChild(kC)}T&&T()})}}e.getElementsByTagName("head")[0].appendChild(kz)}return{load:function(kC,T,kz){if(typeof kC==="string"){i(kC,T,kz)}else{if(kC.length>0){var kB=kC.length;for(var kA=0;kA<kB;kA++){i(kC[kA],function(){kB--;if(kB===0&&T){T()}})}}}}}})(window.document);function ik(){}ik.instances={};ik.getInstance=function(i,T){if(ik.instances[i]){return ik.instances[i]}var e=new ku(i,T);ik.instances[i]=e;return e};function ku(e,i){this._name=e;this._baseZoom=18;this._opts={tileSize:256};e9.extend(this._opts,i||{})}ku.mapZoomBaseIndex=[8,8,8,8,7,7,6,6,5,5,4,3,3,3,2,2,1,1,0,0,0,0,0,0,0,0];ku.baseScaleZoom=[19,17,15,12,10,9,7,5,3];ku.baseScaleZoomMercatorSize=[512,2048,4096,32768,65536,262144,1048576,4194304,8388608];ku.mapZoomBaseZoomMapping=[3,3,3,3,5,5,7,7,9,9,10,12,12,12,15,15,17,17,19,19,19,19,19,19,19,19];ku.mapZoomStartZoomMapping=[3,3,3,3,4,4,6,6,8,8,10,11,11,11,14,14,16,16,18,18,18,18,18,18,18,18];ku.baseScaleTileSize=[1024,1024,512,512,256,512,512,512,256];ku.mapZoomTileSize=[256,256,256,256,256,512,256,512,256,512,256,256,512,1024,256,512,512,1024,512,1024,2048,4096,4096*2,4096*2*2,4096*2*2*2,4096*2*2*2*2];ku.baseZoomInfo={"3":[3],"5":[4,5],"7":[6,7],"9":[8,9],"10":[10],"12":[11,12,13],"15":[14,15],"17":[16,17],"19":[18,19,20,21,22,23,24,25]};ku.prototype={getName:function(){return this._name},getTileSize:function(e){e=Math.floor(e);if(e<3){e=3}if(this._name==="na"){return ku.mapZoomTileSize[e]}return this._opts.tileSize},getBaseTileSize:function(i){i=Math.floor(i);if(this._name==="na"){var e=ku.mapZoomBaseZoomMapping[i];return ku.mapZoomTileSize[e]}return this._opts.tileSize},getDataZoom:function(e){e=Math.floor(e);if(this._name==="na"){return ku.mapZoomBaseZoomMapping[e]}return e},getZoomUnits:function(e){return Math.pow(2,(this._baseZoom-e))},getMercatorSize:function(T,i){if(this._name==="na"){T=Math.floor(T);var e=ku.mapZoomBaseIndex[T];return ku.baseScaleZoomMercatorSize[e]}return this._opts.tileSize*this.getZoomUnits(i)},getBaseZoom:function(){return this._baseZoom},getParentTile:function(kz,kF,kE,T,i){if(this._name==="na"){var kA=ku.baseZoomInfo[kE];T--;if(kA.indexOf(T)>-1){return{col:kz,row:kF,zoom:kE,useZoom:T}}else{var kC=ku.mapZoomBaseIndex[kE];var kB=ku.baseScaleZoom[kC+1];if(!kB){return null}var kD=this.getFactorByZooms(kB,kE);var e=ku.baseZoomInfo[kB];return{col:Math.floor(kz/kD),row:Math.floor(kF/kD),zoom:kB,useZoom:e[e.length-1]}}return null}if(kE-1<i){return null}return{col:Math.floor(kz/2),row:Math.floor(kF/2),zoom:kE-1,useZoom:kE-1}},getChildTiles:function(kA,kC,e,T,kJ,kP){if(this._name==="na"){var kz=ku.baseZoomInfo[e];T+=kP;if(kz.indexOf(T)>-1){return[{col:kA,row:kC,zoom:e,useZoom:T}]}else{var kN=0;var kK=e;while(kN<kP){var kO=ku.mapZoomBaseIndex[kK];var kE=ku.baseScaleZoom[kO-1];if(!kE){return null}var kF=ku.baseZoomInfo[kE];if(kF[kP-1]){var kG=[];var kI=this.getFactorByZooms(e,kE);var i=kA*kI;var kH=kC*kI;for(var kM=0;kM<kI;kM++){var kB=i+kM;for(var kL=0;kL<kI;kL++){var kD=kH+kL;kG.push({col:kB,row:kD,zoom:kE,useZoom:kF[kP-1]})}}return kG}kN+=kF.length;if(kP===kF.length){kK=kE}}}return null}var kG=[];if(e+kP>kJ){return null}var kI=Math.pow(2,kP);var i=kA*kI;var kH=kC*kI;var kE=e+kP;var kG=[];for(var kM=0;kM<2;kM++){var kB=i+kM;for(var kL=0;kL<2;kL++){var kD=kH+kL;kG.push({col:kB,row:kD,zoom:kE,useZoom:kE})}}return kG},getFactorByZooms:function(i,kz){var T=ku.mapZoomBaseIndex[i];var kA=ku.mapZoomBaseIndex[kz];var e=ku.baseScaleZoomMercatorSize[T];var kB=ku.baseScaleZoomMercatorSize[kA];return e/kB}};var df={};var ad=["swiftshader","microsoft basic render driver"];var hG=["intel","nvidia","amd","apple","geforce"];function gU(e){e=e.toLowerCase();if(ad.indexOf(e)>=0){return true}if(e.indexOf("mobile")>=0){return true}return false}function cI(T){T=T.toLowerCase();for(var e=0;e<hG.length;e++){if(T.indexOf(hG[e])>=0){return true}}return false}function ks(e){if(!e){return false}if(gU(e)){return false}if(cI(e)){return true}return false}df.ifEnableEarth=function(i){var e=df.ifEnableEarth;if(!i&&typeof e._enable==="boolean"){return e._enable}if(df.ifSupportWebGL()){e._enable=true;return true}e._enable=false;return false};df.ifEnableWebGLMap=function(i){var e=df.ifEnableWebGLMap;if(!i&&typeof e._enable==="boolean"){return e._enable}if(df.ifSupportWebGL()){if(aL.inMapHost){e._enable=true;return true}else{if(window.Blob||window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder){e._enable=true;return true}else{e._enable=false;return false}}}e._enable=false;return false};df.params={};df.ifSupportWebGL=function(){var i=df.ifSupportWebGL;if(typeof i._supportWebGL==="boolean"){return i._supportWebGL}if(!window.WebGLRenderingContext){i._supportWebGL=false;return false}var T=document.createElement("canvas");T.width=300;T.height=150;var kA=null;var kG={alpha:true,antialias:false,failIfMajorPerformanceCaveat:false,preserveDrawingBuffer:false,stencil:false};try{kA=T.getContext("webgl",kG)||T.getContext("experimental-webgl",kG)}catch(kC){i._supportWebGL=false}if(kA===null){i._supportWebGL=false}else{i._supportWebGL=true;var kE=kA.getExtension("WEBGL_debug_renderer_info");var kD="";if(kE){kD=kA.getParameter(kE.UNMASKED_RENDERER_WEBGL);if(ks(kD)===true){i._supportWebGL=true}var kF=kA.getParameter(kE.UNMASKED_VENDOR_WEBGL);i._renderer=kD;i._vendor=kF}if(!kE&&e9.Browser.firefox){i._supportWebGL=true}if(!kE&&e9.Platform.macintosh){i._supportWebGL=true}if(kA.drawingBufferWidth!==T.width||kA.drawingBufferHeight!==T.height){i._supportWebGL=false}if(kA.getParameter(kA.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<4){i._supportWebGL=false}var kz=kA.getParameter(kA.MAX_TEXTURE_SIZE);df.params.maxTextureSize=kz;if(kz<4096){i._supportWebGL=false}var kB=kA.getParameter(kA.MAX_TEXTURE_IMAGE_UNITS);if(kB<8){i._supportWebGL=false}if(kA.getShaderPrecisionFormat&&!kA.getShaderPrecisionFormat(kA.FRAGMENT_SHADER,kA.HIGH_FLOAT)){hP.sendMessage(a1(4,246,1,1),["monitor","ShaderPrecision","sys_"+kD]);return i._supportWebGL}if(!kA.getShaderPrecisionFormat||!kA.getShaderPrecisionFormat(kA.FRAGMENT_SHADER,kA.HIGH_FLOAT)){hP.sendMessage(a1(4,246,1,1),["monitor","ShaderPrecision","sys_"+kD]);return i._supportWebGL}if(!kA.getShaderPrecisionFormat||kA.getShaderPrecisionFormat(kA.FRAGMENT_SHADER,kA.HIGH_FLOAT).precision<23){i._supportWebGL=false}}return i._supportWebGL};df.ifSupportCanvas2d=function(){var kA=df.ifSupportCanvas2d;if(typeof kA.supportCanvas2d==="boolean"){return kA.supportCanvas2d}var T=document.createElement("canvas");var i=null;try{i=T.getContext("2d")}catch(kz){kA.supportCanvas2d=false}if(i===null){kA.supportCanvas2d=false}else{kA.supportCanvas2d=true}return kA.supportCanvas2d};df.ifCanvas2dInBlackList=function(){return true};df.ifEnableCanvas2dMap=function(){return false;var i=navigator.userAgent;var e=0;var kz=0;var kA=0;if(/macintosh/ig.test(i)){var T=0;if(/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(i)&&!/chrome/i.test(i)){T=parseInt((RegExp["\x241"]||RegExp["\x242"]),10)}if(T>0){return false}return true}if(/windows nt (\d+\.\d)/ig.test(i)){kz=parseFloat(RegExp.$1);if(kz>=6.1){if(/chrome\/(\d+\.\d)/i.test(i)){e=parseFloat(RegExp.$1);if(e>=31){return true}}if(/MSIE (\d+(\.\d+)?)/.test(i)){kA=parseFloat(RegExp.$1);if(kA>=10){return true}}if(/Firefox/.test(i)){return true}if(/rv:11.0/ig.test(i)){return true}if(/edge/ig.test(i)){return true}}}return false};df.ifSupportCSS3=function(kD,i){var kC=document.createElement("div");var kB="Webkit Moz O ms".split(" ");var e=kB.length;var T="";var kz=kC.style;if(kD in kz){T=kD}kD=kD.replace(/^[a-z]/,function(kE){return kE.toUpperCase()});while(e--){var kA=kB[e]+kD;if(kA in kz){T=kA;break}}if(i){return T}else{return T.length>0?true:false}};df.isModernBrowser=df.ifSupportCanvas2d()&&df.ifSupportCSS3("transform");function aC(i,e){this._size=i;this._curSize=0;this._cache={};this._least=null;this._most=null;this._options={clearCallback:null,removeOldCallback:null};e=e||{};for(var T in e){this._options[T]=e[T]}this._getDataTimes=0;this._hitTimes=0}aC.prototype.setData=function(kz,kB){var i=this._cache;var T=this._size;if(T===0){return}var e=this._curSize;if(e===T){this._removeOld()}var kA;if(!i[kz]){kA={key:kz,data:kB,older:null,newwer:null};i[kz]=kA;if(this._least===null){this._least=kA}if(this._most===null){this._most=kA}this._curSize++}else{kA=i[kz];kA.data=kB;if(this._most===kA){return}kA.older&&(kA.older.newer=kA.newer);kA.newer&&(kA.newer.older=kA.older);if(this._least===kA){this._least=kA.newer}}if(this._most&&this._most!==kA){this._most.newer=kA;kA.older=this._most;this._most=kA;kA.newer=null}};aC.prototype.getData=function(e){var i=this._cache[e];this._getDataTimes++;if(i){this._hitTimes++;var T=i.data;if(this._most===i){return T}i.older&&(i.older.newer=i.newer);i.newer&&(i.newer.older=i.older);if(this._least===i){this._least=i.newer}this._most.newer=i;i.older=this._most;i.newer=null;this._most=i;return T}return null};aC.prototype.getAllData=function(){return this._cache};aC.prototype.getHitRate=function(){return this._hitTimes/this._getDataTimes};aC.prototype.removeData=function(i){var e=this._cache;var T=e[i];if(!T){return}if(this._options.clearCallback){this._options.clearCallback(T.data,T.key)}T.older&&(T.older.newer=T.newer);T.newer&&(T.newer.older=T.older);if(this._least===T){this._least=T.newer}if(this._most===T){this._most=T.older}delete e[i];this._curSize--};aC.prototype._removeOld=function(){var e=this._cache;var kz=Math.round(this._size*0.6);var T=0;while(this._least&&T<kz){var i=this._least;this._least=i.newer;i.newer&&(i.newer.older=null);if(this._options.clearCallback){this._options.clearCallback(i.data,i.key)}delete e[i.key];T++}this._curSize-=T;if(this._options.removeOldCallback){this._options.removeOldCallback()}};aC.prototype.clear=function(){var e=this._cache;var i=this._least;if(this._options.clearCallback){while(i){this._options.clearCallback(i.data,i.key);i=i.newer}}this._least=this._most=null;this._cache={};this._curSize=0};aC.prototype.forEach=function(e){var i=this._least;while(i){e(i.data);i=i.newer}};aC.prototype.clearExcept=function(i){var e=this._cache;var T=this._least;while(T){if(!i[T.key]){if(this._options.clearCallback){this._options.clearCallback(T.data,T.key)}T.older&&(T.older.newer=T.newer);T.newer&&(T.newer.older=T.older);if(this._least===T){this._least=T.newer}if(this._most===T){this._most=T.older}delete e[T.key];this._curSize--}T=T.newer}};!function(T,i){"object"==typeof bG&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(T="undefined"!=typeof globalThis?globalThis:T||self).gcoord=i()}(this,(function(){var ld=function(){return(ld=Object.assign||function(li){for(var i,T=1,lk=arguments.length;T<lk;T++){for(var lj in i=arguments[T]){Object.prototype.hasOwnProperty.call(i,lj)&&(li[lj]=i[lj])}}return li}).apply(this,arguments)},kY=Math.sin,k0=Math.cos,k4=Math.sqrt,k3=Math.abs,lh=Math.PI,k9=6378245,kX=0.006693421622965823;function lc(T,i){return T>=72.004&&T<=137.8347&&i>=0.8293&&i<=55.8271}function lf(lk,lj){var ln,i,lp,T=(lp=300+(ln=lk-105)+2*(i=lj-35)+0.1*ln*ln+0.1*ln*i+0.1*k4(k3(ln)),lp+=2*(20*kY(6*ln*lh)+20*kY(2*ln*lh))/3,(lp+=2*(20*kY(ln*lh)+40*kY(ln/3*lh))/3)+2*(150*kY(ln/12*lh)+300*kY(ln/30*lh))/3),li=function(ls,lr){var lq=2*ls-100+3*lr+0.2*lr*lr+0.1*ls*lr+0.2*k4(k3(ls));return lq+=2*(20*kY(6*ls*lh)+20*kY(2*ls*lh))/3,lq+=2*(20*kY(lr*lh)+40*kY(lr/3*lh))/3,lq+2*(160*kY(lr/12*lh)+320*kY(lr*lh/30))/3}(lk-105,lj-35),lm=lj/180*lh,ll=kY(lm),lo=k4(ll=1-kX*ll*ll);return[T=180*T/(k9/lo*k0(lm)*lh),li=180*li/(k9*(1-kX)/(ll*lo)*lh)]}function k6(li){var i=li[0],T=li[1];if(!lc(i,T)){return[i,T]}var lj=lf(i,T);return[i+lj[0],T+lj[1]]}function kZ(lk){var lo=lk[0],T=lk[1];if(!lc(lo,T)){return[lo,T]}for(var li=[lo,T],lm=li[0],lj=li[1],ln=k6([lm,lj]),ll=ln[0]-lo,lp=ln[1]-T;k3(ll)>0.000001||k3(lp)>0.000001;){ll=(ln=k6([lm-=ll,lj-=lp]))[0]-lo,lp=ln[1]-T}return[lm,lj]}var la=Math.sin,lb=Math.cos,kH=Math.atan2,le=Math.sqrt,kW=3000*Math.PI/180;function k2(li){var i=li[0]-0.0065,T=li[1]-0.006,lk=le(i*i+T*T)-0.00002*la(T*kW),lj=kH(T,i)-0.000003*lb(i*kW);return[lk*lb(lj),lk*la(lj)]}function kL(li){var i=li[0],T=li[1],lk=le(i*i+T*T)+0.00002*la(T*kW),lj=kH(T,i)+0.000003*lb(i*kW);return[lk*lb(lj)+0.0065,lk*la(lj)+0.006]}var kT=180/Math.PI,kC=Math.PI/180,kE=6378137,lg=20037508.342789244;function kQ(i){return[i[0]*kT/kE,(0.5*Math.PI-2*Math.atan(Math.exp(-i[1]/kE)))*kT]}function k5(li){var i=Math.abs(li[0])<=180?li[0]:li[0]-360*(li[0]<0?-1:1),T=[kE*i*kC,kE*Math.log(Math.tan(0.25*Math.PI+0.5*li[1]*kC))];return T[0]>lg&&(T[0]=lg),T[0]<-lg&&(T[0]=-lg),T[1]>lg&&(T[1]=lg),T[1]<-lg&&(T[1]=-lg),T}var kP,kO,kN,kV,kK,kz,kU=Math.abs,k7=[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],kJ=[75,60,45,30,15,0],kB=[[1.410526172116255e-8,0.00000898305509648872,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-0.03801003308653,17337981.2],[-7.435856389565537e-9,0.000008983055097726239,-0.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,0.00000898305509983578,0.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,0.32710905363475,6856817.37],[-1.981981304930552e-8,0.000008983055099779535,0.03278182852591,40.31678527705744,0.65659298677277,-4.44255534477492,0.85341911805263,0.12923347998204,-0.04625736007561,4482777.06],[3.09191371068437e-9,0.000008983055096812155,0.00006995724062,23.10934304144901,-0.00023663490511,-0.6321817810242,-0.00663494467273,0.03430082397953,-0.00466043876332,2555164.4],[2.890871144776878e-9,0.000008983055095805407,-3.068298e-8,7.47137025468032,-0.00000353937994,-0.02145144861037,-0.00001234426596,0.00010322952773,-0.00000323890364,826088.5]],k8=[[-0.0015702102444,111320.7020616939,1704480524535203,-10338987376042340,26112667856603880,-35149669176653700,26595700718403920,-10725012454188240,1800819912950474,82.5],[0.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[0.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[0.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-0.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-0.0003218135878613132,111320.7020701615,0.00369383431289,823725.6402795718,0.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,0.37238884252424,7.45]];function kI(lj,T,li){var ll=kU(T)/li[9],lk=li[0]+li[1]*kU(lj),i=li[2]+li[3]*ll+li[4]*Math.pow(ll,2)+li[5]*Math.pow(ll,3)+li[6]*Math.pow(ll,4)+li[7]*Math.pow(ll,5)+li[8]*Math.pow(ll,6);return[lk*=lj<0?-1:1,i*=T<0?-1:1]}function k1(li){for(var i=li[0],T=li[1],lk=[],lj=0;lj<kJ.length;lj++){if(kU(T)>kJ[lj]){lk=k8[lj];break}}return kI(i,T,lk)}function kG(li){for(var i=li[0],T=li[1],lk=[],lj=0;lj<k7.length;lj++){if(T>=k7[lj]){lk=kB[lj];break}}return kI(i,T,lk)}function kF(T,i){if(!T){throw new Error(i)}}function kR(i){return !!i&&"[object Array]"===Object.prototype.toString.call(i)}function kM(i){return !isNaN(Number(i))&&null!==i&&!kR(i)}function kD(){for(var li=[],i=0;i<arguments.length;i++){li[i]=arguments[i]}var T=li.length-1;return function(){for(var lj=[],ll=0;ll<arguments.length;ll++){lj[ll]=arguments[ll]}for(var lk=T,e=li[T].apply(null,lj);lk--;){e=li[lk].call(null,e)}return e}}function kA(lz,lo,lq){if(void 0===lq&&(lq=!1),null!==lz){for(var lt,ls,lC,lv,ln,ly,lB,lu,lp=0,lw=0,lx=lz.type,lj="FeatureCollection"===lx,lA="Feature"===lx,lm=lj?lz.features.length:1,lr=0;lr<lm;lr++){ln=(lu=!!(lB=lj?lz.features[lr].geometry:lA?lz.geometry:lz)&&"GeometryCollection"===lB.type)?lB.geometries.length:1;for(var ll=0;ll<ln;ll++){var lk=0,T=0;if(null!==(lv=lu?lB.geometries[ll]:lB)){var li=lv.type;switch(lp=!lq||"Polygon"!==li&&"MultiPolygon"!==li?0:1,li){case null:break;case"Point":if(!1===lo(ly=lv.coordinates,lw,lr,lk,T)){return !1}lw++,lk++;break;case"LineString":case"MultiPoint":for(ly=lv.coordinates,lt=0;lt<ly.length;lt++){if(!1===lo(ly[lt],lw,lr,lk,T)){return !1}lw++,"MultiPoint"===li&&lk++}"LineString"===li&&lk++;break;case"Polygon":case"MultiLineString":for(ly=lv.coordinates,lt=0;lt<ly.length;lt++){for(ls=0;ls<ly[lt].length-lp;ls++){if(!1===lo(ly[lt][ls],lw,lr,lk,T)){return !1}lw++}"MultiLineString"===li&&lk++,"Polygon"===li&&T++}"Polygon"===li&&lk++;break;case"MultiPolygon":for(ly=lv.coordinates,lt=0;lt<ly.length;lt++){for(T=0,ls=0;ls<ly[lt].length;ls++){for(lC=0;lC<ly[lt][ls].length-lp;lC++){if(!1===lo(ly[lt][ls][lC],lw,lr,lk,T)){return !1}lw++}T++}lk++}break;case"GeometryCollection":for(lt=0;lt<lv.geometries.length;lt++){if(!1===kA(lv.geometries[lt],lo,lq)){return !1}}break;default:throw new Error("Unknown Geometry Type")}}}}}}!function(i){i.WGS84="WGS84",i.WGS1984="WGS84",i.EPSG4326="WGS84",i.GCJ02="GCJ02",i.AMap="GCJ02",i.BD09="BD09",i.BD09LL="BD09",i.Baidu="BD09",i.BMap="BD09",i.BD09MC="BD09MC",i.BD09Meter="BD09MC",i.EPSG3857="EPSG3857",i.EPSG900913="EPSG3857",i.EPSG102100="EPSG3857",i.WebMercator="EPSG3857",i.WM="EPSG3857"}(kz||(kz={}));var kS={WGS84:{to:(kP={},kP[kz.GCJ02]=k6,kP[kz.BD09]=kD(kL,k6),kP[kz.BD09MC]=kD(k1,kL,k6),kP[kz.EPSG3857]=k5,kP)},GCJ02:{to:(kO={},kO[kz.WGS84]=kZ,kO[kz.BD09]=kL,kO[kz.BD09MC]=kD(k1,kL),kO[kz.EPSG3857]=kD(k5,kZ),kO)},BD09:{to:(kN={},kN[kz.WGS84]=kD(kZ,k2),kN[kz.GCJ02]=k2,kN[kz.EPSG3857]=kD(k5,kZ,k2),kN[kz.BD09MC]=k1,kN)},EPSG3857:{to:(kV={},kV[kz.WGS84]=kQ,kV[kz.GCJ02]=kD(k6,kQ),kV[kz.BD09]=kD(kL,k6,kQ),kV[kz.BD09MC]=kD(k1,kL,k6,kQ),kV)},BD09MC:{to:(kK={},kK[kz.WGS84]=kD(kZ,k2,kG),kK[kz.GCJ02]=kD(k2,kG),kK[kz.EPSG3857]=kD(k5,kZ,k2,kG),kK[kz.BD09]=kG,kK)}};return ld(ld({},kz),{CRSTypes:kz,transform:function(lm,lk,ll){if(kF(!!lm,"The args[0] input coordinate is required"),kF(!!lk,"The args[1] original coordinate system is required"),kF(!!ll,"The args[2] target coordinate system is required"),lk===ll){return lm}var lo=kS[lk];kF(!!lo,"Invalid original coordinate system: "+lk);var ln=lo.to[ll];kF(!!ln,"Invalid target coordinate system: "+ll);var T=typeof lm;if(kF("string"===T||"object"===T,"Invalid input coordinate type: "+T),"string"===T){try{lm=JSON.parse(lm)}catch(lk){throw new Error("Invalid input coordinate: "+lm)}}var lj=!1;kR(lm)&&(kF(lm.length>=2,"Invalid input coordinate: "+lm),kF(kM(lm[0])&&kM(lm[1]),"Invalid input coordinate: "+lm),lm=lm.map(Number),lj=!0);var li=ln;return lj?li(lm):(kA(lm,(function(lp){var i;i=li(lp),lp[0]=i[0],lp[1]=i[1]})),lm)}})}));var hV={ColorRefTable:{aliceblue:["#f0f8ff","rgb(240,248,255)"],antiquewhite:["#faebd7","rgb(250,235,215)"],aqua:["#00ffff","rgb(0,255,255)"],aquamarine:["#7fffd4","rgb(127,255,212)"],azure:["#f0ffff","rgb(240,255,255)"],beige:["#f5f5dc","rgb(245,245,220)"],bisque:["#ffe4c4","rgb(255,228,196)"],black:["#000000","rgb(0,0,0)"],blanchedalmond:["#ffebcd","rgb(255,235,205)"],blue:["#0000ff","rgb(0,0,255)"],blueviolet:["#8a2be2","rgb(138,43,226)"],brown:["#a52a2a","rgb(165,42,42)"],burlywood:["#deb887","rgb(222,184,135)"],cadetblue:["#5f9ea0","rgb(95,158,160)"],chartreuse:["#7fff00","rgb(127,255,0)"],chocolate:["#d2691e","rgb(210,105,30)"],coral:["#ff7f50","rgb(255,127,80)"],cornflowerblue:["#6495ed","rgb(100,149,237)"],cornsilk:["#fff8dc","rgb(255,248,220)"],crimson:["#dc143c","rgb(220,20,60)"],cyan:["#00ffff","rgb(0,255,255)"],darkblue:["#00008b","rgb(0,0,139)"],darkcyan:["#008b8b","rgb(0,139,139)"],darkgoldenrod:["#b8860b","rgb(184,134,11)"],darkgray:["#a9a9a9","rgb(169,169,169)"],darkgreen:["#006400","rgb(0,100,0)"],darkgrey:["#a9a9a9","rgb(169,169,169)"],darkkhaki:["#bdb76b","rgb(189,183,107)"],darkmagenta:["#8b008b","rgb(139,0,139)"],darkolivegreen:["#556b2f","rgb(85,107,47)"],darkorange:["#ff8c00","rgb(255,140,0)"],darkorchid:["#9932cc","rgb(153,50,204)"],darkred:["#8b0000","rgb(139,0,0)"],darksalmon:["#e9967a","rgb(233,150,122)"],darkseagreen:["#8fbc8f","rgb(143,188,143)"],darkslateblue:["#483d8b","rgb(72,61,139)"],darkslategray:["#2f4f4f","rgb(47,79,79)"],darkslategrey:["#2f4f4f","rgb(47,79,79)"],darkturquoise:["#00ced1","rgb(0,206,209)"],darkviolet:["#9400d3","rgb(148,0,211)"],deeppink:["#ff1493","rgb(255,20,147)"],deepskyblue:["#00bfff","rgb(0,191,255)"],dimgray:["#696969","rgb(105,105,105)"],dimgrey:["#696969","rgb(105,105,105)"],dodgerblue:["#1e90ff","rgb(30,144,255)"],firebrick:["#b22222","rgb(178,34,34)"],floralwhite:["#fffaf0","rgb(255,250,240)"],forestgreen:["#228b22","rgb(34,139,34)"],fuchsia:["#ff00ff","rgb(255,0,255)"],gainsboro:["#dcdcdc","rgb(220,220,220)"],ghostwhite:["#f8f8ff","rgb(248,248,255)"],gold:["#ffd700","rgb(255,215,0)"],goldenrod:["#daa520","rgb(218,165,32)"],gray:["#808080","rgb(128,128,128)"],green:["#008000","rgb(0,128,0)"],greenyellow:["#adff2f","rgb(173,255,47)"],grey:["#808080","rgb(128,128,128)"],honeydew:["#f0fff0","rgb(240,255,240)"],hotpink:["#ff69b4","rgb(255,105,180)"],indianred:["#cd5c5c","rgb(205,92,92)"],indigo:["#4b0082","rgb(75,0,130)"],ivory:["#fffff0","rgb(255,255,240)"],khaki:["#f0e68c","rgb(240,230,140)"],lavender:["#e6e6fa","rgb(230,230,250)"],lavenderblush:["#fff0f5","rgb(255,240,245)"],lawngreen:["#7cfc00","rgb(124,252,0)"],lemonchiffon:["#fffacd","rgb(255,250,205)"],lightblue:["#add8e6","rgb(173,216,230)"],lightcoral:["#f08080","rgb(240,128,128)"],lightcyan:["#e0ffff","rgb(224,255,255)"],lightgoldenrodyellow:["#fafad2","rgb(250,250,210)"],lightgray:["#d3d3d3","rgb(211,211,211)"],lightgreen:["#90ee90","rgb(144,238,144)"],lightgrey:["#d3d3d3","rgb(211,211,211)"],lightpink:["#ffb6c1","rgb(255,182,193)"],lightsalmon:["#ffa07a","rgb(255,160,122)"],lightseagreen:["#20b2aa","rgb(32,178,170)"],lightskyblue:["#87cefa","rgb(135,206,250)"],lightslategray:["#778899","rgb(119,136,153)"],lightslategrey:["#778899","rgb(119,136,153)"],lightsteelblue:["#b0c4de","rgb(176,196,222)"],lightyellow:["#ffffe0","rgb(255,255,224)"],lime:["#00ff00","rgb(0,255,0)"],limegreen:["#32cd32","rgb(50,205,50)"],linen:["#faf0e6","rgb(250,240,230)"],magenta:["#ff00ff","rgb(255,0,255)"],maroon:["#800000","rgb(128,0,0)"],mediumaquamarine:["#66cdaa","rgb(102,205,170)"],mediumblue:["#0000cd","rgb(0,0,205)"],mediumorchid:["#ba55d3","rgb(186,85,211)"],mediumpurple:["#9370db","rgb(147,112,219)"],mediumseagreen:["#3cb371","rgb(60,179,113)"],mediumslateblue:["#7b68ee","rgb(123,104,238)"],mediumspringgreen:["#00fa9a","rgb(0,250,154)"],mediumturquoise:["#48d1cc","rgb(72,209,204)"],mediumvioletred:["#c71585","rgb(199,21,133)"],midnightblue:["#191970","rgb(25,25,112)"],mintcream:["#f5fffa","rgb(245,255,250)"],mistyrose:["#ffe4e1","rgb(255,228,225)"],moccasin:["#ffe4b5","rgb(255,228,181)"],navajowhite:["#ffdead","rgb(255,222,173)"],navy:["#000080","rgb(0,0,128)"],oldlace:["#fdf5e6","rgb(253,245,230)"],olive:["#808000","rgb(128,128,0)"],olivedrab:["#6b8e23","rgb(107,142,35)"],orange:["#ffa500","rgb(255,165,0)"],orangered:["#ff4500","rgb(255,69,0)"],orchid:["#da70d6","rgb(218,112,214)"],palegoldenrod:["#eee8aa","rgb(238,232,170)"],palegreen:["#98fb98","rgb(152,251,152)"],paleturquoise:["#afeeee","rgb(175,238,238)"],palevioletred:["#db7093","rgb(219,112,147)"],papayawhip:["#ffefd5","rgb(255,239,213)"],peachpuff:["#ffdab9","rgb(255,218,185)"],peru:["#cd853f","rgb(205,133,63)"],pink:["#ffc0cb","rgb(255,192,203)"],plum:["#dda0dd","rgb(221,160,221)"],powderblue:["#b0e0e6","rgb(176,224,230)"],purple:["#800080","rgb(128,0,128)"],red:["#ff0000","rgb(255,0,0)"],rosybrown:["#bc8f8f","rgb(188,143,143)"],royalblue:["#4169e1","rgb(65,105,225)"],saddlebrown:["#8b4513","rgb(139,69,19)"],salmon:["#fa8072","rgb(250,128,114)"],sandybrown:["#f4a460","rgb(244,164,96)"],seagreen:["#2e8b57","rgb(46,139,87)"],seashell:["#fff5ee","rgb(255,245,238)"],sienna:["#a0522d","rgb(160,82,45)"],silver:["#c0c0c0","rgb(192,192,192)"],skyblue:["#87ceeb","rgb(135,206,235)"],slateblue:["#6a5acd","rgb(106,90,205)"],slategray:["#708090","rgb(112,128,144)"],slategrey:["#708090","rgb(112,128,144)"],snow:["#fffafa","rgb(255,250,250)"],springgreen:["#00ff7f","rgb(0,255,127)"],steelblue:["#4682b4","rgb(70,130,180)"],tan:["#d2b48c","rgb(210,180,140)"],teal:["#008080","rgb(0,128,128)"],thistle:["#d8bfd8","rgb(216,191,216)"],tomato:["#ff6347","rgb(255,99,71)"],turquoise:["#40e0d0","rgb(64,224,208)"],violet:["#ee82ee","rgb(238,130,238)"],wheat:["#f5deb3","rgb(245,222,179)"],white:["#ffffff","rgb(255,255,255)"],whitesmoke:["#f5f5f5","rgb(245,245,245)"],yellow:["#ffff00","rgb(255,255,0)"],yellowgreen:["#9acd32","rgb(154,205,50)"]},regGroup:{hex:/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,rgb:/rgb\(\s*(\d|\d\d|1\d\d|2[0-4]\d|25[0-5])\s*,\s*(\d|\d\d|1\d\d|2[0-4]\d|25[0-5])\s*,\s*(\d|\d\d|1\d\d|2[0-4]\d|25[0-5])\s*\)/,rgba:/rgba\(\s*(\d|\d\d|1\d\d|2[0-4]\d|25[0-5])\s*,\s*(\d|\d\d|1\d\d|2[0-4]\d|25[0-5])\s*,\s*(\d|\d\d|1\d\d|2[0-4]\d|25[0-5])\s*,\s*(0|1|0\.[1-9])\s*\)/},parseHexToRgbaArray:function(kB){var kC=kB.replace("#","");if(kC.length===3){kC+="f"}else{if(kC.length===6){kC+="ff"}}var e=[];var kA=kC.length;var kz=kA===8?2:1;for(var T=0;T<kA;T=T+kz){if(kz===2){e.push(parseInt(kC.slice(T,T+2),16))}else{e.push(parseInt(kC.slice(T,T+1)+kC.slice(T,T+1),16))}}return e},parseRgbaStrToArray:function(i){var e=[0,0,0,255];if(i.indexOf("rgba(")===0){var kz=i.replace("rgba(","").replace(")","");var T=kz.split(",");e[0]=parseInt(T[0],10);e[1]=parseInt(T[1],10);e[2]=parseInt(T[2],10);e[3]=Math.round(parseFloat(T[3])*255)}else{if(i.indexOf("rgb(")===0){var kz=i.replace("rgb(","").replace(")","");var kA=kz.split(",");e[0]=parseInt(kA[0],10);e[1]=parseInt(kA[1],10);e[2]=parseInt(kA[2],10);e[3]=255}}return e},parseHexAndOpacityToRgbaArray:function(kA,kB){var T=[];var kE=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;var kD=kA.toLowerCase();if(kE.test(kD)){if(kD.length===4){var e="#";for(var kC=1;kC<4;kC++){e+=kD.slice(kC,kC+1).concat(kD.slice(kC,kC+1))}kD=e}for(var kz=1;kz<7;kz+=2){T.push(parseInt(kD.slice(kz,kz+2),16))}T.push(kB)}return T},parseCSSColor:function(e){if(e.indexOf("#")===0){return hV.parseHexToRgbaArray(e)}return hV.parseRgbaStrToArray(e)},rgbToHSV:function(kA){var e=kA[0]/255;var T=kA[1]/255;var kB=kA[2]/255;var kE=Math.max(e,T,kB);var kz=Math.min(e,T,kB);var kD=kE-kz;var i;if(kD===0){i=0}else{if(kE===e){i=60*(((T-kB)/kD)%6)}else{if(kE===T){i=60*((kB-e)/kD+2)}else{if(kE===kB){i=60*((e-T)/kD+4)}}}}var kF=kE===0?0:(kD/kE);var kC=kE;while(i<0){i+=360}return[i,kF,kC]},hsvToRGB:function(kz){var kD=kz[2]*kz[1];var T=kD*(1-Math.abs((kz[0]/60)%2-1));var i=kz[2]-kD;var kA=kz[0];var kC;var kB;var e;if(kA>=0&&kA<60){kC=kD;kB=T;e=0}else{if(kA>=60&&kA<120){kC=T;kB=kD;e=0}else{if(kA>=120&&kA<180){kC=0;kB=kD;e=T}else{if(kA>=180&&kA<240){kC=0;kB=T;e=kD}else{if(kA>=240&&kA<300){kC=T;kB=0;e=kD}else{if(kA>=300&&kA<360){kC=kD;kB=0;e=T}}}}}}kC=(kC+i)*255>255?255:(kC+i)*255;kB=(kB+i)*255>255?255:(kB+i)*255;e=(e+i)*255>255?255:(e+i)*255;return[Math.round(kC),Math.round(kB),Math.round(e)]},formatColorCssToRgbaArray:function(kB,T,kz){kz=(typeof kz!=="boolean")?true:kz;if(typeof kB!=="string"){return kz?[0,0,0,1]:[0,0,0,255]}var i=(kB||"Black").trim().toLowerCase();var e=[];var kA=hV.ColorRefTable[i];if(kA!==undefined){i=kA[0]}e=hV.parseCSSColor(i);if(T!==undefined&&!isNaN(Number(T))){T=Number(T);e[3]=hV.fitTo(T,0,1)}else{e[3]=Number((e[3]/255).toFixed(2))}if(!kz){e[3]=Math.floor(e[3]*255)}return e},fitTo:function(T,i,e){if(T<i){T=i}else{if(T>e){T=e}}return T},generateColorRamp:function(e,kF,kG,kz,kL){kG=kG||[];kz=kz||"#ccc";kL=kL||1;const T=document.createElement("canvas");const kM=T.getContext("2d");T.width=256;T.height=kL;const kB=kF[0];const kI=kF[kF.length-1];if(e.length===kF.length){const kJ=kM.createLinearGradient(0,0,256,1);for(var kE=0;kE<e.length;++kE){var kK=(kF[kE]-kB)/(kI-kB);kJ.addColorStop(kK,e[kE])}kM.fillStyle=kJ;kM.fillRect(0,0,256,kL)}else{if(e.length-kF.length===-1){var kD=0;var kA=1;for(var kE=0;kE<e.length;++kE){var kH=(kF[kA]-kB)/(kI-kB);var kK=Math.floor(kH*256);kM.fillStyle=e[kE];kM.fillRect(kD,0,kK,kL);kD=kK;kA++}}else{kM.fillStyle=kz||"#ccc";kM.fillRect(0,0,256,kL)}}if(e.length-kF.length<=-1&&kG.length===2){kM.fillStyle=kz||"#ccc";var kH=(kG[0]-kB)/(kI-kB);var kK=Math.floor(kH*256);kM.fillRect(0,0,kK,kL);kH=(kG[1]-kB)/(kI-kB);kK=Math.floor(kH*256);kM.fillRect(kK,0,255,kL)}var kC=new Uint8Array(new Uint8ClampedArray(kM.getImageData(0,0,256,kL).data));return{canvas:T,data:kC,width:256,height:kL}},validateColor:function(e,i){return hV.regGroup[i].test(e)},convert2rgba:function(e,i){if(i===undefined){i=1}if(hV.validateColor(e,"rgba")){return e}if(hV.validateColor(e,"rgb")){e=e.replace(/rgb/g,"rgba");e=e.replace(/\)/,","+i+")");return e}var T=hV.formatColorCssToRgbaArray(e,i,true);return"rgba("+T.join(",")+")"}};(function(kB){function kL(kQ,kT){var kS=(kQ&65535)+(kT&65535);var kR=(kQ>>16)+(kT>>16)+(kS>>16);return(kR<<16)|(kS&65535)}function kK(kQ,kR){return(kQ<<kR)|(kQ>>>(32-kR))}function kF(kV,kS,kR,kQ,kU,kT){return kL(kK(kL(kL(kS,kV),kL(kQ,kT)),kU),kR)}function e(kS,kR,kW,kV,kQ,kU,kT){return kF((kR&kW)|(~kR&kV),kS,kR,kQ,kU,kT)}function kC(kS,kR,kW,kV,kQ,kU,kT){return kF((kR&kV)|(kW&~kV),kS,kR,kQ,kU,kT)}function kI(kS,kR,kW,kV,kQ,kU,kT){return kF(kR^kW^kV,kS,kR,kQ,kU,kT)}function kO(kS,kR,kW,kV,kQ,kU,kT){return kF(kW^(kR|~kV),kS,kR,kQ,kU,kT)}function T(k0,kV){k0[kV>>5]|=128<<(kV%32);k0[((kV+64)>>>9<<4)+14]=kV;var kS;var kU;var kT;var kR;var kQ;var kZ=1732584193;var kY=-271733879;var kX=-1732584194;var kW=271733878;for(kS=0;kS<k0.length;kS+=16){kU=kZ;kT=kY;kR=kX;kQ=kW;kZ=e(kZ,kY,kX,kW,k0[kS],7,-680876936);kW=e(kW,kZ,kY,kX,k0[kS+1],12,-389564586);kX=e(kX,kW,kZ,kY,k0[kS+2],17,606105819);kY=e(kY,kX,kW,kZ,k0[kS+3],22,-1044525330);kZ=e(kZ,kY,kX,kW,k0[kS+4],7,-176418897);kW=e(kW,kZ,kY,kX,k0[kS+5],12,1200080426);kX=e(kX,kW,kZ,kY,k0[kS+6],17,-1473231341);kY=e(kY,kX,kW,kZ,k0[kS+7],22,-45705983);kZ=e(kZ,kY,kX,kW,k0[kS+8],7,1770035416);kW=e(kW,kZ,kY,kX,k0[kS+9],12,-1958414417);kX=e(kX,kW,kZ,kY,k0[kS+10],17,-42063);kY=e(kY,kX,kW,kZ,k0[kS+11],22,-1990404162);kZ=e(kZ,kY,kX,kW,k0[kS+12],7,1804603682);kW=e(kW,kZ,kY,kX,k0[kS+13],12,-40341101);kX=e(kX,kW,kZ,kY,k0[kS+14],17,-1502002290);kY=e(kY,kX,kW,kZ,k0[kS+15],22,1236535329);kZ=kC(kZ,kY,kX,kW,k0[kS+1],5,-165796510);kW=kC(kW,kZ,kY,kX,k0[kS+6],9,-1069501632);kX=kC(kX,kW,kZ,kY,k0[kS+11],14,643717713);kY=kC(kY,kX,kW,kZ,k0[kS],20,-373897302);kZ=kC(kZ,kY,kX,kW,k0[kS+5],5,-701558691);kW=kC(kW,kZ,kY,kX,k0[kS+10],9,38016083);kX=kC(kX,kW,kZ,kY,k0[kS+15],14,-660478335);kY=kC(kY,kX,kW,kZ,k0[kS+4],20,-405537848);kZ=kC(kZ,kY,kX,kW,k0[kS+9],5,568446438);kW=kC(kW,kZ,kY,kX,k0[kS+14],9,-1019803690);kX=kC(kX,kW,kZ,kY,k0[kS+3],14,-187363961);kY=kC(kY,kX,kW,kZ,k0[kS+8],20,1163531501);kZ=kC(kZ,kY,kX,kW,k0[kS+13],5,-1444681467);kW=kC(kW,kZ,kY,kX,k0[kS+2],9,-51403784);kX=kC(kX,kW,kZ,kY,k0[kS+7],14,1735328473);kY=kC(kY,kX,kW,kZ,k0[kS+12],20,-1926607734);kZ=kI(kZ,kY,kX,kW,k0[kS+5],4,-378558);kW=kI(kW,kZ,kY,kX,k0[kS+8],11,-2022574463);kX=kI(kX,kW,kZ,kY,k0[kS+11],16,1839030562);kY=kI(kY,kX,kW,kZ,k0[kS+14],23,-35309556);kZ=kI(kZ,kY,kX,kW,k0[kS+1],4,-1530992060);kW=kI(kW,kZ,kY,kX,k0[kS+4],11,1272893353);kX=kI(kX,kW,kZ,kY,k0[kS+7],16,-155497632);kY=kI(kY,kX,kW,kZ,k0[kS+10],23,-1094730640);kZ=kI(kZ,kY,kX,kW,k0[kS+13],4,681279174);kW=kI(kW,kZ,kY,kX,k0[kS],11,-358537222);kX=kI(kX,kW,kZ,kY,k0[kS+3],16,-722521979);kY=kI(kY,kX,kW,kZ,k0[kS+6],23,76029189);kZ=kI(kZ,kY,kX,kW,k0[kS+9],4,-640364487);kW=kI(kW,kZ,kY,kX,k0[kS+12],11,-421815835);kX=kI(kX,kW,kZ,kY,k0[kS+15],16,530742520);kY=kI(kY,kX,kW,kZ,k0[kS+2],23,-995338651);kZ=kO(kZ,kY,kX,kW,k0[kS],6,-198630844);kW=kO(kW,kZ,kY,kX,k0[kS+7],10,1126891415);kX=kO(kX,kW,kZ,kY,k0[kS+14],15,-1416354905);kY=kO(kY,kX,kW,kZ,k0[kS+5],21,-57434055);kZ=kO(kZ,kY,kX,kW,k0[kS+12],6,1700485571);kW=kO(kW,kZ,kY,kX,k0[kS+3],10,-1894986606);kX=kO(kX,kW,kZ,kY,k0[kS+10],15,-1051523);kY=kO(kY,kX,kW,kZ,k0[kS+1],21,-2054922799);kZ=kO(kZ,kY,kX,kW,k0[kS+8],6,1873313359);kW=kO(kW,kZ,kY,kX,k0[kS+15],10,-30611744);kX=kO(kX,kW,kZ,kY,k0[kS+6],15,-1560198380);kY=kO(kY,kX,kW,kZ,k0[kS+13],21,1309151649);kZ=kO(kZ,kY,kX,kW,k0[kS+4],6,-145523070);kW=kO(kW,kZ,kY,kX,k0[kS+11],10,-1120210379);kX=kO(kX,kW,kZ,kY,k0[kS+2],15,718787259);kY=kO(kY,kX,kW,kZ,k0[kS+9],21,-343485551);kZ=kL(kZ,kU);kY=kL(kY,kT);kX=kL(kX,kR);kW=kL(kW,kQ)}return[kZ,kY,kX,kW]}function kJ(kR){var kS;var kQ="";var kT=kR.length*32;for(kS=0;kS<kT;kS+=8){kQ+=String.fromCharCode((kR[kS>>5]>>>(kS%32))&255)}return kQ}function kE(kR){var kT;var kQ=[];kQ[(kR.length>>2)-1]=undefined;for(kT=0;kT<kQ.length;kT+=1){kQ[kT]=0}var kS=kR.length*8;for(kT=0;kT<kS;kT+=8){kQ[kT>>5]|=(kR.charCodeAt(kT/8)&255)<<(kT%32)}return kQ}function kD(kQ){return kJ(T(kE(kQ),kQ.length*8))}function kP(kS,kV){var kR;var kU=kE(kS);var kQ=[];var kT=[];var kW;kQ[15]=kT[15]=undefined;if(kU.length>16){kU=T(kU,kS.length*8)}for(kR=0;kR<16;kR+=1){kQ[kR]=kU[kR]^909522486;kT[kR]=kU[kR]^1549556828}kW=T(kQ.concat(kE(kV)),512+kV.length*8);return kJ(T(kT.concat(kW),512+128))}function kN(kT){var kS="0123456789abcdef";var kR="";var kQ;var kU;for(kU=0;kU<kT.length;kU+=1){kQ=kT.charCodeAt(kU);kR+=kS.charAt((kQ>>>4)&15)+kS.charAt(kQ&15)}return kR}function kG(kQ){return unescape(encodeURIComponent(kQ))}function kz(kQ){return kD(kG(kQ))}function kH(kQ){return kN(kz(kQ))}function i(kQ,kR){return kP(kG(kQ),kG(kR))}function kM(kQ,kR){return kN(i(kQ,kR))}function kA(kR,kS,kQ){if(!kS){if(!kQ){return kH(kR)}return kz(kR)}if(!kQ){return kM(kS,kR)}return i(kS,kR)}if(typeof define==="function"&&define.amd){define(function(){return kA})}else{if(typeof module==="object"&&module.exports){module.exports=kA}else{kB.md5=kA}}})(this);var cT={levels:{INFO:"info",WARNING:"warning",ERROR:"error"},category:{JS:"js",RESOURCE:"resource",AJAX:"ajax"},config:{jsError:true,resourceError:true,ajaxError:true},hosts:"api.map.baidu.com|webmap0.bdimg.com|maponline0.bdimg.com|",ignoreUrl:"api.map.baidu.com/images/blank.gif",sender:true,collections:[],sendError:function(){},init:function(i,e,T){this.hosts+=i?i:"";au&&au(this.config,e);this.sender=true;if(T){this.sender=false}this.hosts=this.urlScope(this.hosts);this.sendError=this.notifyError();var kz=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};this.config.jsError&&this.handleJavaScriptError(kz);this.config.resourceError&&this.handleResourceError(kz);this.config.ajaxError&&this.handleAjaxError(kz)},handleJavaScriptError:function(T){var e=this;var i=T.onerror;T.onerror=function(kD,kC,kz,kB,kA){if(e.isFetch(e.category.JS)&&e.hostExit(kC)){if(kA&&kA.stack){e.sendError({title:kD,msg:kA.stack,category:e.category.JS,level:e.levels.ERROR})}else{if(typeof kD==="string"){e.sendError({title:kD,msg:JSON.stringify({resourceUrl:kC,rowNum:kz,colNum:kB}),category:"js",level:e.levels.ERROR})}}}if(i&&b0(i)){i&&i.apply(T,arguments)}}},handleResourceError:function(i){var e=this;i.addEventListener("error",function(kB){if(kB){var kC=kB.target||kB.srcElement;var kA=kC instanceof HTMLScriptElement||kC instanceof HTMLLinkElement||kC instanceof HTMLImageElement;if(!kA){if(!i.onerror){var T=kB.filename||null;if(!e.isFetch(e.category.JS)||!e.hostExit(T)){return}if(kB.error&&kB.error.stack){e.sendError({title:kB.message,msg:kB.error.stack,category:e.category.JS,level:e.levels.ERROR})}else{if(typeof kB.message==="string"){e.sendError({title:kB.message,msg:JSON.stringify({resourceUrl:T,rowNum:kB.lineno,colNum:kB.cowno}),category:e.category.JS,level:e.levels.ERROR})}}}return}var kz=kC.src||kC.href;if(e.isFetch(e.category.RESOURCE)&&e.hostExit(kz)){e.sendError({title:kC.nodeName,msg:kz,category:e.category.RESOURCE,level:e.levels.ERROR})}}},true)},handleAjaxError:function(kB){var e=this;var kA=kB.location.protocol;if(kA==="file:"){return}if(!kB.XMLHttpRequest){return}var i=kB.XMLHttpRequest;var T=i.prototype.send;var kz=function(kD){if(kD&&kD.currentTarget&&kD.currentTarget.status!==200){var kC=kD.target.responseURL;if(e.isFetch(e.category.AJAX)&&e.hostExit(kC)){e.sendError({title:kC,msg:JSON.stringify({response:kD.target.response,responseURL:kC,status:kD.target.status,statusText:kD.target.statusText}),category:e.category.AJAX,level:e.levels.ERROR})}}};i.prototype.send=function(){if(this["addEventListener"]){this["addEventListener"]("error",kz);this["addEventListener"]("load",kz);this["addEventListener"]("abort",kz)}else{var kC=this["onreadystatechange"];this["onreadystatechange"]=function(kD){if(this.readyState===4){kz(kD)}kC&&kC.apply(this,arguments)}}return T.apply(this,arguments)}},notifyError:function(T){var i=T||1000;this._idleWorkerTicker=(function(kz){return function(){kz.runJob()}})(this);var e=this;return function(kA){if(kA.url){if(!e.isFetch(kA.category)){return}var kz=kA.url||"";if(!e.hostExit(kz)){return}delete kA.url}if(!navigator.onLine){return}e.collections.push(kA);e.checkJob(i)}},runJob:function(){if(this.collections.length===0){clearInterval(this.idleWork);this.idleWork=null;return}var kA=this.collections.slice(0,2);var T=jE(JSON.stringify({dataset:kA}));var kz=new Date().getTime();if(window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]){var i=eG.apiIMG+"/blank.gif?product=jsapi&v=gl&l="+T+"&t="+kz}else{var i=eG.apiIMG+"/blank.gif?product=jsapi&v=gl&l="+T+"&ak="+eZ+"&t="+kz}if(this.sender){try{var kC=document.createElement("div");kC.style="width:0;height:0;visibility: hidden;opacity: 0;z-index:-999;background-image: url("+i+");";document.querySelector("BODY").appendChild(kC);setTimeout(function(){document.querySelector("BODY").removeChild(kC)})}catch(kB){}}this.collections.splice(0,2);if(this.collections.length===0){clearInterval(this.idleWork);this.idleWork=null}},checkJob:function(e){if(!this.idleWork&&this._idleWorkerTicker){this.idleWork=setInterval(this._idleWorkerTicker,e)}},urlScope:function(kz){var T={};var kB=Object.keys(E);if(E&&kB.length>0){for(var kA in E){if(E[kA]&&(typeof E[kA]!=="function")){T[kA]=E[kA]}}}try{var kD=JSON.stringify(T);if(kD.length>2){return kz+"|"+kD}else{return kz}}catch(kC){return kz}},hostExit:function(i){try{if(i&&i.indexOf("//")===0){i=window.location.protocol+i}var T=new URL(i);if(!T||!T.host){return false}var kA=T.host+T.pathname;if(this.ignoreUrl.indexOf(kA)===-1&&this.hosts.indexOf(T.host)>-1){return true}return false}catch(kz){return false}},isFetch:function(e){return this.config[e+"Error"]||false}};bG.fetchDebug=cT;var hP={device:{PC:0,NA:1},config:{mask:["FFFFFFFF"],open:true,reset:60*60*1000},url:E.apiHost+"?qt=jsapi_log",startTime:Date.now(),mark:{},records:{},sendMessage:function(e,i){},init:function(i,T){this.kill();var e=this;this.config.open=!!i;T=T||{};if(T.reset){this.config.reset=T.reset}this.sendMessage=(function(kA){var kz=kA||1000;e._idleWorkerTicker=(function(kB){return function(){kB.runJob()}})(e);return function(kB,kC){if(window.navigator&&!navigator.onLine){return}if(Date.now()-e.startTime>e.config.reset){e.startTime=Date.now();e.mark={};e.records={}}if(!e.mark[kB]){e.mark[kB]=true;e.records[kB]=kC}e.checkJob(kz)}})(T.timers)},runJob:function(){if(Object.keys(this.records).length===0){clearInterval(this.idleWork);this.idleWork=null;return}var kB=Object.keys(this.records);var kz=kB[0];var T=new Date().getTime();var kA="logCbk"+Math.floor(Math.random()*10000000000);bG[kA]=function(e){delete bG[kA]};if(window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]){var i=this.url+"&bmapgl2=1&device="+(b5()?this.device.NA:this.device.PC)+"&module="+(this.records[kz][0]||"")+"&func="+(this.records[kz][1]||"")+"&subfunc="+(this.records[kz][2]||"")+"&t="+T+"&callback="+fF+"."+kA}else{var i=this.url+"&ak="+eZ+"&bmapgl2=1&device="+(b5()?this.device.NA:this.device.PC)+"&module="+(this.records[kz][0]||"")+"&func="+(this.records[kz][1]||"")+"&subfunc="+(this.records[kz][2]||"")+"&t="+T+"&callback="+fF+"."+kA}i+=jI()(i);if(this.config.open){try{g3.load(i);delete this.records[kz]}catch(kC){}}if(Object.keys(this.records).length===0){clearInterval(this.idleWork);this.idleWork=null}},checkJob:function(e){if(!this.idleWork&&this._idleWorkerTicker){this.idleWork=setInterval(this._idleWorkerTicker,e)}},kill:function(){if(this.idleWork){clearInterval(this.idleWork);this.idleWork=null}this._idleWorkerTicker=null;this.mark={};this.records={}}};hP.init(true,{reset:20*60*1000});var ki={request:function(kH,kD,kz,kK,kB){var kE=new Date()["getTime"]();var kG=(Math.random()*100000)["toFixed"](0);bG._rd["_cbk"+kG]=function(kL){if(kL.result&&kL.result["error"]&&kL.result["error"]===202){alert("该AK因为恶意行为已经被管理员封禁！");return}if(kL.result&&kL.result["error"]&&kL.result["error"]===403){if(hi!==null){hi.update("未获得百度地图商用授权，可能导致部分地图请求失败，请刷新后重试。")}return}kz=kz||{};kH&&kH(kL,kz);delete bG._rd["_cbk"+kG]};kK=kK||"";var kJ;var kA;if(kz&&kz.useEncodeURI){kJ=jG(kD,encodeURI);kA=jG(kD)}else{kJ=jG(kD,encodeURIComponent);kA=jG(kD)}if(window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]){var i=window._BMapSecurityConfig["serviceHost"]+kK+"?"+kJ+"&ie=utf-8&oue=1&fromproduct=jsapi";var kF=window._BMapSecurityConfig["serviceHost"]+kK+"?"+kA+"&ie=utf-8&oue=1&fromproduct=jsapi"}else{var i=E.apiHost+"/"+kK+"?"+kJ+"&ie=utf-8&oue=1&fromproduct=jsapi";var kF=E.apiHost+"/"+kK+"?"+kA+"&ie=utf-8&oue=1&fromproduct=jsapi"}if(!kB){i+="&res=api";kF+="&res=api"}i+="&callback="+fF+"._rd._cbk"+kG;kF+="&callback="+fF+"._rd._cbk"+kG;var kC=window.___abvk?window.___abvk:ki.getSeckeyCidItem("SECKEY_ABVK");var e=ki.getSeckeyCidItem("BMAP_SECKEY");var kI=encodeURIComponent(kC+","+e);var T=kC+","+e;if(window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]){i+="&v=gl&seckey="+kI+"&timeStamp="+kE;kF+="&v=gl&seckey="+T+"&timeStamp="+kE}else{i+="&ak="+eZ+"&v=gl&seckey="+kI+"&timeStamp="+kE;kF+="&ak="+eZ+"&v=gl&seckey="+T+"&timeStamp="+kE}i+=jI()(kF);g3.load(i)},getSeckeyCidItem:function(i){if(navigator.cookieEnabled){var T=new RegExp("(^| )"+i+"=([^;]*)(;|$)");var e=document.cookie.match(T);if(e){return unescape(e[2])}return -1}if(localStorage){return localStorage.getItem(i)?localStorage.getItem(i):-1}if(sessionStorage){return sessionStorage.getItem(i)?localStorage.getItem(i):-1}}};window.srqtimer=null;window.firstTime=true;window.srqcount=0;bG._rd={};var je=(function(){var kM={};var kL="HIGH";var kF="FOCUS";var T={};var kz;function i(kN){var kS=kN||[];for(var kT=0;kT<kS.length;kT++){var kW=kS[kT];var kV=[];for(var kR=0;kR<kW.length;kR++){var kO=kW[kR];kV.push(new cG(kO[0],kO[1]))}var kP=new i1(kV);var kU=new fW("onbeforeaddoverlay",kP);kU.overlay=kP;kU.isLayerMask=true;kz.dispatchEvent(kU);kP._i(kz);kJ(kL,kP);if(kz.config.highRegion){if(kz.config.highRegion.lineOpt){var kQ=new bu(kV,kz.config.highRegion.lineOpt);kz.addOverlay(kQ)}if(kz.config.highRegion.focusOpt){kJ(kF,kP)}}}}function e(kN){var kO=new fW("onbeforeaddoverlay",kN);kO.overlay=kN;kO.isLayerMask=true;kz.dispatchEvent(kO);kN._i(kz);kJ(kF,kN)}function kH(kN){kI(kF,kN)}function kJ(kN,kO){if(kO){if(!kD(kN)){kM[kN]=[]}kM[kN].push(kO)}kB(kN)}function kI(kO,kP){if(kP){if(kD(kO)){for(var kN=0;kN<kM[kO].length;kN++){if(kM[kO][kN]===kP){kM[kO].splice(kN,1);break}}}}else{delete kM[kO]}kB(kO)}function kB(kR){if(kD(kR)){var kS=[];for(var kQ=0;kQ<kK(kR).length;kQ++){var kP=kK(kR)[kQ];var kN=kP.getFillStyleForGL();var kT=kP.buildFillVertex(hW);var kO=[kN,kT[0],kT[1]];kO.hashCode=kP.hashCode;kO.hasMultipleParts=kP.hasMultipleParts;kS.push(kO)}T[kR]=kS}else{delete T[kR]}}function kE(kN){return T[kN]}function kD(kN){return kM[kN]?true:false}function kK(kN){return kM[kN]}function kG(kN,kO){if(kM[kN]){kM[kN].visible=kO}}function kA(kN){kz=kN}function kC(){kM[kL]=[];kM[kF]=[];kM={};T={}}return{HIGH:kL,FOCUS:kF,kill:kC,setMap:kA,dataProcessFromHigh:i,addFocusMask:e,removeFocusMask:kH,getMask:kK,getRender:kE,setVisible:kG}})();var dq={request:function(i,kE){var kA=new Date()["getTime"]();var kD=(Math.random()*100000).toFixed(0);if(kE){BMapGL._rd["_cbk"+kD]=function(kG){kE&&kE(kG);delete BMapGL._rd["_cbk"+kD]};i+="&callback=BMapGL._rd._cbk"+kD}function kB(kH){var kG;var kI=new RegExp("(^| )"+kH+"=([^;]*)(;|$)");if(kG=document.cookie.match(kI)){return unescape(kG[2])}else{return -1}}if(i.indexOf("v=")===-1){i+="&v=gl"}var kz=window.___abvk?window.___abvk:this.getSeckeyCidItem("SECKEY_ABVK");var e=this.getSeckeyCidItem("BMAP_SECKEY");var kF=encodeURIComponent(kz+","+e);var T=kz+","+e;signUrl=i+"&seckey="+T+"&timeStamp="+kA;i+="&seckey="+kF+"&timeStamp="+kA;i+=jI()(signUrl);var kC=b6("script",{src:i,type:"text/javascript",charset:"utf-8"});if(kC.addEventListener){kC.addEventListener("load",function(kH){var kG=kH.target;kG.parentNode.removeChild(kG)},false);kC.addEventListener("error",function(kG){kE&&kE([,,,,,])},false)}else{if(kC.attachEvent){kC.attachEvent("onreadystatechange",function(kH){var kG=window.event.srcElement;if(kG&&(kG.readyState=="loaded"||kG.readyState=="complete")){kG.parentNode.removeChild(kG)}})}}document.getElementsByTagName("head")[0].appendChild(kC);kC=null},getSeckeyCidItem:function(i){if(navigator.cookieEnabled){var T=new RegExp("(^| )"+i+"=([^;]*)(;|$)");var e=document.cookie.match(T);if(e){return unescape(e[2])}return -1}if(localStorage){return localStorage.getItem(i)?localStorage.getItem(i):-1}if(sessionStorage){return sessionStorage.getItem(i)?localStorage.getItem(i):-1}}};function gY(){this._map=null;this._container;this._type="control";this.blockInfoWindow=true;this._visible=true}gY.inherits(dh,"Control");e9.extend(gY.prototype,{initialize:function(e){this._map=e;if(this._container){if(this._opts&&this._opts.container){this._opts.container.appendChild(this._container)}else{e.container.appendChild(this._container)}return this._container}return},_i:function(e){if(!this._container&&this.initialize&&b0(this.initialize)){this._container=this.initialize(e)}this._opts=this._opts||{printable:false};this._setStyle();this._setPosition();if(this._container){this._container._jsobj=this}},_setStyle:function(){var i=this._container;if(i){var e=i.style;e.position="absolute";e.zIndex=this._cZIndex||"10";e.MozUserSelect="none";if(!this._opts.printable){e9.ac(i,"BMap_noprint")}e9.on(i,"contextmenu",hH)}},remove:function(){this._map=null;if(!this._container){return}this._container.parentNode&&this._container.parentNode.removeChild(this._container);this._container._jsobj=null;this._container=null},_render:function(e){if(this._opts&&this._opts.container){this._container=bS(this._opts.container,'<div unselectable="on"></div>')}else{var i='<div unselectable="on"></div>';if(e&&e.config.autoSafeArea&&cC()){this._safeAreaContainer=bS(this._map.container,i);this._safeAreaContainer.style.position="absolute";this._safeAreaContainer.style.bottom="env(safe-area-inset-bottom)";this._container=bS(this._safeAreaContainer,i)}else{this._container=bS(this._map.container,i)}}if(this._visible===false){this._container.style.display="none"}return this._container},_setPosition:function(){this.setAnchor(this._opts.anchor)},setAnchor:function(kz){if(this.anchorFixed||typeof kz!=="number"||isNaN(kz)||kz<BMAP_ANCHOR_TOP_LEFT||kz>BMAP_ANCHOR_BOTTOM_RIGHT){kz=this.defaultAnchor}this._opts.offset=this._opts.offset||this.defaultOffset;var T=this._opts.anchor;this._opts.anchor=kz;if(!this._container){return}var kB=this._container;var e=this._opts.offset.width;var kA=this._opts.offset.height;kB.style.left=kB.style.top=kB.style.right=kB.style.bottom="auto";switch(kz){case BMAP_ANCHOR_TOP_LEFT:kB.style.top=kA+"px";kB.style.left=e+"px";break;case BMAP_ANCHOR_TOP_RIGHT:kB.style.top=kA+"px";kB.style.right=e+"px";break;case BMAP_ANCHOR_BOTTOM_LEFT:kB.style.bottom=kA+"px";kB.style.left=e+"px";break;case BMAP_ANCHOR_BOTTOM_RIGHT:kB.style.bottom=kA+"px";kB.style.right=e+"px";break;default:break}var i=["TL","TR","BL","BR"];e9.rc(this._container,"anchor"+i[T]);e9.ac(this._container,"anchor"+i[kz])},getAnchor:function(){return this._opts.anchor},setOffset:function(e){if(!e){return}this._opts=this._opts||{};this._opts.offset=new jm(e.width,e.height);if(!this._container){return}this.setAnchor(this._opts.anchor)},getOffset:function(){return this._opts.offset},getDom:function(){return this._container},show:function(){if(this._visible===true){return}this._visible=true;if(this._container){this._container.style.display=""}this.dispatchEvent(new fW("onshow"))},hide:function(){if(this._visible===false){return}this._visible=false;if(this._container){this._container.style.display="none"}this.dispatchEvent(new fW("onhide"))},isPrintable:function(){return !!this._opts.printable},isVisible:function(){if(!this._container&&!this._map){return false}return !!this._visible},_asyncLoadCode:function(){var e=this;hl.load("control",function(){if(e._asyncDraw){e._asyncDraw()}})}});var es={TOP_LEFT:0,TOP_RIGHT:1,BOTTOM_LEFT:2,BOTTOM_RIGHT:3};bG.ControlAnchor=es;window.BMAP_ANCHOR_TOP_LEFT=0;window.BMAP_ANCHOR_TOP_RIGHT=1;window.BMAP_ANCHOR_BOTTOM_LEFT=2;window.BMAP_ANCHOR_BOTTOM_RIGHT=3;function gm(e){gY.call(this);e=e||{};this._opts={printable:false};e9.extend(this._opts,e);this._copyrightCollection=[];this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT;this.defaultOffset=new jm(5,2);this.setAnchor(e.anchor);this._canShow=true;this.sateMapStyle=false;this.blockInfoWindow=false;this._asyncLoadCode()}gm.inherits(gY,"CopyrightControl");e9.extend(gm.prototype,{initialize:function(e){this._map=e;return this._container},addCopyright:function(kz){var e={minZoom:0,bounds:null,content:"",mapType:""};for(var T in kz){e[T]=kz[T]}if(this._map){var kC=e.minZoom;if(kC===-1||kC<this._map.getMinZoom()||kC>this._map.getMaxZoom()){e.minZoom=this._map.getMinZoom()}if(e.mapType!==""&&!ev[e.mapType]){e.mapType=BMAPGL_NORMAL_MAP}}var kA=this.getCopyright(kz.id);if(kA){for(var kB in e){kA[kB]=e[kB]}}else{this._copyrightCollection.push(e)}},getCopyright:function(kz){for(var T=0,e=this._copyrightCollection.length;T<e;T++){if(this._copyrightCollection[T].id===kz){return this._copyrightCollection[T]}}},addSateMapStyle:function(){this.sateMapStyle=true;if(this._container){e9.ac(this._container,"BMap_cpyCtrl_w")}},removeSateMapStyle:function(){this.sateMapStyle=false;if(this._container){e9.rc(this._container,"BMap_cpyCtrl_w")}}});function bB(e){gY.call(this);e=e||{};this.canCheckSize=e.canCheckSize===false?false:true;this.curCityName="";this.curCityCode="";this.defaultOffset=new jm(10,10);this.defaultAnchor=es.TOP_LEFT;this.onChangeBefore=[];this.onChangeAfter=[];this.onChangeSuccess=[];this._opts={printable:false,offset:e.offset||this.defaultOffset,anchor:e.anchor||this.defaultAnchor,expand:!!(e.expand)};if(e.onChangeBefore&&b0(e.onChangeBefore)){this.onChangeBefore.push(e.onChangeBefore)}if(e.onChangeAfter&&b0(e.onChangeAfter)){this.onChangeAfter.push(e.onChangeAfter)}if(e.onChangeSuccess&&b0(e.onChangeSuccess)){this.onChangeSuccess.push(e.onChangeSuccess)}this.setAnchor(e.anchor);this._asyncLoadCode();hP.sendMessage(a1(4,5,3),["control","city"])}bB.inherits(gY,"CityListControl");e9.extend(bB.prototype,{initialize:function(e){this._map=e;return this._container}});function ky(e){gY.call(this);e=e||{};this._opts={printable:false};this._opts=e9.extend(e9.extend(this._opts,{unit:"metric"}),e);this.defaultAnchor=BMAP_ANCHOR_BOTTOM_LEFT;this.defaultOffset=new jm(81,18);if(b5()){this.defaultOffset=new jm(75,10)}this.setAnchor(e.anchor);this._units={metric:{name:"metric",conv:1,incon:1000,u1:"米",u2:"公里"},us:{name:"us",conv:3.2808,incon:5280,u1:"英尺",u2:"英里"}};this.sateMapStyle=false;if(!this._units[this._opts.unit]){this._opts.unit="metric"}this._scaleText=null;this._numberArray={};this._asyncLoadCode()}window.BMAP_UNIT_METRIC="metric";window.BMAP_UNIT_IMPERIAL="us";ky.inherits(gY,"ScaleControl");e9.extend(ky.prototype,{initialize:function(e){this._map=e;return this._container},setUnit:function(e){this._opts.unit=this._units[e]&&this._units[e].name||this._opts.unit},getUnit:function(){return this._opts.unit},addSateMapStyle:function(){this.sateMapStyle=true;var e=this._container;if(e){e9.ac(e.children[0],"dark")}},removeSateMapStyle:function(){this.sateMapStyle=false;var e=this._container;if(e){e9.rc(e.children[0],"dark")}}});window.BMAP_NAVIGATION_CONTROL_LARGE=0;window.BMAP_NAVIGATION_CONTROL_SMALL=1;window.BMAP_NAVIGATION_CONTROL_PAN=2;window.BMAP_NAVIGATION_CONTROL_ZOOM=3;window.BMAP_NAVIGATION_CONTROL_ANIM=4;function j3(e){gY.call(this);e=e||{};this._opts={printable:false};e9.extend(this._opts,e);this.controlHeight=[{width:65,height:227,zoomHeight:227,zoomWidth:37,sliderHeight:180},{width:65,height:47,zoomHeight:(this._opts.forceNew===true)?56:47,zoomWidth:37,sliderHeight:0},{width:37,height:57,zoomHeight:0,zoomWidth:0,sliderHeight:0},{width:26,height:56,zoomHeight:56,zoomWidth:6,sliderHeight:0},{width:56,height:47,zoomHeight:47,zoomWidth:37,sliderHeight:180}];this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT;this.defaultOffset=new jm(10,10);this.setAnchor(e.anchor);this.setType(e.type);this._maxTotalZoomLv=19;this._minZoomLevel=-1;this._maxZoomLevel=-1;this._totalZoomLv=-1;this._sliderInterval=10;this._sliderHeight=180;this._minBarY=1;this._maxBarY=-1;this._curBarY=-1;this._zoomDom=null;this._zoomBtnDom=null;this._sliderDom=null;this._sliderBaseDom=null;this._cZIndex="1100";this._asyncLoadCode()}j3.inherits(gY,"NavigationControl");e9.extend(j3.prototype,{initialize:function(e){this._map=e;return this._container},setType:function(e){if(typeof e=="number"&&e>=BMAP_NAVIGATION_CONTROL_LARGE&&e<=BMAP_NAVIGATION_CONTROL_ANIM){this._opts.type=e}else{this._opts.type=BMAP_NAVIGATION_CONTROL_LARGE}},getType:function(){return this._opts.type}});function A(i){gY.call(this);i=i||{};this._opts={printable:false};this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT;this.defaultOffset=new jm(10,10);this.setAnchor(i.anchor);this._opts=e9.extend(e9.extend(this._opts,{offset:this.defaultOffset,enableSwitch:true}),i);var e=this;hl.load("control",function(){e._asyncDraw()})}A.inherits(gY,"MapTypeControl");e9.extend(A.prototype,{initialize:function(e){this._map=e;return this._container},showStreetLayer:function(e){this._map.showStreetLayer(e)}});function jy(e){gY.call(this);e=e||{};this._opts={};this._opts=e9.extend(this._opts,e);this._zoomInDisabled=false;this._zoomOutDisabled=false;this._zoomInTapped=false;this._zoomOutTapped=false;this.defaultAnchor=es.BOTTOM_RIGHT;this.defaultOffset=new jm(15,20);this.setAnchor(e.anchor);this._asyncLoadCode()}jy.inherits(gY,"ZoomControl");e9.extend(jy.prototype,{initialize:function(e){this._map=e;return this._container}});function gE(e){gY.call(this);e=e||{};this._opts={autoZoom:true,autoViewport:true};this._opts=e9.extend(this._opts,e);this.defaultAnchor=es.BOTTOM_LEFT;this.defaultOffset=new jm(10,50);this.watchPosition=this._opts.watchPosition||false;this.useCompass=this._opts.useCompass||false;this.locMarker=null;this.locLevel=16;this.setAnchor(this._opts.anchor);this.onLocationStart=e.onLocationStart||null;this._asyncLoadCode()}gE.inherits(gY,"LocationControl");e9.extend(gE.prototype,{initialize:function(e){this._map=e;return this._container},startLocation:function(){this._startLocationCalled=true},stopLocationTrace:function(){},setOptions:function(e){e=e||{};e9.extend(this._opts,e)}});function bJ(e){gY.call(this);e=e||{};this._opts={};this._opts=e9.extend(this._opts,e);this.defaultAnchor=es.BOTTOM_LEFT;this.defaultOffset=new jm(5,15);if(b5()){this.defaultOffset=new jm(10,10)}this.setAnchor(e.anchor)}bJ.inherits(gY,"LogoControl");e9.extend(bJ.prototype,{initialize:function(i){this._map=i;var e=this._container=document.createElement("div");e.innerHTML='<img src="'+E.apiHost+'/images/logo_hd.png"  style="height:21px;width:62px;"/>';i.getContainer().appendChild(e);return e}});function ax(e,i){this._map=e;this._indoorInfo=i;this._visible=true;this._adjustVisible=true;this._isMobile=b5();this._sizeConfig={FLOOR_BTN_HEIGHT:this._isMobile?35:26,SWITCH_ARROW_HEIGHT:this._isMobile?20:15};this._init()}ax.prototype._init=function(){this._render();this._bindDom();this._bind();this._adjustDisplayHeight();var e=new fW("onindoor_bar_show");e.uid=this._indoorInfo.uid;e.floors=this._indoorInfo.floors;this._map.dispatchEvent(e)};ax.prototype._render=function(){if(!this._indoorInfo){return}var kD=this._isMobile;var e=this._div=b6("div");e9.ac(e,"floor-select-container");kD&&e9.ac(e,"mobile");kD&&e9.ac(e,"all-border-radius");var i=this._btnTop=b6("button");e9.ac(i,"floor-switch-top");e9.ac(i,"top-border-radius");var kB=b6("div");e9.ac(kB,"floor-switch-top-icon");i.appendChild(kB);var kA=this._btnBottom=b6("button");var T=b6("div");e9.ac(T,"floor-switch-bottom-icon");kA.appendChild(T);e9.ac(kA,"floor-switch-bottom");e9.ac(kA,"bottom-border-radius");var kz=this._floorsContainer=b6("div");e9.ac(kz,"floors-container");kz.appendChild(this._createFloorsDom());this._div.appendChild(i);this._div.appendChild(kz);this._div.appendChild(kA);var kE=0;if(this._btnTop.style.display===""){kE=2*this._sizeConfig.SWITCH_ARROW_HEIGHT}this._div.style.height=parseInt(this._floorsContainer.style.height,10)+kE+"px";this._map.getContainer().appendChild(this._div);if(!kD){var kC=this;setTimeout(function(){kC._div.style.right="20px"},20)}};ax.prototype._createFloorsDom=function(){if(!this._indoorInfo){return}var T=this._ol=b6("ol");var kB=this._indoorInfo.currentFloor;for(var kA=this._indoorInfo.floors.length-1;kA>=0;kA--){var kC=this._indoorInfo.floors[kA].floorName;var e=b6("li");var kz=b6("button");e9.ac(kz,"btn-select-floor");if(kA===kB){e9.ac(kz,"selected")}kz.setAttribute("data-floor",kA);kz.innerHTML=kC;e.appendChild(kz);T.appendChild(e)}return T};ax.prototype._updateUI=function(){if(!this._ol){this._render();this._bind();this._adjustDisplayHeight();return}this._ol=null;this._ol=this._createFloorsDom();this._floorsContainer.innerHTML="";this._floorsContainer.appendChild(this._ol);this._adjustDisplayHeight()};ax.prototype._bindDom=function(){var e=this;e9.on(this._floorsContainer,"click",function(kz){var T=kz.target||kz.srcElement;if(T.tagName.toLowerCase()==="button"){e._map.showIndoor(e._indoorInfo.uid,parseInt(T.getAttribute("data-floor"),10));var i=new fW("onindoor_bar_click");i.uid=e._indoorInfo.uid;e._map.dispatchEvent(i)}});e9.on(this._floorsContainer,"mouseover",function(T){var i=T.target;if(i.tagName.toLowerCase()==="button"){e9.ac(i,"hover")}});e9.on(this._floorsContainer,"mouseout",function(T){var i=T.target;if(i.tagName.toLowerCase()==="button"){e9.rc(i,"hover")}});e9.on(this._floorsContainer,"touchstart",function(T){var i=T.target;if(i.tagName.toLowerCase()==="button"){e9.ac(i,"onmousedown")}});e9.on(this._floorsContainer,"touchend",function(T){var i=T.target;if(i.tagName.toLowerCase()==="button"){e9.rc(i,"onmousedown")}});e9.on(this._btnTop,"mouseover",function(i){if(this._disable){return}e9.ac(this,"hover")});e9.on(this._btnTop,"mouseout",function(i){e9.rc(this,"hover")});e9.on(this._btnBottom,"mouseover",function(i){if(this._disable){return}e9.ac(this,"hover")});e9.on(this._btnBottom,"mouseout",function(i){e9.rc(this,"hover")});e9.on(this._btnTop,"touchstart",function(i){if(this.className.indexOf("disable")>-1){return}e9.ac(this,"onmousedown")});e9.on(this._btnTop,"touchend",function(i){e9.rc(this,"onmousedown")});e9.on(this._btnBottom,"touchstart",function(i){if(this.className.indexOf("disable")>-1){return}e9.ac(this,"onmousedown")});e9.on(this._btnBottom,"touchend",function(i){e9.rc(this,"onmousedown")});e9.on(this._btnTop,"click",function(i){e._setBarSliderTop(parseInt(e._ol.style.top,10)+26)});e9.on(this._btnBottom,"click",function(i){e._setBarSliderTop(parseInt(e._ol.style.top,10)-26)});e9.on(this._div,"mousemove",al);e9.on(this._div,"wheel",hH);e9.on(this._div,"mousewheel",hH);this._map.addEventListener("resize",function(){e._adjustDisplayHeight()})};ax.prototype._adjustDisplayHeight=function(){if(!this._indoorInfo){return}var kB=this._map.getSize().height;var kC=this._sizeConfig.FLOOR_BTN_HEIGHT;var kD=kB-291-100;if(this._isMobile){kD=kB-12-108-this._map.config.bottomOffset}var e=this._indoorInfo.floors.length;var T=e*kC;var kz=e;var kF=0;var kG=this._floorsContainer.children[0];if(T>kD){this._showArrow=true;e9.rc(kG.children[0].children[0],"top-border-radius");e9.rc(kG.children[e-1].children[0],"bottom-border-radius")}else{this._showArrow=false;e9.ac(kG.children[0].children[0],"top-border-radius");e9.ac(kG.children[e-1].children[0],"bottom-border-radius")}while(T>kD){if(kz===0){break}kz--;kF=2*this._sizeConfig.SWITCH_ARROW_HEIGHT;T=kz*kC+kF}this._currentDisplayHeight=T;if(kz<3){this._setAdjustVisbile(false)}else{this._setAdjustVisbile(true)}this._floorsContainer.style.height=kz*kC+"px";var kA=this._indoorInfo.currentFloor;var i=e-kA;var kE=kA-1;this._div.style.height=parseInt(this._floorsContainer.style.height,10)+kF+"px";var kH=-(e-(kA+Math.round(kz/2)))*kC;this._setBarSliderTop(kH);if(kz<e){e9.show(this._btnTop);e9.show(this._btnBottom)}else{e9.hide(this._btnTop);e9.hide(this._btnBottom);this._setBarSliderTop(0)}if(this._isMobile){this._div.style.bottom=108+this._map.config.bottomOffset+"px"}};ax.prototype._setBarSliderTop=function(kz){var T=26;var i=this._indoorInfo.floors.length;var e=i*T;if(this._currentDisplayHeight){if(this._showArrow){e=this._currentDisplayHeight-30}else{e=this._currentDisplayHeight}}if(e-kz>=i*T){kz=e-i*T;e9.ac(this._btnBottom,"disable");e9.rc(this._btnBottom,"hover");this._btnBottom._disable=true}else{e9.rc(this._btnBottom,"disable");this._btnBottom._disable=false}if(kz>=0){kz=0;e9.ac(this._btnTop,"disable");e9.rc(this._btnTop,"hover");this._btnTop._disable=true}else{e9.rc(this._btnTop,"disable");this._btnTop._disable=false}this._ol.style.top=kz+"px"};ax.prototype._setAdjustVisbile=function(e){if(this._adjustVisible===e){return}this._adjustVisible=e;if(e&&this._visible){this._div.style.right="20px"}else{this._div.style.right="-30px"}};ax.prototype._bind=function(){var i=this._map;var e=this;i.on("indoor_status_changed",function(kD){if(e._visible===false){return}var T=e._ol;var kB=kD.uid;if(!kB){return}var kC=kD.floor;for(var kA=0;kA<T.children.length;kA++){var kz=T.children[kA].children[0];if(parseInt(kz.getAttribute("data-floor"),10)===kC){e9.ac(kz,"selected")}else{e9.rc(kz,"selected")}}});i.on("zoomend",function(T){if(this.getZoom()<17){e._setAdjustVisbile(false)}else{e._setAdjustVisbile(true)}})};ax.prototype.setInfo=function(e){if(this._indoorInfo&&this._indoorInfo.uid===e.uid){return}this._indoorInfo=e;this._updateUI()};ax.prototype.show=function(){if(this._visible===true){return}this._visible=true;if(!this._isMobile){this._div.style.right="20px"}else{this._div.style.display=""}var e=new fW("onindoor_bar_show");e.uid=this._indoorInfo.uid;e.floors=this._indoorInfo.floors;this._map.dispatchEvent(e)};ax.prototype.hide=function(){if(this._visible===false){return}this._visible=false;if(!this._isMobile){this._div.style.right="-30px"}else{this._div.style.display="none"}};function fb(e){this._opts=e||{};this.defaultOffset=new jm(2,80);this.defaultAnchor=BMAP_ANCHOR_TOP_RIGHT;if(this._opts.anchor===undefined){this.setAnchor(this.defaultAnchor)}else{this.setAnchor(this._opts.anchor)}this._firstAnimation=true}fb.inherits(gY,"NavigationControl3D");e9.extend(fb.prototype,{initialize:function(T){this._map=T;this._createDom();this._bindDom();this._bind();if(!b5()){this._headingControl=new i0(this._map,this._div)}this._tiltControl=new c1(this._map,this._div);this._render();var i=this._map.getMapType();var e=this;if(i==="B_EARTH_MAP"||this._map._renderType==="webgl"){e._div.style.opacity="1";e._div.style.visibility="visible"}else{e._div.style.opacity="0";e._div.style.visibility="hidden"}return this._container},_createDom:function(){var i=this._div=document.createElement("div");this._container=i;var e=i.style;e.position="absolute";e.zIndex=5;e.width="52px";e.height="82px";e.right="-3px";e.bottom="79px";e.opacity="0";e.visibility="hidden";e.WebkitTransition=e.transition="opacity .3s ease-out,visibility .3s ease-out"},_render:function(){var e=document.getElementById("map-operate");if(e){e.appendChild(this._div)}else{this._map.getContainer().appendChild(this._div)}},_bindDom:function(){this._div.addEventListener("mousemove",al)},_bind:function(){if(this._map._renderType==="webgl"){return}var e=this;this._map.on("maptypechange",function(){if(this.mapType==="B_EARTH_MAP"){if(e._firstAnimation){e._firstAnimation=false;setTimeout(function(){e._div.style.opacity="1";e._div.style.visibility="visible"},300)}else{e._div.style.opacity="1";e._div.style.visibility="visible"}}else{e._div.style.opacity="0";e._div.style.visibility="hidden"}})}});function i0(T,i){this._map=T;this._target=T;var kz=T.temp.originMapType||T.mapType;if(kz==="B_EARTH_MAP"&&T._earth){this._target=T._earth}this._outContainer=i||T.getContainer();this._imgRatio=gt()>=h4.HIGH_RES_MIN_RATIO?2:1;this._imgPath=E.imgPath+"earth-navi-control-pc4"+(this._imgRatio===2?"-2x.png":".png");this._enabled=true;var e=this;this._setHeadingOptions={callback:function(){e._target.setLock(false)}};this._init()}e9.extend(i0.prototype,{_init:function(){this._createDom();this._render();this._bindDom();this._bind();this._updateUI();this._checkEnable()},_checkEnable:function(){if(this._target.getZoom()>=this._target._enableHeadingZoom){this.enable()}else{this.disable()}},_createDom:function(){var i=this._div=b6("div");var e=i.style;e.position="absolute";e.zIndex=5;e.top="0";e.left="0";e.width="52px";e.height="54px";e.background="url("+this._imgPath+") no-repeat";e.backgroundSize="266px auto";this._rotateCCW=this._createButton();this._rotateCCW.title="逆时针转动";e=this._rotateCCW.style;e.left="2px";e.top="5px";e.zIndex="1";e.width="15px";e.height="42px";e.backgroundPosition="-75px -5px";this._rotateCW=this._createButton();this._rotateCW.title="顺时针转动";e=this._rotateCW.style;e.right="2px";e.top="5px";e.zIndex="1";e.width="15px";e.height="42px";e.backgroundPosition="-75px -5px";e.WebkitTransform=e.transform="scaleX(-1)";this._compass=this._createButton();this._compass.title="恢复正北方向";e=this._compass.style;e.left="19px";e.top="4px";e.width="14px";e.height="44px";e.backgroundPosition="-56px -4px";e.WebkitTransform=e.transform="rotate(0deg)";this._div.appendChild(this._rotateCCW);this._div.appendChild(this._compass);this._div.appendChild(this._rotateCW);this._domRendered=true},_createButton:function(){var e=b6("button");var i=e.style;i.position="absolute";i.outline="none";i.border="none";i.background="url("+this._imgPath+") no-repeat";i.backgroundSize="266px auto";i.cursor="pointer";return e},_render:function(){this._outContainer.appendChild(this._div)},enable:function(){this._enabled=true;if(this._domRendered){this._rotateCCW.style.cursor="pointer";this._rotateCCW.style.opacity=1;this._rotateCW.style.cursor="pointer";this._rotateCW.style.opacity=1;this._compass.style.cursor="pointer";this._compass.style.opacity=1}},disable:function(){this._enabled=false;if(this._domRendered){this._rotateCCW.style.cursor="";this._rotateCCW.style.opacity=0.4;this._rotateCW.style.cursor="";this._rotateCW.style.opacity=0.4;this._compass.style.cursor="";this._compass.style.opacity=0.4}},_bindDom:function(){iT(this._div,["mousedown","click","dblclick"]);var i=this._map;var e=this;this._rotateCW.addEventListener("click",function(){if(e._isOperating||e._enabled===false){return}if(e._target.getLock()){return}if(e._target.getHeading()===360){e._target.setHeading(0)}e._target.setLock(true);e._target.setHeading(e._target.getHeading()+90,e._setHeadingOptions);i.fire(new fW("onrotatecwclick"))},false);this._rotateCCW.addEventListener("click",function(){if(e._isOperating||e._enabled===false){return}if(e._target.getLock()){return}if(e._target.getHeading()===-360){e._target.setHeading(0)}e._target.setLock(true);e._target.setHeading(e._target.getHeading()-90,e._setHeadingOptions);i.fire(new fW("onrotateccwclick"))},false);this._rotateCW.addEventListener("mouseover",function(){if(e._enabled===false){return}this.style.backgroundPosition="-89px -5px"},false);this._rotateCW.addEventListener("mouseout",function(){if(e._enabled===false){return}this.style.backgroundPosition="-75px -5px"},false);this._rotateCCW.addEventListener("mouseover",function(){if(e._enabled===false){return}this.style.backgroundPosition="-89px -5px"},false);this._rotateCCW.addEventListener("mouseout",function(){if(e._enabled===false){return}this.style.backgroundPosition="-75px -5px"},false);this._compass.addEventListener("click",function(){if(e._isOperating||e._enabled===false){return}if(e._target.getLock()){return}e._target.setLock(true);var T=false;if(e._target.getTilt()!==0){T=true;e._target.setTilt(0,e._setHeadingOptions)}if(e._target.getHeading()%360!==0){T=true;e._target.resetHeading(e._setHeadingOptions)}if(!T){e._target.setLock(false)}i.fire(new fW("oncompassclick"))},false)},_bind:function(){var e=this;this._bindTarget(this._target);if(this._map._renderType==="webgl"){this._map.addEventListener("maptypechange",function(i){if(this.mapType==="B_EARTH_MAP"){e._target=e._map._earth}else{e._target=e._map}e._bindTarget(e._target);e._checkEnable()})}},_bindTarget:function(i){if(i===this._map&&this._mapBinded){return}if(i===this._map._earth&&this._earthBinded){return}var e=this;i.addEventListener("heading_changed",function(T){e._updateUI()});i.addEventListener("animation_start",function(T){e._isOperating=true});i.addEventListener("animation_end",function(T){e._isOperating=false});i.on("load",function(){e._checkEnable()});i.on("zoom_changed",function(){e._checkEnable()});if(i===this._map){this._mapBinded=true}else{this._earthBinded=true}},_updateUI:function(){var e=this._target.getHeading();var i=this._compass.style;i.WebkitTransform=i.transform="rotate("+e+"deg)"},hide:function(){this._div.style.display="none"},show:function(){this._div.style.display="block"}});function c1(T,i){this._map=T;this._target=T;var kz=T.temp.originMapType||T.mapType;if(kz==="B_EARTH_MAP"&&T._earth){this._target=T._earth}this._outContainer=i||T.getContainer();this._imgRatio=gt()>=h4.HIGH_RES_MIN_RATIO?2:1;this._imgPath=E.imgPath+"gl-navi-control-pc4"+(this._imgRatio===2?"-2x.png":".png");this._enabled=true;var e=this;this._setTiltOptions={callback:function(){e._target.setLock(false)}};this._init()}e9.extend(c1.prototype,{_init:function(){this._createDom();this._render();this._bindDom();this._bind();this._checkEnable()},_checkEnable:function(){if(this._target.getZoom()>=this._target._enableTiltZoom){this.enable()}else{this.disable()}},_createDom:function(){var e=this._div=b6("button");e.title="倾斜";var i=e.style;i.position="absolute";i.zIndex=5;i.outline="none";i.border="none";i.cursor="pointer";i.width="26px";i.height="26px";i.top="56px";i.right="13px";i.background="url("+this._imgPath+") no-repeat #fff";i.backgroundSize="266px auto";i.backgroundPosition="-110px 1px";i.boxShadow="1px 2px 1px rgba(0, 0, 0, 0.15)"},enable:function(){this._enabled=true;if(this._div){this._div.style.cursor="pointer"}this._updateUI()},disable:function(){this._enabled=false;if(this._div){this._div.style.cursor=""}this._updateUI()},_render:function(){this._outContainer.appendChild(this._div)},_bindDom:function(){var e=this;this._div.addEventListener("mousedown",function(kz){if(!e._enabled){return}if(e._target.getLock()){return}var i=e._target.getTilt();var T;if(i===e._map.getCurrentMaxTilt()){T="out"}else{if(i===0){T="in"}else{T=e._preTrend?e._preTrend:"in"}}e._curTrend=T;e._clickTimer=setTimeout(function(){e._map.fire(new fW("ontiltmsdown"));e._tiltAni=new fL({duration:9999999,render:function(kA){i=e._target.getTilt();if(T==="in"&&i<e._map.getCurrentMaxTilt()){e._target.setTilt(i+1,{noAnimation:true})}else{if(T==="out"&&i>0){e._target.setTilt(i-1,{noAnimation:true})}}},finish:function(){e._tiltAni=null}});e._clickTimer=null},200);kz.stopPropagation()},false);this._div.addEventListener("mouseup",function(i){if(!e._enabled){return}if(e._tiltAni){e._tiltAni.stop()}e._preTrend=e._curTrend},false);this._div.addEventListener("click",function(kz){if(!e._enabled){return}if(!e._clickTimer){return}if(e._target.getLock()){return}clearTimeout(e._clickTimer);e._map.fire(new fW("ontiltclick"));var i=e._target.getTilt();e._target.setLock(true);kz.stopPropagation();var T=e._map.getCurrentMaxTilt();if(e._curTrend==="in"){e._target.setTilt(T,e._setTiltOptions)}else{if(e._curTrend==="out"){e._target.setTilt(0,e._setTiltOptions)}else{if(i<T){e._target.setTilt(T,e._setTiltOptions)}else{e._target.setTilt(0,e._setTiltOptions)}}}},false);this._div.addEventListener("mouseover",function(i){if(!e._enabled){return}e._mouseOver=true;e._updateUI()},false);this._div.addEventListener("mouseout",function(i){if(!e._enabled){return}e._mouseOver=false;e._updateUI()},false);iT(this._div,["mousedown","click","dblclick"])},_bind:function(){var e=this;var i=this._map;this._bindTarget(this._target);if(this._map._renderType==="webgl"){this._map.addEventListener("maptypechange",function(T){if(this.mapType==="B_EARTH_MAP"){e._target=e._map._earth}else{e._target=e._map}e._bindTarget(e._target);e._checkEnable()})}},_bindTarget:function(i){if(i===this._map&&this._mapBinded){return}if(i===this._map._earth&&this._earthBinded){return}var e=this;i.on("load",function(){e._checkEnable()});i.on("zoom_changed",function(){e._checkEnable()});i.on("tilt_changed",function(){e._updateUI()});if(i===this._map){this._mapBinded=true}else{this._earthBinded=true}},_updateUI:function(){var T=this._target.getTilt();var i=0;var kz=0;var e=0;if(T>0){i=78}if(this._mouseOver){e=52}if(this._enabled===false){kz=26;e=0;i=0}var kA="-"+(110+i+kz+e)+"px 1px";this._div&&(this._div.style.backgroundPosition=kA);if(this._enabled){if(T>0){this._div&&(this._div.title="恢复")}else{this._div&&(this._div.title="倾斜")}}else{this._div&&(this._div.title="请放大地图后操作")}},hide:function(){this._div.style.display="none"},show:function(){this._div.style.display="block"}});function hF(i){dh.call(this);this._opts={container:null,cursor:"default",marker:true};this._opts=e9.extend(this._opts,i);this._type="contextmenu";this._map=null;this._container;this._left=0;this._top=0;this._items=[];this._rItems=[];this._dividers=[];this._enable=true;this.curPixel=null;this.curPoint=null;this._isOpen=false;var e=this;hl.load("menu",function(){e._draw()});hP.sendMessage(a1(4,5,2),["control","menu"])}hF.inherits(dh,"ContextMenu");e9.extend(hF.prototype,{initialize:function(i,e){this._map=i;this._overlay=e||null},remove:function(){this._map=this._overlay=null},addItem:function(kA,e){if(!kA||kA._type!="menuitem"||kA._text==""||kA._width<=0){return}for(var kz=0,T=this._items.length;kz<T;kz++){if(this._items[kz]===kA){return}}if(e===undefined||e>this._items.length-1){e=-1}kA._insertIndex=e;if(e===-1){this._items.push(kA);this._rItems.push(kA)}else{this._items.splice(e,0,kA);this._rItems.splice(e,0,kA)}},removeItem:function(kz){if(!kz||kz._type!="menuitem"){return}for(var T=0,e=this._items.length;T<e;T++){if(this._items[T]===kz){this._items[T].remove();this._items.splice(T,1);delete kz._insertIndex;e--}}for(var T=0,e=this._rItems.length;T<e;T++){if(this._rItems[T]===kz){this._rItems[T].remove();this._rItems.splice(T,1);delete kz._insertIndex;e--}}},addSeparator:function(e){if(e===undefined||e>this._items.length-1){e=-1}var i={_type:"divider",_dIndex:this._dividers.length,_insertIndex:e};this._dividers.push({dom:null});if(e===-1){this._items.push(i)}else{this._items.splice(e,0,i)}},removeSeparator:function(T){if(!this._dividers[T]){return}for(var kz=0,e=this._items.length;kz<e;kz++){if(this._items[kz]&&this._items[kz]._type=="divider"&&this._items[kz]._dIndex==T){this._items.splice(kz,1);e--}if(this._items[kz]&&this._items[kz]._type=="divider"&&this._items[kz]._dIndex>T){this._items[kz]._dIndex--}}this._dividers.splice(T,1)},getDom:function(){return this._container},show:function(){if(this._isOpen==true){return}this._isOpen=true},hide:function(){if(this._isOpen==false){return}this._isOpen=false},setCursor:function(e){if(!e){return}this._opts.cursor=e},getItem:function(e){return this._rItems[e]},enable:function(){this._enable=true},disable:function(){this._enable=false}});function ih(T,kz,i){if(!T||!kz||typeof kz!="function"){return}dh.call(this);this._opts={width:100,id:""};i=i||{};this._opts.width=(i.width*1)?i.width:100;this._opts.id=i.id?i.id:"";this._text=T+"";this._callback=kz;this._map=null;this._type="menuitem";this._contextmenu=null;this._container=null;this._enabled=true;var e=this;hl.load("menu",function(){e._draw()})}ih.inherits(dh,"MenuItem");e9.extend(ih.prototype,{initialize:function(e,i){this._map=e;this._contextmenu=i},remove:function(){this._contextmenu=null;this._map=null},setText:function(e){if(!e){return}this._text=e+""},getDom:function(){return this._container},enable:function(){this._enabled=true},disable:function(){this._enabled=false}});function ij(e,i){this.setSouthWest(e);this.setNorthEast(i)}e9.extend(ij.prototype,{isEmpty:function(){return this.sw===null&&this.ne===null},equals:function(e){if(!e||e.isEmpty()||this.isEmpty()){return false}return this.sw.equals(e.sw)&&this.ne.equals(e.ne)},containsBounds:function(e){if(!e||e.isEmpty()||this.isEmpty()){return false}return(e.sw.lng>this.sw.lng&&e.ne.lng<this.ne.lng&&e.sw.lat>this.sw.lat&&e.ne.lat<this.ne.lat)},getCenter:function(){if(this.isEmpty()){return null}if(Math.abs(this.sw.lng-this.ne.lng)<=dL.HALF_SIZE){return new cG((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}else{var i=this.sw.lng;var T=this.ne.lng;if(i<0){i+=dL.HALF_SIZE*2}else{T+=dL.HALF_SIZE*2}var e=(i+T)/2;if(e>dL.HALF_SIZE){e-=dL.HALF_SIZE*2}return new cG(e,(this.sw.lat+this.ne.lat)/2)}},intersects:function(T){if(!T||T.isEmpty()||this.isEmpty()){return null}if(Math.max(T.sw.lng,T.ne.lng)<Math.min(this.sw.lng,this.ne.lng)||Math.min(T.sw.lng,T.ne.lng)>Math.max(this.sw.lng,this.ne.lng)||Math.max(T.sw.lat,T.ne.lat)<Math.min(this.sw.lat,this.ne.lat)||Math.min(T.sw.lat,T.ne.lat)>Math.max(this.sw.lat,this.ne.lat)){return null}var kA=Math.max(this.sw.lng,T.sw.lng);var i=Math.min(this.ne.lng,T.ne.lng);var kz=Math.max(this.sw.lat,T.sw.lat);var e=Math.min(this.ne.lat,T.ne.lat);return new ij(new cG(kA,kz),new cG(i,e))},setMinMax:function(){this.minX=this.sw?this.sw.lng:null;this.minY=this.sw?this.sw.lat:null;this.maxX=this.ne?this.ne.lng:null;this.maxY=this.ne?this.ne.lat:null},containsPoint:function(e){if(!e){return}return(e.lng>=this.sw.lng&&e.lng<=this.ne.lng&&e.lat>=this.sw.lat&&e.lat<=this.ne.lat)},extend:function(e){if(!e){return}var i=e.lng;var T=e.lat;if(!this.sw){this.sw=e.clone()}if(!this.ne){this.ne=e.clone()}if(this.sw.lng>i){this.sw.lng=i}if(this.ne.lng<i){this.ne.lng=i}if(this.sw.lat>T){this.sw.lat=T}if(this.ne.lat<T){this.ne.lat=T}},getMin:function(){return this.sw},getMax:function(){return this.ne},getSouthWest:function(){return this.sw},getNorthEast:function(){return this.ne},setSouthWest:function(e){this.sw=e?e.clone():null},setNorthEast:function(e){this.ne=e?e.clone():null},clone:function(){return new ij(this.sw,this.ne)},toSpan:function(){if(this.isEmpty()){return new jm(0,0)}return new jm(Math.abs(this.ne.lng-this.sw.lng),Math.abs(this.ne.lat-this.sw.lat))},div:function(e){if(!e||e.isEmpty()||this.isEmpty()){return 0}return((this.ne.lng-this.sw.lng)*(this.ne.lat-this.sw.lat))/((e.ne.lng-e.sw.lng)*(e.ne.lat-e.sw.lat))},makeNormalizedPoint:function(e){this.normalizedTopLeft=this.pointTopLeft.clone();this.normalizedTopRight=this.pointTopRight.clone();this.normalizedBottomRight=this.pointBottomRight.clone();this.normalizedBottomLeft=this.pointBottomLeft.clone();while(e<0){e+=360}e=e%360;if(e>=0&&e<90||e>=270&&e<360){if(this.normalizedTopRight.lng<this.normalizedTopLeft.lng){this.normalizedTopRight.lng+=h4.WORLD_SIZE_MC}if(this.normalizedBottomRight.lng<this.normalizedBottomLeft.lng){this.normalizedBottomRight.lng+=h4.WORLD_SIZE_MC}}else{if(this.normalizedTopLeft.lng<this.normalizedTopRight.lng){this.normalizedTopLeft.lng+=h4.WORLD_SIZE_MC}if(this.normalizedBottomLeft.lng<this.normalizedBottomRight.lng){this.normalizedBottomLeft.lng+=h4.WORLD_SIZE_MC}}},toString:function(){return"Bounds"}});function cG(e,i){if(isNaN(e)){e=du(e);e=isNaN(e)?0:e}if(typeof e==="string"){e=parseFloat(e)}if(isNaN(i)){i=du(i);i=isNaN(i)?0:i}if(typeof i==="string"){i=parseFloat(i)}this.lng=e;this.lat=i}cG.prototype.equals=function(i){if(!i){return false}var kz=Math.abs(this.lat-i.lat);var T=Math.abs(this.lng-i.lng);var e=1e-8;if(kz<e&&T<e){return true}return false};cG.prototype.similar=function(i){if(!i){return false}var kz=Math.abs(this.lat-i.lat);var T=Math.abs(this.lng-i.lng);var e=0.00001;if(kz<e&&T<e){return true}return false};cG.prototype.clone=function(){return new cG(this.lng,this.lat)};cG.prototype.add=function(e){return new cG(this.lng+e.lng,this.lat+e.lat)};cG.prototype.sub=function(e){return new cG(this.lng-e.lng,this.lat-e.lat)};cG.prototype.mult=function(e){return new cG(this.lng*e,this.lat*e)};cG.prototype.div=function(e){return new cG(this.lng/e,this.lat/e)};cG.prototype.mag=function(){return Math.sqrt(this.lng*this.lng+this.lat*this.lat)};cG.prototype.toString=function(){return"Point"};cG.serialize=function(i,e){return[i.lng,i.lat]};cG.deserialize=function(e){return new cG(e[0],e[1])};cG.prototype.toGeoJSON=function(){var i="Point";var T=[this.lng,this.lat];var e={type:"Feature",geometry:{type:i,coordinates:T},properties:this.properties};return e};function jv(){}e9.extend(jv,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[86,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,0.00000898305509648872,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-0.03801003308653,17337981.2],[-7.435856389565537e-9,0.000008983055097726239,-0.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,0.00000898305509983578,0.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,0.32710905363475,6856817.37],[-1.981981304930552e-8,0.000008983055099779535,0.03278182852591,40.31678527705744,0.65659298677277,-4.44255534477492,0.85341911805263,0.12923347998204,-0.04625736007561,4482777.06],[3.09191371068437e-9,0.000008983055096812155,0.00006995724062,23.10934304144901,-0.00023663490511,-0.6321817810242,-0.00663494467273,0.03430082397953,-0.00466043876332,2555164.4],[2.890871144776878e-9,0.000008983055095805407,-3.068298e-8,7.47137025468032,-0.00000353937994,-0.02145144861037,-0.00001234426596,0.00010322952773,-0.00000323890364,826088.5]],LL2MC:[[-0.0015702102444,111320.7020616939,1704480524535203,-10338987376042340,26112667856603880,-35149669176653700,26595700718403920,-10725012454188240,1800819912950474,82.5],[0.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[0.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[0.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-0.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-0.0003218135878613132,111320.7020701615,0.00369383431289,823725.6402795718,0.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,0.37238884252424,7.45]],getDistanceByMC:function(kB,kz){if(!kB||!kz){return 0}var i;var kA;var e;var T;kB=this.convertMC2LL(kB);if(!kB){return 0}i=iW(kB.lng);kA=iW(kB.lat);kz=this.convertMC2LL(kz);if(!kz){return 0}e=iW(kz.lng);T=iW(kz.lat);return this.getDistance(i,e,kA,T)},getDistanceByLL:function(kB,kz){if(!kB||!kz){return 0}kB.lng=this.getLoop(kB.lng,-180,180);kB.lat=this.getRange(kB.lat,-80,84);kz.lng=this.getLoop(kz.lng,-180,180);kz.lat=this.getRange(kz.lat,-80,84);var i;var e;var kA;var T;i=iW(kB.lng);kA=iW(kB.lat);e=iW(kz.lng);T=iW(kz.lat);return this.getDistance(i,e,kA,T)},proximityCovertMC2LL:function(e){if(e===null){return e}if(e.lng<180&&e.lng>-180&&e.lat<90&&e.lat>-90){return e}return this.convertMC2LL(e)},convertMC2LL:function(e){if(e===null){return e}if(!e){return new cG(0,0)}var T;var kA;T=new cG(Math.abs(e.lng),Math.abs(e.lat));for(var kz=0;kz<this.MCBAND.length;kz++){if(T.lat>=this.MCBAND[kz]){kA=this.MC2LL[kz];break}}var kB=this.convertor(e,kA);return new cA(kB.lat,kB.lng)},convertLL2MC:function(kC){if(!kC){return new cG(0,0)}var kE=kC.lat;var kz=kC.lng;kz=this.getLoop(kC.lng,-180,180);kE=ck(kE,-85,85);var kB;for(var kA=0;kA<this.LLBAND.length;kA++){if(kE>=this.LLBAND[kA]){kB=this.LL2MC[kA];break}}if(!kB){for(kA=0;kA<this.LLBAND.length;kA++){if(kE<=-this.LLBAND[kA]){kB=this.LL2MC[kA];break}}}var T=new cG(kz,kE);var kD=this.convertor(T,kB);var e=new cG(kD.lng,kD.lat);e.latLng=new cA(kC.lat,kC.lng);return e},convertor:function(T,kz){if(!T||!kz){return}var e=kz[0]+kz[1]*Math.abs(T.lng);var i=Math.abs(T.lat)/kz[9];var kA=kz[2]+kz[3]*i+kz[4]*i*i+kz[5]*i*i*i+kz[6]*i*i*i*i+kz[7]*i*i*i*i*i+kz[8]*i*i*i*i*i*i;e*=(T.lng<0?-1:1);kA*=(T.lat<0?-1:1);return new cG(e,kA)},getDistance:function(i,e,kz,T){return this.EARTHRADIUS*Math.acos((Math.sin(kz)*Math.sin(T)+Math.cos(kz)*Math.cos(T)*Math.cos(e-i)))},getRange:function(T,i,e){if(i!=null){T=Math.max(T,i)}if(e!=null){T=Math.min(T,e)}return T},getLoop:function(T,i,e){while(T>e){T-=e-i}while(T<i){T+=e-i}return T},tileToBoundRange:function(T){var i=T.col;var kG=T.row;var kF=T.baseTileSize;var kD=Math.pow(2,(18-T.zoom));var kB={lbx:i*kF,lby:kG*kF,rtx:(i+1)*kF,rty:(kG+1)*kF};var e={lbx:kB.lbx*kD,lby:kB.lby*kD,rtx:kB.rtx*kD,rty:kB.rty*kD};var kE=new cG(e.lbx,e.lby);var kA=new cG(e.rtx,e.rty);var kz=this.convertMC2LL(kE);var kC=this.convertMC2LL(kA);return{MC:new ij(kE,kA),LL:new ij(kz,kC)}}});e9.extend(jv.prototype,{lnglatToMercator:function(e){return jv.convertLL2MC(e)},lngLatToPoint:function(e){var i=jv.convertLL2MC(e);return new fv(i.lng,i.lat)},mercatorToLnglat:function(e){return jv.convertMC2LL(e)},pointToLngLat:function(i){var e=new cG(i.x,i.y);var T=jv.convertMC2LL(e);return new cA(T.lat,T.lng)},pointToPixel:function(i,kB,kA,kz){if(!i){return}i=this.lnglatToMercator(i);var T=this.getZoomUnits(kB);var e=Math.round((i.lng-kA.lng)/T+kz.width/2);var kC=Math.round((kA.lat-i.lat)/T+kz.height/2);return new fv(e,kC)},mercatorToPixel:function(kB,kA,kz,T){if(!kB){return}var i=this.getZoomUnits(kA);var e=Math.round((kB.lng-kz.lng)/i+T.width/2);var kC=Math.round((kz.lat-kB.lat)/i+T.height/2);return new fv(e,kC)},pixelToPoint:function(kz,kC,kB,kA){if(!kz){return}var i=this.getZoomUnits(kC);var T=kB.lng+i*(kz.x-kA.width/2);var kD=kB.lat-i*(kz.y-kA.height/2);var e=new cG(T,kD);return this.mercatorToLnglat(e)},tileToBound:function(kz,kD){var i=kz.col;var kG=kz.row;var kF=kz.baseTileSize;var kE=this.getZoomUnits(kz.zoom);var T={x:Math.round(kD.lng/kE),y:Math.round(kD.lat/kE)};var kB={lbx:i*kF,lby:kG*kF,rtx:(i+1)*kF,rty:(kG+1)*kF};var e={lbx:kD.lng+(kB.lbx-T.x)*kE,lby:kD.lat+(kB.lby-T.y)*kE,rtx:kD.lng+(kB.rtx-T.x)*kE,rty:kD.lat+(kB.rty-T.y)*kE};var kA=jv.convertMC2LL(new cG(e.lbx,e.lby));var kC=jv.convertMC2LL(new cG(e.rtx,e.rty));return{MC:new ij(new cG(e.lbx,e.lby),new cG(e.rtx,e.rty)),LL:new ij(kA,kC)}},getZoomUnits:function(e){return Math.pow(2,(18-e))},setCoordType:function(e){this.coordsType=e}});function dL(){}e9.extend(dL,{RADIUS:6378137,EXTENT4326:[-180,-90,180,90],WORLD_EXTENT:[-180,-85,180,85],HALF_SIZE:20037508.342789244,METERS_PER_UNIT:111319.49079327358,EXTENT3857:[-20037508.342789244,-20037508.342789244,20037508.342789244,20037508.342789244],MAX_SAFE_Y:238107693.26496765,origin:[-20037508.342789244,20037508.342789244],size:156543.03392804097,gridSize:[256,256],resolutions:[156543.03392804097,78271.51696402048,39135.75848201024,19567.87924100512,9783.93962050256,4891.96981025128,2445.98490512564,1222.99245256282,611.49622628141,305.748113140705,152.8740565703525,76.43702828517625,38.21851414258813,19.109257071294063,9.554628535647032,4.777314267823516,2.388657133911758,1.194328566955879,0.5971642834779395,0.29858214173896974,0.14929107086948487,0.07464553543474244,0.03732276771737122],gridScaleFrom3857ToBDMC:0.5971642834779395,gridScaleFromBDMCTo3857:1.674581061974954,calcResolutions:function(i){if(this.resolutions.length-1<i){this.resolutions=[];for(var e=0;e<i;++e){this.resolutions.push(this.size/Math.pow(2,e))}}return this.resolutions},forEachTileCoord:function(kF,kE,T,kC){var e=this.getTileRangeForExtentFactory(kF,kE,T);for(var kA=e.minX,kD=e.maxX;kA<=kD;++kA){for(var kz=e.minY,kB=e.maxY;kz<=kB;++kz){kC([kE,kA,kz])}}},getTileRangeForExtentFactory:function(T,kA,i,kz){var e;switch(i.source){case"BD09MC":if(i.target==="EPSG3857"){e=this.getBDTileRangeForExtentAndZ(T,kA,kz)}else{e=this.getTileRangeForExtentAndZ(T,kA,kz)}break;case"EPSG3857":e=this.getTileRangeForExtentAndZ(T,kA,kz);break;default:e=this.getTileRangeForExtentAndZ(T,kA,kz);break}return e},getBDTileRangeForExtentAndZ:function(T,kA,kz){var i=[0,0,0];this.getBDTileCoordForXYAndZ_(T[0],T[1],kA,false,i);var e=i[1];var kB=i[2];this.getBDTileCoordForXYAndZ_(T[2],T[3],kA,true,i);return this.createOrUpdateTileRange(e,i[1],kB,i[2],kz)},getTileRangeForExtentAndZ:function(T,kA,kz){var i=[0,0,0];this.getTileCoordForXYAndZ_(T[0],T[3],kA,false,i);var e=i[1];var kB=i[2];this.getTileCoordForXYAndZ_(T[2],T[1],kA,true,i);return this.createOrUpdateTileRange(e,i[1],kB,i[2],kz)},getBDTileCoordForXYAndZ_:function(e,kD,kB,kA,kz){var kC=256*Math.pow(2,(18-kB));var T=e/kC;var i=kD/kC;if(kA){T=Math.ceil(T)-1;i=Math.ceil(i)-1}else{T=Math.floor(T);i=Math.floor(i)}return this.createOrUpdateTileCoord(kB,T,i,kz)},getTileCoordForXYAndZ_:function(kG,kF,kD,kE,e){var kH=this.origin;var i=(this.resolutions.length===0?this.calcResolutions(21)[kD]:this.resolutions[kD]);var kJ=this.gridSize;var kz=kE?0.5:0;var T=kE?0.5:0;var kI=Math.floor((kG-kH[0])/i+kz);var kB=Math.floor((kH[1]-kF)/i+T);var kC=kI/kJ[0];var kA=kB/kJ[1];if(kE){kC=Math.ceil(kC)-1;kA=Math.ceil(kA)-1}else{kC=Math.floor(kC);kA=Math.floor(kA)}return this.createOrUpdateTileCoord(kD,kC,kA,e)},getTileCoordForCoordAndZ:function(T,i,e){return this.getTileCoordForXYAndZ_(T[0],T[1],i,false,e)},getTileRangeExtent:function(T,kC){var kD=this.origin;if(this.resolutions.length===0){this.calcResolutions(23)}var kA=this.resolutions[T[0]];var kE=this.gridSize;var kB=kD[0]+T[1]*kE[0]*kA;var kz=kD[1]-(T[2]+1)*kE[1]*kA;var i=kB+kE[0]*kA;var e=kz+kE[1]*kA;return this.createOrUpdateTileRange(kB,i,kz,e,kC)},getTileLeftBottomMCPoint:function(kA,T){var i=this.origin;if(this.resolutions.length===0){this.calcResolutions(23)}var kz=this.resolutions[kA[0]];var kC=this.gridSize;var e=i[0]+kA[1]*kC[0]*kz;var kD=i[1]-(kA[2]+1)*kC[1]*kz;var kB=gcoord.transform([e,kD],gcoord.EPSG3857,gcoord.BD09MC);return kB},getRangeExtent:function(i,kH,kD,kJ,kz){var kE=this.calPiexlResolution(kJ,kz);var kC=kH/2*kE;var kF=kD/2*kE;var kB=i[0]-kC;var T=i[0]+kC;var kA=i[1]-kF;var e=i[1]+kF;var kG=gcoord.transform([kB,kA],gcoord[kz.target],gcoord[kz.source]);var kI=gcoord.transform([T,e],gcoord[kz.target],gcoord[kz.source]);return this.createOrUpdateTileRange(kG[0],kI[0],kG[1],kI[1])},getMousePoint:function(kC,kB,i,kA,T){var kz=kv(kC,kB);return this.calLngLatByMapViewPixelInverse(kz.clientPos,i,kB.width,kB.height,kA,T)},calLngLatByMapViewPixelInverse:function(kz,e,i,kG,kH,T){var kC=this.calPiexlResolution(kH,T);var kB=kz.x-i/2;var kA=kz.y-kG/2;var kE=e[0]+kB*kC;var kD=e[1]-kA*kC;var kF=gcoord.transform([kE,kD],gcoord[T.target],gcoord[T.source]);return kF},calPiexlResolution:function(T,i){var e;switch(i.target){case"BD09MC":e=Math.pow(2,(18-T));break;case"EPSG3857":e=this.resolutions[Math.floor(T)];break;default:e=Math.pow(2,(18-T));break}return e},getXYZCellPixelCoor:function(kC,kA,kz,i){var kE=this.gridSize;var kD;var kB;switch(i.source){case"GCJ02":case"EPSG3857":var T=Math.pow(2,kz-1)-(kA+1);var e=kC-Math.pow(2,kz-1);kD=e*kE[0];kB=T*kE[1];break;case"BD09MC":if(i.target==="EPSG3857"){kD=kC*kE[0];kB=kA*kE[1]}else{var T=Math.pow(2,kz-1)-(kA+1);var e=kC-Math.pow(2,kz-1);kD=e*kE[0];kB=T*kE[1]}default:break}return{x:kD,y:kB}},mcToPixel:function(i){var T=this.resolutions[Math.floor(zoom)];var e=i.lng/T;var kz=i.lat/T;return[e,kz]},getBaiduCellPixelCoor:function(e,kz,T){var i=256;return{x:e*i,y:kz*i}},getRelativePixelCoor:function(kB,kz){var i=this.origin;var kA=kB[0];var T=this.resolutions[Math.floor(kA)];var kC=this.gridSize;var e=i[0]/T+kB[1]*kC[0];var kD=i[1]/T-(kB[2]+1)*kC[1];return[kz[0]-e,kz[1]-kD]},getPointPixelCoor:function(e,kE,i){var kC;var kB;var T=Math.pow(2,(18-kE));var kz=this.resolutions[Math.floor(kE)];var kA=jv.convertMC2LL(e);switch(i.source){case"GCJ02":var kD=gcoord.transform([kA.lng,kA.lat],gcoord.BD09LL,gcoord.GCJ02);kD=gcoord.transform(kD,gcoord.WGS84,gcoord.EPSG3857);kC=kD[0]/kz;kB=kD[1]/kz;break;case"BD09LL":case"EPSG3857":var kD=gcoord.transform([kA.lng,kA.lat],gcoord.BD09LL,gcoord.EPSG3857);kC=kD[0]/kz;kB=kD[1]/kz;break;case"BD09MC":kC=e.lng/T;kB=e.lat/T;if(i.target==="BD09MC"){kC*=dL.gridScaleFromBDMCTo3857;kB*=dL.gridScaleFromBDMCTo3857}default:break}return[kC,kB]},getResolutionScale:function(i,e){var T;switch(e.target){case"BD09MC":T=this.gridScaleFrom3857ToBDMC;break;case"EPSG3857":T=this.gridScaleFromBDMCTo3857;break;default:T=this.gridScaleFrom3857ToBDMC;break}return T},getBaiduResolutionScale:function(T){var i=this.resolutions[Math.floor(T)];var e=Math.pow(2,(18-T));var kz=e/i;return kz},getTileCoordCenter:function(T){var e=this.origin;if(this.resolutions.length===0){this.calcResolutions(23)}var i=this.resolutions[T[0]];var kz=this.gridSize;return[e[0]+(T[1]+0.5)*kz[0]*i,e[1]-(T[2]+0.5)*kz[1]*i,]},transformBDmcPoint:function(kA,i){i=i||{};var T=i.source||"EPSG3857";var kz=jv.convertMC2LL(new cG(kA.lng,kA.lat));var e;switch(T){case"GCJ02":e=gcoord.transform([kz.lng,kz.lat],gcoord.BD09LL,gcoord.GCJ02);e=gcoord.transform(e,gcoord.WGS84,gcoord.EPSG3857);break;case"EPSG3857":e=gcoord.transform([kz.lng,kz.lat],gcoord.BD09LL,gcoord.EPSG3857);break;case"BD09MC":if(i.target==="EPSG3857"){e=gcoord.transform([kz.lng,kz.lat],gcoord.BD09LL,gcoord.EPSG3857)}else{e=[kA.lng,kA.lat]}break;default:e=gcoord.transform([kz.lng,kz.lat],gcoord.BD09LL,gcoord[T]);break}return e},transformPointArr:function(e,i,T){return gcoord.transform(e,gcoord[i||"BD09LL"],gcoord[T||"BD09MC"])},getTilesLoop:function(T,e){var i=Math.pow(2,T);while(e>i-1){e=e-i}while(e<0){e=e+i}return e},getLoopBox:function(e,kz){var i=this.HALF_SIZE*2;if(e[0]>0&&kz[2]<0){kz[2]=kz[2]+i}else{if(e[0]<0&&kz[0]>0){kz[0]=kz[0]-i}}return kz},createOrUpdateTileCoord:function(T,e,kz,i){if(i!==undefined){i[0]=T;i[1]=e;i[2]=kz;return i}else{return[T,e,kz]}},createOrUpdateTileRange:function(e,kz,kA,T,i){if(i!==undefined){i.minX=e;i.maxX=kz;i.minY=kA;i.maxY=T;return i}else{return{minX:e,maxX:kz,minY:kA,maxY:T}}},fromEPSG4326:function(T,kE,kC){var kA=T.length;var kB=kC>1?kC:2;var e=kE;if(e===undefined){if(kB>2){e=T.slice()}else{e=new Array(kA)}}for(var kz=0;kz<kA;kz+=kB){e[kz]=(this.HALF_SIZE*T[kz])/180;var kD=this.RADIUS*Math.log(Math.tan((Math.PI*(+T[kz+1]+90))/360));if(kD>this.MAX_SAFE_Y){kD=this.MAX_SAFE_Y}else{if(kD<-this.MAX_SAFE_Y){kD=-this.MAX_SAFE_Y}}e[kz+1]=kD}return e},toEPSG4326:function(T,kD,kC){var kA=T.length;var kB=kC>1?kC:2;var e=kD;if(e===undefined){if(kB>2){e=T.slice()}else{e=new Array(kA)}}for(var kz=0;kz<kA;kz+=kB){e[kz]=(180*T[kz])/this.HALF_SIZE;e[kz+1]=(360*Math.atan(Math.exp(T[kz+1]/this.RADIUS)))/Math.PI-90}return e},findParentGridAndPosition:function(kz,kJ,kI,kD,kE,kG,kC){if(kI-1<0){return false}var kK=kz;var kF=kJ;var T=kI;for(var kB=1;kB<=kC;kB++){var e=this.findParent(kK,kF,T,kB);if(!e){return false}var kH=this.getTileKey(e);var kA=kD.getData(kH);if(kA&&kA.status==="ready"){if(kE[kH]){continue}kG.setData(kA,this.drawIndex,0);kE[kH]=true;return true}kK=e.col;kF=e.row;T=e.zoom}},findParent:function(i,kA,T,kz){if(T-1<0){return null}var e=i%2;var kB=kA%2;return{col:Math.floor(i/2),row:Math.floor(kA/2),sonX:e,sonY:kB,thumbLB:[e*0.5,1-kB*0.5-0.5],thumbRT:[e*0.5+0.5,1-kB*0.5],radio:Math.pow(2,kz),zoom:T-1,useZoom:T-1}},getTileKey:function(e,kz){kz=kz||{};var i=typeof kz.useZoom==="number"?kz.useZoom:e.useZoom;var T=e.style||this.mapStyleId||"default";return this.mapType+"_"+T+"_"+e.col+"_"+e.row+"_"+e.zoom+"_"+i},lon2tile:function(i,e){return(Math.floor((i+180)/360*Math.pow(2,e)))},lat2tile:function(T,i){var e=Math.tan(T*Math.PI/180)+1/Math.cos(T*Math.PI/180);return(Math.floor((1-Math.log(e)/Math.PI)/2*Math.pow(2,i)))},tile2long:function(e,i){return(e/Math.pow(2,i)*360-180)},tile2lat:function(T,e){var i=Math.PI-2*Math.PI*T/Math.pow(2,e);return(180/Math.PI*Math.atan(0.5*(Math.exp(i)-Math.exp(-i))))}});function cA(i,e){if(i<-90){i=-90}else{if(i>90){i=90}}while(e<-180){e+=360}while(e>180){e-=360}e=e||0;i=i||0;cG.call(this,e,i)}cA.inherits(cG,"LatLng");e9.extend(cA.prototype,{equals:function(e){return(this.lat===e.lat&&this.lng===e.lng)},clone:function(){return new cA(this.lat,this.lng)},add:function(e){return new cA(this.lng+e.lng,this.lat+e.lat)},sub:function(e){return new cA(this.lat-e.lat,this.lng-e.lng)},mult:function(e){return new cA(this.lng*e,this.lat*e)},div:function(e){return new cA(this.lng/e,this.lat/e)},mag:function(){return Math.sqrt(this.lng*this.lng+this.lat*this.lat)},getLngSpan:function(e){var i=this.lng;var T=Math.abs(e-i);if(T>180){T=360-T}return T},toString:function(){return"LatLng"},toGeoJSON:function(){var i="Point";var T=[this.lng,this.lat];var e={type:"Feature",geometry:{type:i,coordinates:T},properties:this.properties};return e}});function cP(e,i){if(e&&!i){i=e}this._sw=this._ne=null;this._swLng=this._swLat=null;this._neLng=this._neLat=null;if(e){this._sw=new cA(e.lat,e.lng);this._ne=new cA(i.lat,i.lng);this._swLng=e.lng;this._swLat=e.lat;this._neLng=i.lng;this._neLat=i.lat}}e9.extend(cP.prototype,{isEmpty:function(){return !this._sw||!this._ne},equals:function(e){if(this.isEmpty()){return false}return this.getSouthWest().equals(e.getSouthWest())&&this.getNorthEast().equals(e.getNorthEast())},getSouthWest:function(){return this._sw},getNorthEast:function(){return this._ne},containsBounds:function(e){if(this.isEmpty()||e.isEmpty()){return false}return(e._swLng>this._swLng&&e._neLng<this._neLng&&e._swLat>this._swLat&&e._neLat<this._neLat)},getCenter:function(){if(this.isEmpty()){return null}return new cA((this._swLat+this._neLat)/2,(this._swLng+this._neLng)/2)},intersects:function(T){if(Math.max(T._swLng,T._neLng)<Math.min(this._swLng,this._neLng)||Math.min(T._swLng,T._neLng)>Math.max(this._swLng,this._neLng)||Math.max(T._swLat,T._neLat)<Math.min(this._swLat,this._neLat)||Math.min(T._swLat,T._neLat)>Math.max(this._swLat,this._neLat)){return false}var kA=Math.max(this._swLng,T._swLng);var i=Math.min(this._neLng,T._neLng);var kz=Math.max(this._swLat,T._swLat);var e=Math.min(this._neLat,T._neLat);this._sw=new cA(kz,kA);this._ne=new cA(e,i);this._swLng=kA;this._swLat=kz;this._neLng=i;this._neLat=e;return true},containsPoint:function(e){if(this.isEmpty()){return false}return(e.lng>=this._swLng&&e.lng<=this._neLng&&e.lat>=this._swLat&&e.lat<=this._neLat)},extend:function(e){var i=e.lng;var T=e.lat;if(!this._sw){this._sw=new cA(0,0)}if(!this._ne){this._ne=new cA(0,0)}if(!this._swLng||this._swLng>i){this._sw.lng=this._swLng=i}if(!this._neLng||this._neLng<i){this._ne.lng=this._neLng=i}if(!this._swLat||this._swLat>T){this._sw.lat=this._swLat=T}if(!this._neLat||this._neLat<T){this._ne.lat=this._neLat=T}},toSpan:function(){if(this.isEmpty()){return new cA(0,0)}return new cA(Math.abs(this._neLat-this._swLat),Math.abs(this._neLng-this._swLng))},union:function(i){if(i.isEmpty()){return false}var e=i.getSouthWest();var T=i.getNorthEast();if(this._swLat>e.lat){this._swLat=e.lat}if(this._swLng>e.lng){this._swLng=e.lng}if(this._neLat<T.lat){this._neLat=T.lat}if(this._neLng<T.lng){this._neLng=T.lng}this._sw=new cA(this._swLat,this._swLng);this._ne=new cA(this._neLat,this._neLng);return true},toString:function(){return this._swLat+", "+this._swLng+", "+this._neLat+", "+this._neLng}});window.COORDINATES_WGS84=1;window.COORDINATES_WGS84_MC=2;window.COORDINATES_GCJ02=3;window.COORDINATES_GCJ02_MC=4;window.COORDINATES_BD09=5;window.COORDINATES_BD09_MC=6;window.COORDINATES_MAPBAR=7;window.COORDINATES_51=8;function f7(){}f7.inherits(dh,"Convertor");e9.extend(f7.prototype,{translate:function(i,kA,kz,T){kA=kA||1;kz=kz||5;if(i.length>10){T&&T({status:25});return}if(window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]){var e=window._BMapSecurityConfig["serviceHost"]+"?qt=coords&coords=";e9.each(i,function(kB){e+=kB.lng+","+kB.lat+";"});e=e.replace(/;$/gi,"");e=e+"&from="+kA+"&to="+kz+"&v=gl&type=webgl"}else{var e=E.apiHost+"?qt=coords&coords=";e9.each(i,function(kB){e+=kB.lng+","+kB.lat+";"});e=e.replace(/;$/gi,"");e=e+"&from="+kA+"&to="+kz+"&v=gl&type=webgl&ak="+eZ}dq.request(e,function(kC){data=kC.content;if(typeof data!=="undefined"&&data!==null&&data.status===0){var kB=[];e9.each(data.result,function(kD){kB.push(new cG(kD.x,kD.y))});delete data.result;data.points=kB}else{if(kC.result&&kC.result.error){data={status:kC.result.errror,message:"访问错误，请参考错误状态码https://lbsyun.baidu.com/index.php?title=webapi/appendix"}}}T&&T(data)})}});var ep={idle:0,freeze:1,zooming:2,dragging:3,moving:4,readyToDrag:5,readyToPinch:6,pinching:7,stdMapCtrlDrag:8,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,arrowOpCodes:{37:1,38:2,39:4,40:8}};var am={_map:null,_html:"<div class='BMap_opMask' unselectable='on'></div>",_maskElement:null,_cursor:"default",inUse:false,show:function(e){if(!this._map){this._map=e}this.inUse=true;if(!this._maskElement){this._createMask(e)}this._maskElement.style.display="block"},_createMask:function(i){if(!this._map){this._map=i}if(!this._map){return}var e=this._maskElement=bS(this._map.container,this._html);e9.on(e,"mouseup",function(T){if(T.button==2){hH(T)}});e9.on(e,"contextmenu",hH);e.style.display="none"},getDrawPoint:function(kz,kC,kA){kz=window.event||kz;var i=kz.offsetX||kz.layerX||0;var kB=parseInt(kz.offsetY)||parseInt(kz.layerY)||0;var T=kz.target||kz.srcElement;if(T!=am.getDom(this._map)&&kC==true){while(T&&T!=this._map.container){if(!(T.clientWidth==0&&T.clientHeight==0&&T.offsetParent&&T.offsetParent.nodeName.toLowerCase()=="td")){i+=T.offsetLeft;kB+=T.offsetTop}T=T.offsetParent}}if(T!=am.getDom(this._map)&&T!=this._map.container){return}if(typeof i==="undefined"||typeof kB==="undefined"){return}if(isNaN(i)||isNaN(kB)){return}if(kA){i=i+kA.x;kB=kB+kA.y}return this._map.pixelToPointIn(new fv(i,kB))},hide:function(){if(!this._map){return}this.inUse=false;if(this._maskElement){this._maskElement.style.display="none"}},getDom:function(e){if(!this._maskElement){this._createMask(e)}return this._maskElement},setCursor:function(e){this._cursor=e||"default";if(this._maskElement){this._maskElement.style.cursor=this._cursor}}};function aU(){this._type="overlay"}aU.inherits(e9.BaseClass,"Overlay");aU.getZIndex=function(i,e){i=i*1;if(!i){return 0}if(e){i=jv.convertMC2LL(new cG(0,i)).lat}return(i*-100000)<<1};e9.extend(aU.prototype,{_i:function(T){this._map=T;if(!this.domElement&&b0(this.initialize)){this.domElement=this.initialize(T);if(this.domElement){this.domElement.style.WebkitUserSelect="none";if(this.enableDraggingMap!==undefined&&!this.enableDraggingMap&&!(this instanceof u)){var i=["mousedown","mouseout","mouseover","click","keydown","selectstart"];var e=this;e9.each(i,function(kz){e9.on(e.domElement,kz,al)})}}}this.draw()},initialize:function(e){throw"initialize方法未实现"},draw:function(){throw"draw方法未实现"},remove:function(){if(this.domElement&&this.domElement.parentNode){this.domElement.parentNode.removeChild(this.domElement)}this.domElement=null;this.dispatchEvent(new fW("onremove"))},hide:function(){this._visible=false;e9.hide(this.domElement)},show:function(){this._visible=true;e9.show(this.domElement)},isVisible:function(){return this._visible},getMap:function(){return this._map},dispose:function(){e9.BaseClass.prototype.decontrol.call(this)}});function eM(){e9.BaseClass.call(this);aU.call(this);this._visible=true;this._visibleInternal=true;this.zIndex=0;this.infoWindow=null;this._dblclickTime=0}eM.inherits(aU,"OverlayInternal");e9.extend(eM.prototype,{initialize:function(e){this.map=e;e9.BaseClass.call(this,this.hashCode);return null},draw:function(){},remove:function(){this.decontrol();aU.prototype.remove.call(this)},destroy:function(){},hide:function(){this._visible=false},show:function(){this._visible=true},getDom:function(){return this.domElement},getContainer:function(){return this.domElement},setClassName:function(){},setConfig:function(i){if(!i){return}for(var e in i){if(i.hasOwnProperty(e)){this._config[e]=i[e]}}},getPoint:function(T,kz){if(!T){return this.point}else{var e=kz?kz.width:0;var kA=kz?kz.height:0;if(this.map){var i=this.map.pointToPixelIn(this.point);if(this._config&&this._config.offset){i.x=i.x+this._config.offset.width+e;i.y=i.y+this._config.offset.height+kA}else{i.x=i.x+e;i.y=i.y+kA}return this.map.pixelToPointIn(i)}}},setZIndex:function(e){this.zIndex=e},isVisible:function(){if(!this.domElement){return false}return !!this._visible},enableMassClear:function(){this._config.enableMassClear=true},disableMassClear:function(){this._config.enableMassClear=false},showInternal:function(){this._visibleInternal=true},hideInternal:function(e){this._visibleInternal=false;this._hideInternalReason=e},addContextMenu:function(e){this._menu=e},removeContextMenu:function(e){this._menu=null}});function aS(e){this.map=e;this._overlays={};this._overlayArray=[];this._customOverlays=[];e._overlays=this._overlays;e._overlayArray=this._overlayArray;e._customOverlays=this._customOverlays;this._zoomingOrMoving=false;this._init()}aS.prototype._init=function(){if(this.map._renderType!=="webgl"){this._createOverlayContainers()}else{this._createWebGLOverlayContainers()}this._bind()};aS.prototype._createOverlayContainers=function(){var e=this.map;e.temp.overlayDiv=e.overlayDiv=this._createOverlayDiv(e.platform,200);e.temp.overlayDivEx=e.overlayDivEx=this._createOverlayDiv(e.platform,50);e._panes.floatPane=this._createOverlayDiv(e.temp.overlayDiv,800);e._panes.markerMouseTarget=this._createOverlayDiv(e.temp.overlayDiv,700);e._panes.floatShadow=this._createOverlayDiv(e.temp.overlayDiv,600);e._panes.labelPane=this._createOverlayDiv(e.temp.overlayDiv,500);e._panes.markerPane=this._createOverlayDiv(e.temp.overlayDiv,400);if(e.isCanvasMap()){e._panes.mapPane=this._createOverlayDiv(e.temp.overlayDivEx,50)}else{e._panes.mapPane=this._createOverlayDiv(e.temp.overlayDiv,200)}};aS.prototype._createWebGLOverlayContainers=function(){var e=this.map;e.temp.overlayDiv=e.overlayDiv=this._createOverlayDiv(e.platform,200);e._panes.floatPane=this._createOverlayDiv(e.temp.overlayDiv,800);e._panes.markerMouseTarget=this._createOverlayDiv(e.temp.overlayDiv,700);e._panes.floatShadow=this._createOverlayDiv(e.temp.overlayDiv,600);e._panes.labelPane=this._createOverlayDiv(e.temp.overlayDiv,500);e._panes.markerPane=this._createOverlayDiv(e.temp.overlayDiv,400)};aS.prototype._createOverlayDiv=function(e,kz){var T=b6("div");var i=T.style;i.position="absolute";i.top=i.left=i.width=i.height="0";i.zIndex=kz;e.appendChild(T);return T};aS.prototype._bind=function(){var kA=this.map;var kz=this;function i(kC){kz.draw(kC)}if(kA._renderType!=="webgl"){kA.addEventListener("load",i);kA.addEventListener("moveend",i);kA.addEventListener("resize",i);kA.addEventListener("zoomend",i);kA.addEventListener("zooming_inner",i)}else{kA.on("update",i)}kA.on("destroy",function(){kA._overlays={};kA._overlayArray=[];kA._customOverlays=[];kA.overlayDiv=null;kA.overlayDivEx=null;var kC=Object.keys(kA._panes);for(var kD=0;kD<kC.length;kD++){kA._panes[kC[kD]]=null}var kE=Object.keys(kA.temp);for(var kD=0;kD<kE.length;kD++){kA.temp[kE[kD]]=null}});kA.addEventListener("zoomend",function(kC){if(this.mapType==="B_EARTH_MAP"){if(this._earth.getZoom()<this._earth.zoomForNight+1){this.temp.overlayDiv.style.display="none";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display="none"}}else{if(this.temp.overlayDiv.style.display==="none"){this.temp.overlayDiv.style.display="";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display=""}if(this.temp.infoWin&&this.temp.infoWin.isOpen()){this.temp.infoWin.redraw()}}}}});kA.addEventListener("oncenterandzoom",function(kC){kz.draw(kC);if(this.mapType==="B_EARTH_MAP"){if(this._earth.getZoom()<this._earth.zoomForNight+1){this.temp.overlayDiv.style.display="none";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display="none"}}else{if(this.temp.overlayDiv.style.display==="none"){this.temp.overlayDiv.style.display="";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display=""}if(this.temp.infoWin&&this.temp.infoWin.isOpen()){this.temp.infoWin.redraw()}}}}});kA.addEventListener("maptypechange",function(kC){if(this.mapType==="B_EARTH_MAP"){if(this._panes.mapPane){this._panes.mapPane.style.display="none"}if(this._earth.getZoom()<this._earth.zoomForNight+1){this.temp.overlayDiv.style.display="none";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display="none"}}else{if(this.temp.overlayDiv.style.display==="none"){this.temp.overlayDiv.style.display="";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display=""}if(this.temp.infoWin&&this.temp.infoWin.isOpen()){this.temp.infoWin.redraw()}}}if(this._panes.markerPane){this._panes.markerPane.style.display="none"}}else{if(this._panes.mapPane){this._panes.mapPane.style.display=""}if(this._panes.markerPane){this._panes.markerPane.style.display=""}if(this.temp.overlayDiv.style.display==="none"){this.temp.overlayDiv.style.display="";if(this.temp.overlayDivEx){this.temp.overlayDivEx.style.display=""}if(this.temp.infoWin&&this.temp.infoWin.isOpen()){this.temp.infoWin.redraw()}}}kz.draw(kC)});kA.on("earthstatuschange",function kB(kC){kz.draw(kC)});kA.addEventListener("addoverlay",function(kG){var kD=kG.target;if(kD instanceof eM){if(!kz._overlays[kD.hashCode]){kz._overlays[kD.hashCode]=kD;kz._overlayArray.push(kD)}}else{var kF=false;for(var kE=0,kC=kz._customOverlays.length;kE<kC;kE++){if(kz._customOverlays[kE]===kD){kF=true;break}}if(!kF){kz._customOverlays.push(kD)}}});kA.addEventListener("removeoverlay",function(kF){var kD=kF.target;if(kD instanceof eM){delete kz._overlays[kD.hashCode];for(var kE=0;kE<kz._overlayArray.length;kE++){if(kz._overlayArray[kE]===kD){kz._overlayArray.splice(kE,1);break}}}else{for(var kE=0,kC=kz._customOverlays.length;kE<kC;kE++){if(kz._customOverlays[kE]===kD){kz._customOverlays.splice(kE,1);break}}}});kA.addEventListener("clearoverlays",function(kE){this.closeInfoWindow();this.closeSimpleInfoWindow();for(var kD in kz._overlays){if(kz._overlays[kD]._config.enableMassClear){this.removeOverlay(kz._overlays[kD])}}for(var kC=kz._customOverlays.length-1;kC>=0;kC--){if(kz._customOverlays[kC].enableMassClear!==false){this.removeOverlay(kz._customOverlays[kC]);kz._customOverlays.splice(kC,1)}}});kA.addEventListener("infowindowopen",function(kD){var kC=this.infoWindow;if(kC){e9.hide(kC.popDom);e9.hide(kC.shadowDom)}});function T(){if(this.getMapType()==="B_EARTH_MAP"||this._renderType==="webgl"){if(kz._zoomingOrMoving===false){this._panes.markerMouseTarget.style.display="none";kz._zoomingOrMoving=true}}}function e(kE){if(this.getMapType()==="B_EARTH_MAP"||this._renderType==="webgl"){if(kz._zoomingOrMoving===true){if(this._panes.markerMouseTarget){this._panes.markerMouseTarget.style.display=""}kz._zoomingOrMoving=false;for(var kD=0;kD<kz._overlayArray.length;kD++){var kC=kz._overlayArray[kD];if(kC instanceof kb===true){kC.draw(kE)}}}}}kA.addEventListener("tilt_changed",e);kA.addEventListener("heading_changed",e);kA.addEventListener("movestart",T);kA.addEventListener("moveend",e);kA.addEventListener("zoomstart",T);kA.addEventListener("zoomend",e);kA.addEventListener("animation_start",T);kA.addEventListener("animation_end",e);kA.addEventListener("displayoptions_changed",function(kC){if(this._displayOptions.overlay===false){this.temp.overlayDiv.style.display="none"}else{this.temp.overlayDiv.style.display=""}})};aS.prototype.draw=function(kC){kC=kC||{};if(this.map.getMapType()==="B_EARTH_MAP"){for(var kA=0;kA<this._overlayArray.length;kA++){var T=this._overlayArray[kA];if(T instanceof iU===true){continue}if(this._zoomingOrMoving){if(T instanceof kb===true){continue}}T.draw(kC)}}else{for(var kA=0,kz=this._overlayArray.length;kA<kz;kA++){var T=this._overlayArray[kA];if(this._zoomingOrMoving&&T instanceof kb===true){continue}T.draw(kC)}}e9.each(this._customOverlays,function(e){e.draw(kC);if(!(e instanceof bU)){hP.sendMessage(a1(4,2,12),["overlay","user_custom"])}});if(this.map.temp.infoWin){this.map.temp.infoWin.setPosition(kC.center,kC.zoom)}if(this.map.getMapType()!=="B_EARTH_MAP"&&this.map._renderType!=="webgl"){if(bG.DrawerSelector){var kB=bG.DrawerSelector.getDrawer(this.map);kB.setPalette()}}};bG.register(function(e){e._overlayMgr=new aS(e)});function iU(e){eM.call(this);this._config={strokeColor:"#000",strokeWeight:2,strokeOpacity:1,strokeStyle:"solid",dashArray:null,strokeLineCap:"round",strokeLineJoin:"round",enableMassClear:true,getParseTolerance:null,getParseCacheIndex:null,enableParse:true,enableEditing:false,mouseOverTolerance:5,geodesic:false,linkRight:false,clip:true,texture:null,textureSize:null,textureZoomWithMap:false,textureRepeat:true,zIndex:0};this.setConfig(e);if(this._config.zIndex!==undefined){this.zIndex=this._config.zIndex}if(this._config.strokeOpacity<0||this._config.strokeOpacity>1){this._config.strokeOpacity=1}if(this._config.fillOpacity<0||this._config.fillOpacity>1){this._config.fillOpacity=1}if(this._config.strokeStyle!=="solid"&&this._config.strokeStyle!=="dashed"&&this._config.strokeStyle!=="dotted"){this._config.strokeStyle="solid"}this.domElement=null;this._bounds=new ij();this.points=[];this.greatCirclePoints=[];this._parseCache=[];this._holesCache=[];this._parseCacheGL=[];this._parseCacheGLRaw=[];this._areaCacheGL=[];this._strokeStyleInfoForGL=[[]];this._fillStyleInfoForGL="";this.vertexMarkers=[];this._temp={}}iU.JOININDEX={miter:0,round:1,bevel:2};iU.CAPINDEX={round:0,butt:1,square:2};iU.inherits(eM,"Graph");iU.getGraphPoints=function(i){var e=[];if(!i||i.length===0){return e}if(typeof i==="string"){var T=i.split(";");e9.each(T,function(kA){var kz=kA.split(",");e.push(new cG(kz[0],kz[1]))})}if(i.constructor===Array&&i.length>0){e=i}return e};iU.parseTolerance={0:[0.09,0.005,0.0001,0.00001],1:[9000,500,20,1]};e9.extend(iU.prototype,{initialize:function(e){this.map=e;return null},draw:function(){},setPoints:function(e){this._clearCache();this.points=iU.getGraphPoints(e).slice(0);this._calcBounds()},setPathIn:function(e){this.setPoints(e)},_calcBounds:function(){if(!this.points){return}var e=this;e._bounds=new ij();if(!this.hasMultipleParts){e9.each(this.points,function(i){e._bounds.extend(i)})}else{e9.each(this.points,function(i){e9.each(i,function(T){e._bounds.extend(T)})})}},getPoints:function(){return this.points},getPathIn:function(){return this.points},setPointAt:function(i,e){if(!e||!this.points[i]){return}this._clearCache();this.points[i]=new cG(e.lng,e.lat);this._calcBounds()},setPositionAt:function(i,e){if(!e||!this.points[i]){return}var T=jv.convertLL2MC(e);this.setPointAt(i,T)},setOptions:function(i){i=i||{};for(var e in i){if(i.hasOwnProperty(e)){this._config[e]=i[e]}}},setStrokeColor:function(e){this._config.strokeColor=e},getStrokeColor:function(){return this._config.strokeColor},setStrokeLineCap:function(e){this._config.strokeLineCap=e},getStrokeLineCap:function(){return this._config.strokeLineCap},setStrokeLineJoin:function(e){this._config.strokeLineJoin=e},getStrokeLineJoin:function(){return this._config.strokeLineJoin},setStrokeWeight:function(e){if(e>0){this._config.strokeWeight=e}},getStrokeWeight:function(){return this._config.strokeWeight},setStrokeOpacity:function(e){if(!e||e>1||e<0){return}this._config.strokeOpacity=e},getStrokeOpacity:function(){return this._config.strokeOpacity},setFillOpacity:function(e){if(e>1||e<0){return}this._config.fillOpacity=e},getFillOpacity:function(){return this._config.fillOpacity},setStrokeStyle:function(e){if(e!=="solid"&&e!=="dashed"&&e!=="dotted"){return}this._config.strokeStyle=e},getStrokeStyle:function(){return this._config.strokeStyle},setFillColor:function(e){this._config.fillColor=e||""},getFillColor:function(){return this._config.fillColor},getBoundsIn:function(){this._bounds.setMinMax();return this._bounds},getBounds:function(){var e=this.getBoundsIn();var i=new ij(jv.convertMC2LL(e.getSouthWest()),jv.convertMC2LL(e.getNorthEast()));i.setMinMax();return i},remove:function(){if(this.map){this.map.removeEventListener("onmousemove",this._graphMouseEvent);this.map.removeEventListener("onclick",this._graphClickEvent)}eM.prototype.remove.call(this);this._clearCache();var e=new fW("onlineupdate");e.action="remove";e.overlay=this;this.fire(e)},enableEditing:function(){if(this.points.length<2){return}this._config.enableEditing=true;var e=this;hl.load("poly",function(){e.addVertexs()},true)},disableEditing:function(){this._config.enableEditing=false;var e=this;hl.load("poly",function(){e.clearVertexs()},true)},getLength:function(){if(typeof this._length==="number"){return this._length}if(typeof this._config.totalLength==="number"){this._length=this._config.totalLength;return this._length}var T=0;if(this.points.length<=1){this._length=0;return T}for(var e=0;e<this.points.length-1;e++){T+=eF(this.points[e],this.points[e+1])}this._length=T;return T},getParsedPoints:function(){var e=this._simplification(this.points);if(this.hasMultipleParts){return e}return[e]},_simplification:function(kE){var e=this.map;var kD=this.getParseCacheIndex(e.getZoom());var kG;if(this._parseCache[kD]){kG=this._parseCache[kD]}else{var kB=kE;if(this.greatCirclePoints.length>0){kB=this.greatCirclePoints}var kA=e.config.coordType===2?1:e.config.coordType;var kC=this.getParseTolerance(e.getZoom(),kA);if(!this.hasMultipleParts){var kF=d2(kB,kC)}else{var kF=[];for(var T=0;T<kB.length;T++){var kz=d2(kB[T],kC);kF.push(kz)}}kG=this._parseCache[kD]=kF}return kG},_clearCache:function(){this._length=null;this._parseCache.length=0;this._parseCacheGL.length=0;this._parseCacheGLRaw.length=0;this._areaCacheGL.length=0},canRenderDataBeMerged:function(){var e=this._config;if(e.texture){return false}return true}});if(e9.Browser.ie&&document.namespaces&&!document.namespaces.olv){document.namespaces.add("olv","urn:schemas-microsoft-com:vml")}function bz(kB,kz,kI){var kF=false,kD=false,kG=false,kK=new fv(kB.x,kB.y),kJ=new fv(kz.x,kz.y),kA=fX(kK,kI),T=fX(kJ,kI),kH;var kM,kL;var kE=kI.minX,kC=kI.minY,i=kI.maxX,e=kI.maxY;do{if(kA.all==0&&T.all==0){kF=true;kG=true}else{if((kA.all&T.all)!=0){kG=true}else{if(kA.all!=0){kH=kA}else{kH=T}if(kH.top){kM=kK.x+(kJ.x-kK.x)*(kC-kK.y)/(kJ.y-kK.y);kL=kC}else{if(kH.bottom){kM=kK.x+(kJ.x-kK.x)*(e-kK.y)/(kJ.y-kK.y);kL=e}else{if(kH.right){kL=kK.y+(kJ.y-kK.y)*(i-kK.x)/(kJ.x-kK.x);kM=i}else{if(kH.left){kL=kK.y+(kJ.y-kK.y)*(kE-kK.x)/(kJ.x-kK.x);kM=kE}}}}kD=true;if(kH.all==kA.all){kK.x=Math.round(kM);kK.y=Math.round(kL);kA=fX(kK,kI)}else{kJ.x=Math.round(kM);kJ.y=Math.round(kL);T=fX(kJ,kI)}}}}while(!kG);if(kF){return{pixel0:new fv(kK.x,kK.y),pixel1:new fv(kJ.x,kJ.y),clip:kD?true:false}}}function fX(i,kA){var T={top:0,bottom:0,right:0,left:0,all:0};var e=i.x,kz=i.y;if(kz<kA.minY){T.top=8;T.all+=T.top}else{if(kz>kA.maxY){T.bottom=4;T.all+=T.bottom}}if(e>kA.maxX){T.right=2;T.all+=T.right}else{if(e<kA.minX){T.left=1;T.all+=T.left}}return T}function dS(e){e=e.replace(/,/gm," ");e=e.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");e=e.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");e=e.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");e=e.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");e=e.replace(/([0-9])([+\-])/gm,"$1 $2");e=e.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");e=e.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 ");e=dS.compressSpaces(e);e=dS.trim(e);this.PathParser=new (function(i){this.tokens=i.split(" ");this.reset=function(){this.i=-1;this.command="";this.previousCommand="";this.start=new dS.Point(0,0);this.control=new dS.Point(0,0);this.current=new dS.Point(0,0);this.points=[];this.angles=[]};this.isEnd=function(){return this.i>=this.tokens.length-1};this.isCommandOrEnd=function(){if(this.isEnd()){return true}return this.tokens[this.i+1].match(/^[A-Za-z]$/)!=null};this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return true;break}return false};this.getToken=function(){this.i++;return this.tokens[this.i]};this.getScalar=function(){return parseFloat(this.getToken())};this.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken()};this.getPoint=function(){var T=new dS.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(T)};this.getAsControlPoint=function(){var T=this.getPoint();this.control=T;return T};this.getAsCurrentPoint=function(){var T=this.getPoint();this.current=T;return T};this.getReflectedControlPoint=function(){if(this.previousCommand.toLowerCase()!="c"&&this.previousCommand.toLowerCase()!="s"&&this.previousCommand.toLowerCase()!="q"&&this.previousCommand.toLowerCase()!="t"){return this.current}var T=new dS.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return T};this.makeAbsolute=function(T){if(this.isRelativeCommand()){T.x+=this.current.x;T.y+=this.current.y}return T};this.addMarker=function(kz,kA,T){if(T!=null&&this.angles.length>0&&this.angles[this.angles.length-1]==null){this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(T)}this.addMarkerAngle(kz,kA==null?null:kA.angleTo(kz))};this.addMarkerAngle=function(kz,T){this.points.push(kz);this.angles.push(T)};this.getMarkerPoints=function(){return this.points};this.getMarkerAngles=function(){for(var kz=0;kz<this.angles.length;kz++){if(this.angles[kz]==null){for(var T=kz+1;T<this.angles.length;T++){if(this.angles[T]!=null){this.angles[kz]=this.angles[T];break}}}}return this.angles}})(e);this.bounds=function(){return this.draw(null)};this.draw=function(kT){var kV=this.PathParser;kV.reset();var kG=new dS.BoundingBox();if(kT!=null){kT.beginPath()}while(!kV.isEnd()){kV.nextCommand();switch(kV.command){case"M":case"m":var kQ=kV.getAsCurrentPoint();kV.addMarker(kQ);kG.addPoint(kQ.x,kQ.y);if(kT!=null){kT.moveTo(kQ.x,kQ.y)}kV.start=kV.current;while(!kV.isCommandOrEnd()){var kQ=kV.getAsCurrentPoint();kV.addMarker(kQ,kV.start);kG.addPoint(kQ.x,kQ.y);if(kT!=null){kT.lineTo(kQ.x,kQ.y)}}break;case"L":case"l":while(!kV.isCommandOrEnd()){var kZ=kV.current;var kQ=kV.getAsCurrentPoint();kV.addMarker(kQ,kZ);kG.addPoint(kQ.x,kQ.y);if(kT!=null){kT.lineTo(kQ.x,kQ.y)}}break;case"H":case"h":while(!kV.isCommandOrEnd()){var kz=new dS.Point((kV.isRelativeCommand()?kV.current.x:0)+kV.getScalar(),kV.current.y);kV.addMarker(kz,kV.current);kV.current=kz;kG.addPoint(kV.current.x,kV.current.y);if(kT!=null){kT.lineTo(kV.current.x,kV.current.y)}}break;case"V":case"v":while(!kV.isCommandOrEnd()){var kz=new dS.Point(kV.current.x,(kV.isRelativeCommand()?kV.current.y:0)+kV.getScalar());kV.addMarker(kz,kV.current);kV.current=kz;kG.addPoint(kV.current.x,kV.current.y);if(kT!=null){kT.lineTo(kV.current.x,kV.current.y)}}break;case"C":case"c":while(!kV.isCommandOrEnd()){var kX=kV.current;var kB=kV.getPoint();var kC=kV.getAsControlPoint();var kI=kV.getAsCurrentPoint();kV.addMarker(kI,kC,kB);kG.addBezierCurve(kX.x,kX.y,kB.x,kB.y,kC.x,kC.y,kI.x,kI.y);if(kT!=null){kT.bezierCurveTo(kB.x,kB.y,kC.x,kC.y,kI.x,kI.y)}}break;case"S":case"s":while(!kV.isCommandOrEnd()){var kX=kV.current;var kB=kV.getReflectedControlPoint();var kC=kV.getAsControlPoint();var kI=kV.getAsCurrentPoint();kV.addMarker(kI,kC,kB);kG.addBezierCurve(kX.x,kX.y,kB.x,kB.y,kC.x,kC.y,kI.x,kI.y);if(kT!=null){kT.bezierCurveTo(kB.x,kB.y,kC.x,kC.y,kI.x,kI.y)}}break;case"Q":case"q":while(!kV.isCommandOrEnd()){var kX=kV.current;var kC=kV.getAsControlPoint();var kI=kV.getAsCurrentPoint();kV.addMarker(kI,kC,kC);kG.addQuadraticCurve(kX.x,kX.y,kC.x,kC.y,kI.x,kI.y);if(kT!=null){kT.quadraticCurveTo(kC.x,kC.y,kI.x,kI.y)}}break;case"T":case"t":while(!kV.isCommandOrEnd()){var kX=kV.current;var kC=kV.getReflectedControlPoint();kV.control=kC;var kI=kV.getAsCurrentPoint();kV.addMarker(kI,kC,kC);kG.addQuadraticCurve(kX.x,kX.y,kC.x,kC.y,kI.x,kI.y);if(kT!=null){kT.quadraticCurveTo(kC.x,kC.y,kI.x,kI.y)}}break;case"A":case"a":while(!kV.isCommandOrEnd()){var kX=kV.current;var kF=kV.getScalar();var kE=kV.getScalar();var T=kV.getScalar()*(Math.PI/180);var kH=kV.getScalar();var kD=kV.getScalar();var kI=kV.getAsCurrentPoint();var k2=new dS.Point(Math.cos(T)*(kX.x-kI.x)/2+Math.sin(T)*(kX.y-kI.y)/2,-Math.sin(T)*(kX.x-kI.x)/2+Math.cos(T)*(kX.y-kI.y)/2);var kU=Math.pow(k2.x,2)/Math.pow(kF,2)+Math.pow(k2.y,2)/Math.pow(kE,2);if(kU>1){kF*=Math.sqrt(kU);kE*=Math.sqrt(kU)}var kM=(kH==kD?-1:1)*Math.sqrt(((Math.pow(kF,2)*Math.pow(kE,2))-(Math.pow(kF,2)*Math.pow(k2.y,2))-(Math.pow(kE,2)*Math.pow(k2.x,2)))/(Math.pow(kF,2)*Math.pow(k2.y,2)+Math.pow(kE,2)*Math.pow(k2.x,2)));if(isNaN(kM)){kM=0}var kL=new dS.Point(kM*kF*k2.y/kE,kM*-kE*k2.x/kF);var kA=new dS.Point((kX.x+kI.x)/2+Math.cos(T)*kL.x-Math.sin(T)*kL.y,(kX.y+kI.y)/2+Math.sin(T)*kL.x+Math.cos(T)*kL.y);var kS=function(k3){return Math.sqrt(Math.pow(k3[0],2)+Math.pow(k3[1],2))};var kO=function(k4,k3){return(k4[0]*k3[0]+k4[1]*k3[1])/(kS(k4)*kS(k3))};var k0=function(k4,k3){return(k4[0]*k3[1]<k4[1]*k3[0]?-1:1)*Math.acos(kO(k4,k3))};var k1=k0([1,0],[(k2.x-kL.x)/kF,(k2.y-kL.y)/kE]);var kK=[(k2.x-kL.x)/kF,(k2.y-kL.y)/kE];var kJ=[(-k2.x-kL.x)/kF,(-k2.y-kL.y)/kE];var kY=k0(kK,kJ);if(kO(kK,kJ)<=-1){kY=Math.PI}if(kO(kK,kJ)>=1){kY=0}var kR=1-kD?1:-1;var kW=k1+kR*(kY/2);var i=new dS.Point(kA.x+kF*Math.cos(kW),kA.y+kE*Math.sin(kW));kV.addMarkerAngle(i,kW-kR*Math.PI/2);kV.addMarkerAngle(kI,kW-kR*Math.PI);kG.addPoint(kI.x,kI.y);if(kT!=null){var kO=kF>kE?kF:kE;var kP=kF>kE?1:kF/kE;var kN=kF>kE?kE/kF:1;kT.translate(kA.x,kA.y);kT.rotate(T);kT.scale(kP,kN);kT.arc(0,0,kO,k1,k1+kY,1-kD);kT.scale(1/kP,1/kN);kT.rotate(-T);kT.translate(-kA.x,-kA.y)}}break;case"Z":case"z":if(kT!=null){kT.closePath()}kV.current=kV.start}}return kG};this.getMarkers=function(){var kz=this.PathParser.getMarkerPoints();var kB=this.PathParser.getMarkerAngles();var kA=[];for(var T=0;T<kz.length;T++){kA.push([kz[T],kB[T]])}return kA}}dS.trim=function(e){return e.replace(/^\s+|\s+$/g,"")};dS.compressSpaces=function(e){return e.replace(/[\s\r\t\n]+/gm," ")};dS.Point=function(e,i){this.x=e;this.y=i};dS.Point.prototype.angleTo=function(e){return Math.atan2(e.y-this.y,e.x-this.x)};dS.Point.prototype.applyTransform=function(e){var i=this.x*e[0]+this.y*e[2]+e[4];var T=this.x*e[1]+this.y*e[3]+e[5];this.x=i;this.y=T};dS.BoundingBox=function(i,kz,e,T){this.x1=Number.NaN;this.y1=Number.NaN;this.x2=Number.NaN;this.y2=Number.NaN;this.x=function(){return this.x1};this.y=function(){return this.y1};this.width=function(){return this.x2-this.x1};this.height=function(){return this.y2-this.y1};this.addPoint=function(kA,kB){if(kA!=null){if(isNaN(this.x1)||isNaN(this.x2)){this.x1=kA;this.x2=kA}if(kA<this.x1){this.x1=kA}if(kA>this.x2){this.x2=kA}}if(kB!=null){if(isNaN(this.y1)||isNaN(this.y2)){this.y1=kB;this.y2=kB}if(kB<this.y1){this.y1=kB}if(kB>this.y2){this.y2=kB}}};this.addX=function(kA){this.addPoint(kA,null)};this.addY=function(kA){this.addPoint(null,kA)};this.addBoundingBox=function(kA){this.addPoint(kA.x1,kA.y1);this.addPoint(kA.x2,kA.y2)};this.addQuadraticCurve=function(kF,kE,kB,kA,kH,kG){var kD=kF+2/3*(kB-kF);var kC=kE+2/3*(kA-kE);var kJ=kD+1/3*(kH-kF);var kI=kC+1/3*(kG-kE);this.addBezierCurve(kF,kE,kD,kJ,kC,kI,kH,kG)};this.addBezierCurve=function(kN,kM,kE,kC,kJ,kH,kP,kO){var kF=[kN,kM],kD=[kE,kC],kB=[kJ,kH],kA=[kP,kO];this.addPoint(kF[0],kF[1]);this.addPoint(kA[0],kA[1]);for(jK=0;jK<=1;jK++){var kQ=function(kU){return Math.pow(1-kU,3)*kF[jK]+3*Math.pow(1-kU,2)*kU*kD[jK]+3*(1-kU)*Math.pow(kU,2)*kB[jK]+Math.pow(kU,3)*kA[jK]};var kS=6*kF[jK]-12*kD[jK]+6*kB[jK];var kT=-3*kF[jK]+9*kD[jK]-9*kB[jK]+3*kA[jK];var kR=3*kD[jK]-3*kF[jK];if(kT==0){if(kS==0){continue}var kL=-kR/kS;if(0<kL&&kL<1){if(jK==0){this.addX(kQ(kL))}if(jK==1){this.addY(kQ(kL))}}continue}var kG=Math.pow(kS,2)-4*kR*kT;if(kG<0){continue}var kK=(-kS+Math.sqrt(kG))/(2*kT);if(0<kK&&kK<1){if(jK==0){this.addX(kQ(kK))}if(jK==1){this.addY(kQ(kK))}}var kI=(-kS-Math.sqrt(kG))/(2*kT);if(0<kI&&kI<1){if(jK==0){this.addX(kQ(kI))}if(jK==1){this.addY(kQ(kI))}}}};this.isPointInBox=function(kA,kB){return(this.x1<=kA&&kA<=this.x2&&this.y1<=kB&&kB<=this.y2)};this.addPoint(i,kz);this.addPoint(e,T)};function ft(i,e){this.id=bG.getGUID("symbol_icon_");this.size=(i instanceof jm)?i:new jm(2,2);this.anchor=(e instanceof jm)?e:new jm(this.size.width/2,this.size.height/2);this.data=null;this.offset=this.anchor;this.imageSize=this.size;this.imageOffset=new jm(0,0);this.style={scale:1,rotation:0};this.srcSetObject={};this._initOptions={size:this.size,scale:this.style.scale,rotation:this.style.rotation};this.overlay=null;this.isReDraw=false}ft.prototype.add=function(){const e=document.createElement("canvas");e.width=this.size.width;e.height=this.size.height;this.context=e.getContext("2d")};ft.prototype.remove=function(){if(this.context){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height);this.context.canvas.width=0;this.context.canvas.height=0}this.context=null;this.data=null};ft.prototype.render=function(e){return true};ft.prototype.resetInitOptions=function(){this._initOptions=new jm(this.size.width,this.size.height);this._initOptions.scale=this.style.scale;this._initOptions.rotation=this.style.rotation};ft.prototype.update=function(){var e=this.overlay;if(e){if(e.domElement){var kz=(this.style.scale-this._initOptions.scale)/this._initOptions.scale;if(kz>=0){kz=kz+1}else{kz=1+kz}var i=this._initOptions.rotation===0?this.style.rotation:(this.style.rotation-this._initOptions.rotation);while(i<0){i+=360}var T=e.domElement.style;T.width=this._initOptions.width+"px";T.height=this._initOptions.height+"px";T.transform="rotate("+i+"deg) scale("+kz+")"}if(!this.isReDraw){this._refresh(e)}}};ft.prototype._refresh=function(e){e.textureCoord=e.textureCoordGLMap=null;var i=new fW("onstatus_change");i.overlay=e;i.action="setIcon";i.imageUrlChanged=true;setTimeout(function(){e.fire(i)},100)};ft.prototype.generateRenderData=function(){var i=this.offset=this.anchor;var e=this.size;var T=[];T.push(-i.width,i.height-e.height,0);T.push(e.width-i.width,i.height-e.height,0);T.push(e.width-i.width,i.height,0);T.push(-i.width,i.height-e.height,0);T.push(e.width-i.width,i.height,0);T.push(-i.width,i.height,0);return{vertex:T}};ft.prototype.getCurrentImageUrl=function(){return this.id};ft.prototype.getRenderData=function(){this._renderData=this.generateRenderData();return this._renderData};ft.prototype.toString=function(){return"Symbol"};var fJ={14:"m-0.00573,-10c-5.51975,0 -9.99427,4.47453 -9.99427,9.99428c0,5.51974 4.47452,9.99425 9.99427,9.99425c5.51972,0 9.99426,-4.47452 9.99426,-9.99425c0,-5.51975 -4.47453,-9.99428 -9.99426,-9.99428zm0,17.92491c-4.37412,0 -7.93132,-3.55788 -7.93132,-7.93063c0,-4.37345 3.5572,-7.93134 7.93132,-7.93134c4.37411,0 7.93062,3.55721 7.93062,7.93134c0,4.37412 -3.55789,7.93063 -7.93062,7.93063zm-0.00068,-15.4088c-0.38027,0 -0.68696,0.30807 -0.68696,0.68765l0,6.34078l-4.15752,1.81815c-0.34794,0.15266 -0.50611,0.55837 -0.35344,0.90632c0.11278,0.25787 0.36445,0.4119 0.6292,0.4119c0.09214,0 0.18635,-0.01857 0.27575,-0.05845l4.55635,-1.99279c0.00344,-0.00137 0.00619,-0.00275 0.00894,-0.00412l0.00275,-0.00138c0.01032,-0.00413 0.01581,-0.01376 0.02545,-0.01719c0.07151,-0.03576 0.13821,-0.07771 0.19185,-0.1341c0.02337,-0.02338 0.03644,-0.05364 0.05431,-0.08045c0.03301,-0.04401 0.06946,-0.08733 0.0894,-0.14028c0.0165,-0.04126 0.01787,-0.08596 0.02613,-0.12997c0.00894,-0.04469 0.02614,-0.08389 0.02614,-0.1286l0,-6.7905c0,-0.37889 -0.30807,-0.68697 -0.68833,-0.68697z",13:"m-0.00706,-9.5c-5.24281,0 -9.49294,4.25065 -9.49294,9.49294c0,5.24331 4.25014,9.49294 9.49294,9.49294c5.24281,0 9.49294,-4.24964 9.49294,-9.49294c0,-5.2423 -4.25013,-9.49294 -9.49294,-9.49294zm3.08857,3.85997c0.61044,0 1.10279,0.96873 1.10279,2.16271s-0.49384,2.1647 -1.10279,2.1647c-0.60844,0 -1.10228,-0.96873 -1.10228,-2.16372s0.49434,-2.16369 1.10228,-2.16369zm-6.28628,0c0.60844,0 1.10228,0.96873 1.10228,2.16271s-0.49284,2.1647 -1.10228,2.1647s-1.10277,-0.96873 -1.10277,-2.16372s0.49383,-2.16369 1.10277,-2.16369zm3.21167,12.16493c-1.87667,0 -3.63373,-1.14814 -5.14663,-3.14239c1.56571,1.02156 3.27993,1.59064 5.07786,1.59064c1.90905,0 3.72343,-0.63985 5.36539,-1.78497c-1.54429,2.11685 -3.35767,3.33672 -5.29662,3.33672l-0.00001,0z",12:"m9.27295,5.92958l-2.64443,-4.57961c-0.79727,-1.37992 -2.10131,-3.63983 -2.8986,-5.01973l-2.64441,-4.57858c-0.79782,-1.38093 -2.10186,-1.38093 -2.89913,0l-2.64335,4.57858c-0.79728,1.3799 -2.10188,3.63981 -2.89916,5.01973l-2.64387,4.57961c-0.79728,1.38101 -0.14472,2.50988 1.44983,2.50988l16.37221,0c1.59561,0 2.24711,-1.12887 1.45091,-2.50988l0,0zm-8.88166,0.70811l-1.56837,0l0,-1.50484l1.56837,0l0,1.50484zm-0.07527,-2.61447l-1.41621,0l-0.14044,-6.44231l1.68427,0l-0.12761,6.44231l0,0z",11:"m8.08295,-6.56414l-3.59319,0l0,-1.43586l-8.98155,0l0,1.43586l-3.59321,0c-1.0569,0 -1.915,0.85509 -1.915,1.91159l0,9.92258c0,1.05357 0.8581,1.91158 1.915,1.91158l16.16796,0c1.05692,0 1.91501,-0.85801 1.91501,-1.91158l0,-9.92258c0,-1.0565 -0.85809,-1.91159 -1.91501,-1.91159l0,0zm-8.08397,12.66884c-3.20143,0 -5.80643,-2.60031 -5.80643,-5.79596c0,-3.19569 2.605,-5.79891 5.80643,-5.79891s5.80789,2.60322 5.80789,5.79891c0,3.19565 -2.60794,5.79596 -5.80789,5.79596zm0,-9.6804c-2.15036,0 -3.89142,1.7394 -3.89142,3.88444c0,2.14503 1.74252,3.8844 3.89142,3.8844c2.1489,0 3.89141,-1.73937 3.89141,-3.8844c0,-2.14503 -1.74105,-3.88444 -3.89141,-3.88444z",10:"m0,-10c-0.20885,0 -0.39491,0.08583 -0.55177,0.24149c-0.15674,0.15536 -0.28646,0.37838 -0.39429,0.65665c-0.21586,0.55655 -0.34853,1.33844 -0.42114,2.27477c-0.07231,0.93446 -0.08474,2.02273 -0.05447,3.18765c-2.58175,1.05925 -7.81787,3.24648 -8.23854,3.73474c-0.56001,0.65029 -0.37908,1.3954 -0.15331,1.89002l8.608,-1.75235c0.18202,2.28374 0.4407,4.5455 0.66615,6.31771c-0.8418,0.24646 -2.41323,0.73303 -2.73754,1.03474c-0.4469,0.41562 -0.4469,1.75793 -0.4469,1.75793l3.52318,-0.28665c0.08286,0.57874 0.13486,0.9163 0.13486,0.9163l0.00511,0.03042l0.02778,0l0.06486,0l0.02778,0l0.00511,-0.03042c0,0 0.05185,-0.33756 0.13486,-0.9163l3.52424,0.28665c0,0 0,-1.34231 -0.44688,-1.75793c-0.32446,-0.30172 -1.89697,-0.7895 -2.73847,-1.0358c0.22484,-1.76681 0.4832,-4.02001 0.66507,-6.29634l8.50712,1.73203c0.22561,-0.49462 0.40765,-1.23973 -0.15237,-1.89002c-0.41538,-0.48221 -5.52504,-2.62071 -8.1386,-3.69423c0.03119,-1.17999 0.01971,-2.28285 -0.05353,-3.22816l0,-0.00233c-0.07263,-0.93523 -0.20545,-1.71635 -0.42114,-2.27244c-0.10784,-0.27827 -0.23634,-0.50114 -0.3932,-0.65665c-0.15689,-0.15567 -0.34293,-0.24149 -0.55195,-0.24149l0,0l0,0l0,0l0.00001,0l0,0l-0.00003,0.00001z",3:"m-10,0l10,-10l10,10l-10,10l-10,-10z",5:"M0,0 L-5,-15 0,-10 5,-15 z",6:"M0,0 L5,15 0,10 -5,15z",7:"M-5,-15 L0,0 5,-15",8:"M-5,15 L0,0 5,15",9:"m0,-24c-4.4183,0 -8,3.58167 -8,8c0,1.42102 0.3816,2.75 1.0312,3.90601c0.1079,0.19202 0.221,0.38098 0.3438,0.56299l6.625,11.53101l6.625,-11.53101c0.102,-0.151 0.19,-0.31097 0.281,-0.46899l0.063,-0.09399c0.649,-1.15601 1.031,-2.48499 1.031,-3.90601c0,-4.41833 -3.582,-8 -8,-8zm0,4c2.209,0 4,1.79089 4,4c0,2.20898 -1.791,4 -4,4c-2.2091,0 -4,-1.79102 -4,-4c0,-2.20911 1.7909,-4 4,-4z"};var cf={BMap_Symbol_SHAPE_CIRCLE:1,BMap_Symbol_SHAPE_RECTANGLE:2,BMap_Symbol_SHAPE_RHOMBUS:3,BMap_Symbol_SHAPE_STAR:4,BMap_Symbol_SHAPE_BACKWARD_CLOSED_ARROW:5,BMap_Symbol_SHAPE_FORWARD_CLOSED_ARROW:6,BMap_Symbol_SHAPE_BACKWARD_OPEN_ARROW:7,BMap_Symbol_SHAPE_FORWARD_OPEN_ARROW:8,BMap_Symbol_SHAPE_POINT:9,BMap_Symbol_SHAPE_PLANE:10,BMap_Symbol_SHAPE_CAMERA:11,BMap_Symbol_SHAPE_WARNING:12,BMap_Symbol_SHAPE_SMILE:13,BMap_Symbol_SHAPE_CLOCK:14};function dU(i,e){ft.call(this);e=e||{};this.style={anchor:e.anchor||new jm(0,0),fillColor:e.fillColor||"#000",fillOpacity:e.fillOpacity||0,scale:e.scale||1,rotation:e.rotation||0,strokeColor:e.strokeColor||"#000",strokeOpacity:e.strokeOpacity===undefined?1:e.strokeOpacity,strokeWeight:e.strokeWeight};this._type=(typeof i==="number")?i:"UserDefined";this._anchor=this.style.anchor;this._originOffset=new jm(0,0);this.anchor=new jm(0,0);this._rawPath=i;this._buildPath(true)}dU.inherits(ft,"SVGSymbol");dU.generateKey=function(kz,i){if(!kz){return null}if(parseInt(kz)){kz=parseInt(kz)}if(typeof kz==="number"){if(!fJ[kz]&&![0,1,2,0,4][kz]){return null}}var e={anchor:i.anchor||new jm(0,0),fillColor:i.fillColor||"#000",fillOpacity:i.fillOpacity||0,scale:i.scale||1,rotation:i.rotation||0,strokeColor:i.strokeColor||"#000",strokeOpacity:i.strokeOpacity===undefined?1:i.strokeOpacity,strokeWeight:i.strokeWeight};var T=q({path:kz,style:e});return"symbol_svg_icon_"+T};e9.extend(dU.prototype,{_buildPath:function(kK){var kE=this;var kG=kE._rawPath;if(parseInt(kG)){kG=parseInt(kG)}if(fJ[kG]){kG=fJ[kG]}kE.id=dU.generateKey(kG,kE.style);if(!kE.id){return}switch(kG){case cf.BMap_Symbol_SHAPE_CIRCLE:var kH=kE._calSize(2),kF=kH,kP=kE.style.scale,kA=kE._anchor;this.size=new jm(kH,kF);this.anchor=new jm(kH/2+kA.width*kP,kF/2+kA.height*kP);kE.path=cf.BMap_Symbol_SHAPE_CIRCLE;break;case cf.BMap_Symbol_SHAPE_RECTANGLE:var kH=kE._calSize(4),kF=kE._calSize(2),kA=kE._anchor,kM=kE.style.strokeWeight!==undefined?kE.style.strokeWeight:kE.style.scale,kP=kE.style.scale;this.size=new jm(kH,kF);this._originOffset=new jm(Math.floor(-kM/2),Math.floor(-kM/2));this.anchor=new jm(kH/2+kA.width*kP,kF/2+kA.height*kP);kE.path=cf.BMap_Symbol_SHAPE_RECTANGLE;break;case cf.BMap_Symbol_SHAPE_STAR:var kH=kE._calSize(20),kF=kH,kA=kE._anchor,kP=kE.style.scale;this.size=new jm(kH,kF);this.anchor=new jm(kH/2+kA.width*kP,kF/2+kA.height*kP);kE.path=cf.BMap_Symbol_SHAPE_STAR;break;default:var kG=new dS(kG),kz=kG.bounds(),kJ=kE.style.rotation*Math.PI/180,kM=kE.style.strokeWeight!==undefined?kE.style.strokeWeight:kE.style.scale,kP=kE.style.scale,kA=kE._anchor;var kO=new jm(Math.floor(kz.x1*kP-kM/2),Math.floor(kz.y1*kP-kM/2)),e={topleft:new fv(Math.floor(kz.x1*kP-kM/2)-kP*kA.width,Math.floor(kz.y1*kP-kM/2)-kP*kA.height),bottomleft:new fv(Math.floor(kz.x1*kP-kM/2)-kP*kA.width,Math.ceil(kz.y2*kP-kM/2)-kP*kA.height),topright:new fv(Math.ceil(kz.x2*kP+kM/2)-kP*kA.width,Math.floor(kz.y1*kP-kM/2)-kP*kA.height),bottomright:new fv(Math.ceil(kz.x2*kP+kM/2)-kP*kA.width,Math.ceil(kz.y2*kP+kM/2)-kP*kA.height)},i={},kN=[],kD=[];var kL=e.topleft.x===0?0:Math.atan(e.topleft.y/e.topleft.x),T=kL+kJ;for(var kI in e){var kC=Math.cos(kJ)*e[kI].x-Math.sin(kJ)*e[kI].y,kB=Math.sin(kJ)*e[kI].x+Math.cos(kJ)*e[kI].y;i[kI]=new fv(kC,kB);kN.push(kC);kD.push(kB)}xmax=Math.max.apply(Math,kN),ymax=Math.max.apply(Math,kD),xmin=Math.min.apply(Math,kN),ymin=Math.min.apply(Math,kD);this.size=new jm(Math.ceil(xmax-xmin),Math.ceil(ymax-ymin));this.anchor=new jm(-xmin,-ymin);this._originOffset=new jm(xmin-i.topleft.x,ymin-i.topleft.y);this._innerOffset=new fv(kO.width,kO.height);this._rotationAngle=kJ;kE.path=kG;break}this.imageSize=new jm(this.size.width,this.size.height);this.offset=this.anchor;if(kK){this.resetInitOptions()}},_calSize:function(e){if(this.style.strokeWeight){return e*this.style.scale+this.style.strokeWeight%3+this.style.strokeWeight}else{return e*this.style.scale+this.style.scale+this.style.scale%2}},render:function(T){var kF=this,kz=this.style.scale,kG,kH=this.size;if(this.context){kG=this.context;if(this.context.canvas.width/2!==this.size.width||this.context.canvas.height/2!==this.size.height){this.context.canvas.width=this.size.width*2;this.context.canvas.height=this.size.height*2}kG.clearRect(0,0,this.size.width*2,this.size.height*2);kG.fillStyle=hV.convert2rgba(kF.style.fillColor,kF.style.fillOpacity);kG.strokeStyle=hV.convert2rgba(kF.style.strokeColor,kF.style.strokeOpacity);kG.save()}else{return false}kG.scale(2,2);kG.lineCap="round";kG.lineJoin="round";kG.lineWidth=kF.style.strokeWeight||kz;if(kF._originOffset){kG.translate(-kF._originOffset.width,-kF._originOffset.height)}if(kF._rotationAngle){kG.rotate(kF._rotationAngle)}if(kF._innerOffset){kG.translate(-kF._innerOffset.x,-kF._innerOffset.y)}switch(kF.path){case cf.BMap_Symbol_SHAPE_CIRCLE:kG.arc(kH.width/2,kH.height/2,kz,0,2*Math.PI);break;case cf.BMap_Symbol_SHAPE_RECTANGLE:kG.rect(0,0,4*kz,2*kz);break;case cf.BMap_Symbol_SHAPE_STAR:kG.beginPath();var kB=kH.width/2,kD=kz*10;var kA=(2*Math.PI)/10;for(var kC=11;kC!=0;kC--){var e=kD*(kC%2+1)/2;var kE=kA*kC;kG.lineTo((e*Math.sin(kE))+kB,(e*Math.cos(kE))+kB)}kG.closePath();break;default:kG.lineWidth=kG.lineWidth/kz;kG.scale(kz,kz);kF.path.draw(kG)}kG.fill();kG.stroke();kG.restore();this.data=kG.getImageData(0,0,this.size.width*2,this.size.height*2);return true},setPath:function(e){this._rawPath=e;this._buildPath();this.update()},setAnchor:function(e){this._anchor=this.style.anchor=e;this._buildPath();this.update()},setRotation:function(e){this.style.rotation=e;this._buildPath();this.update()},setScale:function(e){this.style.scale=e;this._buildPath();this.update()},setStrokeWeight:function(e){this.style.strokeWeight=e;this._buildPath();this.update()},setStrokeColor:function(e){e=hV.convert2rgba(e,this.style.strokeOpacity);this.style.strokeColor=e;this._buildPath();this.update()},setStrokeOpacity:function(e){this.style.strokeOpacity=e;this._buildPath();this.update()},setFillOpacity:function(e){this.style.fillOpacity=e;this._buildPath();this.update()},setFillColor:function(e){this.style.fillColor=e;this._buildPath();this.update()}});bG.SymbolShapeType=cf;function jP(kB,kz,T){if(!kB||!kz){return}this.imageUrl=null;this.imageDom=null;if(typeof kB==="string"){this.imageUrl=kB}else{this.imageDom=kB;if(!this.imageDom.id){this.imageDom.id=bG.getGUID("icon_dom_")}}this.size=kz;var kA=new jm(Math.floor(kz.width/2),Math.floor(kz.height/2));var i={offset:kA,imageOffset:new jm(0,0)};T=T||{};for(var e in T){i[e]=T[e]}if(T.anchor){i.offset=T.anchor}this.anchor=this.offset=i.offset;this.imageOffset=i.imageOffset;this.infoWindowOffset=T.infoWindowOffset||this.offset;this.printImageUrl=T.printImageUrl||"";this.imageSize=T.imageSize||this.size;this.srcSetObject={};this.setImageSrcset(T.srcset||T.srcSet)}jP.prototype.setImageUrl=function(e){if(!e){return}this.imageUrl=e;this._renderData=null};jP.prototype.getCurrentImageUrl=function(){if(window.devicePixelRatio>1&&this.srcSetObject["2x"]){return this.srcSetObject["2x"]}return this.imageUrl};jP.prototype.setPrintImageUrl=function(e){if(!e){return}this.printImageUrl=e};jP.prototype.setSize=function(e){if(!e){return}this.size=new jm(e.width,e.height);this._renderData=null};jP.prototype.setOffset=function(e){if(!e){return}this.anchor=this.offset=new jm(e.width,e.height);this._renderData=null};jP.prototype.setAnchor=function(e){this.setOffset(e)};jP.prototype.setImageOffset=function(e){if(!e){return}this.imageOffset=new jm(e.width,e.height);this._renderData=null};jP.prototype.setInfoWindowOffset=function(e){if(!e){return}this.infoWindowOffset=new jm(e.width,e.height)};jP.prototype.setImageSize=function(e){if(!e){return}this.imageSize=new jm(e.width,e.height)};jP.prototype.setImageSrcset=function(T){var e="";if(!T){return}for(var i in T){if(T.hasOwnProperty(i)){this.srcSetObject[i]=T[i];e=T[i]+" "+i+","}}this.srcSet=e};jP.prototype.toString=function(){return"Icon"};jP.prototype.generateRenderData=function(kB){var T=this.offset;var e=this.size;var kD=this.imageOffset;var kC=[];kC.push(-T.width,T.height-e.height,0);kC.push(e.width-T.width,T.height-e.height,0);kC.push(e.width-T.width,T.height,0);kC.push(-T.width,T.height-e.height,0);kC.push(e.width-T.width,T.height,0);kC.push(-T.width,T.height,0);if(kB!==0){for(var kA=0;kA<kC.length;kA+=3){var kz=vec2.fromValues(kC[kA],kC[kA+1]);vec2.rotate(kz,kz,[0,0],iW(-kB));kC[kA]=kz[0];kC[kA+1]=kz[1]}}return{vertex:kC}};jP.prototype.getRenderData=function(e){this._renderData=this.generateRenderData(e);return this._renderData};function ef(T,i){e9.BaseClass.call(this);this.content=T;this.map=null;this._config={width:0,height:0,maxWidth:600,offset:new jm(0,0),title:"",maxContent:"",enableMaximize:false,enableAutoPan:true,enableCloseOnClick:true,margin:[10,10,40,10],collisions:[[10,10],[10,10],[10,10],[10,10]],ifMaxScene:false,canScroll:false,onClosing:function(){return true}};this.setConfig(i);if(this._config.width!==0){if(this._config.width<220){this._config.width=220}if(this._config.width>730){this._config.width=730}}if(this._config.height!==0){if(this._config.height<60){this._config.height=60}if(this._config.height>650){this._config.height=650}}if(this._config.maxWidth!==0){if(this._config.maxWidth<220){this._config.maxWidth=220}if(this._config.maxWidth>730){this._config.maxWidth=730}}this.isWinMax=false;this.IMG_PATH=E.imgPath;this.overlay=null;hP.sendMessage(a1(4,2,10),["overlay","infowindow"]);var e=this;hl.load("infowindow",function(){e._draw()})}ef.inherits(e9.BaseClass,"InfoWindow");e9.extend(ef.prototype,{setWidth:function(e){e=e*1;if(!e&&e!==0||isNaN(e)||e<0){return}if(e!==0){if(e<220){e=220}if(e>730){e=730}}this._config.width=e},setHeight:function(e){e=e*1;if(!e&&e!==0||isNaN(e)||e<0){return}if(e!==0){if(e<60){e=60}if(e>650){e=650}}this._config.height=e},setMaxWidth:function(e){e=e*1;if(!e&&e!==0||isNaN(e)||e<0){return}if(e!==0){if(e<220){e=220}if(e>730){e=730}}this._config.maxWidth=e},setTitle:function(e){this._config.title=e||""},setContent:function(e){this.content=e||""},getContent:function(){return this.content},setMaxContent:function(e){this._config.maxContent=e||""},redraw:function(){},enableAutoPan:function(){this._config.enableAutoPan=true},disableAutoPan:function(){this._config.enableAutoPan=false},enableCloseOnClick:function(){this._config.enableCloseOnClick=true},disableCloseOnClick:function(){this._config.enableCloseOnClick=false},enableMaximize:function(){this._config.enableMaximize=true},disableMaximize:function(){this._config.enableMaximize=false},show:function(){this._visible=true},hide:function(){this._visible=false},close:function(){this.hide()},dispose:function(){e9.BaseClass.prototype.decontrol.call(this)},maximize:function(){this.isWinMax=true},restore:function(){this.isWinMax=false},setConfig:function(i){if(!i){return}for(var e in i){if(typeof(this._config[e])===typeof(i[e])){this._config[e]=i[e]}}},isVisible:function(){return this.isOpen()},isOpen:function(){return false},getPointIn:function(){if(this.overlay&&this.overlay.getPoint){return this.overlay.getPoint()}},getTitle:function(){return this._config.title||""},getPosition:function(){return this.latLng},getPoint:function(){var e=this.getPointIn();if(this.map.config.coordType===BMAP_COORD_GCJ02){var i=jv.convertMC2LL(e);return eS(i)}return jv.convertMC2LL(e)},getOffset:function(){return this._config.offset},dispose:function(){e9.BaseClass.prototype.decontrol.call(this)},toString:function(){return"InfoWindow"}});h4.prototype.openInfoWindow=function(kA,e,T){var kz=e;if(T&&T.coordType&&T.coordType===BMAP_COORD_GCJ02){kz=iP(e,3)}kA.latLng=new cA(kz.lat,kz.lng);var i=jv.convertLL2MC(kz);this.openInfoWindowIn(kA,i)};h4.prototype.closeInfoWindow=function(){var e=this.temp.infoWin||this.temp._infoWin;if(e&&e.overlay){e.overlay.closeInfoWindow()}};h4.prototype.openInfoWindowIn=function(kz,e){if(!kz||kz.toString()!=="InfoWindow"||!e||e.toString()!=="Point"){return}var i=this.temp;if(!i.marker){var T=new jP(E.imgPath+"blank.gif",{width:1,height:1});i.marker=new kb(e,{icon:T,width:1,height:1,offset:new jm(0,0),infoWindowOffset:new jm(0,0),clickable:false});i.marker._fromMap=1}else{i.marker.setPoint(e)}this.addOverlay(i.marker);i.marker.show();i.marker.openInfoWindow(kz)};eM.prototype.openInfoWindow=function(e){if(this.map){this.map.closeInfoWindow();e._visible=true;this.map.temp._infoWin=e;e.overlay=this;e9.BaseClass.call(e,e.hashCode)}};eM.prototype.closeInfoWindow=function(){if(this.map&&this.map.temp._infoWin){this.map.temp._infoWin._visible=false;this.map.temp._infoWin.decontrol();this.map.temp._infoWin=null}};function bm(T,i){eM.call(this);this.content=T;this.map=null;this.domElement=null;this._config={width:0,offset:new jm(0,0),styles:{backgroundColor:"#fff",border:"1px solid #f00",padding:"1px",whiteSpace:"nowrap",fontSize:"12px",zIndex:"80",MozUserSelect:"none"},point:null,enableMassClear:true};i=i||{};this.setConfig(i);if(this._config.width<0){this._config.width=0}this.point=this._config.point;hP.sendMessage(a1(4,2,6),["overlay","dom_label"]);var e=this;hl.load("marker",function(){e._draw()})}bm.inherits(eM,"Label");e9.extend(bm.prototype,{setPoint:function(e){if(e&&e.toString()==="Point"&&!this.getMarker()){if(this.coordType===BMAP_COORD_GCJ02){var i=iP(e,3);this.point=this._config.point=new cG(i.lng,i.lat)}else{this.point=this._config.point=new cG(e.lng,e.lat)}}},setContent:function(e){this.content=e},getContent:function(e){return this.content},setOpacity:function(e){if(e>=0&&e<=1){this._config.opacity=e}},setOffset:function(e){if(!e||e.toString()!=="Size"){return}this._config.offset=new jm(e.width,e.height)},getOffset:function(){return this._config.offset},setStyle:function(e){e=e||{};this._config.styles=e9.extend(this._config.styles,e)},setStyles:function(e){this.setStyle(e)},setTitle:function(e){this._config.title=e||""},getTitle:function(){return this._config.title},setMarker:function(e){if(this._marker&&this._marker!==e){this._marker._config.label=null}this._marker=e;if(e){this.point=this._config.point=e.getPoint()}else{this.point=this._config.point=null}},getMarker:function(){return this._marker||null},getPositionIn:function(){return this.getPoint()},});function ib(T,i){var kz={};for(var e in i){if(i.hasOwnProperty(e)){if(e==="position"){kz.point=jv.convertLL2MC(i[e]);this.latLng=new cA(i[e]["lat"],i[e]["lng"])}else{kz[e]=i[e]}}}bm.call(this,T,kz)}ib.inherits(bm,"LabelOut");e9.extend(ib.prototype,{toString:function(){return"Label"},setPosition:function(e){this.latLng=new cA(e.lat,e.lng);var i=jv.convertLL2MC(e);this.setPoint(i)},getPosition:function(){return this.latLng}});window.BMAP_ANIMATION_DROP=1;window.BMAP_ANIMATION_BOUNCE=2;function kb(e,i){eM.call(this);i=i||{};this.delFlag=i.delFlag;this.coordType=i.coordType;this.point=e;this._rotation=0;this.map=null;this._animation=null;this.domElement=null;this.iconDom=null;this.infoWindowDom=null;this.siblingElement=null;this.textureCoord=null;this.textureCoordGLMap=null;this.collisionDetectionFailed=false;this._config={offset:new jm(0,0),opacity:1,icon:null,title:"",infoWindow:null,label:null,baseZIndex:0,clickable:true,zIndexFixed:false,isTop:false,enableMassClear:true,enableDragging:false,raiseOnDrag:false,restrictDraggingArea:false,startAnimation:"",enableCollisionDetection:false,rank:0,enableDraggingMap:false};this.setOptions(i);this._addlog();this._isDragging=false;var T=this;hl.load("marker",function(){T._draw()})}kb.TOP_ZINDEX=aU.getZIndex(-90)+1000000;kb.DRAG_ZINDEX=kb.TOP_ZINDEX+1000000;kb._injectMethond=function(e){e9.extend(kb.prototype,e)};kb.inherits(eM,"Marker");e9.extend(kb.prototype,{toString:function(){return"Marker"},_addlog:function(){var e=1;var i="normal";if(this._config.icon instanceof dU){e=2;i="svg_symbol"}else{if(this._config.icon instanceof ft){e=3;i="custom_symbol"}}hP.sendMessage(a1(4,2,1,e),["overlay","marker",i])},setOptions:function(e){this.setConfig(e);if(!e.icon){this._config.icon=new jP(E.imgPath+"marker_red.png",new jm(23,25),{offset:new jm(10,25),infoWindowOffset:new jm(10,0)})}},setIcon:function(e){if(e){this._config.icon=e;this.textureCoord=this.textureCoordGLMap=null}},getIcon:function(){return this._config.icon},setLabel:function(e){if(!(e instanceof bm)){return}this._config.label=e;e._config.enableMassClear=this._config.enableMassClear;e.setPoint(this.point)},getLabel:function(){return this._config.label},enableDragging:function(){this._config.enableDragging=true},disableDragging:function(){this._config.enableDragging=false},setPoint:function(e){if(e){this.point=this._config.point=new cG(e.lng,e.lat);this.latLng=jv.convertMC2LL(e)}},setPositionIn:function(e){this.setPoint(e)},getPositionIn:function(){return this.getPoint()},setTop:function(i,e){this._config.isTop=!!i;if(i){this._addi=e||0}},setTitle:function(e){this._config.title=e||""},getTitle:function(){return b(this._config.title)},setOffset:function(e){if(e){this._config.offset=e}},getOffset:function(){return this._config.offset},setAnimation:function(e){this._animation=e},setRank:function(e){this._config.rank=e},getRank:function(){return this._config.rank},setRotation:function(e){while(e<0){e+=360}this._rotation=e%360},getRotation:function(){return this._rotation}});function u(e,T){if(T&&T.coordType&&T.coordType===BMAP_COORD_GCJ02){var kz=iP(e,3);this.latLng=new cA(kz.lat,kz.lng);var i=jv.convertLL2MC(kz)}else{this.latLng=new cA(e.lat,e.lng);var i=jv.convertLL2MC(e)}kb.call(this,i,T)}u.inherits(kb,"MarkerOut");e9.extend(u.prototype,{toString:function(){return"Marker"},toGeoJSON:function(){var i="Point";var T=[this.latLng.lng,this.latLng.lat];var e={type:"Feature",geometry:{type:i,coordinates:T},properties:this.properties};return e},updateByGeoJSON:function(T){var e=new gN();var kB=e.readFeaturesFromObject(T)||[];for(var kz=0,kA=kB.length;kz<kA;++kz){if(kB[kz] instanceof u){this.properties=kB[kz].properties;this.setPosition(kB[kz].getPosition());break}}},setPosition:function(e){this.latLng=new cA(e.lat,e.lng);var i=jv.convertLL2MC(e);this.setPositionIn(i)},getPosition:function(){return this.latLng},});window.BMAP_SHAPE_CIRCLE=1;window.BMAP_SHAPE_RECT=2;function er(i,e,T){eM.call(this,e,T);this.domElement=null;this.point=i;T=T||{};this._config={};this._config.height=e||0;this._config.size=typeof T.size==="number"?T.size:50;this._config.fillOpacity=typeof T.fillOpacity==="number"?T.fillOpacity:0.8;this._config.shape=typeof T.shape==="number"?T.shape:1;ck(this._config.fillOpacity,0,1);if(T.fillColor===""){this._config.fillColor=""}else{this._config.fillColor=T.fillColor?T.fillColor:"#f00"}this._config.icon=(T.icon instanceof jP||T.icon instanceof ft)?T.icon:"";this._config.enableMassClear=T.enableMassClear||true;hP.sendMessage(a1(4,2,2),["overlay","marker3d"]);var kz=this;hl.load("marker",function(){kz._draw()})}er.inherits(eM,"Marker3D");e9.extend(er.prototype,{setPoint:function(e){if(this.map.config.coordType===BMAP_COORD_GCJ02){var T=iP(e,3);this.point=this._config.point=new cG(T.lng,T.lat);this.latLng=jv.convertMC2LL(T)}else{this.point=this._config.point=new cG(e.lng,e.lat);this.latLng=jv.convertMC2LL(e)}var i=new fW("onstatus_change");i.overlay=this;i.action="setPoint";this.fire(i)},setPositionIn:function(e){this.setPoint(e)},getPositionIn:function(){return this.getPoint()},setDomAttribute:function(i,T){var e=new fW("onlineupdate");e.overlay=this;this.dispatchEvent(e)}});function eo(i,e,kz){this.latLng=new cA(i.lat,i.lng);var T=jv.convertLL2MC(i);er.call(this,T,e,kz)}eo.inherits(er,"Marker3d");e9.extend(eo.prototype,{toString:function(){return"Marker3D"},setHeight:function(e){this._config.height=Number(e);this.draw();var i=new fW("onlineupdate");i.overlay=this;this.dispatchEvent(i)},getHeight:function(){return this._config.height},setFillOpacity:function(e){if(e>1||e<0){return}this._config.fillOpacity=e;this.setDomAttribute("fillopacity",e)},getFillOpacity:function(){return this._config.fillOpacity},setFillColor:function(e){this._config.fillColor=e||"";this.setDomAttribute("fillcolor",e)},getFillColor:function(){return this._config.fillColor},setIcon:function(i){if(!i||!this.map){return}this._config.icon=i;if(this._config.icon){var e=this._config.icon.getCurrentImageUrl();var kz=i.getCurrentImageUrl()!==e;this._config.icon=i;this.textureCoord=this.textureCoordGLMap=null;this.draw();var T=new fW("onstatus_change");T.overlay=this;T.action="setIcon";T.imageUrlChanged=kz;this.fire(T)}},getIcon:function(){return this._config.icon},setPosition:function(e){this.latLng=new cA(e.lat,e.lng);var i=jv.convertLL2MC(e);this.setPositionIn(i)},getPosition:function(){var e=this.getPositionIn();return jv.convertMC2LL(e)}});function f8(T,e){iU.call(this,e);this._normalizedBounds=new ij();this.setPoints(T);this._addlog(e);var i=this;hl.load("poly",function(){i._draw()})}f8.inherits(iU,"Polyline");e9.extend(f8.prototype,{_addlog:function(e){var i=1;var T="normal";if(e&&e.strokeTexture){i=2;T="texture"}hP.sendMessage(a1(4,2,3,i),["overlay","polyline",T])},getBoundsIn:function(e){if(!e){this._bounds.setMinMax();return this._bounds}this._normalizedBounds.setMinMax();return this._normalizedBounds},setPoints:function(kC){this._clearCache();this.points=iU.getGraphPoints(kC).slice(0);if(this._config.geodesic===true){this.greatCirclePoints.length=0;for(var kA=0;kA<this.points.length-1;kA++){this.calcGreatCirclePoints(this.points[kA],this.points[kA+1])}}else{if(this._config.linkRight){var kD=[];var kB=null;for(var kA=0;kA<this.points.length-1;kA++){if(!kA){kD.push(this.points[kA])}var T=kB||this.points[kA];kB=this.points[kA+1];var kz=eF(kB,T);if(kz>15437726){if(kB.lng<T.lng){kB.lng+=h4.WORLD_SIZE_MC}else{kB.lng-=h4.WORLD_SIZE_MC}}kD.push(kB)}this.points=kD}}this._calcBounds();this.draw();var e=new fW("onlineupdate");e.overlay=this;this.dispatchEvent(e);if(this._visible&&this._config.enableEditing===true&&!this._config.geodesic){this.clearVertexs&&this.clearVertexs();this.addVertexs&&this.addVertexs()}},_calcBounds:function(){if(!this.points){return}var e=this;e._bounds.setNorthEast(null);e._bounds.setSouthWest(null);if(e.greatCirclePoints&&e.greatCirclePoints.length>0){e9.each(e.greatCirclePoints,function(i){e._bounds.extend(i)})}else{e9.each(e.points,function(i){e._bounds.extend(i)})}e._normalizedBounds.setSouthWest(e._bounds.getSouthWest());e._normalizedBounds.setNorthEast(e._bounds.getNorthEast());if(e._normalizedBounds.sw.lng<-h4.WORLD_SIZE_MC_HALF||e._normalizedBounds.ne.lng>h4.WORLD_SIZE_MC_HALF){e._normalizedBounds.sw.lng=-h4.WORLD_SIZE_MC_HALF;e._normalizedBounds.ne.lng=h4.WORLD_SIZE_MC_HALF}},calcGreatCirclePoints:function(kz,T){var kB=kz.latLng;var kA=T.latLng;if(kB.equals(kA)){return}var e=jv.getDistance(iW(kB.lng),iW(kB.lat),iW(kA.lng),iW(kA.lat));if(e<250000){return}var kF=Math.round(e/150000);var kJ=this.calcAngularDistance(kB,kA);this.greatCirclePoints.push(kz);var kI=kB.lng;var kH=kz;for(var kC=0;kC<kF;kC++){var kE=this.calcMiddlePoint(kB,kA,kC/kF,kJ);var kG=jv.convertLL2MC(kE);var kD=kG.lng;var kK=eF(kG,kH);if(kK>30037726){if(kG.lng<kH.lng){kG.lng+=h4.WORLD_SIZE_MC}else{kG.lng-=h4.WORLD_SIZE_MC}}this.greatCirclePoints.push(kG);kH=kG}var kK=eF(T,kH);if(kK>30037726){if(T.lng<kH.lng){T.lng+=h4.WORLD_SIZE_MC}else{T.lng-=h4.WORLD_SIZE_MC}}this.greatCirclePoints.push(T)},calcMiddlePoint:function(kG,kF,kH,kL){var kA=kG.lat;var kz=kF.lat;var kK=kG.lng;var kI=kF.lng;var kM=iW(kA);var kJ=iW(kz);var i=iW(kK);var e=iW(kI);var kO=Math.sin((1-kH)*kL)/Math.sin(kL);var kN=Math.sin(kH*kL)/Math.sin(kL);var kD=kO*Math.cos(kM)*Math.cos(i)+kN*Math.cos(kJ)*Math.cos(e);var kC=kO*Math.cos(kM)*Math.sin(i)+kN*Math.cos(kJ)*Math.sin(e);var kB=kO*Math.sin(kM)+kN*Math.sin(kJ);var T=Math.atan2(kB,Math.sqrt(Math.pow(kD,2)+Math.pow(kC,2)));var kE=Math.atan2(kC,kD);return new cG(fl(kE),fl(T))},calcAngularDistance:function(kA,i){var kB=iW(kA.lat);var kz=iW(i.lat);var T=iW(kA.lng);var e=iW(i.lng);return Math.acos(Math.sin(kB)*Math.sin(kz)+Math.cos(kB)*Math.cos(kz)*Math.cos(Math.abs(e-T)))}});function bu(kA,e){if(!kA||kA.length===0){return}var kz=[];for(var T=0;T<kA.length;T++){kz[T]=jv.convertLL2MC(kA[T])}f8.call(this,kz,e)}bu.inherits(f8,"PolylineOut");e9.extend(bu.prototype,{toString:function(){return"Polyline"},toGeoJSON:function(){var kz="LineString";var kA=[];var kB=this.getPath();for(var T=0;T<kB.length;T++){kA.push([kB[T].lng,kB[T].lat])}var e={type:"Feature",geometry:{type:kz,coordinates:kA},properties:this.properties};return e},updateByGeoJSON:function(T){var e=new gN();var kB=e.readFeaturesFromObject(T)||[];for(var kz=0,kA=kB.length;kz<kA;++kz){if(kB[kz] instanceof bu){this.properties=kB[kz].properties;this.setPath(kB[kz].getPath());break}}},setPath:function(kz){if(!kz||kz.length===0){return}var T=[];for(var e=0;e<kz.length;e++){T[e]=jv.convertLL2MC(kz[e])}this.setPathIn(T);this._mouseEventPixels=null},getPath:function(){var e=this.getPathIn();if(!e||e.length===0){return[]}var kz=[];for(var T=0;T<e.length;T++){kz[T]=jv.convertMC2LL(e[T])}return kz},getBounds:function(i){var e=this.getBoundsIn(i);var T=new ij(jv.convertMC2LL(e.getSouthWest()),jv.convertMC2LL(e.getNorthEast()));return T}});function g7(T,kz,e){iU.call(this,e);this._normalizedBounds=new ij();this._cps=kz;this._path=T;this.setPoints(T);hP.sendMessage(a1(4,2,7),["overlay","bezier"]);var i=this;hl.load("poly",function(){i._draw()})}g7.inherits(f8,"BezierCurve");e9.extend(g7.prototype,{getBoundsIn:function(e){if(!e){this._bounds.setMinMax();return this._bounds}this._normalizedBounds.setMinMax();return this._normalizedBounds},setPoints:function(e){this._clearCache();this.points=iU.getGraphPoints(e).slice(0);this.points=this.calcBezierPoints(this.points,this._cps);this._calcBounds()},_calcBounds:function(){if(!this.points){return}var e=this;e._bounds.setNorthEast(null);e._bounds.setSouthWest(null);if(e.greatCirclePoints&&e.greatCirclePoints.length>0){e9.each(e.greatCirclePoints,function(i){e._bounds.extend(i)})}else{e9.each(e.points,function(i){e._bounds.extend(i)})}e._normalizedBounds.setSouthWest(e._bounds.getSouthWest());e._normalizedBounds.setNorthEast(e._bounds.getNorthEast());if(e._normalizedBounds.sw.lng<-h4.WORLD_SIZE_MC_HALF||e._normalizedBounds.ne.lng>h4.WORLD_SIZE_MC_HALF){e._normalizedBounds.sw.lng=-h4.WORLD_SIZE_MC_HALF;e._normalizedBounds.ne.lng=h4.WORLD_SIZE_MC_HALF}},getPathIn:function(){return this._path},setPathIn:function(e){this._path=e;this.setPoints(e)},getCpsIn:function(){return this._cps},setCpsIn:function(e){this._cps=e;this.setPoints(this._path)},calcBezierPoints:function(kz,kB){var T=[];for(var e=0;e<kz.length-1;e++){var kA=[kz[e],kB[e][0],kB[e][1],kz[e+1]];T=T.concat((this.bezierbetweenTwoP(kA)))}return T},bezierbetweenTwoP:function(kB){var T=100;var kA=1/T;var e=[];for(var kz=0;kz<T;kz++){e.push(this.getPointOnCubicBezier(kB,kz*kA))}return e},getPointOnCubicBezier:function(kC,kG){var i;var kB;var kz;var kH;var kA;var T;var kF;var e;var kE;var kD;kz=3*(kC[1].lng-kC[0].lng);kB=3*(kC[2].lng-kC[1].lng)-kz;i=kC[3].lng-kC[0].lng-kz-kB;T=3*(kC[1].lat-kC[0].lat);kA=3*(kC[2].lat-kC[1].lat)-T;kH=kC[3].lat-kC[0].lat-T-kA;kF=kG*kG;e=kF*kG;kE=(i*e)+(kB*kF)+(kz*kG)+kC[0].lng;kD=(kH*e)+(kA*kF)+(T*kG)+kC[0].lat;return new cG(kE,kD)}});function cQ(kA,kC,e){if(!kA||kA.length===0){return}this.userPath=kA;this.userCps=kC;var kz=[];for(var T=0;T<kA.length;T++){kz[T]=jv.convertLL2MC(kA[T])}if(!kC||kC.length===0){return}var kB=[];for(var T=0;T<kC.length;T++){kB[T]=[];kB[T][0]=jv.convertLL2MC(kC[T][0]);if(kC[T][1]){kB[T][1]=jv.convertLL2MC(kC[T][1])}else{kB[T][1]=jv.convertLL2MC(kC[T][0])}}g7.call(this,kz,kB,e)}cQ.inherits(g7,"BezierCurveOut");e9.extend(cQ.prototype,{toString:function(){return"BezierCurve"},setPath:function(kz){if(!kz||kz.length===0){return}this.userPath=kz;var T=[];for(var e=0;e<kz.length;e++){T[e]=jv.convertLL2MC(kz[e])}this.setPathIn(T);this._mouseEventPixels=null},getPath:function(){return this.userPath;var e=this.getPathIn();if(!e||e.length===0){return[]}var kz=[];for(var T=0;T<e.length;T++){kz[T]=jv.convertMC2LL(e[T])}return kz},getControlPoints:function(){return this.userCps;var e=this.getCpsIn();if(!e||e.length===0){return[]}var kz=[];for(var T=0;T<e.length;T++){kz[T]=[];kz[T][0]=jv.convertMC2LL(e[T][0]);kz[T][1]=jv.convertMC2LL(e[T][1])}return kz},setControlPoints:function(kz){if(!kz||kz.length===0){return}this.userCps=kz;var T=[];for(var e=0;e<kz.length;e++){T[e]=[];T[e][0]=jv.convertLL2MC(kz[e][0]);if(kz[e][1]){T[e][1]=jv.convertLL2MC(kz[e][1])}else{T[e][1]=jv.convertLL2MC(kz[e][0])}}this.setCpsIn(T)},getBounds:function(i){var e=this.getBoundsIn(i);var T=new ij(jv.convertMC2LL(e.getSouthWest()),jv.convertMC2LL(e.getNorthEast()));return T}});function ex(e,T){iU.call(this,T);this._normalizedBounds=new ij();this.setPoints(e);var i=this;hl.load("poly",function(){i._draw()})}ex.inherits(f8,"PolylineMultipart");e9.extend(ex.prototype,{setPoints:function(e){if(!e){return}this._clearCache();this.points=this._unifyArgs(e);this._calcBounds()},_unifyArgs:function(T){var e=[];var i=[];if(T.constructor===Array){if(T[0].constructor===cG){i.push(T)}else{i=T}}else{if(typeof T==="string"){i.push(T)}}e9.each(i,function(kz){e.push(iU.getGraphPoints(kz))});return e},setPointAt:function(i,e,T){T=T||0;if(!e||!this.points[T]||!this.points[T][i]){return}this._clearCache();this.points[T][i]=new cG(e.lng,e.lat);this._calcBounds()},getBoundsIn:function(e){if(!e){this._bounds.setMinMax();return this._bounds}this._normalizedBounds.setMinMax();return this._normalizedBounds},_calcBounds:function(){if(!this.points){return}var e=this;e._bounds.setNorthEast(null);e._bounds.setSouthWest(null);if(e.greatCirclePoints&&e.greatCirclePoints.length>0){e9.each(e.greatCirclePoints,function(i){e._bounds.extend(i)})}else{e9.each(e.points,function(i){e9.each(i,function(T){e._bounds.extend(T)})})}e._normalizedBounds.setSouthWest(e._bounds.getSouthWest());e._normalizedBounds.setNorthEast(e._bounds.getNorthEast());if(e._normalizedBounds.sw.lng<-h4.WORLD_SIZE_MC_HALF||e._normalizedBounds.ne.lng>h4.WORLD_SIZE_MC_HALF){e._normalizedBounds.sw.lng=-h4.WORLD_SIZE_MC_HALF;e._normalizedBounds.ne.lng=h4.WORLD_SIZE_MC_HALF}}});function hA(T,e){iU.call(this,e);e=e||{};if(typeof e.fillOpacity==="number"){this._config.fillOpacity=e.fillOpacity}else{this._config.fillOpacity=0.6}ck(this._config.fillOpacity,0,1);if(e.fillColor===""){this._config.fillColor=""}else{this._config.fillColor=e.fillColor?e.fillColor:"#fff"}this._parseFillCacheWebGL=[];this.setPoints(T,e);hP.sendMessage(a1(4,2,4),["overlay","polygon"]);var i=this;hl.load("poly",function(){i._draw()})}hA.inherits(iU,"Polygon");e9.extend(hA.prototype,{setPoints:function(kB){var kz=[];if(typeof kB==="string"||kB.length===1||kB[0] instanceof cG||kB[0] instanceof cA||this instanceof hf||kB.length===0){if(kB.length===1){kB=kB[0]}var e=this._processSinglePointArray(kB);this._userPoints=e.userPoints;kz=e.innerPoints;this.hasMultipleParts=false}else{this._userPoints=[];for(var kA=0;kA<kB.length;kA++){var T=this._processSinglePointArray(kB[kA]);this._userPoints.push(T.userPoints);kz.push(T.innerPoints)}this.hasMultipleParts=true}iU.prototype.setPoints.call(this,kz)},setPathIn:function(e){this.setPoints(e)},_processSinglePointArray:function(e){var i=iU.getGraphPoints(e).slice(0);innerPoints=i.slice(0);if(innerPoints.length>1&&!innerPoints[0].equals(innerPoints[innerPoints.length-1])){innerPoints.push(new cG(innerPoints[0].lng,innerPoints[0].lat))}return{userPoints:i,innerPoints:innerPoints}},setPointAt:function(i,e){if(!this._userPoints[i]){return}this._clearCache();this._userPoints[i]=new cG(e.lng,e.lat);this.points[i]=new cG(e.lng,e.lat);if(i===0&&!this.points[0].equals(this.points[this.points.length-1])){this.points[this.points.length-1]=new cG(e.lng,e.lat)}this._calcBounds()},setPositionAt:function(i,e){if(!this._userPoints[i]){return}var T=jv.convertLL2MC(e);this.setPointAt(i,T)},getPoints:function(){var e=this._userPoints;if(e.length===0){e=this.points}return e},getPathIn:function(){return this.getPoints()}});function i1(T,e){if(!T||T.length===0){return}var i=this.setPath(T,true);hA.call(this,i,e)}i1.inherits(hA,"PolygonOut");e9.extend(i1.prototype,{toString:function(){return"Polygon"},toGeoJSON:function(){var kA="Polygon";var kB=[];var kD=this.getPath();if(this.hasMultipleParts){kA="Multi"+kA;for(var kz=0;kz<kD.length;kz++){var kC=[];for(var T=0;T<kD[kz].length;T++){kC.push([kD[kz][T].lng,kD[kz][T].lat])}kB.push(kC)}}else{for(var kz=0;kz<kD.length;kz++){kB.push([kD[kz].lng,kD[kz].lat])}}var e={type:"Feature",geometry:{type:kA,coordinates:[kB]},properties:this.properties};return e},updateByGeoJSON:function(T){var e=new gN();var kB=e.readFeaturesFromObject(T)||[];for(var kz=0,kA=kB.length;kz<kA;++kz){if(kB[kz] instanceof i1){this.properties=kB[kz].properties;this.setPath(kB[kz].getPath());break}}},setPath:function(kE,T){if(!kE||kE.length===0){return}var kD=[];if(typeof kE==="string"||kE[0] instanceof cG||kE[0] instanceof cA){var e=this._processSinglePointArray(kE);for(var kC=0;kC<e.innerPoints.length;kC++){kD[kC]=jv.convertLL2MC(e.innerPoints[kC])}}else{for(var kC=0;kC<kE.length;kC++){var kz=this._processSinglePointArray(kE[kC]);var kB=[];for(var kA=0;kA<kz.innerPoints.length;kA++){kB[kA]=jv.convertLL2MC(kz.innerPoints[kA])}kD.push(kB)}}if(T){return kD}this.setPathIn(kD);this._mouseEventPixels=null},getPath:function(){var e=this.getPathIn();if(!e||e.length===0){return[]}var kB=[];if(this.hasMultipleParts){for(var kz=0;kz<e.length;kz++){var kA=[];for(var T=0;T<e[kz].length;T++){kA[T]=jv.convertMC2LL(e[kz][T])}kB.push(kA)}}else{for(var kz=0;kz<e.length;kz++){kB[kz]=jv.convertMC2LL(e[kz])}}return kB}});function hf(i,e,T){this.point=i;this.radius=Math.abs(e);hA.call(this,[],T)}hf.parseTolerance={0:[0.01,0.0001,0.00001,0.000004],1:[1000,10,1,0.4]};hf.inherits(hA,"Circle");e9.extend(hf.prototype,{initialize:function(e){this.map=e;this.points=this._getPerimeterPoints(this.point,this.radius);this._calcBounds();return null},getPoint:function(){return this.point},setPoint:function(e){if(!e){return}this.point=e;this.latLng=jv.convertMC2LL(e)},setCenterIn:function(e){var i=arguments[1];this.setPoint(e,i)},setRadius:function(e){this.radius=Math.abs(e)},getCenterIn:function(){return this.point},getRadius:function(){return this.radius},_getPerimeterPoints:function(e,kG){if(!e||!kG||!this.map){return[]}var T=this.map;var kD=e.lng;var kB=e.lat;var kM=jv.convertMC2LL(e);kD=kM.lng;kB=kM.lat;var kN=[];var kI=kG/jv.EARTHRADIUS;var kF=(Math.PI/180)*kB;var kL=(Math.PI/180)*kD;for(var kE=0;kE<360;kE+=9){var kC=(Math.PI/180)*kE;var kJ=Math.asin(Math.sin(kF)*Math.cos(kI)+Math.cos(kF)*Math.sin(kI)*Math.cos(kC));var kH=Math.atan2(Math.sin(kC)*Math.sin(kI)*Math.cos(kF),Math.cos(kI)-Math.sin(kF)*Math.sin(kJ));var kK=((kL-kH+Math.PI)%(2*Math.PI))-Math.PI;var kA=new cA(kJ*(180/Math.PI),kK*(180/Math.PI));kN.push(jv.convertLL2MC(kA))}var kz=kN[0];kN.push(new cG(kz.lng,kz.lat));if(kz){this._radiusMercator=Math.sqrt(Math.pow(kz.lng-this.point.lng,2)+Math.pow(kz.lat-this.point.lat,2))}else{this._radiusMercator=this.radius}return kN}});function aX(i,e,kz){this.latLng=new cA(i.lat,i.lng);var T=jv.convertLL2MC(i);hf.call(this,T,e,kz)}aX.inherits(hf,"CircleOut");e9.extend(aX.prototype,{toString:function(){return"Circle"},setCenter:function(e){this.latLng=new cA(e.lat,e.lng);var i=jv.convertLL2MC(e);this.setCenterIn(i)},getCenter:function(){return this.latLng},getPath:function(){var e=this.getPathIn();if(!e||e.length===0){return[]}var kz=[];for(var T=0;T<e.length;T++){kz[T]=jv.convertMC2LL(e[T])}return kz},toGeoJSON:function(){var kz="Polygon";var kA=[];var kB=this.getPath();for(var T=0;T<kB.length;T++){kA.push([kB[T].lng,kB[T].lat])}var e={type:"Feature",geometry:{type:kz,coordinates:[kA]},properties:this.properties};return e},updateByGeoJSON:function(e){}});function ko(kz,e,i){iU.call(this,i);i=i||{};if(typeof i.topFillOpacity==="number"){this._config.topFillOpacity=i.topFillOpacity}else{this._config.topFillOpacity=0.6}if(typeof i.sideFillOpacity==="number"){this._config.sideFillOpacity=i.sideFillOpacity}else{this._config.sideFillOpacity=0.8}ck(this._config.sideFillOpacity,0,1);if(i.topFillColor===""){this._config.topFillColor=""}else{this._config.topFillColor=i.topFillColor?i.topFillColor:"#fff"}if(i.sideFillColor===""){this._config.sideFillColor=""}else{this._config.sideFillColor=i.sideFillColor?i.sideFillColor:"#fff"}this._parseFillCacheWebGL=[];this.setPoints(kz,i);this._config.altitude=e||0;hP.sendMessage(a1(4,2,5),["overlay","prism"]);var T=this;hl.load("poly",function(){T._draw()})}ko.inherits(iU,"Prism");e9.extend(ko.prototype,{setPoints:function(kB){var kz=[];if(typeof kB==="string"||kB[0] instanceof cG||kB[0] instanceof cA||this instanceof hf||kB.length===0){var e=this._processSinglePointArray(kB);this._userPoints=e.userPoints;kz=e.innerPoints;this.hasMultipleParts=false}else{this._userPoints=[];for(var kA=0;kA<kB.length;kA++){var T=this._processSinglePointArray(kB[kA]);this._userPoints.push(T.userPoints);kz.push(T.innerPoints)}this.hasMultipleParts=true}iU.prototype.setPoints.call(this,kz)},setPathIn:function(e){this.setPoints(e)},_processSinglePointArray:function(e){var i=iU.getGraphPoints(e).slice(0);innerPoints=i.slice(0);if(innerPoints.length>1&&!innerPoints[0].equals(innerPoints[innerPoints.length-1])){innerPoints.push(new cG(innerPoints[0].lng,innerPoints[0].lat))}return{userPoints:i,innerPoints:innerPoints}},setPointAt:function(i,e){if(!this._userPoints[i]){return}this._clearCache();this._userPoints[i]=new cG(e.lng,e.lat);this.points[i]=new cG(e.lng,e.lat);if(i===0&&!this.points[0].equals(this.points[this.points.length-1])){this.points[this.points.length-1]=new cG(e.lng,e.lat)}this._calcBounds()},getPoints:function(){var e=this._userPoints;if(e.length===0){e=this.points}return e},getPathIn:function(){return this.getPoints()},setTopFillOpacity:function(e){if(e>1||e<0){return}this._config.topFillOpacity=e;this._setDomAttribute("topfillopacity",e)},getTopFillOpacity:function(){return this._config.topFillOpacity},setSideFillOpacity:function(e){if(e>1||e<0){return}this._config.sideFillOpacity=e;this._setDomAttribute("sidefillopacity",e)},getSideFillOpacity:function(){return this._config.sideFillOpacity},setTopFillColor:function(e){this._config.topFillColor=e||"";this._setDomAttribute("topfillcolor",e)},getTopFillColor:function(){return this._config.topFillColor},setSideFillColor:function(e){this._config.sideFillColor=e||"";this._setDomAttribute("sidefillcolor",e)},getSideFillColor:function(){return this._config.sideFillColor},setAltitude:function(e){this._config.altitude=Number(e);this.draw();var i=new fW("onlineupdate");i.overlay=this;this.dispatchEvent(i)},getAltitude:function(){return this._config.altitude}});function bA(kD,kB,kE){if(!kD||kD.length===0){return}this.userPath=kD;var e=[];if(typeof kD==="string"||kD[0] instanceof cG||kD[0] instanceof cA){var kF=this._processSinglePointArray(kD);for(var kA=0;kA<kF.innerPoints.length;kA++){e[kA]=jv.convertLL2MC(kF.innerPoints[kA])}}else{for(var kA=0;kA<kD.length;kA++){var kC=this._processSinglePointArray(kD[kA]);var T=[];for(var kz=0;kz<kC.innerPoints.length;kz++){T[kz]=jv.convertLL2MC(kC.innerPoints[kz])}e.push(T)}}ko.call(this,e,kB,kE)}bA.inherits(ko,"PrismOut");e9.extend(bA.prototype,{toString:function(){return"Prism"},setPath:function(kz){if(!kz||kz.length===0){return}this.userPath=kz;var T=[];for(var e=0;e<kz.length;e++){T[e]=jv.convertLL2MC(kz[e])}this.setPathIn(T);this._mouseEventPixels=null},getPath:function(){return this.userPath;var e=this.getPathIn();if(!e||e.length===0){return[]}var kz=[];for(var T=0;T<e.length;T++){kz[T]=jv.convertMC2LL(e[T])}return kz}});function b7(kA,i){iU.call(this,i);i=i||{};this._config.type=i.type||"image";this._config.url=i.url||"";this._config.opacity=typeof i.opacity==="number"?i.opacity:1;this._config.sysType=i.sysType!=="fixed"?"geo":"fixed";this._config.top=i.top||false;this.isReDraw=i.isReDraw||false;this.drawHook=(i.drawHook instanceof Function)?i.drawHook:null;ck(this._config.opacity,0,1);if(i.type==="image"&&i.isPixelMap){this._config.isPixelMap=i.isPixelMap||false;var T=i.pixelMap||{};this._config.colors=T.colors||["#F9F871","#FFC75F","#FF9671","#FF6F91","#D65DB1","#845EC2"];this._config.positions=T.positions||[0,0.2,0.4,0.6,0.8,1];this._config.domain=T.domain||[0,255];this._config.clamp=T.clamp||this._config.domain;this._config.noData=(T.noData!==undefined)?T.noData:-99999;this._config.fomularC=T.fomularC||"float generateValue(vec4 pixel){return pixel.r * 255.;}";this._config.fomularJS=T.fomularJS||function(kB){return kB.r};this._config.maskPng=T.maskPng||null;this._config.maskData=T.maskData||-1;this._config.maskCoord=T.maskCoord||null;this.fHashcode=q({str:this._config.fomularC});var e=this.canPixelMap();if(e){this.isPixelMap=true;this.setPixelMap()}}this._parseFillCacheWebGL=[];if(this._config.sysType==="fixed"){this.points=kA}else{this.setPoints(kA,i)}if(kA instanceof ij){this._addlog(i)}var kz=this;hl.load("poly",function(){kz._draw()})}b7.inherits(iU,"GroundOverlay");e9.extend(b7.prototype,{_addlog:function(e){var i=1;var T="picture";if(e){if(e.type==="canvas"&&!e.isReDraw){i=2;T="static_canvas"}else{if(e.type==="canvas"&&e.isReDraw){i=3;T="dynamic_canvas"}else{if(e.type==="video"){i=4;T="video"}else{if(e.type==="image"&&e.isPixelMap){i=5;T="raster"}}}}}hP.sendMessage(a1(4,2,8,i),["overlay","ground_box",T])},setPoints:function(i){var e=iU.getGraphPoints(i).slice(0);this.hasMultipleParts=false;iU.prototype.setPoints.call(this,e)},setPathIn:function(e){this.setPoints(e)},getPoints:function(){return this.points},getPathIn:function(){return this.getPoints()},canPixelMap:function(){if(this._config.colors&&this._config.positions){return true}return false},setPixelMap:function(){if(!this._config.isPixelMap||!this.canPixelMap()){return}var i=this._config.colors;var e=this._config.positions;this.pHashcode=q({colors:i,positions:e});this.pixelColorMap=hV.generateColorRamp(i,e)},setDomain:function(e){if(e instanceof Array&&e.length===2){this._config.domain=e;this.doOnceDraw()}},setClamp:function(e){if(e instanceof Array&&e.length===2){this._config.clamp=e;this.doOnceDraw()}},setMaskPng:function(i){this._config.maskPng=i;if(this.map){var e=new fW("hide");e.overlay=this;this.dispatchEvent(e);var e=new fW("show");e.overlay=this;this.dispatchEvent(e)}this.doOnceDraw()},setMaskData:function(e){this._config.maskData=e;this.doOnceDraw()},setMaskCoord:function(e){this._config.maskCoord=e;this.maskUV=null;this.doOnceDraw()},setNoData:function(e){this._config.noData=e;this.doOnceDraw()},setPositions:function(e){this._config.positions=e;this.setPixelMap();this.doOnceDraw()},setColors:function(e){this._config.colors=e;this.setPixelMap();this.doOnceDraw()},setBounds:function(T,kC){if(T instanceof ij){var kE=Math.min(T.sw.lng,T.ne.lng);var kB=Math.max(T.sw.lng,T.ne.lng);var kD=Math.min(T.sw.lat,T.ne.lat);var e=Math.max(T.sw.lat,T.ne.lat);var kG=[new cG(kE,kD),new cG(kB,kD),new cG(kB,e),new cG(kE,e)];var kz=iU.getGraphPoints(kG).slice(0);var kA=[];for(var kF=0;kF<kz.length;kF++){kA[kF]=jv.convertLL2MC(kz[kF])}}else{if(T.length===4){var kA=T}else{return false}}this.setPoints(kA);if(kC){return true}this.doOnceDraw()},setOpacity:function(e){if(e>1||e<0){return}this._config.opacity=e;this.doOnceDraw()},getOpacity:function(){return this._config.opacity},getImageURL:function(){return this._config.url},setImage:function(e,T){this._config.src=e;this._texture=null;var i=this;this.imageLoad&&this.imageLoad(this._config.src,function(kz,kA){if(kA){i._texture=kz;if(T){i.setBounds(T,true)}i.doOnceDraw()}})},setFomular:function(e,i){if(e&&i){this._config.fomularJS=e;this._config.fomularC=i;this.fHashcode=q({str:this._config.fomularC});this.doOnceDraw()}},setIsPixelMap:function(e){this.isPixelMap=e;this.doOnceDraw()},getImagePixel:function(kz){if(!this._config.isPixelMap||!this.canPixelMap()){return null}if(!this.getImageMaskPixel(kz)){return null}if(this.imageObject){var T=Math.floor((kz.lng-this.points[3].lng)/this.lngMC);var e=Math.floor((-kz.lat+this.points[3].lat)/this.latMC);var i=Math.floor((e*this.imageObject.width+T)*4);if(T>this.imageObject.width||T<0){return null}if(e>this.imageObject.height||e<0){return null}if(i+3>this.imageObject.data.data.length){return null}return[this.imageObject.data.data[i],this.imageObject.data.data[i+1],this.imageObject.data.data[i+2],this.imageObject.data.data[i+3],]}return null},getValue:function(i){if(this._config.isPixelMap&&i&&this._config.fomularJS){if(!(i instanceof Array)){i=this.getImagePixel(i.point)}var e=this._config.fomularJS({r:i[0],g:i[1],b:i[2],a:i[3]});if(e>=this._config.clamp[0]&&e<=this._config.clamp[1]){return e}}return null},setImageObject:function(T){var e=document.createElement("canvas");e.width=T.width;e.height=T.height;var i=e.getContext("2d");i.drawImage(T,0,0,T.width,T.height);this.imageObject={width:T.width,height:T.height,data:i.getImageData(0,0,T.width,T.height)};this.updatePixelMc();i=null;e=null},updatePixelMc:function(){if(this.imageObject){var e=Math.abs(this.points[2].lng-this.points[0].lng);var i=Math.abs(this.points[2].lat-this.points[0].lat);this.lngMC=e/this.imageObject.width;this.latMC=i/this.imageObject.height}},setMaskImageObject:function(T){var e=document.createElement("canvas");e.width=T.width;e.height=T.height;var i=e.getContext("2d");i.drawImage(T,0,0,T.width,T.height);this.imageMaskObject={width:T.width,height:T.height,data:i.getImageData(0,0,T.width,T.height)};i=null;e=null},getImageMaskPixel:function(e){if(!this.imageMaskObject){return true}var kz=this._toOverlayPixelsGL([e]);var kE=this.maskOverlayPixels;var kB=kE[1][0]-kE[0][0];var kA=kE[1][1]-kE[0][1];var T=Math.floor((kz[0][0]-kE[0][0])/kB*this.imageMaskObject.width);var i=Math.floor((-kz[0][1]+kE[1][1])/kA*this.imageMaskObject.height);var kD=Math.floor((i*this.imageMaskObject.width+T)*4);if(T>this.imageMaskObject.width||T<0){return null}if(i>this.imageMaskObject.height||i<0){return null}var kC=this.imageMaskObject.data.data;if(kD+3>kC.length){return false}if(kC[kD+3]>0){if(this._config.maskData>-1&&this._config.maskData!==kC[kD]){return false}return true}return false},doOnceDraw:function(){var e=new fW("onlineupdate");e.overlay=this;this.dispatchEvent(e)},destroy:function(){this.points=[];this.imageMaskObject=null}});function gd(kz,kG){if(!kz){return}kG=kG||{};var kB=[];if(kG.sysType==="fixed"){kB=kz}else{if(kz instanceof ij){var kD=Math.min(kz.sw.lng,kz.ne.lng);var kA=Math.max(kz.sw.lng,kz.ne.lng);var kC=Math.min(kz.sw.lat,kz.ne.lat);var T=Math.max(kz.sw.lat,kz.ne.lat);var kF=[new cG(kD,kC),new cG(kA,kC),new cG(kA,T),new cG(kD,T)];var e=iU.getGraphPoints(kF).slice(0);for(var kE=0;kE<e.length;kE++){kB[kE]=jv.convertLL2MC(e[kE])}}else{if(kz.length===4){kB=kz}else{return false}}}b7.call(this,kB,kG)}gd.inherits(b7,"GroundOverlayOut");e9.extend(gd.prototype,{toString:function(){return"GroundOverlay"}});function dZ(e,i){if(!(e instanceof cG)){return}this.point=e;var e=jv.convertLL2MC(e);this.mc_point=[e.lng,e.lat];this.size=(i.size instanceof jm)?i.size:new jm(32,32);this.scale=i.scale||1;this.anchor=(i.anchor instanceof jm)?i.anchor:new jm(0,0);this.rotation=i.rotation||0;this.offset=(i.offset instanceof jm)?i.offset:new jm(0,0);this.level=i.level||18;hP.sendMessage(a1(4,2,9),["overlay","ground_point"]);var T=this.calBounds(false);gd.call(this,T,i)}dZ.inherits(gd,"GroundPoint");e9.extend(dZ.prototype,{calBounds:function(kB){var e=Math.pow(2,18-this.level);var T=this.scale*e;var kF=this.size.width/2*T;var kM=this.size.height/2*T;var kE=this.anchor.width*T;var kL=this.anchor.height*T;var kz=this.offset.width*T;var kG=this.offset.height*T;var kN=[[-1,-1],[1,-1],[1,1],[-1,1]];var kA=[];var kH=this.rotation*Math.PI/180;var kO=mat2.create();mat2.rotate(kO,kO,kH);for(var kJ=0;kJ<kN.length;kJ++){var kK=kN[kJ][0]*kF-kE;var kI=kN[kJ][1]*kM-kL;var kD=kO[0]*kK+kO[1]*kI;var kC=kO[2]*kK+kO[3]*kI;kA.push(new cG(this.mc_point[0]+kD+kz,this.mc_point[1]+kC+kG))}if(kB){this._mouseEventPixels=null;this.setBounds(kA)}else{return kA}},setPoint:function(T,i){if(!(T instanceof cG)){return}this.point=T;var e=jv.convertLL2MC(T);this.mc_point=[e.lng,e.lat];if(i||i===undefined){this.calBounds(true)}return this},setScale:function(e,i){this.scale=e;if(i||i===undefined){this.calBounds(true)}return this},setSize:function(e,i){if(options.size instanceof jm){this.size=e;if(i||i===undefined){this.calBounds(true)}}return this},setRotation:function(e,i){this.rotation=e;if(i||i===undefined){this.calBounds(true)}return this},setAnchor:function(e,i){if(e instanceof jm){this.anchor=e;if(i||i===undefined){this.calBounds(true)}}return this},setOffset:function(e,i){if(e instanceof jm){this.offset=e;if(i||i===undefined){this.calBounds(true)}}return this}});function bU(i,e){aU.call(this,e);if(!i||!e.point||!b0(i)){throw new Error("参数类型错误")}e=e||{};this.point=e.point;this.createDom=i;this.offsetX=e.offsetX||0;this.offsetY=e.offsetY||0;this.minZoom=e.minZoom||3;this.maxZoom=e.maxZoom||21;this.zIndex=e.zIndex||0;this.nextTick=e.nextTick||false;this.properties=e.properties||{};this.enableMassClear=e.enableMassClear||false;this.enableDraggingMap=e.enableDraggingMap||false;this.fixBottom=e.fixBottom||false;this.anchors=e.anchors||[0.5,1];this.visible=e.visible===undefined?true:!!e.visible;this.customLayer=null;hP.sendMessage(a1(4,2,11),["overlay","dom_custom"])}bU.inherits(aU,"CustomOverlay");e9.extend(bU.prototype,{initialize:function(i){this.map=i;this.show(true);this.div=document.createElement("div");this.div.id="cus_overlay";this.div.setAttribute("data-tag-touch","stop");var e=this.createDom(this.properties);this.div.appendChild(e);this.map.getPanes().labelPane.appendChild(this.div);if(this.zIndex!==0){this.div.style.zIndex=this.zIndex}return this.div},isDraw:function(){if(this.map){var e=this.map.getZoom();if(e<this.minZoom||e>this.maxZoom||!this.visible){this.hide(true);return false}else{this.show(true);return true}}return false},hide:function(e){if(!e){this.visible=false}this._visible=false;e9.hide(this.domElement)},show:function(e){if(!e){this.visible=true}this._visible=true;e9.show(this.domElement)},draw:function(){if(!this.div){return}if(this.nextTick&&this.div.style.position!=="absolute"){this.div.style.opacity=0;setTimeout(function(){this.div.style.opacity=1;this.draw()}.bind(this),0)}if(this.div.children[0]){var kA=this.div.children[0].clientWidth;var e=this.div.children[0].clientHeight;if(!kA&&this.lastClientWidth){kA=this.lastClientWidth;e=this.lastClientHeight}this.lastClientWidth=kA;this.lastClientHeight=e}var kz=this.div.children[0]?kA*this.anchors[0]:0;var T=this.div.children[0]?e*this.anchors[1]-(this.fixBottom?0:25):0;var i=this.map.pointToOverlayPixel(this.point,{useRound:false});this.div.style.position="absolute";this.div.style.left=i.x-kz+this.offsetX+"px";this.div.style.top=i.y-T+this.offsetY+"px";this.div.style.boxSizing="border-box";if(!this.isDraw()){return}},addEventListener:function(T,kA){if(!this.div||!this.map){return}var i=this;var kz=this.map;function e(kE){var kC=new fW("onclick").inherit(kE);var kD=kE.srcElement||kE.target;var kB=kE.clientX||kE.pageX;var kG=kE.clientY||kE.pageY;if(kE&&kC&&kD&&kB&&kG){var kF=e9.Dom.getOffset(kz.container);kC.pixel=new fv(kB-kF.left,kG-kF.top);kC.latLng=kz.pixelToPoint(kC.pixel)}return kC}switch(T){case"mouseover":e9.on(this.div,"mouseover",function(kC){var kB=e(kC);i.dispatchEvent(kB);kA(kB)});break;case"mouseout":e9.on(this.div,"mouseout",function(kC){var kB=e(kC);i.dispatchEvent(kB);kA(kB)});break;case"click":e9.on(this.div,"click",function(kC){var kB=e(kC);i.dispatchEvent(kB);kA(kB)});break;default:break}},setPoint:function(e){if(e instanceof cG){this.div.innerHTML="";this.div.appendChild(this.createDom(this.properties));this.point=e;var kz=this.div.clientWidth*this.anchors[0];var T=this.div.clientHeight*this.anchors[1]-(this.fixBottom?0:25);var i=this.map.pointToOverlayPixel(this.point,{useRound:false});this.div.style.position="absolute";this.div.style.left=i.x-kz+this.offsetX+"px";this.div.style.top=i.y-T+this.offsetY+"px"}},getPoint:function(){return this.point},setProperties:function(e){if(e instanceof Object){Object.assign(this.properties,e);this.div.innerHTML="";this.div.appendChild(this.createDom(this.properties))}},getProperties:function(){return this.properties},toString:function(){return"CustomOverlay"}});var ay={};function im(T,i){e9.BaseClass.call(this);this.content=T;this.map=null;this._config={width:0,height:0,maxWidth:600,offset:new jm(0,0),title:"",maxContent:"",enableMaximize:false,enableAutoPan:true,enableCloseOnClick:true,margin:[10,10,40,10],collisions:[[10,10],[10,10],[10,10],[10,10]],ifMaxScene:false,onClosing:function(){return true}};this.setConfig(i);if(this._config.width<50){this._config.width=50}if(this._config.width>730){this._config.width=730}if(this._config.height!=0){if(this._config.height<50){this._config.height=50}if(this._config.height>650){this._config.height=650}}if(this._config.maxWidth!==0){if(this._config.maxWidth<50){this._config.maxWidth=50}if(this._config.maxWidth>730){this._config.maxWidth=730}}this.isWinMax=false;this.IMG_PATH=E.imgPath;this.overlay=null;var e=this;hl.load("simpleInfowindow",function(){e._draw()})}im.inherits(e9.BaseClass,"SimpleInfoWindow");e9.extend(im.prototype,{setWidth:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<50){e=50}if(e>730){e=730}}this._config.width=e},setHeight:function(e){e=e*1;e-=10;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<50){e=50}if(e>650){e=650}}this._config.height=e},setMaxWidth:function(e){e=e*1;if(!e&&e!=0||isNaN(e)||e<0){return}if(e!=0){if(e<50){e=50}if(e>730){e=730}}this._config.maxWidth=e},setTitle:function(e){this._config.title=e||""},setContent:function(e){this.content=e||""},setMaxContent:function(e){this._config.maxContent=e||""},redraw:function(){},enableAutoPan:function(){this._config.enableAutoPan=true},disableAutoPan:function(){this._config.enableAutoPan=false},enableCloseOnClick:function(){this._config.enableCloseOnClick=true},disableCloseOnClick:function(){this._config.enableCloseOnClick=false},enableMaximize:function(){this._config.enableMaximize=true},disableMaximize:function(){this._config.enableMaximize=false},show:function(){this._visible=true},hide:function(){this._visible=false},close:function(){this.hide()},dispose:function(){e9.BaseClass.prototype.decontrol.call(this)},maximize:function(){this.isWinMax=true},restore:function(){this.isWinMax=false},setConfig:function(i){if(!i){return}for(var e in i){if(typeof(this._config[e])==typeof(i[e])){this._config[e]=i[e]}}},isVisible:function(){return this.isOpen()},isOpen:function(){return false},getPoint:function(){if(this.overlay&&this.overlay.getPoint){return this.overlay.getPoint()}},getOffset:function(){return this._config.offset},dispose:function(){e9.BaseClass.prototype.decontrol.call(this)},toString:function(){return"SimpleInfoWindow"}});h4.prototype.openSimpleInfoWindow=function(kz,e){if(!kz||kz.toString()!="SimpleInfoWindow"||!e||e.toString()!="Point"){return}var i=this.temp;if(!i.marker){var T=new jP(E.imgPath+"blank.gif",{width:1,height:1});i.marker=new kb(e,{icon:T,width:1,height:1,offset:new jm(0,0),infoWindowOffset:new jm(0,0),clickable:false});i.marker._fromMap=1}else{i.marker.setPoint(e)}this.addOverlay(i.marker);i.marker.show();i.marker.openSimpleInfoWindow(kz)};h4.prototype.closeSimpleInfoWindow=function(){var e=this.temp.infoWin||this.temp._infoWin;if(e&&e.overlay){e.overlay.closeSimpleInfoWindow()}};eM.prototype.openSimpleInfoWindow=function(e){if(this.map){this.map.closeSimpleInfoWindow();e._visible=true;this.map.temp._infoWin=e;e.overlay=this;e9.BaseClass.call(e,e.hashCode)}};eM.prototype.closeSimpleInfoWindow=function(){if(this.map&&this.map.temp._infoWin){this.map.temp._infoWin._visible=false;this.map.temp._infoWin.decontrol();this.map.temp._infoWin=null}};function cs(T,e){iU.call(this,e);e=e||{};this._config.showRegion=e.showRegion||"inside";this._config.isBuildingMask=e.isBuildingMask&&true;this._config.isPoiMask=e.isPoiMask&&true;this._config.isMapMask=e.isMapMask&&true;this._config.path=T;this._parseFillCacheWebGL=[];this.setPoints(T,e);hP.sendMessage(a1(4,1,3),["instance","custom_mask"]);var i=this;hl.load("poly",function(){i._draw()})}cs.inherits(iU,"MapMask");e9.extend(cs.prototype,{setPoints:function(i){var e=iU.getGraphPoints(i).slice(0);this.hasMultipleParts=false;iU.prototype.setPoints.call(this,e)},setPathIn:function(e){this.setPoints(e)},_processSinglePointArray:function(e){var i=iU.getGraphPoints(e).slice(0);innerPoints=i.slice(0);if(innerPoints.length>1&&!innerPoints[0].equals(innerPoints[innerPoints.length-1])){innerPoints.push(new cG(innerPoints[0].lng,innerPoints[0].lat))}return{userPoints:i,innerPoints:innerPoints}},getPoints:function(){var e=this._userPoints;if(e.length===0){e=this.points}return e},getPathIn:function(){return this.getPoints()}});function kl(kB,T){if(!kB||kB.length===0){return}var kA=[];if(kB[0] instanceof cG){var e=this._processSinglePointArray(kB);for(var kz=0;kz<e.innerPoints.length;kz++){kA[kz]=jv.convertLL2MC(e.innerPoints[kz])}}cs.call(this,kA,T)}kl.inherits(cs,"MapMaskOut");e9.extend(kl.prototype,{toString:function(){return"MapMask"}});function fv(e,i){e=isNaN(e)?0:e;i=isNaN(i)?0:i;this.x=e;this.y=i}fv.prototype.equals=function(e){if(!e){return false}return e.x===this.x&&e.y===this.y};fv.prototype.clone=function(){return new fv(this.x,this.y)};fv.prototype.toString=function(){return"Pixel"};function jm(i,e){if(typeof i!=="number"){this.width=parseFloat(i)}else{this.width=i}if(typeof e!=="number"){this.height=parseFloat(e)}else{this.height=e}}jm.prototype.equals=function(e){return !!(e&&this.width===e.width&&this.height===e.height)};jm.prototype.toString=function(){return"Size"};var kr={B_NORMAL_MAP:{tileUrls:dI(E.tileDomain,E.rasterTilePath),vectorTileUrls:dI(E.tileDomain,E.vectorTilePath),tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,webgl:{minZoom:3,maxZoom:25},zoomLevelBase:18,errorUrl:E.imgPath+"bg.png",bounds:new ij(new cG(-21364736,-11708041.66),new cG(23855104,12474104.17)),imgExtend:"png"},B_SATELLITE_MAP:{tileUrls:["//maponline0.bdimg.com/starpic/?qt=satepc&","//maponline1.bdimg.com/starpic/?qt=satepc&","//maponline2.bdimg.com/starpic/?qt=satepc&","//maponline3.bdimg.com/starpic/?qt=satepc&"],tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:E.imgPath+"bg.png",bounds:new ij(new cG(-21364736,-10616832),new cG(23855104,15859712)),imgExtend:"png"},B_STREET_MAP:{tileUrls:dI(E.tileDomain,E.rasterTilePath),tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:E.imgPath+"bg.png",bounds:new ij(new cG(-21364736,-10616832),new cG(23855104,15859712)),imgExtend:"png"},BMAP_CUSTOM_LAYER:{tileUrls:[""],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:E.imgPath+"blank.gif",bounds:new ij(new cG(-21364736,-10616832),new cG(23855104,15859712)),imgExtend:"png"},B_EARTH_MAP:{tileUrls:[""],tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,webgl:{minZoom:3,maxZoom:21},zoomLevelBase:18,errorUrl:E.imgPath+"blank.gif",bounds:new ij(new cG(-21364736,-10616832),new cG(23855104,15859712)),imgExtend:"png"},B_NONE_MAP:{tileUrls:"",tileSize:256,baseUnits:256,zoomLevelMin:3,zoomLevelMax:19,minDataZoom:3,maxDataZoom:19,minZoom:3,maxZoom:19,zoomLevelBase:18,errorUrl:E.imgPath+"bg.png",bounds:new ij(new cG(-21364736,-11708041.66),new cG(23855104,12474104.17)),imgExtend:"png"}};var ev=kr;function cV(kC,kD,T,e,kB){if(kB&&ev[kB]){this.mapTypeName=kB}else{this.mapTypeName=BMAP_NORMAL_MAP}if(kC&&kC instanceof Array){var kA=true;for(var kz=0;kz<kC.length;kz++){if(kC[kz] instanceof ij){continue}else{kA=false;break}}kA&&(this.bounds=kC)}if(typeof kD==="number"&&kD>=ev[this.mapTypeName].webgl.minZoom){if(ev[this.mapTypeName].webgl){if(kD>=ev[this.mapTypeName].webgl.minZoom){this.minZoom=kD}else{this.minZoom=ev[this.mapTypeName].webgl.minZoom}}else{if(kD>=ev[this.mapTypeName].minZoom){this.minZoom=kD}else{this.minZoom=ev[this.mapTypeName].minZoom}}}if(typeof T==="number"){if(ev[this.mapTypeName].webgl){if(T<=ev[this.mapTypeName].webgl.maxZoom){this.maxZoom=T}else{this.maxZoom=ev[this.mapTypeName].webgl.maxZoom}}else{if(T<=ev[this.mapTypeName].maxZoom){this.maxZoom=T}else{this.maxZoom=ev[this.mapTypeName].maxZoom}}}if(this.maxZoom<this.minZoom){this.maxZoom=null}if(e&&typeof e==="function"){this.tileUrlFunction=e}hP.sendMessage(a1(4,3,1,2),["layer","vector","private"])}e9.extend(cV.prototype,{addBoundary:function(e){if(e instanceof ij){if(this.bounds){this.bounds.push(e)}else{this.bounds=[e]}}},setTileUrlFunction:function(e){if(e&&typeof e==="function"){this.tileUrlFunction=e}},crossPoint:function(e,kz,kA){if(kA<this.minZoom||kA>this.maxZoom){return false}var kB=this.containsPoint(e,kA);if(kB){return kB}for(var T=0;T<this.bounds.length;T++){if(this.bounds[T].intersects(kz)){kB=true;break}}return kB},containsPoint:function(e,kz){if(!e||!(e instanceof cG)||!this.isValid()){return false}var kA=false;if(kz<this.minZoom||kz>this.maxZoom){return kA}for(var T=0;T<this.bounds.length;T++){if(this.bounds[T].containsPoint(e)){kA=true;break}}return kA},isValid:function(){return this.bounds&&this.minZoom&&this.maxZoom&&this.tileUrlFunction},toString:function(){return"PrivateRegionDataModel"}});function h3(kE,i,kA,T,kz){this.mgr=kE;this.position=kA;this._cbks=[];this.name=kE.getTileName(T,kz,kE.map.config.style);this.info=T;this._transparentPng=kz.isTransparentPng();var kF=b6("img");il(kF);kF.galleryImg=false;var kD=kF.style;kD.position="absolute";kD.width=kE.tileSize+"px";kD.height=kE.tileSize+"px";kD.left=kA[0]+"px";kD.top=kA[1]+"px";this.img=kF;this.src=i;if(eN&&kA._offsetX===0){kD.opacity=0;kD.willChange="opacity"}var kC=this;this.img.onload=function(kN){if(!kC.mgr){return}var kI=kC.mgr;var kG=kI.bufferTiles;if(kI.bufferNumber>0){kG[kC.name]=kC;kG.push(kC.name)}var kK=kG.length-kI.bufferNumber;for(var kL=0;kK>0&&kL<kG.length;kL++){var kM=kG[kL];if(!kI.mapTiles[kM]){if(kG[kM]){kG[kM].mgr=null;var kJ=kG[kM].img;if(kJ.parentNode){iJ(kJ);kJ.parentNode.removeChild(kJ)}kJ=null;kG[kM].img=null;kG[kM]=null;delete kG[kM]}kG.splice(kL,1);kL--;kK--}}kC.loaded=true;kI.imgNumber++;if(!aV(kC.img)){if(kz.tilesDiv){kz.tilesDiv.appendChild(kC.img)}}var kN=new fW("onimagechange");kN.action="show";kN.tile=kC.name;kI.map.dispatchEvent(kN);if(eN&&kA._offsetX===0){var kH=new fL({fps:10,duration:300,render:function(e){if(kC.img&&kC.img.style){kC.img.style.opacity=e*1}},finish:function(){if(kC.img&&kC.img.style){delete kC.img.style.opacity;kC.img.style.willChange="auto"}}})}kC._callCbks()};this.img.onerror=function(kI){kC.error=true;kC._callCbks();if(!kC.mgr){return}var kG=kC.mgr;var kH=ev[kz.mapType];if(kH.errorUrl){kC.img.src=kH.errorUrl}if(!aV(kC.img)){if(kz.tilesDiv){kz.tilesDiv.appendChild(kC.img)}}};kF=null;var kB=new fW("onimagebefore");kB.tile=kC.name;kE.map.dispatchEvent(kB)}h3.prototype._addLoadCbk=function(e){this._cbks.push(e)};h3.prototype._load=function(){if(FeBrowser.ie<=6&&FeBrowser.ie>0&&this._transparentPng){this.img.src=E.imgPath+"blank.gif"}else{this.img.src=this.src}};h3.prototype._callCbks=function(){var T=this;for(var e=0;e<T._cbks.length;e++){T._cbks[e]()}T._cbks.length=0};var eN=(!e9.Browser.ie||e9.Browser.ie>8);function jD(e){this.tileLayers=[];this.map=e;this.bufferNumber=300;this.mapTiles=[];this.bufferTiles=[];this.config=ev[this.map.mapType];this.errorUrl=this.config.errorUrl;this.tileSize=this.config.tileSize;this.baseUnits=this.config.baseUnits;this.baseZoomLevel=this.config.zoomLevelBase;this.tileURLs=this.config.tileUrls;this.imgNumber=0;this.numLoading=0;this.temp={}}bG.register(function(i){if(i._renderType==="webgl"){return}var e=i.tileMgr=new jD(i);i.addEventListener("mousewheel",function(T){e.mouseWheel(T)});i.addEventListener("dblclick",function(T){e.dblClick(T)});i.addEventListener("rightdblclick",function(T){e.dblClick(T)});i.addEventListener("minuspress",function(T){e.keypress(T)});i.addEventListener("pluspress",function(T){e.keypress(T)});i.addEventListener("load",function(T){if(this.mapType===BMAP_EARTH_MAP){return}e.loadTiles()});i.addEventListener("zoomstartcode",function(T){if(this.mapType===BMAP_EARTH_MAP){return}e._zoom(T)});i.addEventListener("moving",function(T){if(this.mapType===BMAP_EARTH_MAP){return}e.moveGridTiles()});i.addEventListener("resize",function(T){if(this.mapType===BMAP_EARTH_MAP){return}e.resizeMap(T)});i.addEventListener("addtilelayer",function(T){e.addTileLayer(T)});i.addEventListener("removetilelayer",function(T){e.removeTileLayer(T)})});e9.extend(jD.prototype,{addTileLayer:function(kz){var T=this;var i=kz.target;T.tileLayers.push(i);if(T.map.loaded){T.moveGridTiles()}},removeTileLayer:function(kG){var kH=this;var kE=kG.target;var kC=kE.mapType;var kB=kH.mapTiles;var kJ=kH.bufferTiles;for(var T in kJ){var kz=T.split("-")[1];if(kz==kC){delete kJ[T]}}for(var T in kB){var kz=T.split("-")[1];if(kz==kC){delete kB[T]}}if(kH.zoomsDiv&&kH.zoomsDiv.parentNode){kH.zoomsDiv.parentNode.removeChild(kH.zoomsDiv);kH.zoomsDiv.innerHTML=""}var kA=kH.map;if(kA.deepZoom){var kI=kA.deepZoom.preDeepZoomDiv;if(kI&&kI.parentNode){kI.parentNode.removeChild(kI)}}for(var kF=0,kD=kH.tileLayers.length;kF<kD;kF++){if(kE==kH.tileLayers[kF]){kH.tileLayers.splice(kF,1)}}kH.moveGridTiles()},hideDeepZoomDiv:function(){var i=this,T=i.map;if(T.deepZoom){var e=T.deepZoom.preDeepZoomDiv;if(e&&e.style.display!="none"){e.style.display="none"}}},getTileLayer:function(kA){var kz=this;for(var T=0,e=kz.tileLayers.length;T<e;T++){tilelayer=kz.tileLayers[T];if(tilelayer.mapType==kA){return tilelayer}}return null},_zoom:function(T){var i=this;if(i.zoomsDiv&&i.zoomsDiv.style.display!="none"){i.zoomsDiv.style.display="none"}i.hideDeepZoomDiv();i.moveGridTiles()},resizeMap:function(i){this.loaded=false;this.moveGridTiles()},_checkTilesLoaded:function(){this.numLoading--;var e=this;if(this.numLoading==0){if(this._checkLoadedTimer){clearTimeout(this._checkLoadedTimer);this._checkLoadedTimer=null}this._checkLoadedTimer=setTimeout(function(){if(e.numLoading==0){e.map.dispatchEvent(new fW("ontilesloaded"))}e._checkLoadedTimer=null},80)}},getTileName:function(e,T,i){var kA=T.mapType;var kz="TILE-"+kA+"-"+i+"-"+e[0]+"-"+e[1]+"-"+e[2];return kz},hideTile:function(kz,T){var i=kz.img;if(aV(i)){if(kz.loaded){this.imgNumber--}if(i.parentNode){iJ(i);i.parentNode.removeChild(i)}}var kA=new fW("onimagechange");kA.tile=this.getTileName(kz.info,T,this.map.config.style);kA.action="hide";delete this.mapTiles[kz.name];if(!kz.loaded){iJ(i);kz._callCbks();i=null;kz.img=null;kz.mgr=null}this.map.dispatchEvent(kA)},loadTiles:function(){var i=this;if(e9.Browser.ie){try{document.execCommand("BackgroundImageCache",false,true)}catch(T){}}if(this.zoomsDiv&&this.zoomsDiv.style.display!="none"){this.zoomsDiv.style.display="none"}i.hideDeepZoomDiv();i.moveGridTiles()},getCell:function(kA,kz){var e=this.baseUnits*Math.pow(2,(this.baseZoomLevel-kz));var T=parseInt(kA.lng/e);var i=parseInt(kA.lat/e);return[T,i,e*(T+0.5),e*(i+0.5)]},moveGridTiles:function(){var kN=this.map,kW=kN.getMapType(),kU=this.tileLayers.length;var kS=kN.centerPoint;if(kW!==BMAP_SATELLITE_MAP){kS=fc.calcLoopCenterPoint(kS)}var kE=kN.width;var k8=kN.getZoomUnits();var kT=k8*kE;var kY=kS.lng-kT/2;var kJ=kS.lng+kT/2;var kM=fc.isAddWidth(kY,kJ);for(var k0=0;k0<kU;k0++){var kA=this.tileLayers[k0];if(kA.baseLayer||kU==1){this.tilesDiv=kA.tilesDiv}var kO=ev[kA.mapType];var kz=kN.zoomLevel;var k3=kN.getZoomUnits(kN.zoomLevel);var kI=kO.baseUnits*Math.pow(2,(kO.zoomLevelBase-kz));var kG=Math.floor(kS.lng/kI);var kZ=Math.floor(kS.lat/kI);var kL=kO.tileSize;var kP=[kG,kZ,(kS.lng-kG*kI)/kI*kL,(kS.lat-kZ*kI)/kI*kL];var kH=kM?kN.width/2*1.5:kN.width/2;var kK=kP[0]-Math.ceil((kH-kP[2])/kL);var k7=kP[1]-Math.ceil((kN.height/2-kP[3])/kL);var k1=kP[0]+Math.ceil((kH+kP[2])/kL);var kQ=kP[1]+Math.ceil((kN.height/2+kP[3])/kL);var kF=[];for(var k5=kK;k5<k1;k5++){for(var k4=k7;k4<kQ;k4++){kF.push([k5,k4]);var kV="id_"+k5+"_"+k4+"_"+kz;kF[kV]=true}}if(kA.mapType!==BMAP_SATELLITE_MAP){kF=fc.calcLoopTiles(kF,kz)}kF.sort((function(i){return function(la,lb){return((0.4*Math.abs(la[0]-i[0])+0.6*Math.abs(la[1]-i[1]))-(0.4*Math.abs(lb[0]-i[0])+0.6*Math.abs(lb[1]-i[1])))}})([kP[0],kP[1]]));var T=this.mapTiles;var e=-kS.lng/k3;var k9=kS.lat/k3;var kX=[e,k9];for(var kR in T){var kC=T[kR];var k6=kC.info;if(!k6){continue}var kV="id_"+k6[0]+"_"+k6[1]+"_"+k6[2];if(!kF[kV]){this.hideTile(kC,kA)}}var kB=-kN.offsetX+kN.width/2;var kD=-kN.offsetY+kN.height/2;kA.tilesDiv.style.left=Math.round(e+kB)-kX[0]+"px";kA.tilesDiv.style.top=Math.round(k9+kD)-kX[1]+"px";this.numLoading+=kF.length;for(var k5=0,k2=kF.length;k5<k2;k5++){this.showTile([kF[k5][0],kF[k5][1],kN.zoomLevel],kX,kA,k5,kN.config.style)}}},showTile:function(kC,kB,kF,kK){this.centerPos=kB;var kD=ev[kF.mapType];var kG=this.map.config.style;var kz=this.getTileName(kC,kF,kG);var kA=(kC[0]*kD.tileSize)+kB[0];var T=(-1-kC[1])*kD.tileSize+kB[1];var kJ=[kA,T];var kE=null;if(kF.mapType!==BMAP_SATELLITE_MAP){kE=fc.calcLoopParam(kC[0],kC[2]);var kI=kE.offsetX;kJ[0]+=kI;kJ._offsetX=kI}var kN=this;var kM=this.mapTiles[kz];if(kM){kM.img.style.left=kJ[0]+"px";kM.img.style.top=kJ[1]+"px";if(kM.loaded){this._checkTilesLoaded()}else{kM._addLoadCbk(function(){kN._checkTilesLoaded()})}return}kM=this.bufferTiles[kz];if(kM){this.imgNumber++;kF.tilesDiv.insertBefore(kM.img,kF.tilesDiv.lastChild);this.mapTiles[kz]=kM;kM.img.style.left=kJ[0]+"px";kM.img.style.top=kJ[1]+"px";if(kM.loaded){this._checkTilesLoaded()}else{kM._addLoadCbk(function(){kN._checkTilesLoaded()})}var kL=new fW("onimagechange");kL.action="cache";kL.tile=this.getTileName(kC,kF,kG);this.map.dispatchEvent(kL)}else{var kH=new fv(kC[0],kC[1]);if(kE){kH.x=kE.col}var i=kF.getTilesUrl(kH,kC[2]);kM=new h3(this,i,kJ,kC,kF);kM._addLoadCbk(function(){kN._checkTilesLoaded()});kM._load();this.mapTiles[kz]=kM;hz(this.map)}},mouseWheel:function(kD){var kC=this.map;if(!kC.config.enableWheelZoom){return}var kE=kC.zoomLevel+(kD.trend===true?1:-1);var kA=kC._getProperZoom(kE);if(kA.exceeded){var T=new fW("onzoomexceeded");T.targetZoom=kE;kC.dispatchEvent(T);return}kC.dispatchEvent(new fW("onzoomstart"));kC.lastLevel=kC.zoomLevel;kC.zoomLevel=kA.zoom;var i=kD.pixel;var kz=kC.pixelToPointIn(i,{zoom:kC.lastLevel});var kB=kC.getZoomUnits(kC.zoomLevel);kC.centerPoint=new cG(kz.lng+kB*(kC.width/2-i.x),kz.lat-kB*(kC.height/2-i.y));this.zoom(i)},dblClick:function(T){var i=this.map;if(!i.config.enableDblclickZoom){return}if(i.mapType==="B_EARTH_MAP"){return}if(i.currentOperation===ep.dragging){return}if(T.type=="onrightdblclick"){i.zoomOut(T.point)}else{i.zoomIn(T.point)}},keypress:function(T){var i=this.map;if(i.getMapType()===BMAP_EARTH_MAP){return}T.type=="onpluspress"?i.zoomIn():i.zoomOut()}});function hO(kz){this.opts=kz||{};this.copyright=this.opts.copyright||{};this.transparentPng=this.opts.transparentPng||false;this.png8=this.opts.png8||false;this.height=this.opts.height||0;this.pack=this.opts.pack||false;this.baseLayer=this.opts.baseLayer||false;this.dataType=this.opts.dataType||1;this.transform=this.opts.transform||0;this.spanLevel=this.opts.spanLevel||0;this.isFlat=!this.opts.isFlat?false:true;this.showLabel=this.opts.showLabel===false?false:true;var e=this.opts.tileTypeName||"web";this.tileType=ik.getInstance(e);this.clipTile=this.opts.clipTile||false;this._type="tilelayer";this.isTop=this.opts.isTop||false;var i=b5()?128:256;this.cacheSize=this.opts.cacheSize||i;var T=this;this.tileCache=new aC(this.cacheSize,{clearCallback:function(kA){if(kA.label){if(kA.label.textImageBitmap){kA.label.textImageBitmap.close()}if(kA.label.indoorTextImageBitmap){kA.label.indoorTextImageBitmap.close()}}T._removeIndoorData(kA)}});this.scaler=gt()>=1.5?2:1;this.normalUdt=ka("ditu","normal").udt;this.numLoading=0;this.numTileLoading=0;this.firstTileLoad=false;this.retry=this.opts.retry||false;this.retryTime=this.opts.retryTime||600;this.useThumbData=false;this.useThumbData=this.opts.useThumbData||false;if(this.baseLayer){this.useThumbData=true}if(typeof this.opts.customLayer==="boolean"){this.customLayer=this.opts.customLayer}else{this.customLayer=true}}hO.inherits(dh,"TileLayer");e9.extend(hO.prototype,{isTransparentPng:function(){return this.transparentPng},getTilesUrl:function(kG,e){var T=ev[this.mapType];if(typeof T!=="object"){return null}var kz=kG.x;var kH=kG.y;kz=fc.calcLoopParam(kz,e).col;var i="";if(this.opts.tileUrlTemplate){i=this.opts.tileUrlTemplate;i=i.replace(/\{X\}/,kH);i=i.replace(/\{Y\}/,kz);i=i.replace(/\{Z\}/,e)}else{if(this.mapType===BMAPGL_NORMAL_MAP){var kF=this.isCanvasMap?0:1;var kB=T.tileUrls[Math.abs(kH+kz)%T.tileUrls.length];if(window.offLineIPAddress){kB=window.offLineIPAddress+"tile5/"}var kA=this.map.config.style;i=kB+"?qt=vtile&x="+kz+"&y="+kH+"&z="+e+(kA==="default"?"":("&styleId=1"))+"&styles=pl&udt="+this.normalUdt+"&scaler="+this.scaler+"&showtext="+kF;i=i.replace(/-(\d+)/gi,"M$1")}if(this.mapType===BMAP_SATELLITE_MAP){var kC=ka("ditu","satellite");var kE=kC.ver;var kD=kC.udt;i=T.tileUrls[Math.abs(kH+kz)%T.tileUrls.length]+"u=x="+kz+";y="+kH+";z="+e+";v="+kE+";type=sate&fm=46&udt="+kD;i=i.replace(/-(\d+)/gi,"M$1")}}return i},initialize:function(kC){this.map=kC;if(kC._renderType==="webgl"){var kB=null;if(this.customLayer!==false){kB=this.getTilesUrl}e9.extend(this,fr);this.labelProcessor=new jx(this);this.callbackDataQueue=[];if(kB){this.getTilesUrl=kB}var T=this;kC.on("indoor_data_refresh",function(kD){if(!T.baseLayer){return}T._refreshIndoorData(kD.uid,kD.floor)});kC.on("custom_labels_ready",function(kD){if(T.mapType!==BMAPGL_NORMAL_MAP&&kD.model==="custom"){return}if((kD.model==="custom")||kD.model==="mvt_"+T.drawIndex){T._doWorkAfterLabelImageLoad(kD.virtualTile,kD.labelCanvas,null,kD.imgKey)}});kC.on("glmoduleloaded",function(){if(!T.baseLayer){return}T.updateAllIconsTextureCoords()});kC.on("layer_update",function(kE){if(T.dataType===2&&kC.customLoaded&&kC.areaCustomLoaded){var kD=new fW("onlayer_clear");kC.fire(kD)}});kC.on("layer_clear",function(kD){if(T.dataType===2){T.clearCache()}});if(this.ontology&&this.ontology._initEvent){this.ontology._initEvent(kC)}}if(!kC.temp.layerZIndex){kC.temp.layerZIndex=0}this.zIndex=this.zIndex||1;if(kC.getRenderType()==="dom"){this.zIndex=kC.tileMgr.tileLayers.length}else{if(this.baseLayer){this.zIndex=0}else{if(this.zIndex>0){this.adjustZIndex()}else{var e=kC._featureMgr.result.bkData;this.zIndex=e.length||1}}}if(!kC.temp.layid){kC.temp.layid=0}if(!this.opts.mapType){this.mapType="BMAP_CUSTOM_LAYER_"+kC.temp.layid;kC.temp.layid++}else{this.mapType=this.opts.mapType}var kz=ev[this.mapType];if(!kz){ev[this.mapType]={tileUrls:[],tileSize:256,baseUnits:256,zoomLevelMin:1,zoomLevelMax:19,minZoom:3,maxZoom:19,minDataZoom:3,maxDataZoom:19,zoomLevelBase:18,errorUrl:E.imgPath+"/blank.gif",bounds:new ij(new cG(-21364736,-10616832),new cG(23855104,15859712)),imgExtend:"png"}}if(kC._renderType!=="webgl"){var kA=bS(kC.platform,'<div style="position:absolute;z-index:'+this.zIndex+'"></div>');kA.style.display="";kA.style.left=Math.ceil(-kC.offsetX+kC.width/2)+"px";kA.style.top=Math.ceil(-kC.offsetY+kC.height/2)+"px";this.tilesDiv=kA}this.isCanvasMap=kC.isCanvasMap();this.lastZoom=kC.getZoom();var i=this;this.addEventListener("initDrawData",function(kD){if(i.opts.boundary){i.addBoundary(i.opts.boundary)}});kC.on("destroy",function(){i.destroy()})},clearCache:function(){this.tileCache.clear();this.map._featureMgr.clearData(this.drawIndex);this.map._featureMgr.setLabelData([],this.drawIndex);this.map._featureMgr.clearLabelOverlayData(this.drawIndex);this.labelProcessor.iconCache.clear()},remove:function(){if(this.tilesDiv&&this.tilesDiv.parentNode){this.tilesDiv.innerHTML="";this.tilesDiv.parentNode.removeChild(this.tilesDiv)}delete this.tilesDiv},getCopyright:function(){return this.copyright},getMapType:function(){return this.mapType},adjustZIndex:function(){if(this.map&&this.map._featureMgr){var e=this.map._featureMgr.result.bkData;while(e[this.zIndex]){this.zIndex+=1}}},_getAdjoinZIndex:function(kA){var T=this.zIndex;if(this.map&&this.map._featureMgr){var e=this.map._featureMgr.result.bkData;if(kA==="up"){for(var kz=this.zIndex+1;kz<e.length;kz++){if(e[kz]){T=kz+1;break}}}else{for(var kz=this.zIndex-1;kz>0;kz--){if(e[kz]){T=kz;break}}}}return T},setZIndex:function(e){this.setTargetZIndex(e)},setTargetZIndex:function(e){this.removeLabel&&this.removeLabel(this.zIndex);this.zIndex=e;this.drawIndex=e;if(this.tilesDiv){this.tilesDiv.style.zIndex=e}},calcLoopParam:function(e,i){return fc.calcLoopParam(e,i)},addBoundary:function(kB){if(!kB||!this.map){return}if(typeof kB==="string"){kB=[kB]}for(var kz=0;kz<kB.length;kz++){var T=new BMapGL.Polygon(kB[kz]);if(T&&b0(T._i)){var kA=new fW("onbeforeaddoverlay",T);kA.overlay=T;kA.isLayerMask=true;this.map.dispatchEvent(kA);T._i(this.map);if(this.boundary){this.boundary.push(T)}else{this.boundary=[T]}}}this.updateBoundary()},clearBoundary:function(){this.boundary=false;this.updateBoundary()},updateBoundary:function(){if(this.boundary===undefined||!this.map){return}var i=this.map._featureMgr.result.bkData;if(i[this.zIndex]){i[this.zIndex].showRegion=this.opts.showRegion;i[this.zIndex].boundary=this.boundary;this.map.dispatchEvent(new fW("onrefresh"));if(this.boundary===false){var T=new fW("onremoveLayerMask");T.hasLayerBoundary=this.map._featureMgr.hasLayerBoundary();this.map.dispatchEvent(T)}}},destroy:function(){this.copyright=null;this.clearCache()},setTop:function(e){this.isTop=!!e;if(this.map){this.map._featureMgr.updateLayerMeta(this.zIndex,{isTop:this.isTop});this.map.dispatchEvent(new fW("onupdate"))}},setLowText:function(e){this.isLowText=!!e;if(this.map){this.map._featureMgr.updateLayerMeta(this.zIndex,{isLowText:this.isLowText});this.map.dispatchEvent(new fW("onupdate"))}},});function o(i,e,T){this.bounds=i;this.content=e;this.mapType=T}o.inherits(dh,"Copyright");var eB={get:function(e){if(!eB.singleton){eB.singleton=new gk(e)}return eB.singleton}};function gk(i){this._map=i;this._tileMgr=i.tileMgr;this._animationDiv=null;this._preAnimationDiv=null;this._animation=null;this._baseLayerDiv=null;this._transformStyleName=df.ifSupportCSS3("transform",true);this._transformOriginStyleName=df.ifSupportCSS3("transformOrigin",true);this._preZoomTimes=1;this._preRenderTick=1;this._enableCanvas2dMap=!!(i.getRenderType()==="canvas");this._isIE9=!!(e9.Browser.ie===9);var e=this;i.addEventListener("maptypechange",function(){e.hide()});i.addEventListener("load",function(){e.hide()})}e9.extend(gk.prototype,{prepareLayer:function(){var kz=this._map;var e=this._tileMgr;this._canvas2dMapMgr=kz.canvas2dMapMgr;var T=this._baseLayerDiv=e.tilesDiv;if(!this._animationDiv){var i=this._preAnimationDiv;if(i){i.parentNode&&i.parentNode.removeChild(i);this._preAnimationDiv=null}this._preAnimationDiv=this._animationDiv=T.cloneNode(true);kz.platform.insertBefore(this._animationDiv,kz.platform.firstChild)}this.show()},prepareAniParam:function(){var kz=this._animationDiv;if(!kz){return}var e=kz.children.length;var T;this._zoomAniInfo=[];for(var kA=e-1;kA>-1;kA--){var kB={};T=kz.children[kA].style;kB.top=parseInt(T.top,10);kB.left=parseInt(T.left,10);this._zoomAniInfo[kA]=kB}},prepareLabelLayer:function(){var kA=this._map;if(this._enableCanvas2dMap&&kA.canvas2dMapMgr){if(this.touchZoomLabelCanvas){this.touchZoomLabelCanvas.parentNode.removeChild(this.touchZoomLabelCanvas)}var i=kA.canvas2dMapMgr._labelCanvas;this.touchZoomLabelCanvas=i.cloneNode(false);var e=this.touchZoomLabelCanvas.getContext("2d");e.drawImage(i,0,0);kA.platform.insertBefore(this.touchZoomLabelCanvas,kA.platform.firstChild);var kz=parseInt(i.style.left,10);var T=parseInt(i.style.top,10);this.touchZoomLabelCanvas.style.zIndex=9;this.touchZoomLabelCanvas.style[this._transformOriginStyleName]=(this._fixPosition.x-(kA.offsetX+kz))+"px "+(this._fixPosition.y-(kA.offsetY+T))+"px";i.style.visibility="hidden"}},show:function(){if(this._animationDiv){this._animationDiv.style.visibility=""}},showLabel:function(){var i=this._map;if(this._enableCanvas2dMap&&i.canvas2dMapMgr){var e=i.canvas2dMapMgr._labelCanvas;if(e){e.style.visibility=""}if(this.touchZoomLabelCanvas){this.touchZoomLabelCanvas.style.zIndex=-2;this.touchZoomLabelCanvas.style.visibility="hidden"}}},hide:function(){if(this._animationDiv){this._animationDiv.style.visibility="hidden"}if(this._preAnimationDiv){this._preAnimationDiv.style.visibility="hidden"}},hideNonAnimationLayers:function(){var kz=this._map;if(kz.getRenderType()==="dom"){if(kz.overlayDiv){kz.overlayDiv.style.visibility="hidden"}if(kz.overlayDivEx){kz.overlayDivEx.style.visibility="hidden"}}var kB=kz.tileMgr.tileLayers;var kA;for(var T=0,e=kB.length;T<e;T++){kA=kB[T];kA.tilesDiv.style.visibility="hidden"}},showNonAnimationLayers:function(){var kz=this._map;if(kz.getRenderType()==="dom"){if(kz.overlayDiv){kz.overlayDiv.style.visibility=""}if(kz.overlayDivEx){kz.overlayDivEx.style.visibility=""}}var kB=kz.tileMgr.tileLayers;var kA;for(var T=0,e=kB.length;T<e;T++){kA=kB[T];kA.tilesDiv.style.visibility=""}},setFixPosition:function(e){this._fixPosition=e},setZoom:function(e,kF){var kC=this._fixPosition;var kL=this._map;var kM=this._baseLayerDiv;var kD={x:kC.x-parseInt(kM.style.left,10)-kL.offsetX,y:kC.y-parseInt(kM.style.top,10)-kL.offsetY};var kz=this._animationDiv;if(!kz){return}var kJ=kz.children.length;var kH;var kK=this._transformStyleName;var kB=this._transformOriginStyleName;var kN=this;var kP;var kE;for(var kI=kJ-1;kI>-1;kI--){var kG=this._zoomAniInfo[kI];kH=kz.children[kI].style;var kA=kG.left-kD.x;var T=kG.top-kD.y;kG.dx=kA*e-kA;kG.dy=T*e-T;kG.preDx=kA-kA;kG.preDy=T-T;kP=kG.preDx+(kG.dx-kG.preDx);kE=kG.preDy+(kG.dy-kG.preDy)+kF;kH.left=kG.left+kP+"px";kH.top=kG.top+kE+"px";kH.width=kH.height=256*e+"px"}if(this._enableCanvas2dMap){var kO=!kN._isIE9?"translate3d(0px, "+kF+"px, 0) scale("+e+")":"translate(0px, "+kF+"px) scale("+e+")";this.touchZoomLabelCanvas.style[kK]=kO}},setZoomFinish:function(){this._animationDiv=null},startAnimation:function(kC){this.prepareLayer();this.hideNonAnimationLayers();var kV=this._map;if(this.touchZoomLabelCanvas){this.touchZoomLabelCanvas.style.display="none"}kC=kC||{};var kT=kC.zoomCount||0;var kH=kC.fixPosition;var kR=kC.fixMCPosition;var kF=kC.pixOffset;this._zoomCount=kT;var kz=kV.getZoom();var kU=kz+kT;var e=kV.config.enableContinuousZoom;var kL=0.5;var kG=5;var T=Math.pow(2,kT);var kX=this._baseLayerDiv;var kI={x:kH.x-parseInt(kX.style.left,10)-kV.offsetX,y:kH.y-parseInt(kX.style.top,10)-kV.offsetY};var kD=this._animationDiv;var kP=kD.children.length;var kZ=this._preZoomTimes;var kS=[];var kQ=this._transformStyleName;var kE=this._transformOriginStyleName;for(var kO=kP-1;kO>-1;kO--){var kM={};var kN=kD.children[kO].style;kM.top=parseInt(kN.top,10);kM.left=parseInt(kN.left,10);var kB=kM.left-kI.x;var kA=kM.top-kI.y;kM.dx=kB*T-kB;kM.dy=kA*T-kA;kM.preDx=kB*kZ-kB;kM.preDy=kA*kZ-kA;kS[kO]=kM}var kW=this;var kK;var kY;var kJ;this._zoomAni=new fL({fps:60,duration:e?500:1,transition:function(i){i=i*kG/(2*kL);return kG*i-kL*i*i},render:function(k8){k8=k8*(4*kL)/(kG*kG);kK=kZ+k8*(T-kZ);var k1=kz+r(kK);var k6=null;var k5=0;var k9=0;if(kC.onAnimationBeforeLooping){var la=kC.onAnimationBeforeLooping(k8,k1);k6=la.loopingCenter;k5=la.yDiff;k9=la.totalYDiff}for(var k2=kS.length-1;k2>-1;k2--){var k3=kS[k2];if(kD.children[k2]){var k7=kD.children[k2].style;kY=k3.preDx+(k3.dx-k3.preDx)*k8-kF.width*k8;kJ=k3.preDy+(k3.dy-k3.preDy)*k8-kF.height*k8+k5;k7.left=k3.left+kY+"px";k7.top=k3.top+kJ+"px";k7.height=k7.width=256*kK+"px"}}var k0=kF.width*k8;var k4=kF.height*k8;if(kV.isRestrict){kW._enableCanvas2dMap&&kW._canvas2dMapMgr.clearLabel()}else{kW._enableCanvas2dMap&&kW._canvas2dMapMgr.drawLabel(kK,kH,kz,kU,kT,k8,k0,k4,k9,k5)}kW._preZoomTimes=kK;kW._preRenderTick=k8;kC.onAnimationLooping&&kC.onAnimationLooping(k8,k1,k6)},finish:function(){kW._preZoomTimes=1;kW._zoomAni=null;kW._animationDiv=null;kC.onAnimationFinish&&kC.onAnimationFinish();kW.showNonAnimationLayers()}});return this._zoomAni},stopAnimation:function(){if(this._zoomAni){this._zoomAni.stop();this._zoomAni=null}}});function kw(e){this._initVars(e);this._initColorCanvas();this._bindEvent(e)}e9.extend(kw.prototype,{_initVars:function(e){this._map=e._map;this._canvas2dMapMgr=e;this._labelCtx=e._labelCtx;this.ratio=this._map.config.ratio;this.sizeRatio=this.ratio>1?2:1;this.RANK1=1000000;this.RANK2=2000000;this.RANK3=3000000;this.RANK4=4000000;this.RANK5=5000000},_initColorCanvas:function(){var i=256,T=b6("canvas"),e=T.style;e.width=i+"px";e.height=i+"px";T.width=i;T.height=i;this._colorCvsSize=i;this._colorCvs=T;this._colorCtx=T.getContext("2d")},getLabelImageData:function(kM){var kL=kM.textImg;var T=kM.textPos;var kJ=this.ratio;var kH=this.sizeRatio/kJ;var kA=this._colorCtx;var kE=this._colorCvsSize;kA.clearRect(0,0,kE,kE);var kG=0;var e=0;var kD=0;for(var kF=0;kF<T.length;kF++){if(T[kF].width>kG){kG=T[kF].width;e=kF;kD=T[kF].drawX}}kG/=kH;var kI=0;for(var kF=0,kC=T.length;kF<kC;kF++){var kK=T[kF];var kN;if(kF===e){kN=0}else{kN=kK.drawX-kD}kA.drawImage(kL,kK.srcX,kK.srcY,kK.width,kK.height,kN,kI,kK.width/kH,kK.height/kH);if(kK.width/kH>kG){kG=kK.width/kH}kI+=kK.height/kH+2*kJ}var kz=kA.getImageData(0,0,kG,kI);var kB=kA.getImageData(0,0,kG,kI);return[kz,kB]},_bindEvent:function(i){var e=this,T=i._map;T.addEventListener("onspotmouseover",function(kC){if(!this.isCanvasMap()||!this.temp.isPermitSpotOver){return}if(kC.spots.length>0){var kB=kC.spots[0].userdata.uid;var kA=kC.spots[0].userdata.name;var kz=e.findLabelByUid(kB,kA);kz&&e._toHighLightColor(kz)}});T.addEventListener("onspotmouseout",function(kC){if(!this.isCanvasMap()||!this.temp.isPermitSpotOver){return}if(kC.spots.length>0){var kB=kC.spots[0].userdata.uid;var kA=kC.spots[0].userdata.name;var kz=e.findLabelByUid(kB,kA);kz&&e._toDefaultColor(kz)}});T.addEventListener("onspotclick",function(kC){if(!this.isCanvasMap()||!this.temp.isPermitSpotOver){return}if(kC.spots&&kC.spots.length>0){var kB=kC.spots[0].userdata.uid;var kA=kC.spots[0].userdata.name;var kz=e.findLabelByUid(kB,kA);kz&&e._changeBaseMapState(kz)}else{e._recoverNormalState()}});T.on("spot_status_reset",function(){e._recoverNormalState()});T.on("spot_highlight",function(kA){var kz=e.findLabelByUid(kA.uid);kz&&e._changeBaseMapState(kz)})},_getTextBound:function(kK){if(!kK.textPos){return null}var kI=this.ratio;var kG=this.sizeRatio/kI;var T=kK.textPos;var kJ=kK.baseDrawX;var kH=kK.baseDrawY;var kE=kJ*kI+(T[0].drawX-kJ)/kG;var kC=kH*kI+(T[0].drawY-kH)/kG;var kA=kE+T[0].width/kG;var e=kC+T[0].height/kG;for(var kF=0,kD=T.length;kF<kD;kF++){var kL=T[kF];var kB=kJ*kI+(kL.drawX-kJ)/kG;if(kB<kE){kE=kB}var kz=kH*kI+(kL.drawY-kH)/kG;if(kz<kC){kC=kz}if(kB+kL.width>kA){kA=kB+kL.width}if(kz+kL.height>e){e=kz+kL.height}}return[kE,kC,kA,e]},_toHighLightColor:function(T){if(T._tempRank&&T._tempRank==this.RANK5){return}var kD=this._getTextBound(T);if(!kD){return}var kz=Math.round(kD[0]);var i=Math.round(kD[1]);var e=this.getLabelImageData(T);var kB=e[0];var kA=e[1];var kC=this._canvas2dMapMgr.getFilterImageData(kB,this.RANK5);T._oldImgData=kA;this._labelCtx.putImageData(kC,kz,i)},_toDefaultColor:function(e){if(e._tempRank&&e._tempRank==this.RANK5){return}if(e._oldImgData){var i=this.sizeRatio;var T=this._getTextBound(e);if(!T){return}this._labelCtx.putImageData(e._oldImgData,Math.round(T[0]),Math.round(T[1]));e._oldImgData=null}},_changeBaseMapState:function(kz){var T=this._canvas2dMapMgr;var i=kz.guid;var e=kz.guidExt;var kA={guid:i,name:kz.name,guidExt:e};T._labelStrategy.setStrategyInfo(kA);T._loadData()},_recoverNormalState:function(){var e=this._canvas2dMapMgr;e._labelStrategy.setStrategyInfo(null);e._loadData()},findLabelByUid:function(kB,kz){var kD=this._canvas2dMapMgr,e=kD._computedLabel;for(var kA=0,T=e.length;kA<T;kA++){var kC=e[kA];if(!kD.isClickableLabel(kC)){continue}if(kB&&kC.guid===kB){return kC}if(kz&&kC.name===kz){return kC}}return null}});function H(e){this._initVars(e)}e9.extend(H.prototype,{_initVars:function(e){this._map=e._map;this._canvas2dMapMgr=e;this.ratio=this._map.config.ratio;this._strategyInfo=null;this.RANK1=1000000;this.RANK2=2000000;this.RANK3=3000000;this.RANK4=4000000;this.RANK5=5000000},setStrategyInfo:function(e){this._strategyInfo=e},preComputeLabel:function(kF,lx,lf,kR,lr,lL){var k9=[],kN=kF._centerX,kL=kF._centerY,lM=kR*lr;var lm=this.ratio;var kE=this._map.getZoom();var k4=0;if(kE===5){k4=4}if(kE===8){k4=-6}kF.sort(function(ll,i){if(ll.x*ll.y<i.x*i.y){return -1}else{return 1}});for(var k6=0,k2=kF.length;k6<k2;k6++){var lC=kF[k6],kX=lC.x,kU=lC.y,kS=lC.z;var kZ=fc.calcLoopParam(kX,kS).offsetX;var lj=kX*lM,li=(kU+1)*lM,kz=(lj-kN)/kR+lx/2+kZ,T=(kL-li)/kR+lf/2;for(var k3=0,lG=lC.length;k3<lG;k3++){var kH=lC[k3],kO=undefined,kM=undefined,lE=undefined,lD=undefined;var lt=kH.baseDrawX=kz+kH.baseX;var ls=kH.baseDrawY=T+kH.baseY;if(kH.type=="fixed"){var ld=kH.iconPos,kQ=kH.textPos,lI=kH.textImg;if(ld){ld.drawX=kz+ld.destX;ld.drawY=T+ld.destY;kO=ld.drawX;kM=ld.drawY;lE=ld.drawX+ld.width;lD=ld.drawY+ld.height}if(kQ&&lI){for(var lu=0;lu<kQ.length;lu++){var lH=kQ[lu];lH.drawX=kz+lH.destX;lH.drawY=T+lH.destY;if(!kO){kO=lH.drawX;kM=lH.drawY;lE=lH.drawX+lH.width;lD=lH.drawY+lH.height}else{if(lH.drawX<kO){kO=lH.drawX}if(lH.drawY<kM){kM=lH.drawY}if(lH.drawX+lH.width>lE){lE=lH.drawX+lH.width}if(lH.drawY+lH.height>lD){lD=lH.drawY+lH.height}}}}}else{kH.tileX=kz;kH.tileY=T;kO=kz+kH.minXOriginal;kM=T+kH.minYOriginal;lE=kz+kH.maxXOriginal;lD=T+kH.maxYOriginal}if(kO!=undefined){var lw=lt+(kO-lt)/lm;var lv=ls+(kM-ls)/lm;var k7=lt+(lE-lt)/lm;var k5=ls+(lD-ls)/lm;kH.minX=lw;kH.minY=lv;kH.maxX=k7;kH.maxY=k5;var lA=(lw+k7)/2,lz=(lv+k5)/2,lg=kN+(lA-lx/2)*kR,le=kL+(lf/2-lz)*kR;kH.geoX=lg;kH.geoY=le;k9.push(kH)}}}if(lL){for(var k6=0,k2=lL.length;k6<k2;k6++){var k1=lL[k6];var lp=k1[0];var kI=k1[1];var ld=lp.iconPos;var kC=ld.geoX;var kA=ld.geoY;var lt=(kC-kN)/kR+lx/2;var ls=(kL-kA)/kR+lf/2;var kO=lt+ld.destX;var kM=ls+ld.destY;var lE=kO+ld.width;var lD=kM+ld.height;lp.textPos=lp.textPos||lp._textPos;var kQ=lp.textPos;var ly=kQ[0];var kW=lt+ly.destX;var kK=ls+ly.destY;if(kK<kM){kM=kK}if(kW+ly.width>lE){lE=kW+ly.width}if(kK+ly.height>lD){lD=kK+ly.height}if(kQ.length===2){var kV=kQ[1];var kT=lt+kV.destX;var kJ=ls+kV.destY;if(kJ<kM){kM=kJ}if(kT+kV.width>lE){lE=kT+kV.width}if(kJ+kV.height>lD){lD=kJ+kV.height}}lp._tempBounds=[kO,kM,lE,lD];var ld=kI.iconPos;var kC=ld.geoX;var kA=ld.geoY;var lt=(kC-kN)/kR+lx/2;var ls=(kL-kA)/kR+lf/2;var kO=lt+ld.destX;var kM=ls+ld.destY;var lE=kO+ld.width;var lD=kM+ld.height;kI.textPos=kI.textPos||kI._textPos;var kQ=kI.textPos;var ly=kQ[0];var kW=lt+ly.destX;var kK=ls+ly.destY;if(kW<kO){kO=kW}if(kK<kM){kM=kK}if(kK+ly.height>lD){lD=kK+ly.height}if(kQ.length===2){var kV=kQ[1];var kT=lt+kV.destX;var kJ=ls+kV.destY;if(kT<kO){kO=kT}if(kJ<kM){kM=kJ}if(kJ+kV.height>lD){lD=kJ+kV.height}}kI._tempBounds=[kO,kM,lE,lD]}for(var k6=0,k2=lL.length;k6<k2;k6++){var k1=lL[k6];var lp=k1[0];var kI=k1[1];if(k6===0&&kI.textPos){kI._textPos=kI.textPos;delete kI.textPos}var lB=lp;if(!lp.textPos&&kI.textPos){lB=kI}var lF=lB._tempBounds;for(k3=k6+1;k3<k2;k3++){var k0=lL[k3];var la=k0[0];var lK=k0[1];var kP=0;var lJ=la._tempBounds;if(!(lF[2]<lJ[0]||lF[0]>lJ[2]||lF[3]<lJ[1]||lF[1]>lJ[3])){kP++;if(la.textPos){la._textPos=la.textPos;delete la.textPos}}var lJ=lK._tempBounds;if(!(lF[2]<lJ[0]||lF[0]>lJ[2]||lF[3]<lJ[1]||lF[1]>lJ[3])){kP++;if(lK.textPos){lK._textPos=lK.textPos;delete lK.textPos}}if(kP>=2){if(lB.textPos){lB._textPos=lB.textPos;delete lB.textPos}}}}for(var k6=0,k2=lL.length;k6<k2;k6++){var k1=lL[k6];var lp=k1[0];var kI=k1[1];var lb=lp;if(!lp.textPos&&kI.textPos){lb=kI}var ld=lb.iconPos;var kC=ld.geoX;var kA=ld.geoY;var lt=lb.baseDrawX=(kC-kN)/kR+lx/2;var ls=lb.baseDrawY=(kL-kA)/kR+lf/2;ld.drawX=lt+ld.destX;ld.drawY=ls+ld.destY;var kO=ld.drawX;var kM=ld.drawY;var lE=ld.drawX+ld.width;var lD=ld.drawY+ld.height;var kQ=lb.textPos;if(kQ){var ly=kQ[0];ly.drawX=lt+ly.destX;ly.drawY=ls+ly.destY;if(ly.drawX<kO){kO=ly.drawX}if(ly.drawY<kM){kM=ly.drawY}if(ly.drawX+ly.width>lE){lE=ly.drawX+ly.width}if(ly.drawY+ly.height>lD){lD=ly.drawY+ly.height}if(kQ.length===2){var kV=kQ[1];kV.drawX=lt+kV.destX;kV.drawY=ls+kV.destY;if(kV.drawX<kO){kO=kV.drawX}if(kV.drawY<kM){kM=kV.drawY}if(kV.drawX+kV.width>lE){lE=kV.drawX+kV.width}if(kV.drawY+kV.height>lD){lD=kV.drawY+kV.height}}}var lw=lt+(kO-lt)/lm;var lv=ls+(kM-ls)/lm;var k7=lt+(lE-lt)/lm;var k5=ls+(lD-ls)/lm;lb.minX=lw;lb.minY=lv;lb.maxX=k7;lb.maxY=k5;var lo=(lw+k7)/2;var ln=(lv+k5)/2;var kD=kN+(lo-lx/2)*kR;var kB=kL+(lf/2-ln)*kR;lb.geoX=kD;lb.geoY=kB;k9.push(lb)}}var lq=this._strategyInfo;if(lq){var k8=lq.guid;var lh=lq.name;var kY=lq.guidExt;for(var k6=0,k2=k9.length;k6<k2;k6++){var kG=k9[k6];delete kG._tempRank;if(!this._canvas2dMapMgr.isClickableLabel(kG)||(kY===1&&!kG.guidExt)){continue}if((k8&&k8===kG.guid)||(lh&&lh===kG.name)){kG._tempRank=this.RANK5}}}else{for(var k6=0,k2=k9.length;k6<k2;k6++){var kG=k9[k6];if(kG.type=="line"||!kG.iconPos){continue}delete kG._tempRank}}k9.sort(function(lN,ll){var lO=lN._tempRank?lN._tempRank:lN.rank,i=ll._tempRank?ll._tempRank:ll.rank;if(lO===i){return lN.baseX-ll.baseX}return i-lO});for(var k6=0,k2=k9.length;k6<k2;k6++){var lB=k9[k6];lB.isDel=false;lB.isFadeout=false;lB._schedule=0;lB._isIgnore=false;lB.arrIntersectIndex=[];for(k3=k6+1;k3<k2;k3++){var lc=k9[k3];if(!(lB.maxX-k4<lc.minX||lB.minX>lc.maxX-k4||lB.maxY-k4<lc.minY||lB.minY>lc.maxY-k4)){lB.arrIntersectIndex.push(k3)}}}for(var k6=0,k2=k9.length;k6<k2;k6++){var kG=k9[k6];if(kG.isDel==false){var e=kG.arrIntersectIndex;for(var k3=0,lG=e.length;k3<lG;k3++){var lk=k9[e[k3]];lk.isDel=true;if(lk.guidExt===1){lk.isDel=false}}}}return k9}});function ab(e){this._map=e;this._initCanvas();this._initVars();this._bindEvent();this._tileType=ik.getInstance("na")}bG.register(function(i){if(i.getRenderType()==="canvas"){var e=i.config.style;if(bG["FeatureStyle"+e]){i.canvas2dMapMgr=new ab(i)}else{i.loadMapStyleFiles(function(){i.canvas2dMapMgr=new ab(i);i.canvas2dMapMgr._loadData()})}}});e9.extend(ab.prototype,{_initCanvas:function(){var kC=this._map,kA=kC.getSize(),kz=kA.width,i=kA.height,e=kC.platform,kD=b6("canvas"),kB=kD.style;var T=this.ratio=kC.config.ratio;this._width=kz;this._height=i;kB.cssText="position: absolute;left:0;top:0;width:"+kz+"px;height:"+i+"px;z-index:100;";kD.width=kz*T;kD.height=i*T;this._labelCanvas=kD;this._labelCtx=kD.getContext("2d");e.appendChild(kD)},_initVars:function(){var e=ka("ditu","normal");this._udt=e.udt;this._version=e.ver;this._labelDataUrls=ev.B_NORMAL_MAP.vectorTileUrls;this._style=bG["FeatureStyle"+this._map.config.style];this._labelCount=0;this._vectorDrawLib=new hk(this);this._cache={maxNum:500,delNum:50,arrCache:[]};this._computedLabel=null;this._spotData=null;this._labelStrategy=new H(this);this._labelClick=new kw(this);this._biz=new eD(this);this._map.temp.isPermitSpotOver=true;this.labelStyleParam="pl";if(this._map.getMapType()===BMAP_SATELLITE_MAP){this.labelStyleParam="sl"}this.statRequestCount=0;this.statResponseCount=0},_resizeHandler:function(kB){var kD=this,i=kD._map,kA=i.getSize(),T=kA.width,kF=kA.height;var kC=this.ratio;var kG=this._labelCanvas,kz=kG.style;kz.width=T+"px";kz.height=kF+"px";kG.width=T*kC;kG.height=kF*kC;kD._width=T;kD._height=kF;var kE=true;kD._loadData(kE)},_bindEvent:function(){var e=this,i=e._map;i.addEventListener("load",function(T){e.clearLabel();e._loadData()});i.addEventListener("zoomend",function(T){if(!T.notClearLabel){e.clearLabel()}e._loadData()});i.addEventListener("moveend",function(T){e._loadData()});i.addEventListener("resize",function(T){e._resizeHandler(T)});i.addEventListener("maptypechange",function(T){if(T.mapType===BMAP_EARTH_MAP){e.hideLabelCanvas()}else{e.showLabelCanvas();if(T.mapType===BMAPGL_NORMAL_MAP){e.labelStyleParam="pl"}else{if(T.mapType===BMAP_SATELLITE_MAP){e.labelStyleParam="sl"}}e._loadData()}});i.addEventListener("streetlayer_show",function(T){if(this.isCanvasMap()){e.showLabelCanvas()}});i.addEventListener("streetlayer_hide",function(T){if(this.isCanvasMap()){e.hideLabelCanvas()}});i.addEventListener("loadbizdata",function(kz){var T=kz.data;e._biz.proecessBizData(T,function(){e.updateLabel()})});i.addEventListener("unloadbizdata",function(T){e._biz.clearBizData();e.updateLabel()});e.isDrawText=false;setTimeout(function(){if(!e.isDrawText){i.dispatchEvent(new fW("onmapwhitescreen"))}},10000)},getStyle:function(){return this._style},_getZoomUnits:function(e){return Math.pow(2,18-e)},_createCacheForm:function(T,kD,kC,i){var kB=this;var e=kB._cache;var kz=e.arrCache;var kE=this._getLabelId(T,kD,kC,i);var kA={id:kE,updateLabelCounter:0};kz.push(kA);kz[kE]=kA;return kA},_getLabelId:function(i,kz,T,e){return"_"+i+"_"+kz+"_"+T+"_"+e+"_"+this.labelStyleParam},_getCache:function(i,kz,T,e){return this._cache.arrCache[this._getLabelId(i,kz,T,e)]},_setCacheValue:function(kA,kN,kL,kz,kG){var kI=this;var e=kI._cache;var kC=e.arrCache;var kE=e.maxNum;var kB=e.delNum;var kM=this._getLabelId(kA,kN,kL,kz);var kH=kC[kM];if(kG){kH.lb=kG}if(kC.length>kE){var T=kC.splice(0,kB);for(var kF=0,kD=T.length;kF<kD;kF++){var kJ=T[kF],kK=kJ.id;if(kC[kK].lb){kC[kK].lb=null}kC[kK]=null;delete kC[kK]}T=null}},_loadData:function(kL){var k4=this._map;if(!k4.isCanvasMap()){return}var kE=k4.getCenterIn();var k3=fc.calcLoopCenterPoint(kE);var kD=this._tileType;var kG=this._width/2;var kS=this._height;var kT=k4.getZoom();var kP=kD.getDataZoom(kT);var kI=k4.getZoomUnits(kT);var kO=kI*kG;var k2=k3.lng-kO;var k1=k3.lng+kO;var kM=fc.isAddWidth(k2,k1);kG=kM?kG*1.5:kG;var kN=kD.getTileSize(kT);var kA=kD.getMercatorSize(kT,kP);var kH=Math.floor(k3.lng/kA);var kJ=Math.floor(k3.lat/kA);var kB=[kH,kJ,(k3.lng-kH*kA)/kA*kN,(k3.lat-kJ*kA)/kA*kN];var kV=kB[0]-Math.ceil((kG-kB[2])/kN);var kZ=kB[1]-Math.ceil((kS/2-kB[3])/kN);var kR=kB[0]+Math.ceil((kG+kB[2])/kN);var kW=kB[1]+Math.ceil((kS/2+kB[3])/kN);k4.temp.isPermitSpotOver=false;var e=[];for(var kY=kV;kY<kR;kY++){for(var kX=kZ;kX<kW;kX++){e.push([kY,kX,kP]);var kQ="id_"+kY+"_"+kX+"_"+kT;e[kQ]=true}}e._zoom=kP;e=fc.calcLoopTiles(e,kT);e.sort((function(i){return function(k6,k7){return((0.4*Math.abs(k6[0]-i[0])+0.6*Math.abs(k6[1]-i[1]))-(0.4*Math.abs(k7[0]-i[0])+0.6*Math.abs(k7[1]-i[1])))}})([kB[0],kB[1]]));var kK=this._cache.arrCache;this._curViewLabels=[];var kz="viewKey_"+Math.floor(kE.lng)+"_"+Math.floor(kE.lat)+"_"+kT;this.statRequestCount=0;this.statResponseCount=0;this._labelCount+=e.length;var kF=kT;for(var kY=0,kU=e.length;kY<kU;kY++){var kH=e[kY][0];var kJ=e[kY][1];var T=e[kY][2];var kC=this._getLabelId(kH,kJ,T,kF);var k0=kK[kC];if(!k0){k0=this._createCacheForm(kH,kJ,T,kF)}if(typeof k0.lb==="undefined"){k0.lb=null;this._loadLabelData(kH,kJ,T,kF,kN,kz);this.statRequestCount++}else{if(k0.lb){this._curViewLabels.push(k0.lb);this._labelCount--}else{if(kL){this._loadLabelData(kH,kJ,T,kF,kN,kz)}k0.updateLabelCounter++}}}if(this._labelCount===0){this.updateLabel()}var k5=this;if(k5.errorTimer){clearTimeout(k5.errorTimer)}k5.errorTimer=setTimeout(function(){if(k5._labelCount!==0){k5._labelCount=0;k5.updateLabel()}var k7=new fW("onloaddatatimeout");var k8=0;var k6=0;var k9=0;var i=0;if(k5.statRequestCount===k5.statResponseCount){k8=1}else{k6=1}if(k6===1){i=k5.statRequestCount-k5.statResponseCount;k9=k5.statResponseCount}k7.noTimeoutCount=k8;k7.timeoutCount=k6;k7.timeoutNoLoaded=i;k7.timeoutLoaded=k9;k5._map.dispatchEvent(k7)},500)},clearLabel:function(){var e=this._width;var T=this._height;var i=this.ratio;this._labelCtx.clearRect(0,0,e*i,T*i)},updateLabel:function(){var i=this._map;var e=i.getCenterIn();var kz=this._width;var kC=this._height;var kF=i.getZoom();var kE=this._tileType.getTileSize(kF);var kD=this._getZoomUnits(kF);var T=this._labelCtx;this._labelCanvas.style.left=-i.offsetX+"px";this._labelCanvas.style.top=-i.offsetY+"px";var kB=this._curViewLabels;kB._centerX=e.lng;kB._centerY=e.lat;var kA=this._biz.bizLabels;this._computedLabel=this._labelStrategy.preComputeLabel(kB,kz,kC,kD,kE,kA);this._computedLabel._zoom=kF;this.clearLabel();this._vectorDrawLib.drawIconAndText(T,this._computedLabel,kF);this._addSpotData();i.temp.isPermitSpotOver=true;if(kB.length>0){this.isDrawText=true}},_loadLabelData:function(kI,kH,kG,T,kJ,e){var kB=kI.toString();var kz=kH.toString();var kD="cbk_"+kB.replace("-","_")+"_"+kz.replace("-","__")+"_"+Math.floor(kG);var kN=fF+"."+kD;var kM=this._labelDataUrls;var kF=Math.abs(kI+kH)%kM.length;var kS=kM[kF];if(window.offLineIPAddress){kS=window.offLineIPAddress+"pvd/"}var i=this.labelStyleParam;var kL="?qt=vtile";var kO="";if(this._map.config.style!=="default"){kO="&styleId=1"}var kK="x={x}&y={y}&z={z}&udt={udt}&v={v}&styles={styles}"+kO+"&textonly=1&textimg=1&scaler={scaler}&fn="+encodeURIComponent(kN);var kP=fc.calcLoopParam(kI,kG).col;var kE=this.ratio>1?2:1;var kC=kK.replace(/{x}/,kP).replace(/{y}/,kH).replace(/{z}/,Math.floor(kG)).replace(/{styles}/,i).replace(/{udt}/,this._udt).replace(/{v}/,this._version).replace(/{scaler}/,kE);var kA=kS+kL+"&param="+window.encodeURIComponent(e5(kC));var kR=this;var kQ=kR._map;bG[kD]=function(kT){kR._vectorDrawLib.parseLabelData(kT,kI,kH,kG,T,kJ,function(kY){var kV=kQ.getCenterIn();var kZ=kQ.getZoom();var k1="viewKey_"+Math.floor(kV.lng)+"_"+Math.floor(kV.lat)+"_"+kZ;kR._labelCount--;var k2=kR._getCache(kI,kH,kG,T).updateLabelCounter;kR._labelCount-=k2;var kW=kR._curViewLabels;if(k1===e||(kR._labelCount<0&&kZ===kG)){kW.push(kY)}if(k1===e){kR.statResponseCount++}if(kR._labelCount<=0){var kU=(new Date()).getTime();kR.updateLabel();var kX=(new Date()).getTime();var k0=new fW("oncanvasmaploaded");k0.drawTime=kX-kU;if(kR.statResponseCount===kR.statRequestCount){k0.isAllLoadedDrawing=true}kQ.dispatchEvent(k0)}kR._setCacheValue(kI,kH,kG,T,kY);delete bG[kD]})};g3.load(kA)},drawLabel:function(T,kz,kG,i,kE,kA,e,kB,kF,kC){var kD=this;if(!kD._computedLabel){return}if(kD._computedLabel._zoom!==kG){kD.clearLabel();return}kD._map.temp.isPermitSpotOver=false;kD.clearLabel();kD._vectorDrawLib.zoomingIconAndText(this._labelCtx,kD._computedLabel,T,kz,i,kE,kA,e,kB,kF,kC)},_addSpotData:function(){this._spotData=[];var kG=this._map.getZoom();for(var kB=0,kA=this._computedLabel.length;kB<kA;kB++){var kD=this._computedLabel[kB];if(!this.isClickableLabel(kD)||(kD.guidExt===1&&kD.startScale>kG)){continue}var kC=[];kC[0]=(kD.minX-kD.maxX)/2;kC[1]=(kD.minY-kD.maxY)/2;kC[2]=(kD.maxX-kD.minX)/2;kC[3]=(kD.maxY-kD.minY)/2;var kz=null;if(kD.iconPos){kz=new cG(kD.iconPos.geoX,kD.iconPos.geoY)}var T=kD.name?kD.name.replace("\\\\","<br>"):"";if(kD.iconPos&&kD.iconPos.iconType.indexOf("ditie")>-1&&this._map.getZoom()>14){T=""}var kF={n:T,pt:new cG(kD.geoX,kD.geoY),userdata:{iconPoint:kz,uid:kD.guid,name:T,type:kD.iconPos?kD.iconPos.iconType:"",iconImg:kD.iconImg,mapPoi:true,adver_log:kD.adver_log||""},bd:kC,tag:"MAP_SPOT_INFO"};this._spotData.push(kF)}var kE=new fW("onspotsdataready");kE.spots=this._spotData;this._map._spotDataOnCanvas=this._spotData;this._map.dispatchEvent(kE)},isClickableLabel:function(e){if(e.isDel||(!e.guid&&!e.name)){return false}return true},getFilterImageData:function(T,kC){var kD=T.data,kB=this._labelStrategy,kC=parseInt(kC);for(var kE=0,kA=kD.length;kE<kA;kE+=4){var e=kD[kE],kF=kD[kE+1],kG=kD[kE+2],kH=kD[kE+3];if(kH===0){continue}var kz=Math.round((e+kF+kG)/3);var kI=kz-90;kI=kI<0?0:kI;if(kC===kB.RANK5){kD[kE]=51+kI*1.3;kD[kE+1]=133+kI*0.8;kD[kE+2]=255}}return T},showLabelCanvas:function(){this._labelCanvas.style.visibility=""},hideLabelCanvas:function(){this._labelCanvas.style.visibility="hidden"}});var aW=5;var jr=4;var gP=3;var P=2;var eC=1;var hN=0;var kx=3;var iK=5;var fu={3:{start:3,base:3},4:{start:4,base:5},5:{start:4,base:5},6:{start:6,base:7},7:{start:6,base:7},8:{start:8,base:9},9:{start:8,base:9},10:{start:10,base:10},11:{start:11,base:12},12:{start:11,base:12},13:{start:11,base:12},14:{start:14,base:15},15:{start:14,base:15},16:{start:16,base:17},17:{start:16,base:17},18:{start:18,base:19},19:{start:18,base:19},20:{start:18,base:19},21:{start:18,base:19}};function hk(kz){this._canvas2dMapMgr=kz;var i=this.ratio=kz._map.config.ratio;this._featureStyle=null;this._map=kz._map;var T=bH();var e="udt="+T.udt+"&v="+T.ver;this.sizeRatio=this.ratio>1?2:1;this._binaryCache={};this._iconCache={};this._initColorCanvas()}e9.extend(hk.prototype,{_initColorCanvas:function(){var i=256,T=b6("canvas"),e=T.style;e.width=i+"px";e.height=i+"px";T.width=i;T.height=i;this._colorCvs=T;this._colorCtx=T.getContext("2d")},parseLabelData:function(i,kB,kA,kz,e,kE,kD){if(!this._featureStyle){this._featureStyle=this._canvas2dMapMgr.getStyle()}if(!i||!i[0]){kD([]);return}var kC=this._map.getZoomUnits();var T=this;this.loadTextPng(i,kE,kB,kA,kz,e,kC,kD)},loadTextPng:function(kQ,kH,kF,kE,kC,i,kA,kz){var kP=this;var e=kQ[5];var kO=this._map;var kL=kO.getZoom();var T=kO.getSize();var kM=T.width;var kK=T.height;var kN=kO.getCenterIn();var kD=kN.lng;var kB=kN.lat;var kJ=kF*kH*kA;var kI=(kE+1)*kH*kA;if(e){var kG=new Image();kG.onload=function(){kP.calcIconAndTextInfo(kQ,kG,kH,kF,kE,kC,i,kA,kJ,kI,kz);delete this.onload};kG.src=e}else{setTimeout(function(){kP.calcIconAndTextInfo(kQ,null,kH,kF,kE,kC,i,kA,kJ,kI,kz)},1)}},calcIconAndTextInfo:function(kS,kJ,kK,kI,kF,kD,kz,kB,kM,kL,kA){var kR=this;var kQ=kR._featureStyle;var kG=[];kG.x=kI;kG.y=kF;kG.z=kD;var kH=kR._canvas2dMapMgr,T=kI*kB*kK,kP=(kF+1)*kB*kK,kC={tileLeft:T,tileTop:kP,zoomUnits:kB};var e=[];if(kS[0]){for(var kN=0;kN<kS[0].length;kN++){if(kS[0][kN][0]===kx){e.push(kS[0][kN])}}}var kE=kS[2]||[];for(var kN=0;kN<e.length;kN++){this._getFixedLabelInfo(e[kN],kJ,kz,kB,kK,kM,kL,kG)}var kO=Math.pow(2,kz-kD);for(kN=0;kN<kE.length;kN++){this._getLineLabelInfo(kE[kN],kJ,kD,kz,kB,kK,kM,kL,kO,kG)}kA(kG)},_getFixedLabelInfo:function(kJ,kN,kA,kE,kO,kR,kQ,kT){var kI=kJ[1];if(!kI){return}var kV=this._map.getZoom();var k3=this._map.config.style;var k4=this._featureStyle;var kF=kA;if(kF===9){kF=8}for(var k0=0;k0<kI.length;k0++){var k5=kI[k0];var e=k5[0];var kz=a3.getStyleFromCache(k3,e,"point",kF,k4);var kZ=a3.getStyleFromCache(k3,e,"pointText",kF,k4);if((!kZ||kZ.length===0)&&(!kz||kz.length===0)){if(kF===5){var kD=k5[1];if(!kD){continue}for(var kW=0;kW<kD.length;kW++){var kU=kD[kW][4];if(kU&&kU[7]==="北京"){kz=a3.getStyleFromCache(k3,e,"point",6,k4);kZ=a3.getStyleFromCache(k3,e,"pointText",6,k4);break}else{continue}}}else{continue}}var kD=k5[1];if(!kD){continue}var k1=null;var kG=1;var T=0;var kM=0;if(kz&&kz[0]){kz=kz[0];k1=kz.icon;kG=kz.zoom?kz.zoom/100:1}else{kz=null}for(var kW=0;kW<kD.length;kW++){var kU=kD[kW][4];if(!kU){continue}var kY=kU[2];if(!this._isVisible(kY,kV)){continue}var kH=kU[12];if(kZ&&kZ.length>0&&!kH){continue}var kL=Math.round(kU[0]/100);var kK=Math.round(kU[1]/100);var kX={lng:kR+kL,lat:kQ-(kO*kE-kK)};var kC=kL/kE;var kB=kO-kK/kE;var kP=kU[7]||"";var k2=kU[5];var kS={type:"fixed",name:kP,textImg:kN,rank:kU[4],baseX:kC,baseY:kB,iconPos:null,textPos:null,guid:kU[3]||"",tracer:kY,direction:k2,startScale:3};if((k2!==jr&&kH||!kH)&&k1!==null){kS.iconPos=this._getIconPosition(k1,kG,kC,kB,kX);if(kS.iconPos){T=kS.iconPos.width;kM=kS.iconPos.height}}if(T===0){kS.direction=jr}if(kH){kS.textPos=this._getTextDrawData(kU,kC,kB,T,kM)}if(kS.textPos||kS.iconPos){kT.push(kS)}}}},_isVisible:function(e,i){var kz;if(!this._binaryCache[e]){kz=e.toString(2);if(kz.length<8){kz=new Array(8-kz.length+1).join("0")+kz}this._binaryCache[e]=kz}kz=this._binaryCache[e];var T=fu[i].start;return kz[i-T]==="1"},_getIconPosition:function(kD,kB,T,i,e){var kz=this._map.config.style;var kE=bG["iconSetInfo"+kz][kD];if(!kE){if(kD.charCodeAt(0)>=48&&kD.charCodeAt(0)<=57){kE=bG["iconSetInfo"+kz]["_"+kD]}}if(!kE){return null}var kA=kE[0];var kC=kE[1];kA=kA*kB;kC=kC*kB;return{srcX:0,srcY:0,destX:T-kA/2,destY:i-kC/2,width:kA,height:kC,geoX:e.lng,geoY:e.lat,mcPt:e,iconType:kD}},_getTextDrawData:function(kK,kJ,kI,kz,kG){var kP=kK[5];if(typeof kP!=="number"){kP=0}var kE=this.ratio;var kD=kE/2;kz*=kD;kG*=kD;var kF=kK[12];var kA=kF.length;var kS=0;var kR=0;var kO=[];var kN=0;var kQ=0;for(var kM=0;kM<kA;kM++){kQ+=Math.round(kF[kM][3])}for(var kM=0;kM<kA;kM++){var kC=kF[kM];var kB=kC[0];var i=kC[1];var T=kC[2];var e=kC[3];var kT=2*kE;var kL=0;if(kz!==0){kL=2*kE}if(kz===0){kP=jr}switch(kP){case gP:var kH=kI-kQ/2-kT*(kA-1)/2;kS=kJ-T-kz/2-kL;kR=kH+kN+kT*kM;break;case eC:var kH=kI-kQ/2-kT*(kA-1)/2;kS=kJ+kz/2+kL;kR=kH+kN+kT*kM;break;case P:var kH=kI-kG/2-kQ-kT*(kA-1)-kT;kS=kJ-T/2;kR=kH+kN+kT*kM;break;case hN:var kH=kI+kG/2+kT/2;kS=kJ-T/2;kR=kH+kN+kT*kM;break;case jr:var kH=kI-e/2-kT*(kA-1)/2;kS=kJ-T/2;kR=kH+kN+kT*kM;break}kN+=e;if(T>0&&e>0){kO.push({srcX:kB,srcY:i,destX:kS,destY:kR,width:T,height:e})}}if(kO.length>0){return kO}return null},_getLineLabelInfo:function(kH,kz,kA,kW,k9,kO,kU,kT,kV,kN){if(kH.length!==10){return}var kY=this.ratio;var T=this.ratio;var k5=kH[7].length;var kP=kH[1];var k7=kH[3];var ld=kH[8];var kD=kH[4];var e=2;var kB=kD.slice(0,e);for(var la=e;la<kD.length;la+=e){kB[la]=kB[la-e]+kD[la];kB[la+1]=kB[la-(e-1)]+kD[la+1]}for(var la=e;la<kD.length;la+=e){if(la%(k7*e)===0||la%(k7*e)===1){continue}kB[la]=kB[la-e]+kD[la]/kV;kB[la+1]=kB[la-(e-1)]+kD[la+1]/kV}for(var lc=0;lc<k5;lc++){var k8=kH[7][lc];if(!this._isVisible(k8,kW)){continue}var k0=kH[6][lc];var kM=lc*k7*e;kD=kB.slice(kM,kM+k7*e);var kQ=[];var kZ=undefined;var kX=undefined;var kL=undefined;var kK=undefined;var ld=kH[9].slice(0);if(k0){ld.reverse()}var k3;var k1;for(var lb=0;lb<k7;lb++){var kJ=kH[5][k7*lc+lb];var k4=kD[lb*e]/100;var k2=kD[lb*e+1]/100;var kI=ld[lb];var kE=kI[0];var kG=kI[1];var kC=kI[2];var kF=kI[3];var kS;var kR;var lf;var le;if(lb===0){k3=lf=k4/k9;k1=kO-k2/k9;le=k2/k9}else{lf=k4/k9;le=k2/k9}var lh=k3+(lf-k3)*T-kC/2;var lg=k1+(kO-le-k1)*T-kF/2;if(kZ===undefined){kZ=k3-kC/2;kX=k1-kF/2;kL=kZ+kC;kK=kX+kF}else{if(lh<kZ){kZ=lh}if(lg<kX){kX=lg}if(lh+kC>kL){kL=lh+kC}if(lg+kF>kK){kK=lg+kF}}kQ.push({angle:kJ,srcX:kE,srcY:kG,destX:lh,destY:lg,width:kC,height:kF})}var k6={type:"line",textImg:kz,rank:kP,baseX:k3,baseY:k1,arrWordPos:kQ,minXOriginal:kZ,minYOriginal:kX,maxXOriginal:kL,maxYOriginal:kK,text:""};kN.push(k6)}},alterColor:function(kC,e,kB){var T=this._colorCtx,i=this._canvas2dMapMgr;T.clearRect(0,0,kC.width,kC.height);T.drawImage(e,kC.srcX,kC.srcY,kC.width,kC.height,0,0,kC.width,kC.height);var kA=T.getImageData(0,0,kC.width,kC.height),kz=i.getFilterImageData(kA,kB);T.putImageData(kz,0,0)},drawIconAndText:function(kO,kN,e){var kF=this.ratio;var kD=this.sizeRatio/kF;var kH=2/kF;var kZ=this;for(var kR=0,kP=kN.length;kR<kP;kR++){var kG=kN[kR];if(kG.isDel==false){var kA=kG.baseDrawX;var kz=kG.baseDrawY;if(kG.type=="fixed"){var kC=kG.iconPos,kS=kG.textPos,kL=kG.textImg,kV=kG.startScale;if(kC&&kV<=e){var T=this._iconCache[kC.iconType];if(T){if(T.img){kO.drawImage(T.img,0,0,T.img.width,T.img.height,Math.round(kA*kF+(kC.drawX-kA)/kH),Math.round(kz*kF+(kC.drawY-kz)/kH),kC.width/kH,kC.height/kH)}else{T.drawLabels.push(kG)}}else{if(!T){this._iconCache[kC.iconType]={img:null,drawLabels:[kG]};var k1=new Image();k1._iconName=kC.iconType;k1.onload=function(){var k7=kZ._iconCache[this._iconName];k7.img=this;this.onload=null;for(var k3=0;k3<k7.drawLabels.length;k3++){var k5=k7.drawLabels[k3];var k4=k5.baseDrawX;var k2=k5.baseDrawY;var k6=k5.iconPos;kO.drawImage(this,0,0,this.width,this.height,Math.round(k4*kF+(k6.drawX-k4)/kH),Math.round(k2*kF+(k6.drawY-k2)/kH),k6.width/kH,k6.height/kH)}k7.drawPos=[]};k1.src=E.getIconSetPath(kZ._map.config.style)+kC.iconType+".png"}}}if(kS&&kL&&kV<=e){for(var kE=0;kE<kS.length;kE++){var kM=kS[kE];if(!kG._tempRank){kO.drawImage(kL,kM.srcX,kM.srcY,kM.width,kM.height,Math.round(kA*kF+(kM.drawX-kA)/kD),Math.round(kz*kF+(kM.drawY-kz)/kD),kM.width/kD,kM.height/kD)}else{this.alterColor(kM,kL,kG._tempRank);kO.drawImage(this._colorCvs,0,0,kM.width,kM.height,Math.round(kA*kF+(kM.drawX-kA)/kD),Math.round(kz*kF+(kM.drawY-kz)/kD),kM.width/kD,kM.height/kD)}}}}else{var kB=kG.arrWordPos,kL=kG.textImg,kK=kG.tileX,kI=kG.tileY;for(var kQ=0,kJ=kB.length;kQ<kJ;kQ++){var kT=kB[kQ];var k0=Math.round(kK+kT.destX);var kY=Math.round(kI+kT.destY);var kU=kT.angle;k0=kA*kF+k0-kA;kY=kz*kF+kY-kz;if(kU>10&&kU<350){kO.save();var kX=Math.round(k0+kT.width/2);var kW=Math.round(kY+kT.height/2);kO.translate(kX,kW);kO.rotate(-kU/180*Math.PI);kO.drawImage(kL,kT.srcX,kT.srcY,kT.width,kT.height,-Math.round(kT.width/2),-Math.round(kT.height/2),kT.width/kD,kT.height/kD);kO.restore()}else{kO.drawImage(kL,kT.srcX,kT.srcY,kT.width,kT.height,k0,kY,kT.width/kD,kT.height/kD)}}}}}},isCollide:function(kB,kK,kJ,e,kD,T,kF){for(var kA=0,kz=T.length;kA<kz;kA++){var kE=T[kA],kC=1/Math.pow(2,kF+1),kI=kC*kE[3]/2,kH=kC*kE[4]/2,kG=kE[0];if(kG!=kB){if(!(kK+e<kE[1]-kI||kK>kE[1]+kE[3]+kI||kJ+kD<kE[2]-kH||kJ>kE[2]+kE[4]+kH)){return true}}}return false},zoomingIconAndText:function(kZ,kT,kz,kX,kY,lr,k6,kH,lc,k5,kQ){var ls=this.ratio;var kI=this.sizeRatio/ls;var lt=2/ls;var lD=ls/2;var ln=kX.x;var lm=kX.y;var k0=2*ls;if(kQ!==0){lm+=k5}var kL=undefined,kE=undefined,kB=undefined,kG=undefined,kP=undefined;var lb=lr>0?true:false;if(!lb){kL=[];var lf=1-k6}for(var lz=0,lx=kT.length;lz<lx;lz++){var lu=kT[lz];if(lu.isDel==false){var lE=lu.baseDrawX;var lB=lu.baseDrawY;kZ.save();kZ.translate(-kH*ls,-lc*ls);if(lu.isFadeout){if(!lb&&lu._schedule<=k6&&!lu._isIgnore){kZ.globalAlpha=lf;lu._schedule=k6}else{lu._isIgnore=true;continue}}if(lu.type=="fixed"){var k1=lu.iconPos,k8=lu.textPos,kC=lu.textImg,k2=lu.startScale;var T;var lj=0;if(k1){lj=k0}if(k1&&!lu.iconImg&&this._iconCache[k1.iconType]){T=this._iconCache[k1.iconType].img}if(k1&&k2<=kY&&T){kG=k1.width;kP=k1.height;kE=(ln+(lE-ln)*kz)*ls-kG/2/lt;kB=(lm+(lB-lm)*kz)*ls-kP/2/lt+kQ;if(!lb&&this.isCollide(lz,kE,kB,kG,kP,kL,lr)){lu.isFadeout=true}kZ.drawImage(T,k1.srcX,k1.srcY,T.width,T.height,Math.round(kE),Math.round(kB),kG/lt,kP/lt);!lb&&kL.push([lz,kE,kB,kG,kP])}if(k8&&kC&&k2<=kY){var k7;var k9;var kS=0;var k4=0;if(k1){kS=k1.width;k4=k1.height}var lk=k8.length;var kK=0;var la=0;for(var kU=0;kU<lk;kU++){var lw=k8[kU];la+=lw.height;if(kK<lw.width){kK=lw.width}}la+=(kU-1)*k0;if(!lb&&this.isCollide(lz,kE,kB,kK,la,kL,lr)){lu.isFadeout=true}var lv=0;for(var kU=0;kU<lk;kU++){var lw=k8[kU];switch(lu.direction){case gP:k7=-(kS/2/lt+lw.width+lj);k9=-la/2+lv+k0*kU;break;case eC:k7=kS/2/lt+lj;k9=-la/2+lv+k0*kU;break;case P:k7=-lw.width/2;k9=-k4/2/lt-la+lv-k0*(kU+1);break;case hN:k7=-lw.width/2;k9=k4/2/lt+lv+k0*(kU+1);break;case jr:k7=-lw.width/2;k9=-la/2+lv+k0*kU;break}lv+=lw.height;kE=(ln+(lE-ln)*kz)*ls+k7/kI;kB=(lm+(lB-lm)*kz)*ls+k9/kI;+kQ;kG=lw.width;kP=lw.height;if(!lu._tempRank){kZ.drawImage(kC,lw.srcX,lw.srcY,kG,kP,Math.round(kE),Math.round(kB),kG/kI,kP/kI)}else{this.alterColor(lw,kC,lu._tempRank);kZ.drawImage(this._colorCvs,0,0,kG,kP,Math.round(kE),Math.round(kB),kG/kI,kP/kI)}!lb&&kL.push([lz,kE,kB,kG,kP])}}}else{var kR=lu.arrWordPos,kC=lu.textImg,lC=lu.tileX,lA=lu.tileY;var kJ=kR[0];var kF=Math.round(lC+kJ.destX);var kD=Math.round(lA+kJ.destY);for(var ly=0,li=kR.length;ly<li;ly++){var lq=kR[ly];var lG=Math.round(lC+lq.destX);var lF=Math.round(lA+lq.destY);var kW=lq.angle;var lh=Math.round((ln+(lE-ln)*kz)*ls-kJ.width/2+lG-kF);var lg=Math.round((lm+(lB-lm)*kz)*ls-kJ.height/2+lF-kD);kE=lh;kB=lg;kG=lq.width;kP=lq.height;if(!lb&&this.isCollide(lz,kE,kB,kG,kP,kL,lr)){lu.isFadeout=true}if(kW>10&&kW<350){var lp=lh+lq.width/2;var lo=lg+lq.height/2;var kA=kW/180*Math.PI;var k3=Math.cos(kA);var kM=Math.sin(kA);var le=k3;var kN=k3;var ld=kM;var kO=-kM;var kV=lp-lp*k3-lo*kM;var e=lo+lp*kM-lo*k3;kZ.save();kZ.transform(le,kO,ld,kN,kV,e);kZ.drawImage(kC,lq.srcX,lq.srcY,kG,kP,kE,kB,kG/kI,kP/kI);kZ.restore()}else{kZ.drawImage(kC,lq.srcX,lq.srcY,kG,kP,kE,kB,kG/kI,kP/kI)}!lb&&kL.push([lz,kE,kB,kG,kP])}}kZ.restore()}}}});function eD(e){this.initVars(e)}e9.extend(eD.prototype,{initVars:function(e){this._map=e._map;this._canvas2dMapMgr=e;this.base64Prefix="data:image/png;base64,";this.bizData=null;this.objTextsPng=null;this.arrIconsPng=null;this.bizLabels=null},proecessBizData:function(kB,kF){var kD=this;this.bizData=kB;this.objTextsPng=null;this.arrIconsPng=null;var T=kB.textsPng;var kH=kB.iconsPng;if(!T||!kH){return}var kE=new Image();kE.onload=function(){kD.objTextsPng=this;kD.calcIconAndTextInfo(kF);this.onload=null};kE.src=this.base64Prefix+T;var kG=kH.length;var e=[];for(var kA=0;kA<kG;kA++){var kC=kH[kA];var kz=new Image();(function(i){kz.onload=function(){kG--;e[i]=this;if(kG===0){kD.arrIconsPng=e;kD.calcIconAndTextInfo(kF)}this.onload=null}})(kA);kz.src=this.base64Prefix+kC}},calcIconAndTextInfo:function(kI){if(this.objTextsPng&&this.arrIconsPng){var kE=this.bizData;var kC=kE.pois;var e=[];for(var kF=0,kB=kC.length;kF<kB;kF++){var kz=kC[kF];var kD=this.arrIconsPng[kz.iconPng];var kA=kD.height/2;var kH={type:"fixed",name:"",textImg:this.objTextsPng,iconImg:kD,rank:kz.rank,iconPos:{srcX:0,srcY:0,destX:-kD.width/2,destY:-kA/2,width:kD.width,height:kA,geoX:kz.x,geoY:kz.y,iconType:"vectorCustom"},textPos:this.calcTextPos(kz.pos,kD),startScale:kz.from<12?12:kz.from,guid:kz.guid,guidExt:1,adver_log:kz.adver_log||""};var T={type:"fixed",textDirLeft:"left",name:"",textImg:this.objTextsPng,iconImg:kD,rank:kz.rank,iconPos:{srcX:0,srcY:0,destX:-kD.width/2,destY:-kA/2,width:kD.width,height:kA,geoX:kz.x,geoY:kz.y,iconType:"vectorCustom"},textPos:this.calcTextPosLeft(kz.pos,kD),startScale:kz.from<12?12:kz.from,guid:kz.guid,guidExt:1,adver_log:kz.adver_log||""};var kG=[kH,T];e.push(kG)}this.bizLabels=e;kI&&kI()}},calcTextPos:function(kC,T){var i=[];var kB=kC.length/4;var kA=T.width/2;if(kB===1){var kz={srcX:kC[0],srcY:kC[1],destX:kA,destY:-kC[3]/2,width:kC[2],height:kC[3]};i.push(kz)}else{var kz={srcX:kC[0],srcY:kC[1],destX:kA,destY:-kC[3],width:kC[2],height:kC[3]};var e={srcX:kC[4],srcY:kC[5],destX:kA,destY:0,width:kC[6],height:kC[7]};i.push(kz);i.push(e)}return i},calcTextPosLeft:function(kC,T){var i=[];var kB=kC.length/4;var kA=T.width/2;if(kB===1){var kz={srcX:kC[0],srcY:kC[1],destX:-kA-kC[2],destY:-kC[3]/2,width:kC[2],height:kC[3]};i.push(kz)}else{var kz={srcX:kC[0],srcY:kC[1],destX:-kA-kC[2],destY:-kC[3],width:kC[2],height:kC[3]};var e={srcX:kC[4],srcY:kC[5],destX:-kA-kC[2],destY:0,width:kC[6],height:kC[7]};i.push(kz);i.push(e)}return i},clearBizData:function(){this.bizData=null;this.bizLabels=null}});var jU={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};var ip={Int8:1,Uint8:1,Int16:2,Uint16:2,Uint32:4,Float32:4};function B(kz,kB,T,kA){this.arrayBuffer=kz;this.attributes=kB.members;this.bytesPerElement=0;if(this.attributes){for(var e=0;e<this.attributes.length;e++){this.bytesPerElement+=ip[this.attributes[e].type]*this.attributes[e].components}}else{this.bytesPerElement=kz.BYTES_PER_ELEMENT*kB.components}this.length=kA||kz.byteLength/this.bytesPerElement;this.type=T;this.arrayType=kB}B.prototype.bind=function(i){var e=i[this.type];if(!this.buffer){this.buffer=i.createBuffer();i.bindBuffer(e,this.buffer);i.bufferData(e,this.arrayBuffer,i.STATIC_DRAW);this.arrayBuffer=null}else{i.bindBuffer(e,this.buffer)}};B.prototype.setVertexAttribPointers=function(kz,e){for(var i=0;i<this.attributes.length;i++){var kA=this.attributes[i];var T=e.attributes[kA.name];kz.vertexAttribPointer(T,kA.components,kz[jU[kA.type]],kA.normalize,this.bytesPerElement,kA.offset)}};B.prototype.updateVertexData=function(kz,i,T){this.arrayBuffer=i;if(!this.buffer){return this.bind(kz)}if(T<=this.length){var e=kz[this.type];kz.bindBuffer(e,this.buffer);kz.bufferData(e,this.arrayBuffer,kz.STATIC_DRAW)}else{this.destroy(kz);this.bind(kz)}this.length=T};B.prototype.destroy=function(e){if(this.buffer){e.deleteBuffer(this.buffer);this.buffer=null}};B.BufferType={VERTEX:"ARRAY_BUFFER",ELEMENT:"ELEMENT_ARRAY_BUFFER"};B.ELEMENT_ATTRIBUTE_TYPE="Uint16";B.VERTEX_ATTRIBUTE_ALIGNMENT=4;function dY(){this.boundProgram=null;this.boundVertexBuffer=null;this.boundElementBuffer=null;this.vao=null}dY.prototype.bind=function(kD,e,kz,kC){var kA=kD.extVertexArrayObject;if(kA===undefined){kA=kD.extVertexArrayObject=kD.getExtension("OES_vertex_array_object")}if(kA){if(!this.vao){this.vao=kA.createVertexArrayOES()}kA.bindVertexArrayOES(this.vao)}else{}if(!this.boundProgram){var kE=kA?0:(kD.currentNumAttributes||0);var kB=e.numAttributes;var T;for(T=kE;T<kB;T++){kD.enableVertexAttribArray(T)}if(!kA){for(T=kB;T<kE;T++){kD.disableVertexAttribArray(T)}kD.currentNumAttributes=kB}kz.bind(kD);kz.setVertexAttribPointers(kD,e);if(kC){kC.bind(kD)}if(kA){this.boundProgram=e;this.boundVertexBuffer=kz;this.boundElementBuffer=kC}}};dY.prototype.update=function(kD,kz,T,kC,e,i,kB){var kA=kD.extVertexArrayObject;if(kA===undefined){kA=kD.extVertexArrayObject=kD.getExtension("OES_vertex_array_object")}if(kA){kA.bindVertexArrayOES(this.vao);if(this.boundVertexBuffer){this.boundVertexBuffer.updateVertexData(kD,T,kC);this.boundVertexBuffer.setVertexAttribPointers(kD,this.boundProgram)}if(e&&this.boundElementBuffer){this.boundElementBuffer.updateVertexData(kD,i,kB)}}else{kz.updateVertexData(kD,T,kC);if(e){e.updateVertexData(kD,i,kB)}}};dY.prototype.unbind=function(i){var e=i.extVertexArrayObject;if(e){e.bindVertexArrayOES(null);this.boundProgram=null;this.boundVertexBuffer=null;this.boundElementBuffer=null}};dY.prototype.destroy=function(i){var e=i.extVertexArrayObject;if(e&&this.vao){e.deleteVertexArrayOES(this.vao);this.vao=null;this.boundProgram=null;this.boundVertexBuffer=null;this.boundElementBuffer=null}};function F(){}e9.extend(F.prototype,{centerAndZoomIn:function(T,kF,kG){kG=kG||{};if(!this.loaded){this.firstTileLoad=false}kF=this._getProperZoom(kF).zoom;if(kG.noAnimation!==true&&this.loaded){var kB=this._ifUseAnimation(T,kF);if(kB){this.flyToIn(T,kF,kG);return}}var kD=this;if(!T&&!kF){return}this._stopAllAnimations();if(T&&!T.equals(this.centerPoint)){this.fire(new fW("oncenter_changed"))}if(kF&&kF!==this.zoomLevel){this.fire(new fW("onzoom_changed"))}T=T||this.centerPoint;kF=kF||this.zoomLevel;kF=this._getProperZoom(kF).zoom;if(this.mapType===BMAP_EARTH_MAP){if(!this._earth){this.mapType=BMAPGL_NORMAL_MAP;this.temp.originMapType=BMAP_EARTH_MAP;function kE(){kD._earth=new bG.Earth(kD,{showRealSunlight:kD.config.showRealSunlight,showMilkyway:kD.config.showMilkyway,earthBackground:kD.config.earthBackground});kD._proxyEarthEvents();kD._changeEarthMapType(BMAP_EARTH_MAP);e9.extend(kD,bG.EarthView.prototype);delete kD.temp.originMapType}hl.load("earth",function(){if(bG["FeatureStyle"+kD.config.style]){kE()}else{kD.loadMapStyleFiles(function(){kE()})}})}}this.lastLevel=this.zoomLevel||kF;this.zoomLevel=kF;var kC=new fW("onload");kC.point=T;kC.zoom=kF;this.centerPoint=new cG(T.lng,T.lat);this.defaultZoomLevel=this.defaultZoomLevel||this.zoomLevel;this.defaultCenter=this.defaultCenter||this.centerPoint;if(this.mapType!==BMAP_EARTH_MAP){this.centerPoint=this.restrictCenter(this.centerPoint)}if(!this.loaded&&!(this.temp.originMapType===BMAP_EARTH_MAP)){var i=this.config.defaultMaxBounds;var kA=new o(i,"baidu",this.mapType);if(this.mapType!==BMAP_NONE_MAP){var kz=new hO({mapType:this.mapType,copyright:kA,dataType:this.mapType===BMAP_SATELLITE_MAP?gW:h2,customLayer:this.mapType===BMAP_SATELLITE_MAP,baseLayer:true,transparentPng:false,tileTypeName:this.mapType===BMAP_SATELLITE_MAP?"web":"na"});kz._isInnerLayer=true;this.addTileLayer(kz);this.baseLayerAdded=true}if(this.mapType===BMAP_NONE_MAP){hP.sendMessage(a1(4,3,15),["layer","blank"])}else{if(this.mapType===BMAP_SATELLITE_MAP){hP.sendMessage(a1(4,3,2),["layer","raster"])}else{hP.sendMessage(a1(4,3,1,1),["layer","vector","normal"])}}if(this.mapType===BMAP_SATELLITE_MAP&&this.config.showVectorStreetLayer){this._addHybirdVectorMap()}else{if(this.mapType===BMAP_SATELLITE_MAP&&this._isHybridShow===true){this._addHybirdMap()}}this.on("zoom_changed",function(){if(this._heading===0){return}if(this.getZoom()<7&&this.config.restrictCenter===true){kD.resetHeading()}})}this.loaded=true;this.dispatchEvent(kC);kG.callback&&kG.callback()},_ifUseAnimation:function(kz,kE){var kD=this.getSize();var T={zoom:this.zoomLevel};var kG={zoom:kE};var kF=this.pointToPixelIn(this.centerPoint);var kA=this.pointToPixelIn(kz,T);var kC=this.pointToPixelIn(this.centerPoint,kG);var kI=this.pointToPixelIn(kz,kG);var kB=Math.abs(kF.x-kA.x);var i=Math.abs(kF.y-kA.y);var e=Math.abs(kC.x-kI.x);var kH=Math.abs(kC.y-kI.y);if((kB>kD.width||i>kD.height)&&(e>kD.width||kH>kD.height)){return false}return true},_setPlatformPosition:function(kG,kF,kI){kI=kI||{};if(kG===0&&kF===0&&!kI.point){return}if(isNaN(kI.initMapOffsetX)){kI.initMapOffsetX=this.offsetX}if(isNaN(kI.initMapOffsetY)){kI.initMapOffsetY=this.offsetY}var kC=iW(this._heading);if(this._tilt>0){kF=kF/Math.cos(iW(this._tilt))}var kH=kG*Math.cos(kC)+kF*Math.sin(kC);var kE=-kG*Math.sin(kC)+kF*Math.cos(kC);kH=kH+kI.initMapOffsetX;kE=kE+kI.initMapOffsetY;if(kI.point){var i=this.restrictCenter(kI.point);if(!i.equals(this.centerPoint)){this.centerPoint=i.clone();this.fire(new fW("oncenter_changed"))}}else{var kz=this.offsetX-kH;var e=this.offsetY-kE;var kD=this.centerPoint.lng;var kB=this.centerPoint.lat;var kA=new cG(kD,kB);var T=this.getZoomUnits();this.centerPoint=this.restrictCenter(new cG(kA.lng+kz*T,kA.lat-e*T),T);this.fire(new fW("oncenter_changed"))}this.offsetX=kH;this.offsetY=kE;this.dispatchEvent(new fW("onmoving"))},restrictCenter:function(kH,e){if(this.config.restrictCenter===false){return kH}e=e||this.getZoomUnits();var kF=this.pixelToPointIn(new fv(this.width,0),{center:kH});var kC=this.pixelToPointIn(new fv(0,this.height),{center:kH});var kI=kH.lng;var kN=kH.lat;if(!!this.config.restrictBounds&&!this.config.restrictBounds.isEmpty()){var kM=this.config.restrictBounds;var T=kM.getSouthWest();var kK=kM.getNorthEast();var kG=jv.convertLL2MC(T);var kA=jv.convertLL2MC(kK);var kD=this.calcNewZoomByRestriction(kI,kN,kC,kF,kG.lng,kA.lng,kG.lat,kA.lat);if(kD>this.zoomLevel){this.zoomLevel=kD;return kH}kH.lng=this.calcNewLngByBounds(kI,kC,kF,kG.lng,kA.lng,e);kH.lat=this.calcNewLatByBounds(kN,kC,kF,kG.lat,kA.lat,e);return kH}var kE=this.pixelToPointIn(new fv(0,0),{center:kH});var kz=this.pixelToPointIn(new fv(0,this.height),{center:kH});if(this.zoomLevel<5){if(kE.lat>h4.MAX_LAT&&kz.lat<h4.MIN_LAT){var i=h4.MAX_LAT-kH.lat;var kB=kH.lat-h4.MIN_LAT;var kL;if(i<kB){kL=i/(this.height/2)}else{kL=kB/(this.height/2)}var kJ=18-r(kL);this.zoomLevel=kJ;return kH}}if(kE.lat>h4.MAX_LAT){kH.lat=h4.MAX_LAT-this.height/2*e}else{if(kz.lat<h4.MIN_LAT){kH.lat=h4.MIN_LAT+this.height/2*e}}return kH},calcNewZoomByRestriction:function(kG,kF,e,kE,kA,kC,kz,kB){var kJ=0;var kK=0;if(typeof kz==="number"&&typeof kB==="number"&&kE.lat>kB&&e.lat<kz){var T=kB-kF;var i=kF-kz;var kD;if(T<i){kD=T/(this.height/2)}else{kD=i/(this.height/2)}kJ=18-r(kD)}if(typeof kA==="number"&&typeof kC==="number"&&kE.lng>kC&&e.lng<kA){var kI=kC-kG;var kH=kG-kA;var kD;if(kI<kH){kD=kI/(this.width/2)}else{kD=kH/(this.width/2)}kK=18-r(kD)}return Math.max(kJ,kK)||this.zoomLevel},calcNewLatByBounds:function(i,kz,T,kC,kB,e){var kA=i;if(T.lat>kB){kA=kB-this.height/2*e}else{if(kz.lat<kC){kA=kC+this.height/2*e}}return kA},calcNewLngByBounds:function(kC,kB,kz,kA,T,e){var i=kC;if(kz.lng>T){i=T-this.width/2*e}else{if(kB.lng<kA){i=kA+this.width/2*e}}return i},zoomTo:function(e,kL,kM){var kH=ev[this.mapType];if(!kH){return}var kG=this._getProperZoom(e);e=kG.zoom;if(this.zoomLevel===e){kM&&kM.callback&&kM.callback();return}var kB=e;this.lastLevel=this.zoomLevel;kM=kM||{};if(this.zoomEventStatus==="idle"){this.fire(new fW("onzoomstart"));this.zoomEventStatus="zooming"}if(!kL&&(this.getInfoWindow()&&this.temp.infoWin&&this.temp.infoWin.isOpen())){kL=jv.convertLL2MC(this.getInfoWindow().getPoint())}var T=null;if(kM.fixPixel){T=kM.fixPixel}else{if(kL){T=this.pointToPixelIn(kL,{useRound:false})}}var kC=this.pixelToPointIn(T);var kD=this.centerPoint.clone();this.fixPoint=kL;this.fixPixel=T;this.fixCenter=kD;this.mousePosMCPoint=kC;if(kM.noAnimation){e=kG.zoom;this.zoomLevel=e;this.fire(new fW("onzoom_changed"));var kA=this.getCurrentMaxTilt();if(this._tilt>kA){this._tilt=kA}if(kL){if(this._heading%360!==0||this._tilt>0){var i=this._webglMapCamera.fromScreenPixelToMC(T.x,T.y,{center:kD,zoom:this.zoomLevel});if(i){var kI=i.sub(kC);var kz=kD.sub(kI);this.centerPoint=this.restrictCenter(kz)}}else{var kF=this.getZoomUnits();var kz=new cG(kL.lng-kF*(T.x-this.width/2),kL.lat+kF*(T.y-this.height/2));this.centerPoint=this.restrictCenter(kz,kF)}this.fire(new fW("oncenter_changed"))}this._checkFireZoomend();kM.callback&&kM.callback();return}this._animationInfo.zoom={current:this.zoomLevel,diff:e-this.zoomLevel,target:e};var kJ=this;var kK=this._tilt;if(this.fixPoint||kK>h4.MAX_DRAG_TILT_L2){kM.renderCallback=function(){var kQ=kJ.getCurrentMaxTilt();if(kJ._tilt>kQ){kJ._tilt=kQ}var kR=kJ.fixPixel;if(!kJ.fixPixel||!kJ.fixPoint){return}var kN=kJ.fixPixel;var kX=kJ.fixPoint;var kU=kJ.fixCenter;var kS=kJ.mousePosMCPoint;if(kJ._heading%360!==0||kJ._tilt>0){var kO=kJ._webglMapCamera.fromScreenPixelToMC(kN.x,kN.y,{center:kU,zoom:kJ.zoomLevel,tilt:kJ._tilt});if(kO){var kW=kO.sub(kS);var kP=kU.sub(kW);kJ.centerPoint=kJ.restrictCenter(kP)}}else{var kT=kN;var kV=kJ.getZoomUnits();var kP=new cG(kX.lng-kV*(kT.x-kJ.width/2),kX.lat+kV*(kT.y-kJ.height/2));kJ.centerPoint=kJ.restrictCenter(kP,kV)}kJ.fire(new fW("oncenter_changed"))}}if(kM.fromMouseWheel===true){this._startInfiniteZoomAnimation(kM);kM.callback&&kM.callback();kJ._checkFireZoomend();return}if(!kM.callback){kM.callback=function(){kJ._checkFireZoomend()}}else{var kE=kM.callback;kM.callback=function(kN,kO){kE(kN,kO);kJ._checkFireZoomend()}}this._startAnimation(kM)},_checkFireZoomend:function(){var e=this;if(e.fireZoomendTimer){clearTimeout(e.fireZoomendTimer)}e.fireZoomendTimer=setTimeout(function(){if(e.zoomEventStatus==="zooming"){e.fire(new fW("onzoomend"));e.zoomEventStatus="idle"}e.fireZoomendTimer=null},150)},deepZoomMedia:function(e){var i=this;if(!i.temp.isStdCtrlBusy){i.temp.isStdCtrlBusy=true;i.deepZoomTo(i.zoomLevel+e);setTimeout(function(){i.temp.isStdCtrlBusy=false},400)}},deepZoomTo:function(e){this.zoomTo(e)},flyToIn:function(T,k3,kO){kO=kO||{};var kA=this._getProperZoom(k3);k3=kA.zoom;if(this.centerPoint.equals(T)&&this.zoomLevel===k3&&typeof kO.heading!=="number"&&typeof kO.tilt!=="number"){return}var e=this.getHeading()%360;var kG=this.getTilt();var kM=0;var kQ=0;var kJ=this.getBounds().containsPoint(T);if(typeof kO.heading==="number"){kM=kO.heading}else{if(kJ){kM=e}}if(typeof kO.tilt==="number"){kQ=kO.tilt}else{if(kJ){kQ=kG}}this._heading=e;var k0=kM-e;var kW=kQ-kG;var kK=this;var kC=this.zoomLevel;var kD=1.42;var kS=this.zoomScale(k3-kC);var k5=this.getZoomUnits();var kI=this.centerPoint.div(k5);var k6=T.div(k5);var kZ=this.worldSize();var kV=kD;var kU=Math.max(this.width,this.height);var kT=kU/kS;var kH=k6.sub(kI).mag();var i=kV*kV;function k2(k8){var k7=(kT*kT-kU*kU+(k8?-1:1)*i*i*kH*kH)/(2*(k8?kT:kU)*i*kH);return Math.log(Math.sqrt(k7*k7+1)-k7)}function kz(k7){return(Math.exp(k7)-Math.exp(-k7))/2}function kE(k7){return(Math.exp(k7)+Math.exp(-k7))/2}function kN(k7){return kz(k7)/kE(k7)}var kF=k2(0);var kX=function(k7){return(kE(kF)/kE(kF+kV*k7))};var kY=function(k7){return kU*((kE(kF)*kN(kF+kV*k7)-kz(kF))/i)/kH};var kB=(k2(1)-kF)/kV;if(Math.abs(kH)<0.000001||kB===Infinity||isNaN(kB)){if(Math.abs(kU-kT)<0.000001){this._animationInfo.zoom={current:this.zoomLevel,diff:k3-this.zoomLevel};this._animationInfo.center={current:this.centerPoint,diff:T.sub(this.centerPoint)};this._animationInfo.heading={current:e,diff:kM-e};this._animationInfo.tilt={current:kG,diff:kQ-kG};this.setLock(true);this._startAnimation({callback:function(k7){kK.setLock(false);if(kO.callback){kO.callback(k7)}},duration:kO.duration});return}var k4=kT<kU?-1:1;kB=Math.abs(Math.log(kT/kU))/kV;kY=function(){return 0};kX=function(k7){return Math.exp(k4*kV*k7)}}var k1=1.7;if(kB<0.3){k1=0.8}else{if(kB>5){k1=(kB-5)/2+k1}}var kP=kO.duration||1000*kB/k1;if(isNaN(kP)){var kR={};for(var kL in kO){kR[kL]=kO[kL];kR.noAnimation=true}this.centerAndZoomIn(T,k3,kR);return}this.fire(new fW("onmovestart"));this.fire(new fW("onzoomstart"));this.setLock(true);this._startAnimation({duration:kP,renderCallback:function(k7,k8){var k9=k7*kB;var lc=kY(k9);var lb=kC+kK.scaleZoom(1/kX(k9));if(lb<kK.getMinZoom()){lb=kK.getMinZoom()}if(lb>kK.getMaxZoom()){lb=kK.getMaxZoom()}if(lb!==kK.zoomLevel){kK.zoomLevel=lb;kK.fire(new fW("onzoom_changed"))}kK.centerPoint=kI.add(k6.sub(kI).mult(lc)).mult(k5);kK.fire(new fW("oncenter_changed"));if(typeof kM==="number"){var la=k7/0.7;if(la>1){la=1}kK.setHeading(e+k0*k7,{noAnimation:true})}if(typeof kQ==="number"){kK.setTilt(kG+kW*k7,{noAnimation:true})}},callback:function(k7,k8){kK.setLock(false);if(k8&&k8.stop===true){kK.fire(new fW("onmoveend"));kK.fire(new fW("onzoomend"));kO.callback&&kO.callback(k7);return}if(k3!==kK.zoomLevel){kK.zoomLevel=k3;kK.fire(new fW("onzoom_changed"))}kK.fire(new fW("onmoveend"));kK.fire(new fW("onzoomend"));kO.callback&&kO.callback(k7)}})},zoomScale:function(e){return Math.pow(2,e)},scaleZoom:function(e){return Math.log(e)/Math.LN2},panToIn:function(i,T){T=T||{};if(!i||i.equals(this.centerPoint)){T.callback&&T.callback();return}var kz=this.pointToPixelIn(i);var e=Math.round(this.width/2);var kB=Math.round(this.height/2);var kA=this._ifUseAnimation(i,this.zoomLevel);if(T.noAnimation===true||kA===false){this._stopAllAnimations();this._panToIn(e-kz.x,kB-kz.y,i);T.callback&&T.callback();return}this.flyToIn(i,this.zoomLevel,T)},_panToIn:function(i,e,kz){var T=this.temp;if(T.operating===true){return}if(T.dragAni){T.dragAni.stop(false,{readyToMove:true});T.dragAni=null}this.dispatchEvent(new fW("onmovestart"));this._setPlatformPosition(i,e,{point:kz});this.dispatchEvent(new fW("onmoveend"))},_stopAllAnimations:function(e){e=e||{};if(this._ani){this._ani.stop(!!e.goToEnd,{stopCurrentAnimation:e.stopCurrentAnimation});this._ani=null}if(this._infiniteAni){this._infiniteAni.stop();this._infiniteAni=null}},panBy:function(i,e,T){i=Math.round(i)||0;e=Math.round(e)||0;T=T||{};if(Math.abs(i)<=this.width&&Math.abs(e)<=this.height&&T.noAnimation!==true){this._panBy(i,e,T)}else{this._panToIn(i,e,T.point);T.callback&&T.callback()}},_panBy:function(i,e,kA){if(this.temp.operating===true){return}kA=kA||{};this.dispatchEvent(new fW("onmovestart"));var kz=this;var T=kz.temp;T.pl=kz.offsetX;T.pt=kz.offsetY;if(T.tlPan){T.tlPan.cancel()}if(T.dragAni){T.dragAni.stop(false,{readyToMove:true});T.dragAni=null}T.tlPan=new fL({fps:kA.fps||kz.config.fps,duration:kA.duration||kz.config.actionDuration,transition:kA.transition||gR.easeInOutQuad,render:function(kB){this.terminative=kz.temp.operating;if(kz.temp.operating){return}kz._setPlatformPosition(i*kB,e*kB,{initMapOffsetX:T.pl,initMapOffsetY:T.pt})},finish:function(kB){kz.dispatchEvent(new fW("onmoveend"));kz.temp.tlPan=false;if(kz.temp.stopArrow===true){kz.temp.stopArrow=false;if(kz.temp.arrow!==0){kz._arrow()}}}})},_startAnimation:function(i){var kA=this._animationInfo;var T=this;i=i||{};if(T._ani){T._ani.stop(!!i.goToEnd,{stopCurrentAnimation:i.stopCurrentAnimation})}if(T._infiniteAni){T._infiniteAni.stop();T._infiniteAni=null}var kB=i.duration||500;var kC=i.transition||gR.ease;var e=new fW("onanimation_start");this.fire(e);if(i.unstopable){kA=this._animationInfoUnstopable}var kz=new fL({duration:kB,transition:kC,render:function(kF,kE){for(var kD in kA){if(!kA.hasOwnProperty(kD)){continue}var kH=kA[kD].current;var kG=kA[kD].diff;T._setValueTick(kD,kH,kG,kF)}if(i.renderCallback){i.renderCallback(kF,kE)}},finish:function(kD){T.fire(new fW("onanimation_end"));if(i.unstopable){T._animationInfoUnstopable={};T._unstopableAni=null}else{T._ani=null;T._animationInfo={}}if(i.mapNeedCbk){i.mapNeedCbk()}if(i.callback){i.callback(kD)}},onStop:function(kD){kD=kD||{};T.fire(new fW("onanimation_end"));if(kD.stopCurrentAnimation){T._animationInfo={}}T._ani=null;if(i.mapNeedCbk){i.mapNeedCbk()}if(i.callback){i.callback(null,{stop:true})}}});if(i.unstopable){T._unstopableAni=kz}else{T._ani=kz}},_startInfiniteZoomAnimation:function(e){var i=this;if(i._ani){i._ani.stop(!!e.goToEnd,{stopCurrentAnimation:e.stopCurrentAnimation})}if(i._infiniteAni){return}this.fire(new fW("onanimation_start"));i._infiniteAni=new fL({duration:10000,transition:gR.linear,render:function(){var T=i._animationInfo.zoom;if(Math.abs(T.current-T.target)<0.001){i._setValue("zoom",T.target);i._infiniteAni&&i._infiniteAni.stop();return}T.current+=(T.target-T.current)*0.35;i._setValue("zoom",T.current);if(e.renderCallback){e.renderCallback()}},finish:function(){i._infiniteAni=null;i._animationInfo={};i.fire(new fW("onanimation_end"));if(e.callback){e.callback()}},onStop:function(){i._infiniteAni=null;i._animationInfo={};i.fire(new fW("onanimation_end"));if(e.callback){e.callback()}}})},_setValue:function(e,T){if(e==="zoom"){this._preZoomLevel=this.zoomLevel;var i=this._getProperZoom(T);T=i.zoom;if(T!==this.zoomLevel){this.zoomLevel=T;if(T<5){this.restrictCenter(this.centerPoint)}this.fire(new fW("on"+e+"_changed"))}return}else{if(e==="center"){this.centerPoint=T}}this["_"+e]=T;this.fire(new fW("on"+e+"_changed"))},_setValueTick:function(e,kA,kz,i){if(e==="center"){var T=new cG(kA.lng+kz.lng*i,kA.lat+kz.lat*i);this._setValue(e,T);return}if(e==="zoom"){this._setValue(e,Math.pow(kA,1-i)*Math.pow(kA+kz,i));return}this._setValue(e,kA+kz*i)},setHeading:function(kz,i){i=i||{};if(kz===this._heading){i.callback&&i.callback();return}var T=eq(this._heading,360);var e=eq(kz,360);if(e===T){this._heading=kz;i.callback&&i.callback();return}if(e===0&&T>180){e=360}if(i.noAnimation){this._setValue("heading",kz);i.callback&&i.callback();return}if(i.unstopable){this._animationInfoUnstopable.heading={current:T,diff:e-T}}else{this._animationInfo.heading={current:T,diff:e-T}}this._startAnimation(i)},resetHeading:function(e){var i=this._heading;while(i<0){i+=360}i=i%360;if(i>180){i-=360}this._heading=i;e=e||{};e.unstopable=true;this.setHeading(0,e)},getHeading:function(){return this._heading},setTilt:function(e,i){i=i||{};if(e===this._tilt){i.callback&&i.callback();return}if(e>h4.MAX_TILT){e=h4.MAX_TILT}if(e<h4.MIN_TILT){e=h4.MIN_TILT}if(i&&i.noAnimation){this._setValue("tilt",e);i.callback&&i.callback();return}this._animationInfo.tilt={current:this._tilt,diff:e-this._tilt};this._startAnimation(i)},getTilt:function(){return this._tilt},getCenterIn:function(){return this.centerPoint},getZoom:function(){return this.zoomLevel},getCameraPosition:function(T){T=T||{};var e=T.center||this.centerPoint;var kz=T.zoom||this.zoomLevel;var kC=typeof T.heading==="number"?T.heading:this._heading;var i=typeof T.tilt==="number"?T.tilt:this._tilt;var kB=this._webglMapCamera.generateMVMatrix(e,kz,kC,i);var kA=mat4.create(Float32Array);mat4.invert(kA,kB);return this._webglMapCamera.getPosition(kA)}});function bs(i){this._jobQueue=[];this._idleOnlyJobQueue=[];var e=this;this.isIdle=true;i.on("updateframe",function(kz){var T=12-kz.frameTime;T=T<1?1:T;e.isIdle=false;if(e.idleWorkTimer){clearInterval(e.idleWorkTimer);e.idleWorkTimer=null}e.runJobs(T)});this._idleWorkerTicker=(function(T){return function(){if(T.isIdle){T.runJobs();T.runIdleOnlyJobs()}}})(this);i.on("mapglidle",function(){e.isIdle=true;e.runJobs();e.runIdleOnlyJobs();e.idleWorkTimer=setInterval(e._idleWorkerTicker,bs.MAX_IDLE_TIME)});i.on("destroy",function(){if(e.idleWorkTimer){clearInterval(e.idleWorkTimer);e.idleWorkTimer=null}})}bs.MAX_IDLE_TIME=50;bs.MAX_FRAME_TIME=6;bs.prototype.runJobs=function(i){if(this._jobQueue.length===0){return}var kz=ix();var e=0;i=i||bs.MAX_FRAME_TIME;while(this._jobQueue.length&&e<i){var T=this._jobQueue.shift();if(T.state!=="invalid"){T.call()}e=ix()-kz}};bs.prototype.runIdleOnlyJobs=function(){if(this._idleOnlyJobQueue.length===0){return}var T=ix();var e=0;while(this._idleOnlyJobQueue.length&&e<bs.MAX_IDLE_TIME){var i=this._idleOnlyJobQueue.shift();if(i.state!=="invalid"){i.call()}e=ix()-T}};bs.prototype.checkIdleRunning=function(){if(this.isIdle&&!this.idleWorkTimer){this.runJobs();this.runIdleOnlyJobs();this.idleWorkTimer=setInterval(this._idleWorkerTicker,50)}};bs.prototype.addJob=function(e){this._jobQueue.push(e);this.checkIdleRunning()};bs.prototype.clearJobs=function(){this._jobQueue.length=0;this._idleOnlyJobQueue.length=0};bs.prototype.addIdleOnlyJob=function(e){this._idleOnlyJobQueue.push(e);this.checkIdleRunning()};var d5={};(function(kC){if(!kG){var kG=0.000001}if(!i){var i=(typeof Float32Array!=="undefined")?Float32Array:Array}if(!kA){var kA=Math.random}var T={};var kB=Math.PI/180;T.toRadian=function(kH){return kH*kB};var kF={};kF.create=function(kI){kI=kI||i;var kH=new kI(2);kH[0]=0;kH[1]=0;return kH};kF.clone=function(kH,kJ){kJ=kJ||i;var kI=new kJ(2);kI[0]=kH[0];kI[1]=kH[1];return kI};kF.fromValues=function(kH,kK,kJ){kJ=kJ||i;var kI=new kJ(2);kI[0]=kH;kI[1]=kK;return kI};kF.copy=function(kI,kH){kI[0]=kH[0];kI[1]=kH[1];return kI};kF.set=function(kI,kH,kJ){kI[0]=kH;kI[1]=kJ;return kI};kF.add=function(kJ,kI,kH){kJ[0]=kI[0]+kH[0];kJ[1]=kI[1]+kH[1];return kJ};kF.subtract=function(kJ,kI,kH){kJ[0]=kI[0]-kH[0];kJ[1]=kI[1]-kH[1];return kJ};kF.sub=kF.subtract;kF.multiply=function(kJ,kI,kH){kJ[0]=kI[0]*kH[0];kJ[1]=kI[1]*kH[1];return kJ};kF.mul=kF.multiply;kF.divide=function(kJ,kI,kH){kJ[0]=kI[0]/kH[0];kJ[1]=kI[1]/kH[1];return kJ};kF.div=kF.divide;kF.min=function(kJ,kI,kH){kJ[0]=Math.min(kI[0],kH[0]);kJ[1]=Math.min(kI[1],kH[1]);return kJ};kF.max=function(kJ,kI,kH){kJ[0]=Math.max(kI[0],kH[0]);kJ[1]=Math.max(kI[1],kH[1]);return kJ};kF.scale=function(kJ,kI,kH){kJ[0]=kI[0]*kH;kJ[1]=kI[1]*kH;return kJ};kF.scaleAndAdd=function(kJ,kI,kH,kK){kJ[0]=kI[0]+(kH[0]*kK);kJ[1]=kI[1]+(kH[1]*kK);return kJ};kF.distance=function(kJ,kI){var kH=kI[0]-kJ[0],kK=kI[1]-kJ[1];return Math.sqrt(kH*kH+kK*kK)};kF.dist=kF.distance;kF.squaredDistance=function(kJ,kI){var kH=kI[0]-kJ[0],kK=kI[1]-kJ[1];return kH*kH+kK*kK};kF.sqrDist=kF.squaredDistance;kF.length=function(kI){var kH=kI[0],kJ=kI[1];return Math.sqrt(kH*kH+kJ*kJ)};kF.len=kF.length;kF.squaredLength=function(kI){var kH=kI[0],kJ=kI[1];return kH*kH+kJ*kJ};kF.sqrLen=kF.squaredLength;kF.negate=function(kI,kH){kI[0]=-kH[0];kI[1]=-kH[1];return kI};kF.normalize=function(kK,kJ){var kI=kJ[0],kL=kJ[1];var kH=kI*kI+kL*kL;if(kH>0){kH=1/Math.sqrt(kH);kK[0]=kJ[0]*kH;kK[1]=kJ[1]*kH}return kK};kF.dot=function(kI,kH){return kI[0]*kH[0]+kI[1]*kH[1]};kF.cross=function(kJ,kI,kH){var kK=kI[0]*kH[1]-kI[1]*kH[0];kJ[0]=kJ[1]=0;kJ[2]=kK;return kJ};kF.lerp=function(kJ,kI,kH,kK){var kM=kI[0],kL=kI[1];kJ[0]=kM+kK*(kH[0]-kM);kJ[1]=kL+kK*(kH[1]-kL);return kJ};kF.random=function(kH,kJ){kJ=kJ||1;var kI=kA()*2*Math.PI;kH[0]=Math.cos(kI)*kJ;kH[1]=Math.sin(kI)*kJ;return kH};kF.transformMat2=function(kK,kJ,kI){var kH=kJ[0],kL=kJ[1];kK[0]=kI[0]*kH+kI[2]*kL;kK[1]=kI[1]*kH+kI[3]*kL;return kK};kF.transformMat2d=function(kK,kJ,kI){var kH=kJ[0],kL=kJ[1];kK[0]=kI[0]*kH+kI[2]*kL+kI[4];kK[1]=kI[1]*kH+kI[3]*kL+kI[5];return kK};kF.transformMat3=function(kK,kJ,kI){var kH=kJ[0],kL=kJ[1];kK[0]=kI[0]*kH+kI[3]*kL+kI[6];kK[1]=kI[1]*kH+kI[4]*kL+kI[7];return kK};kF.transformMat4=function(kK,kJ,kI){var kH=kJ[0],kL=kJ[1];kK[0]=kI[0]*kH+kI[4]*kL+kI[12];kK[1]=kI[1]*kH+kI[5]*kL+kI[13];return kK};kF.rotate=function(kK,kI,kH,kO){var kN=kI[0]-kH[0];var kM=kI[1]-kH[1];var kJ=Math.sin(kO);var kL=Math.cos(kO);kK[0]=kN*kL-kM*kJ+kH[0];kK[1]=kN*kJ+kM*kL+kH[1];return kK};kF.forEach=(function(){var kH=kF.create();return function(kK,kO,kP,kN,kM,kI){var kL,kJ;if(!kO){kO=2}if(!kP){kP=0}if(kN){kJ=Math.min((kN*kO)+kP,kK.length)}else{kJ=kK.length}for(kL=kP;kL<kJ;kL+=kO){kH[0]=kK[kL];kH[1]=kK[kL+1];kM(kH,kH,kI);kK[kL]=kH[0];kK[kL+1]=kH[1]}return kK}})();kF.str=function(kH){return"vec2("+kH[0]+", "+kH[1]+")"};kC.vec2=kF;var kE={};kE.create=function(kI){kI=kI||i;var kH=new kI(3);kH[0]=0;kH[1]=0;kH[2]=0;return kH};kE.clone=function(kH,kJ){kJ=kJ||i;var kI=new kJ(3);kI[0]=kH[0];kI[1]=kH[1];kI[2]=kH[2];return kI};kE.fromValues=function(kH,kL,kJ,kK){kK=kK||i;var kI=new kK(3);kI[0]=kH;kI[1]=kL;kI[2]=kJ;return kI};kE.copy=function(kI,kH){kI[0]=kH[0];kI[1]=kH[1];kI[2]=kH[2];return kI};kE.set=function(kI,kH,kK,kJ){kI[0]=kH;kI[1]=kK;kI[2]=kJ;return kI};kE.add=function(kJ,kI,kH){kJ[0]=kI[0]+kH[0];kJ[1]=kI[1]+kH[1];kJ[2]=kI[2]+kH[2];return kJ};kE.subtract=function(kJ,kI,kH){kJ[0]=kI[0]-kH[0];kJ[1]=kI[1]-kH[1];kJ[2]=kI[2]-kH[2];return kJ};kE.sub=kE.subtract;kE.multiply=function(kJ,kI,kH){kJ[0]=kI[0]*kH[0];kJ[1]=kI[1]*kH[1];kJ[2]=kI[2]*kH[2];return kJ};kE.mul=kE.multiply;kE.divide=function(kJ,kI,kH){kJ[0]=kI[0]/kH[0];kJ[1]=kI[1]/kH[1];kJ[2]=kI[2]/kH[2];return kJ};kE.div=kE.divide;kE.min=function(kJ,kI,kH){kJ[0]=Math.min(kI[0],kH[0]);kJ[1]=Math.min(kI[1],kH[1]);kJ[2]=Math.min(kI[2],kH[2]);return kJ};kE.max=function(kJ,kI,kH){kJ[0]=Math.max(kI[0],kH[0]);kJ[1]=Math.max(kI[1],kH[1]);kJ[2]=Math.max(kI[2],kH[2]);return kJ};kE.scale=function(kJ,kI,kH){kJ[0]=kI[0]*kH;kJ[1]=kI[1]*kH;kJ[2]=kI[2]*kH;return kJ};kE.scaleAndAdd=function(kJ,kI,kH,kK){kJ[0]=kI[0]+(kH[0]*kK);kJ[1]=kI[1]+(kH[1]*kK);kJ[2]=kI[2]+(kH[2]*kK);return kJ};kE.distance=function(kJ,kI){var kH=kI[0]-kJ[0],kL=kI[1]-kJ[1],kK=kI[2]-kJ[2];return Math.sqrt(kH*kH+kL*kL+kK*kK)};kE.dist=kE.distance;kE.squaredDistance=function(kJ,kI){var kH=kI[0]-kJ[0],kL=kI[1]-kJ[1],kK=kI[2]-kJ[2];return kH*kH+kL*kL+kK*kK};kE.sqrDist=kE.squaredDistance;kE.length=function(kI){var kH=kI[0],kK=kI[1],kJ=kI[2];return Math.sqrt(kH*kH+kK*kK+kJ*kJ)};kE.len=kE.length;kE.squaredLength=function(kI){var kH=kI[0],kK=kI[1],kJ=kI[2];return kH*kH+kK*kK+kJ*kJ};kE.sqrLen=kE.squaredLength;kE.negate=function(kI,kH){kI[0]=-kH[0];kI[1]=-kH[1];kI[2]=-kH[2];return kI};kE.normalize=function(kK,kJ){var kI=kJ[0],kM=kJ[1],kL=kJ[2];var kH=kI*kI+kM*kM+kL*kL;if(kH>0){kH=1/Math.sqrt(kH);kK[0]=kJ[0]*kH;kK[1]=kJ[1]*kH;kK[2]=kJ[2]*kH}return kK};kE.dot=function(kI,kH){return kI[0]*kH[0]+kI[1]*kH[1]+kI[2]*kH[2]};kE.cross=function(kI,kN,kM){var kH=kN[0],kP=kN[1],kO=kN[2],kL=kM[0],kK=kM[1],kJ=kM[2];kI[0]=kP*kJ-kO*kK;kI[1]=kO*kL-kH*kJ;kI[2]=kH*kK-kP*kL;return kI};kE.lerp=function(kJ,kI,kH,kK){var kN=kI[0],kM=kI[1],kL=kI[2];kJ[0]=kN+kK*(kH[0]-kN);kJ[1]=kM+kK*(kH[1]-kM);kJ[2]=kL+kK*(kH[2]-kL);return kJ};kE.random=function(kH,kL){kL=kL||1;var kJ=kA()*2*Math.PI;var kK=(kA()*2)-1;var kI=Math.sqrt(1-kK*kK)*kL;kH[0]=Math.cos(kJ)*kI;kH[1]=Math.sin(kJ)*kI;kH[2]=kK*kL;return kH};kE.transformMat4=function(kK,kJ,kI){var kH=kJ[0],kM=kJ[1],kL=kJ[2];kK[0]=kI[0]*kH+kI[4]*kM+kI[8]*kL+kI[12];kK[1]=kI[1]*kH+kI[5]*kM+kI[9]*kL+kI[13];kK[2]=kI[2]*kH+kI[6]*kM+kI[10]*kL+kI[14];return kK};kE.transformMat3=function(kK,kJ,kI){var kH=kJ[0],kM=kJ[1],kL=kJ[2];kK[0]=kH*kI[0]+kM*kI[3]+kL*kI[6];kK[1]=kH*kI[1]+kM*kI[4]+kL*kI[7];kK[2]=kH*kI[2]+kM*kI[5]+kL*kI[8];return kK};kE.transformQuat=function(kN,kT,kH){var kU=kT[0],kS=kT[1],kR=kT[2],kP=kH[0],kO=kH[1],kM=kH[2],kQ=kH[3],kK=kQ*kU+kO*kR-kM*kS,kJ=kQ*kS+kM*kU-kP*kR,kI=kQ*kR+kP*kS-kO*kU,kL=-kP*kU-kO*kS-kM*kR;kN[0]=kK*kQ+kL*-kP+kJ*-kM-kI*-kO;kN[1]=kJ*kQ+kL*-kO+kI*-kP-kK*-kM;kN[2]=kI*kQ+kL*-kM+kK*-kO-kJ*-kP;return kN};kE.rotateX=function(kJ,kI,kH,kM){var kL=[],kK=[];kL[0]=kI[0]-kH[0];kL[1]=kI[1]-kH[1];kL[2]=kI[2]-kH[2];kK[0]=kL[0];kK[1]=kL[1]*Math.cos(kM)-kL[2]*Math.sin(kM);kK[2]=kL[1]*Math.sin(kM)+kL[2]*Math.cos(kM);kJ[0]=kK[0]+kH[0];kJ[1]=kK[1]+kH[1];kJ[2]=kK[2]+kH[2];return kJ};kE.rotateY=function(kJ,kI,kH,kM){var kL=[],kK=[];kL[0]=kI[0]-kH[0];kL[1]=kI[1]-kH[1];kL[2]=kI[2]-kH[2];kK[0]=kL[2]*Math.sin(kM)+kL[0]*Math.cos(kM);kK[1]=kL[1];kK[2]=kL[2]*Math.cos(kM)-kL[0]*Math.sin(kM);kJ[0]=kK[0]+kH[0];kJ[1]=kK[1]+kH[1];kJ[2]=kK[2]+kH[2];return kJ};kE.rotateZ=function(kJ,kI,kH,kM){var kL=[],kK=[];kL[0]=kI[0]-kH[0];kL[1]=kI[1]-kH[1];kL[2]=kI[2]-kH[2];kK[0]=kL[0]*Math.cos(kM)-kL[1]*Math.sin(kM);kK[1]=kL[0]*Math.sin(kM)+kL[1]*Math.cos(kM);kK[2]=kL[2];kJ[0]=kK[0]+kH[0];kJ[1]=kK[1]+kH[1];kJ[2]=kK[2]+kH[2];return kJ};kE.forEach=(function(){var kH=kE.create();return function(kK,kO,kP,kN,kM,kI){var kL,kJ;if(!kO){kO=3}if(!kP){kP=0}if(kN){kJ=Math.min((kN*kO)+kP,kK.length)}else{kJ=kK.length}for(kL=kP;kL<kJ;kL+=kO){kH[0]=kK[kL];kH[1]=kK[kL+1];kH[2]=kK[kL+2];kM(kH,kH,kI);kK[kL]=kH[0];kK[kL+1]=kH[1];kK[kL+2]=kH[2]}return kK}})();kE.str=function(kH){return"vec3("+kH[0]+", "+kH[1]+", "+kH[2]+")"};kC.vec3=kE;var kD={};kD.create=function(kI){kI=kI||i;var kH=new kI(4);kH[0]=0;kH[1]=0;kH[2]=0;kH[3]=0;return kH};kD.clone=function(kH,kJ){kJ=kJ||i;var kI=new kJ(4);kI[0]=kH[0];kI[1]=kH[1];kI[2]=kH[2];kI[3]=kH[3];return kI};kD.fromValues=function(kH,kM,kK,kI,kL){kL=kL||i;var kJ=new kL(4);kJ[0]=kH;kJ[1]=kM;kJ[2]=kK;kJ[3]=kI;return kJ};kD.copy=function(kI,kH){kI[0]=kH[0];kI[1]=kH[1];kI[2]=kH[2];kI[3]=kH[3];return kI};kD.set=function(kJ,kH,kL,kK,kI){kJ[0]=kH;kJ[1]=kL;kJ[2]=kK;kJ[3]=kI;return kJ};kD.add=function(kJ,kI,kH){kJ[0]=kI[0]+kH[0];kJ[1]=kI[1]+kH[1];kJ[2]=kI[2]+kH[2];kJ[3]=kI[3]+kH[3];return kJ};kD.subtract=function(kJ,kI,kH){kJ[0]=kI[0]-kH[0];kJ[1]=kI[1]-kH[1];kJ[2]=kI[2]-kH[2];kJ[3]=kI[3]-kH[3];return kJ};kD.sub=kD.subtract;kD.multiply=function(kJ,kI,kH){kJ[0]=kI[0]*kH[0];kJ[1]=kI[1]*kH[1];kJ[2]=kI[2]*kH[2];kJ[3]=kI[3]*kH[3];return kJ};kD.mul=kD.multiply;kD.divide=function(kJ,kI,kH){kJ[0]=kI[0]/kH[0];kJ[1]=kI[1]/kH[1];kJ[2]=kI[2]/kH[2];kJ[3]=kI[3]/kH[3];return kJ};kD.div=kD.divide;kD.min=function(kJ,kI,kH){kJ[0]=Math.min(kI[0],kH[0]);kJ[1]=Math.min(kI[1],kH[1]);kJ[2]=Math.min(kI[2],kH[2]);kJ[3]=Math.min(kI[3],kH[3]);return kJ};kD.max=function(kJ,kI,kH){kJ[0]=Math.max(kI[0],kH[0]);kJ[1]=Math.max(kI[1],kH[1]);kJ[2]=Math.max(kI[2],kH[2]);kJ[3]=Math.max(kI[3],kH[3]);return kJ};kD.scale=function(kJ,kI,kH){kJ[0]=kI[0]*kH;kJ[1]=kI[1]*kH;kJ[2]=kI[2]*kH;kJ[3]=kI[3]*kH;return kJ};kD.scaleAndAdd=function(kJ,kI,kH,kK){kJ[0]=kI[0]+(kH[0]*kK);kJ[1]=kI[1]+(kH[1]*kK);kJ[2]=kI[2]+(kH[2]*kK);kJ[3]=kI[3]+(kH[3]*kK);return kJ};kD.distance=function(kK,kI){var kH=kI[0]-kK[0],kM=kI[1]-kK[1],kL=kI[2]-kK[2],kJ=kI[3]-kK[3];return Math.sqrt(kH*kH+kM*kM+kL*kL+kJ*kJ)};kD.dist=kD.distance;kD.squaredDistance=function(kK,kI){var kH=kI[0]-kK[0],kM=kI[1]-kK[1],kL=kI[2]-kK[2],kJ=kI[3]-kK[3];return kH*kH+kM*kM+kL*kL+kJ*kJ};kD.sqrDist=kD.squaredDistance;kD.length=function(kJ){var kH=kJ[0],kL=kJ[1],kK=kJ[2],kI=kJ[3];return Math.sqrt(kH*kH+kL*kL+kK*kK+kI*kI)};kD.len=kD.length;kD.squaredLength=function(kJ){var kH=kJ[0],kL=kJ[1],kK=kJ[2],kI=kJ[3];return kH*kH+kL*kL+kK*kK+kI*kI};kD.sqrLen=kD.squaredLength;kD.negate=function(kI,kH){kI[0]=-kH[0];kI[1]=-kH[1];kI[2]=-kH[2];kI[3]=-kH[3];return kI};kD.normalize=function(kL,kK){var kI=kK[0],kN=kK[1],kM=kK[2],kJ=kK[3];var kH=kI*kI+kN*kN+kM*kM+kJ*kJ;if(kH>0){kH=1/Math.sqrt(kH);kL[0]=kK[0]*kH;kL[1]=kK[1]*kH;kL[2]=kK[2]*kH;kL[3]=kK[3]*kH}return kL};kD.dot=function(kI,kH){return kI[0]*kH[0]+kI[1]*kH[1]+kI[2]*kH[2]+kI[3]*kH[3]};kD.lerp=function(kJ,kI,kH,kK){var kN=kI[0],kM=kI[1],kL=kI[2],kO=kI[3];kJ[0]=kN+kK*(kH[0]-kN);kJ[1]=kM+kK*(kH[1]-kM);kJ[2]=kL+kK*(kH[2]-kL);kJ[3]=kO+kK*(kH[3]-kO);return kJ};kD.random=function(kH,kI){kI=kI||1;kH[0]=kA();kH[1]=kA();kH[2]=kA();kH[3]=kA();kD.normalize(kH,kH);kD.scale(kH,kH,kI);return kH};kD.transformMat4=function(kL,kK,kI){var kH=kK[0],kN=kK[1],kM=kK[2],kJ=kK[3];kL[0]=kI[0]*kH+kI[4]*kN+kI[8]*kM+kI[12]*kJ;kL[1]=kI[1]*kH+kI[5]*kN+kI[9]*kM+kI[13]*kJ;kL[2]=kI[2]*kH+kI[6]*kN+kI[10]*kM+kI[14]*kJ;kL[3]=kI[3]*kH+kI[7]*kN+kI[11]*kM+kI[15]*kJ;return kL};kD.transformQuat=function(kN,kT,kH){var kU=kT[0],kS=kT[1],kR=kT[2],kP=kH[0],kO=kH[1],kM=kH[2],kQ=kH[3],kK=kQ*kU+kO*kR-kM*kS,kJ=kQ*kS+kM*kU-kP*kR,kI=kQ*kR+kP*kS-kO*kU,kL=-kP*kU-kO*kS-kM*kR;kN[0]=kK*kQ+kL*-kP+kJ*-kM-kI*-kO;kN[1]=kJ*kQ+kL*-kO+kI*-kP-kK*-kM;kN[2]=kI*kQ+kL*-kM+kK*-kO-kJ*-kP;return kN};kD.forEach=(function(){var kH=kD.create();return function(kK,kO,kP,kN,kM,kI){var kL,kJ;if(!kO){kO=4}if(!kP){kP=0}if(kN){kJ=Math.min((kN*kO)+kP,kK.length)}else{kJ=kK.length}for(kL=kP;kL<kJ;kL+=kO){kH[0]=kK[kL];kH[1]=kK[kL+1];kH[2]=kK[kL+2];kH[3]=kK[kL+3];kM(kH,kH,kI);kK[kL]=kH[0];kK[kL+1]=kH[1];kK[kL+2]=kH[2];kK[kL+3]=kH[3]}return kK}})();kD.str=function(kH){return"vec4("+kH[0]+", "+kH[1]+", "+kH[2]+", "+kH[3]+")"};kC.vec4=kD;var kz={};kz.create=function(kI){kI=kI||i;var kH=new kI(4);kH[0]=1;kH[1]=0;kH[2]=0;kH[3]=1;return kH};kz.clone=function(kH,kJ){kJ=kJ||i;var kI=new kJ(4);kI[0]=kH[0];kI[1]=kH[1];kI[2]=kH[2];kI[3]=kH[3];return kI};kz.copy=function(kI,kH){kI[0]=kH[0];kI[1]=kH[1];kI[2]=kH[2];kI[3]=kH[3];return kI};kz.identity=function(kH){kH[0]=1;kH[1]=0;kH[2]=0;kH[3]=1;return kH};kz.transpose=function(kJ,kI){if(kJ===kI){var kH=kI[1];kJ[1]=kI[2];kJ[2]=kH}else{kJ[0]=kI[0];kJ[1]=kI[2];kJ[2]=kI[1];kJ[3]=kI[3]}return kJ};kz.invert=function(kL,kJ){var kK=kJ[0],kI=kJ[1],kH=kJ[2],kN=kJ[3],kM=kK*kN-kH*kI;if(!kM){return null}kM=1/kM;kL[0]=kN*kM;kL[1]=-kI*kM;kL[2]=-kH*kM;kL[3]=kK*kM;return kL};kz.adjoint=function(kJ,kH){var kI=kH[0];kJ[0]=kH[3];kJ[1]=-kH[1];kJ[2]=-kH[2];kJ[3]=kI;return kJ};kz.determinant=function(kH){return kH[0]*kH[3]-kH[2]*kH[1]};kz.multiply=function(kL,kQ,kO){var kK=kQ[0],kJ=kQ[1],kI=kQ[2],kH=kQ[3];var kR=kO[0],kP=kO[1],kN=kO[2],kM=kO[3];kL[0]=kK*kR+kI*kP;kL[1]=kJ*kR+kH*kP;kL[2]=kK*kN+kI*kM;kL[3]=kJ*kN+kH*kM;return kL};kz.mul=kz.multiply;kz.rotate=function(kL,kO,kN){var kK=kO[0],kJ=kO[1],kI=kO[2],kH=kO[3],kP=Math.sin(kN),kM=Math.cos(kN);kL[0]=kK*kM+kI*kP;kL[1]=kJ*kM+kH*kP;kL[2]=kK*-kP+kI*kM;kL[3]=kJ*-kP+kH*kM;return kL};kz.scale=function(kL,kM,kO){var kK=kM[0],kJ=kM[1],kI=kM[2],kH=kM[3],kP=kO[0],kN=kO[1];kL[0]=kK*kP;kL[1]=kJ*kP;kL[2]=kI*kN;kL[3]=kH*kN;return kL};kz.str=function(kH){return"mat2("+kH[0]+", "+kH[1]+", "+kH[2]+", "+kH[3]+")"};kz.frob=function(kH){return(Math.sqrt(Math.pow(kH[0],2)+Math.pow(kH[1],2)+Math.pow(kH[2],2)+Math.pow(kH[3],2)))};kz.LDU=function(kH,kK,kJ,kI){kH[2]=kI[2]/kI[0];kJ[0]=kI[0];kJ[1]=kI[1];kJ[3]=kI[3]-kH[2]*kJ[1];return[kH,kK,kJ]};kC.mat2=kz;var e={};e.create=function(kI){kI=kI||i;var kH=new kI(16);kH[0]=1;kH[1]=0;kH[2]=0;kH[3]=0;kH[4]=0;kH[5]=1;kH[6]=0;kH[7]=0;kH[8]=0;kH[9]=0;kH[10]=1;kH[11]=0;kH[12]=0;kH[13]=0;kH[14]=0;kH[15]=1;return kH};e.clone=function(kH){var kI=new i(16);kI[0]=kH[0];kI[1]=kH[1];kI[2]=kH[2];kI[3]=kH[3];kI[4]=kH[4];kI[5]=kH[5];kI[6]=kH[6];kI[7]=kH[7];kI[8]=kH[8];kI[9]=kH[9];kI[10]=kH[10];kI[11]=kH[11];kI[12]=kH[12];kI[13]=kH[13];kI[14]=kH[14];kI[15]=kH[15];return kI};e.copy=function(kI,kH){kI[0]=kH[0];kI[1]=kH[1];kI[2]=kH[2];kI[3]=kH[3];kI[4]=kH[4];kI[5]=kH[5];kI[6]=kH[6];kI[7]=kH[7];kI[8]=kH[8];kI[9]=kH[9];kI[10]=kH[10];kI[11]=kH[11];kI[12]=kH[12];kI[13]=kH[13];kI[14]=kH[14];kI[15]=kH[15];return kI};e.identity=function(kH){kH[0]=1;kH[1]=0;kH[2]=0;kH[3]=0;kH[4]=0;kH[5]=1;kH[6]=0;kH[7]=0;kH[8]=0;kH[9]=0;kH[10]=1;kH[11]=0;kH[12]=0;kH[13]=0;kH[14]=0;kH[15]=1;return kH};e.transpose=function(kK,kJ){if(kK===kJ){var kO=kJ[1],kM=kJ[2],kL=kJ[3],kH=kJ[6],kN=kJ[7],kI=kJ[11];kK[1]=kJ[4];kK[2]=kJ[8];kK[3]=kJ[12];kK[4]=kO;kK[6]=kJ[9];kK[7]=kJ[13];kK[8]=kM;kK[9]=kH;kK[11]=kJ[14];kK[12]=kL;kK[13]=kN;kK[14]=kI}else{kK[0]=kJ[0];kK[1]=kJ[4];kK[2]=kJ[8];kK[3]=kJ[12];kK[4]=kJ[1];kK[5]=kJ[5];kK[6]=kJ[9];kK[7]=kJ[13];kK[8]=kJ[2];kK[9]=kJ[6];kK[10]=kJ[10];kK[11]=kJ[14];kK[12]=kJ[3];kK[13]=kJ[7];kK[14]=kJ[11];kK[15]=kJ[15]}return kK};e.invert=function(k0,k5){var k9=k5[0],k7=k5[1],k6=k5[2],k3=k5[3],kL=k5[4],kK=k5[5],kJ=k5[6],kI=k5[7],kZ=k5[8],kY=k5[9],kX=k5[10],kW=k5[11],lb=k5[12],la=k5[13],k8=k5[14],k4=k5[15],kV=k9*kK-k7*kL,kU=k9*kJ-k6*kL,kT=k9*kI-k3*kL,kS=k7*kJ-k6*kK,kR=k7*kI-k3*kK,kQ=k6*kI-k3*kJ,kP=kZ*la-kY*lb,kO=kZ*k8-kX*lb,kN=kZ*k4-kW*lb,kM=kY*k8-kX*la,k2=kY*k4-kW*la,k1=kX*k4-kW*k8,kH=kV*k1-kU*k2+kT*kM+kS*kN-kR*kO+kQ*kP;if(!kH){return null}kH=1/kH;k0[0]=(kK*k1-kJ*k2+kI*kM)*kH;k0[1]=(k6*k2-k7*k1-k3*kM)*kH;k0[2]=(la*kQ-k8*kR+k4*kS)*kH;k0[3]=(kX*kR-kY*kQ-kW*kS)*kH;k0[4]=(kJ*kN-kL*k1-kI*kO)*kH;k0[5]=(k9*k1-k6*kN+k3*kO)*kH;k0[6]=(k8*kT-lb*kQ-k4*kU)*kH;k0[7]=(kZ*kQ-kX*kT+kW*kU)*kH;k0[8]=(kL*k2-kK*kN+kI*kP)*kH;k0[9]=(k7*kN-k9*k2-k3*kP)*kH;k0[10]=(lb*kR-la*kT+k4*kV)*kH;k0[11]=(kY*kT-kZ*kR-kW*kV)*kH;k0[12]=(kK*kO-kL*kM-kJ*kP)*kH;k0[13]=(k9*kM-k7*kO+k6*kP)*kH;k0[14]=(la*kU-lb*kS-k8*kV)*kH;k0[15]=(kZ*kS-kY*kU+kX*kV)*kH;return k0};e.adjoint=function(kP,kS){var kW=kS[0],kU=kS[1],kT=kS[2],kQ=kS[3],kK=kS[4],kJ=kS[5],kI=kS[6],kH=kS[7],kO=kS[8],kN=kS[9],kM=kS[10],kL=kS[11],kY=kS[12],kX=kS[13],kV=kS[14],kR=kS[15];kP[0]=(kJ*(kM*kR-kL*kV)-kN*(kI*kR-kH*kV)+kX*(kI*kL-kH*kM));kP[1]=-(kU*(kM*kR-kL*kV)-kN*(kT*kR-kQ*kV)+kX*(kT*kL-kQ*kM));kP[2]=(kU*(kI*kR-kH*kV)-kJ*(kT*kR-kQ*kV)+kX*(kT*kH-kQ*kI));kP[3]=-(kU*(kI*kL-kH*kM)-kJ*(kT*kL-kQ*kM)+kN*(kT*kH-kQ*kI));kP[4]=-(kK*(kM*kR-kL*kV)-kO*(kI*kR-kH*kV)+kY*(kI*kL-kH*kM));kP[5]=(kW*(kM*kR-kL*kV)-kO*(kT*kR-kQ*kV)+kY*(kT*kL-kQ*kM));kP[6]=-(kW*(kI*kR-kH*kV)-kK*(kT*kR-kQ*kV)+kY*(kT*kH-kQ*kI));kP[7]=(kW*(kI*kL-kH*kM)-kK*(kT*kL-kQ*kM)+kO*(kT*kH-kQ*kI));kP[8]=(kK*(kN*kR-kL*kX)-kO*(kJ*kR-kH*kX)+kY*(kJ*kL-kH*kN));kP[9]=-(kW*(kN*kR-kL*kX)-kO*(kU*kR-kQ*kX)+kY*(kU*kL-kQ*kN));kP[10]=(kW*(kJ*kR-kH*kX)-kK*(kU*kR-kQ*kX)+kY*(kU*kH-kQ*kJ));kP[11]=-(kW*(kJ*kL-kH*kN)-kK*(kU*kL-kQ*kN)+kO*(kU*kH-kQ*kJ));kP[12]=-(kK*(kN*kV-kM*kX)-kO*(kJ*kV-kI*kX)+kY*(kJ*kM-kI*kN));kP[13]=(kW*(kN*kV-kM*kX)-kO*(kU*kV-kT*kX)+kY*(kU*kM-kT*kN));kP[14]=-(kW*(kJ*kV-kI*kX)-kK*(kU*kV-kT*kX)+kY*(kU*kI-kT*kJ));kP[15]=(kW*(kJ*kM-kI*kN)-kK*(kU*kM-kT*kN)+kO*(kU*kI-kT*kJ));return kP};e.determinant=function(k2){var k7=k2[0],k5=k2[1],k3=k2[2],k1=k2[3],kK=k2[4],kJ=k2[5],kI=k2[6],kH=k2[7],kY=k2[8],kX=k2[9],kW=k2[10],kV=k2[11],k9=k2[12],k8=k2[13],k6=k2[14],k4=k2[15],kU=k7*kJ-k5*kK,kT=k7*kI-k3*kK,kS=k7*kH-k1*kK,kR=k5*kI-k3*kJ,kQ=k5*kH-k1*kJ,kP=k3*kH-k1*kI,kO=kY*k8-kX*k9,kN=kY*k6-kW*k9,kM=kY*k4-kV*k9,kL=kX*k6-kW*k8,k0=kX*k4-kV*k8,kZ=kW*k4-kV*k6;return kU*kZ-kT*k0+kS*kL+kR*kM-kQ*kN+kP*kO};e.multiply=function(kT,kX,kU){var k1=kX[0],k0=kX[1],kY=kX[2],kV=kX[3],kN=kX[4],kL=kX[5],kJ=kX[6],kH=kX[7],kS=kX[8],kR=kX[9],kQ=kX[10],kP=kX[11],k3=kX[12],k2=kX[13],kZ=kX[14],kW=kX[15];var kO=kU[0],kM=kU[1],kK=kU[2],kI=kU[3];kT[0]=kO*k1+kM*kN+kK*kS+kI*k3;kT[1]=kO*k0+kM*kL+kK*kR+kI*k2;kT[2]=kO*kY+kM*kJ+kK*kQ+kI*kZ;kT[3]=kO*kV+kM*kH+kK*kP+kI*kW;kO=kU[4];kM=kU[5];kK=kU[6];kI=kU[7];kT[4]=kO*k1+kM*kN+kK*kS+kI*k3;kT[5]=kO*k0+kM*kL+kK*kR+kI*k2;kT[6]=kO*kY+kM*kJ+kK*kQ+kI*kZ;kT[7]=kO*kV+kM*kH+kK*kP+kI*kW;kO=kU[8];kM=kU[9];kK=kU[10];kI=kU[11];kT[8]=kO*k1+kM*kN+kK*kS+kI*k3;kT[9]=kO*k0+kM*kL+kK*kR+kI*k2;kT[10]=kO*kY+kM*kJ+kK*kQ+kI*kZ;kT[11]=kO*kV+kM*kH+kK*kP+kI*kW;kO=kU[12];kM=kU[13];kK=kU[14];kI=kU[15];kT[12]=kO*k1+kM*kN+kK*kS+kI*k3;kT[13]=kO*k0+kM*kL+kK*kR+kI*k2;kT[14]=kO*kY+kM*kJ+kK*kQ+kI*kZ;kT[15]=kO*kV+kM*kH+kK*kP+kI*kW;return kT};e.mul=e.multiply;e.translate=function(kT,kV,kO){var kN=kO[0],kM=kO[1],kL=kO[2],kY,kX,kW,kU,kK,kJ,kI,kH,kS,kR,kQ,kP;if(kV===kT){kT[12]=kV[0]*kN+kV[4]*kM+kV[8]*kL+kV[12];kT[13]=kV[1]*kN+kV[5]*kM+kV[9]*kL+kV[13];kT[14]=kV[2]*kN+kV[6]*kM+kV[10]*kL+kV[14];kT[15]=kV[3]*kN+kV[7]*kM+kV[11]*kL+kV[15]}else{kY=kV[0];kX=kV[1];kW=kV[2];kU=kV[3];kK=kV[4];kJ=kV[5];kI=kV[6];kH=kV[7];kS=kV[8];kR=kV[9];kQ=kV[10];kP=kV[11];kT[0]=kY;kT[1]=kX;kT[2]=kW;kT[3]=kU;kT[4]=kK;kT[5]=kJ;kT[6]=kI;kT[7]=kH;kT[8]=kS;kT[9]=kR;kT[10]=kQ;kT[11]=kP;kT[12]=kY*kN+kK*kM+kS*kL+kV[12];kT[13]=kX*kN+kJ*kM+kR*kL+kV[13];kT[14]=kW*kN+kI*kM+kQ*kL+kV[14];kT[15]=kU*kN+kH*kM+kP*kL+kV[15]}return kT};e.scale=function(kK,kI,kJ){var kH=kJ[0],kM=kJ[1],kL=kJ[2];kK[0]=kI[0]*kH;kK[1]=kI[1]*kH;kK[2]=kI[2]*kH;kK[3]=kI[3]*kH;kK[4]=kI[4]*kM;kK[5]=kI[5]*kM;kK[6]=kI[6]*kM;kK[7]=kI[7]*kM;kK[8]=kI[8]*kL;kK[9]=kI[9]*kL;kK[10]=kI[10]*kL;kK[11]=kI[11]*kL;kK[12]=kI[12];kK[13]=kI[13];kK[14]=kI[14];kK[15]=kI[15];return kK};e.rotate=function(k1,k8,la,kH){var kR=kH[0],kQ=kH[1],kP=kH[2],k2=Math.sqrt(kR*kR+kQ*kQ+kP*kP),kW,k6,kV,lc,lb,k9,k7,kO,kN,kM,kL,k0,kZ,kY,kX,kU,kT,kS,k5,k4,k3,kK,kJ,kI;if(Math.abs(k2)<kG){return null}k2=1/k2;kR*=k2;kQ*=k2;kP*=k2;kW=Math.sin(la);k6=Math.cos(la);kV=1-k6;lc=k8[0];lb=k8[1];k9=k8[2];k7=k8[3];kO=k8[4];kN=k8[5];kM=k8[6];kL=k8[7];k0=k8[8];kZ=k8[9];kY=k8[10];kX=k8[11];kU=kR*kR*kV+k6;kT=kQ*kR*kV+kP*kW;kS=kP*kR*kV-kQ*kW;k5=kR*kQ*kV-kP*kW;k4=kQ*kQ*kV+k6;k3=kP*kQ*kV+kR*kW;kK=kR*kP*kV+kQ*kW;kJ=kQ*kP*kV-kR*kW;kI=kP*kP*kV+k6;k1[0]=lc*kU+kO*kT+k0*kS;k1[1]=lb*kU+kN*kT+kZ*kS;k1[2]=k9*kU+kM*kT+kY*kS;k1[3]=k7*kU+kL*kT+kX*kS;k1[4]=lc*k5+kO*k4+k0*k3;k1[5]=lb*k5+kN*k4+kZ*k3;k1[6]=k9*k5+kM*k4+kY*k3;k1[7]=k7*k5+kL*k4+kX*k3;k1[8]=lc*kK+kO*kJ+k0*kI;k1[9]=lb*kK+kN*kJ+kZ*kI;k1[10]=k9*kK+kM*kJ+kY*kI;k1[11]=k7*kK+kL*kJ+kX*kI;if(k8!==k1){k1[12]=k8[12];k1[13]=k8[13];k1[14]=k8[14];k1[15]=k8[15]}return k1};e.rotateX=function(kH,kO,kN){var kT=Math.sin(kN),kM=Math.cos(kN),kS=kO[4],kR=kO[5],kQ=kO[6],kP=kO[7],kL=kO[8],kK=kO[9],kJ=kO[10],kI=kO[11];if(kO!==kH){kH[0]=kO[0];kH[1]=kO[1];kH[2]=kO[2];kH[3]=kO[3];kH[12]=kO[12];kH[13]=kO[13];kH[14]=kO[14];kH[15]=kO[15]}kH[4]=kS*kM+kL*kT;kH[5]=kR*kM+kK*kT;kH[6]=kQ*kM+kJ*kT;kH[7]=kP*kM+kI*kT;kH[8]=kL*kM-kS*kT;kH[9]=kK*kM-kR*kT;kH[10]=kJ*kM-kQ*kT;kH[11]=kI*kM-kP*kT;return kH};e.rotateY=function(kL,kS,kR){var kT=Math.sin(kR),kQ=Math.cos(kR),kK=kS[0],kJ=kS[1],kI=kS[2],kH=kS[3],kP=kS[8],kO=kS[9],kN=kS[10],kM=kS[11];if(kS!==kL){kL[4]=kS[4];kL[5]=kS[5];kL[6]=kS[6];kL[7]=kS[7];kL[12]=kS[12];kL[13]=kS[13];kL[14]=kS[14];kL[15]=kS[15]}kL[0]=kK*kQ-kP*kT;kL[1]=kJ*kQ-kO*kT;kL[2]=kI*kQ-kN*kT;kL[3]=kH*kQ-kM*kT;kL[8]=kK*kT+kP*kQ;kL[9]=kJ*kT+kO*kQ;kL[10]=kI*kT+kN*kQ;kL[11]=kH*kT+kM*kQ;return kL};e.rotateZ=function(kL,kO,kN){var kT=Math.sin(kN),kM=Math.cos(kN),kK=kO[0],kJ=kO[1],kI=kO[2],kH=kO[3],kS=kO[4],kR=kO[5],kQ=kO[6],kP=kO[7];if(kO!==kL){kL[8]=kO[8];kL[9]=kO[9];kL[10]=kO[10];kL[11]=kO[11];kL[12]=kO[12];kL[13]=kO[13];kL[14]=kO[14];kL[15]=kO[15]}kL[0]=kK*kM+kS*kT;kL[1]=kJ*kM+kR*kT;kL[2]=kI*kM+kQ*kT;kL[3]=kH*kM+kP*kT;kL[4]=kS*kM-kK*kT;kL[5]=kR*kM-kJ*kT;kL[6]=kQ*kM-kI*kT;kL[7]=kP*kM-kH*kT;return kL};e.fromRotationTranslation=function(kU,kS,kQ){var kN=kS[0],kM=kS[1],kL=kS[2],kO=kS[3],kV=kN+kN,kH=kM+kM,kP=kL+kL,kK=kN*kV,kJ=kN*kH,kI=kN*kP,kT=kM*kH,kR=kM*kP,kY=kL*kP,kZ=kO*kV,kX=kO*kH,kW=kO*kP;kU[0]=1-(kT+kY);kU[1]=kJ+kW;kU[2]=kI-kX;kU[3]=0;kU[4]=kJ-kW;kU[5]=1-(kK+kY);kU[6]=kR+kZ;kU[7]=0;kU[8]=kI+kX;kU[9]=kR-kZ;kU[10]=1-(kK+kT);kU[11]=0;kU[12]=kQ[0];kU[13]=kQ[1];kU[14]=kQ[2];kU[15]=1;return kU};e.fromQuat=function(kR,kO){var kL=kO[0],kK=kO[1],kJ=kO[2],kM=kO[3],kS=kL+kL,kH=kK+kK,kN=kJ+kJ,kI=kL*kS,kQ=kK*kS,kP=kK*kH,kY=kJ*kS,kX=kJ*kH,kV=kJ*kN,kW=kM*kS,kU=kM*kH,kT=kM*kN;kR[0]=1-kP-kV;kR[1]=kQ+kT;kR[2]=kY-kU;kR[3]=0;kR[4]=kQ-kT;kR[5]=1-kI-kV;kR[6]=kX+kW;kR[7]=0;kR[8]=kY+kU;kR[9]=kX-kW;kR[10]=1-kI-kP;kR[11]=0;kR[12]=0;kR[13]=0;kR[14]=0;kR[15]=1;return kR};e.frustum=function(kL,kI,kQ,kH,kP,kN,kM){var kO=1/(kQ-kI),kK=1/(kP-kH),kJ=1/(kN-kM);kL[0]=(kN*2)*kO;kL[1]=0;kL[2]=0;kL[3]=0;kL[4]=0;kL[5]=(kN*2)*kK;kL[6]=0;kL[7]=0;kL[8]=(kQ+kI)*kO;kL[9]=(kP+kH)*kK;kL[10]=(kM+kN)*kJ;kL[11]=-1;kL[12]=0;kL[13]=0;kL[14]=(kM*kN*2)*kJ;kL[15]=0;return kL};e.perspective=function(kK,kJ,kI,kL,kH){var kN=1/Math.tan(kJ/2),kM=1/(kL-kH);kK[0]=kN/kI;kK[1]=0;kK[2]=0;kK[3]=0;kK[4]=0;kK[5]=kN;kK[6]=0;kK[7]=0;kK[8]=0;kK[9]=0;kK[10]=(kH+kL)*kM;kK[11]=-1;kK[12]=0;kK[13]=0;kK[14]=(2*kH*kL)*kM;kK[15]=0;return kK};e.ortho=function(kK,kI,kQ,kH,kO,kN,kM){var kL=1/(kI-kQ),kP=1/(kH-kO),kJ=1/(kN-kM);kK[0]=-2*kL;kK[1]=0;kK[2]=0;kK[3]=0;kK[4]=0;kK[5]=-2*kP;kK[6]=0;kK[7]=0;kK[8]=0;kK[9]=0;kK[10]=2*kJ;kK[11]=0;kK[12]=(kI+kQ)*kL;kK[13]=(kO+kH)*kP;kK[14]=(kM+kN)*kJ;kK[15]=1;return kK};e.lookAt=function(kV,k2,k3,kN){var k1,k0,kY,kJ,kI,kH,kQ,kP,kO,kW,kZ=k2[0],kX=k2[1],kU=k2[2],kM=kN[0],kL=kN[1],kK=kN[2],kT=k3[0],kS=k3[1],kR=k3[2];if(Math.abs(kZ-kT)<kG&&Math.abs(kX-kS)<kG&&Math.abs(kU-kR)<kG){return e.identity(kV)}kQ=kZ-kT;kP=kX-kS;kO=kU-kR;kW=1/Math.sqrt(kQ*kQ+kP*kP+kO*kO);kQ*=kW;kP*=kW;kO*=kW;k1=kL*kO-kK*kP;k0=kK*kQ-kM*kO;kY=kM*kP-kL*kQ;kW=Math.sqrt(k1*k1+k0*k0+kY*kY);if(!kW){k1=0;k0=0;kY=0}else{kW=1/kW;k1*=kW;k0*=kW;kY*=kW}kJ=kP*kY-kO*k0;kI=kO*k1-kQ*kY;kH=kQ*k0-kP*k1;kW=Math.sqrt(kJ*kJ+kI*kI+kH*kH);if(!kW){kJ=0;kI=0;kH=0}else{kW=1/kW;kJ*=kW;kI*=kW;kH*=kW}kV[0]=k1;kV[1]=kJ;kV[2]=kQ;kV[3]=0;kV[4]=k0;kV[5]=kI;kV[6]=kP;kV[7]=0;kV[8]=kY;kV[9]=kH;kV[10]=kO;kV[11]=0;kV[12]=-(k1*kZ+k0*kX+kY*kU);kV[13]=-(kJ*kZ+kI*kX+kH*kU);kV[14]=-(kQ*kZ+kP*kX+kO*kU);kV[15]=1;return kV};e.str=function(kH){return"mat4("+kH[0]+", "+kH[1]+", "+kH[2]+", "+kH[3]+", "+kH[4]+", "+kH[5]+", "+kH[6]+", "+kH[7]+", "+kH[8]+", "+kH[9]+", "+kH[10]+", "+kH[11]+", "+kH[12]+", "+kH[13]+", "+kH[14]+", "+kH[15]+")"};e.frob=function(kH){return(Math.sqrt(Math.pow(kH[0],2)+Math.pow(kH[1],2)+Math.pow(kH[2],2)+Math.pow(kH[3],2)+Math.pow(kH[4],2)+Math.pow(kH[5],2)+Math.pow(kH[6],2)+Math.pow(kH[6],2)+Math.pow(kH[7],2)+Math.pow(kH[8],2)+Math.pow(kH[9],2)+Math.pow(kH[10],2)+Math.pow(kH[11],2)+Math.pow(kH[12],2)+Math.pow(kH[13],2)+Math.pow(kH[14],2)+Math.pow(kH[15],2)))};kC.mat4=e})(window);function cm(){this.result={bkData:[],eleData:[[],[],[],[],[],[],[],[],[],[]],tileLabels:[]}}e9.extend(cm.prototype,{createLayer:function(T,i){var e=this.result.bkData;if(!e[T]){e[T]=[[],[],[]]}this.updateLayer(T,i)},removeLayer:function(i){var e=this.result.bkData;e[i]=null},updateLayer:function(T,i){var e=this.result.bkData;if(!e[T]){return}i=i||{};e[T].tileTypeName=i.tileTypeName||"na";e[T].dataType=i.dataType||2;e[T].png8=i.png8||false;e[T].pack=i.pack||false;e[T].isTop=i.isTop||false;e[T].isLowText=i.isLowText||false;e[T].clipTile=i.clipTile||false;e[T].boundary=i.boundary||false;if(i.ontology){e[T].ontology=i.ontology}},updateLayerMeta:function(kA,T){var e=this.result.bkData;if(!e[kA]){return}T=T||{};var kB=Object.keys(T);for(var kz=0;kz<kB.length;kz++){if(T.hasOwnProperty(kB[kz])){e[kA][kB[kz]]=T[kB[kz]]}}},hasLayerBoundary:function(){var e=this.result.bkData;var T=false;for(var kz=0;kz<e.length;kz++){if(e[kz]&&e[kz].boundary){T=true;break}}return T},getResult:function(){return this.result},setData:function(kB,kA,kC){var e=this.result.bkData;var T=e[kA]?e[kA][kC]:null;if(!T){return}for(var kz=0;kz<T.length;kz++){if(T[kz].key&&T[kz].key===kB.key){T[kz]=kB;return}}T.push(kB)},setLabelData:function(T,i){var e=this.result.tileLabels;e[i||0]=T},getLabelData:function(i){var e=this.result.tileLabels;if(i===undefined){return e}return e[i]||[]},clearLabelData:function(i){var e=this.result.tileLabels;if(i===undefined){e=[];return}e[i]=[]},setOverlayData:function(T,e,i){if(!this.result.eleData[e]){return}if(e>=2&&e<=4){this.result.eleData[e][i||0]=T;return}else{if(e===0||e===5||e===6){T.sort(function(kA,kz){return kA.overlay.zIndex-kz.overlay.zIndex})}}this.result.eleData[e]=T},clearLabelOverlayData:function(e){if(e===undefined){this.result.eleData[2]=[];this.result.eleData[3]=[];this.result.eleData[4]=[]}this.result.eleData[2][e]=[];this.result.eleData[3][e]=[];this.result.eleData[4][e]=[]},clearData:function(kz){var e=this.result.bkData;if(typeof kz==="number"){if(e[kz]){e[kz][0]=[];e[kz][1]=[];e[kz][2]=[]}return}for(var T=0;T<e.length;T++){if(!e[T]){continue}e[T][0]=[];e[T][1]=[];e[T][2]=[]}},sortThumbData:function(i){var e=this.result.bkData;var T=e[i];if(!T){return}if(T[0]&&T[0].length>0){T[0].sort(function(kA,kz){return kA.tileInfo.useZoom-kz.tileInfo.useZoom})}}});var gD=(function(){var kJ=new Int8Array(4);var T=new Int32Array(kJ.buffer,0,1);var kE=new Float32Array(kJ.buffer,0,1);function kL(kS){T[0]=kS;return kE[0]}function i(kS){kE[0]=kS;return T[0]}function kF(kS){var kU=(kS[3]<<24|kS[2]<<16|kS[1]<<8|kS[0]);var kT=kL(kU&4278190079);return kT}var kA=0;var kD=1;var kH=2;var kP=0;var kM=1;var kK=2;var kB=9;function kI(kS,kT){var kU;if(kT%2===0){kU=[-kS[1],kS[0]]}else{kU=[kS[1],-kS[0]]}return kU}function e(kS,kT,kU){var kV=kI(kS,kT);var kW;if(kU===kD){return kV}else{if(kT===4||kT===5){kW=[kV[0]-kS[0],kV[1]-kS[1]]}else{kW=[kV[0]+kS[0],kV[1]+kS[1]]}if(kU===kA){vec2.normalize(kW,kW)}return kW}}function kO(kT,kS){return Math.sqrt(Math.pow(kT[0]-kS[0],2)+Math.pow(kT[1]-kS[1],2))}function kz(kW,kV,kU,kS){var kT=vec2.dot(kW,kV);if(kU===kK||kU===kM){if((kS===0||kS===1)&&kT>0){return true}else{if((kS===2||kS===3)&&kT<0){return true}}}if((kS===0||kS===1)&&kT<0){return true}else{if((kS===2||kS===3)&&kT>0){return true}}return false}function kG(kT,kY,k0){var kZ=kI(kT,kY);var kV;var kX=kT;var kW=k0;var k2=[];vec2.normalize(k2,[kX[0]+kW[0],kX[1]+kW[1]]);var k1=vec2.dot(kZ,[-k2[1],k2[0]]);if(Math.abs(k1)<0.1){k1=1}var kU=1/k1;kV=[-k2[1]*kU,k2[0]*kU];var kS=vec2.dot(kT,kV);if(kS<0){vec2.negate(kV,kV)}return{cos2:kS,offset:kV}}function kR(kT,kY,k0,kS){var kZ=kI(kT,kY);var kX;var kW;var kV;if(kY===0||kY===1){kX=k0;kW=kT}else{kX=kT;kW=k0}if(!kX||!kW){return kZ}var k2=[kX[0]+kW[0],kX[1]+kW[1]];if(k2[0]===0&&k2[1]===0){vec2.normalize(k2,kW)}else{vec2.normalize(k2,k2)}var k3=kz(k2,kZ,kS,kY);if(k3){return kZ}var k1=vec2.dot(kZ,[-k2[1],k2[0]]);if(Math.abs(k1)<0.1){k1=1}var kU=1/k1;kV=[-k2[1]*kU,k2[0]*kU];return kV}function kQ(k3,k4,kX,kW,k5,k2,kV,kY,kU,k1){var k0;var kT=0;var kS=false;k0=k2.length/kB-1;kC(k4[0],k3[0],kX[0],k5,kW,4,kY,kU,undefined,k2,k1);k0++;kT++;kC(k4[0],k3[0],kX[0],k5,kW,5,kY,kU,undefined,k2,k1);k0++;kT++;for(var kZ=0;kZ<k3.length;kZ++){kC(k4[kZ],k3[kZ],kX[kZ],k5,kW,0,kY,kU,k3[kZ-1],k2,k1);kN(kV,++k0,++kT,kS);kC(k4[kZ],k3[kZ],kX[kZ],k5,kW,1,kY,kU,k3[kZ-1],k2,k1);kN(kV,++k0,++kT,kS);kC(k4[kZ+1],k3[kZ],kX[kZ+1],k5,kW,2,kY,kU,k3[kZ+1],k2,k1);kN(kV,++k0,++kT,kS);kC(k4[kZ+1],k3[kZ],kX[kZ+1],k5,kW,3,kY,kU,k3[kZ+1],k2,k1);kN(kV,++k0,++kT,kS);if(kW===kM&&kZ!==k3.length-1){kC(k4[kZ+1],k3[kZ],kX[kZ+1],k5,kW,8,kY,kU,k3[kZ+1],k2,k1);kN(kV,++k0,++kT,kS);kS=kS?false:true}}kC(k4[k4.length-1],k3[k3.length-1],kX[k4.length-1],k5,kW,6,kY,kU,undefined,k2,k1);kN(kV,++k0,++kT,kS);kC(k4[k4.length-1],k3[k3.length-1],kX[k4.length-1],k5,kW,7,kY,kU,undefined,k2,k1);kN(kV,++k0,++kT,kS)}function kC(k5,kV,kZ,k6,kU,k0,kX,kT,k3,k2,k1){var k4=k0%2===0?1:-1;var kY;if(k0===4||k0===5||k0===6||k0===7){kY=e(kV,k0,k6)}else{if(k0===0||k0===1||k0===2||k0===3){kY=kR(kV,k0,k3,kU)}else{if(k0===8){var kW=kG(kV,k0,k3);kY=kW.offset;vec2.normalize(kY,kY);var kS=kW.cos2;if(kS<0){k4=-k4}}}}k2[k2.length]=k5[0]*10;k2[k2.length]=k5[1]*10;k2[k2.length]=kY[0]*kT*10;k2[k2.length]=kY[1]*kT*10;k2[k2.length]=kX;k2[k2.length]=k4;k2[k2.length]=0;k2[k2.length]=k1||0;k2[k2.length]=kZ}function kN(kW,kU,kS,kV){var kT;if(kS%2===0){if(kV){kW[kW.length]=kU-2;kW[kW.length]=kU-1;kW[kW.length]=kU}else{kW[kW.length]=kU-1;kW[kW.length]=kU-2;kW[kW.length]=kU}}else{if(kV){kW[kW.length]=kU-1;kW[kW.length]=kU-2;kW[kW.length]=kU}else{kW[kW.length]=kU-2;kW[kW.length]=kU-1;kW[kW.length]=kU}}}return{getVertexCount:function(kT,kS){if(kS===kM){return kT*5-2}else{return kT*4}},buildData:function(k4,kU,k5,k0,kS,kX,kT,k1,k3){var k2=[];var kZ=k3?k3:0;var kW=[kZ*10];for(var kY=0;kY<k4.length;kY++){if(kY>0){kZ+=kO(k4[kY],k4[kY-1]);kW.push(kZ*10)}if(kY!==k4.length-1){var kV=[k4[kY+1][0]-k4[kY][0],k4[kY+1][1]-k4[kY][1]];var k6=[];if(kV[0]===0&&kV[1]===0){k6=[0,0]}else{vec2.normalize(k6,kV)}k2[k2.length]=[k6[0],k6[1]]}}return kQ(k2,k4,kW,kU,k5,k0,kS,kF(kX),kT,k1)},toTileSolidLineVertices:function(kW,kT){var kU=new Float32Array(kW.length/kB*5);var kS=new Int16Array(kU.buffer);var kY=0;var kV=0;for(var kX=0;kX<kW.length;kX+=kB){kS[kY]=~~kW[kX];kS[kY+1]=~~kW[kX+1];kS[kY+2]=~~kW[kX+2];kS[kY+3]=~~kW[kX+3];kU[kV+2]=kW[kX+4];kS[kY+6]=kW[kX+5];kS[kY+7]=kT?kT:0;kS[kY+8]=kW[kX+7];kS[kY+9]=0;kY+=10;kV+=5}return kU}}})();var gW=1;var h2=2;var fr={drawIndex:0,devicePixelRatio:gt(),zoomState:1,curViewTilesInfo:null,iconSetImg:null,LAST_CALC_ZOOM:-1,LAST_LOAD_VECTOR_ZOOM_CHANGE:false,lastCollisionTestTime:0,remove:function(){this.tileCache.clear();this.removeLabel(this.drawIndex);if(this.tileLabels){this.tileLabels=[]}},removeLabel:function(i){if(this.dataType===2&&((this.tileType&&this.tileType.getName()==="na")||(this.ontology&&this.ontology instanceof ek))){this.map._featureMgr.clearData(i);this.map._featureMgr.clearLabelOverlayData(i);this.map._featureMgr.clearLabelData(i);var T=new fW("onspotsdataremove");T.index=i;this.map.dispatchEvent(T);if(this.ontology&&this.ontology instanceof ek){this.clearCache();return}var e=new fW("onlayer_update");e.name="na";this.map.fire(e)}},initDrawData:function(){this.drawIndex=this.zIndex;var e={tileTypeName:this.tileType.getName(),dataType:this.dataType,png8:this.png8,pack:this.pack,isTop:this.isTop||false,isLowText:this.isLowText||false,clipTile:this.clipTile,boundary:this.boundary};if(this.ontology){e.ontology=this.ontology}this.map._featureMgr.createLayer(this.drawIndex,e);this.dispatchEvent(new fW("oninitDrawData"))},destroyDrawData:function(){this.map._featureMgr.removeLayer(this.drawIndex);var i=new fW("onremoveLayerMask");i.hasLayerBoundary=this.map._featureMgr.hasLayerBoundary();this.map.dispatchEvent(i)},setZIndex:function(kD){kD=Math.abs(Math.floor(kD))||1;if(!kD||kD===this.zIndex){return}var kA=this.map._featureMgr.result.bkData;var kz=this.map.tileMgr.tileLayers;var kF=this.map._normalLayerMgr.layers;function kG(kL){var kJ=null;var kK=[kz,kF];for(var kH=0;kH<kK.length;kH++){for(var kI=0;kI<kK[kH].length;kI++){if(kK[kH][kI].zIndex===kL){kJ=kK[kH][kI];break}}if(kJ){break}}return kJ}var T=[];var kC=[];var kE=this.zIndex;var i=kG(kD);if(kA[kD]&&i){T.push(i);kC.push(kA[kD]);this.setTargetZIndex(kD);kA[kD]=kA[kE];kA[kE]=null}else{this.setTargetZIndex(kD);kA[kD]=kA[kE];kA[kE]=null;this.map.dispatchEvent(new fW("onupdate"));return}var kB=kD+1;while(kB){var e=kG(kB);if(kA[kB]&&e){T.push(e);kC.push(kA[kB]);T.shift().setTargetZIndex(kB);kA[kB]=kC.shift();kB+=1}else{T.shift().setTargetZIndex(kB);kA[kB]=kC.shift();kB=0}}this.map.dispatchEvent(new fW("onupdate"))},setZIndexTop:function(){var e=this.map._featureMgr.result.bkData;e[e.length]=e[this.zIndex];e[this.zIndex]=null;this.setTargetZIndex(e.length-1);this.map.dispatchEvent(new fW("onrefresh"))},setUpLevel:function(){var e=this._getAdjoinZIndex("up");if(this.zIndex!==e){this.setZIndex(e)}},setDownLevel:function(){var e=this._getAdjoinZIndex("down");if(this.zIndex!==e){this.setZIndex(e)}},getTileKey:function(e,kz){kz=kz||{};var i=typeof kz.useZoom==="number"?kz.useZoom:e.useZoom;var T=e.style||this.mapStyleId||"default";return this.mapType+"_"+T+"_"+e.col+"_"+e.row+"_"+e.zoom+"_"+i},getTileRenderDataKey:function(i){var T=i.col;var kz=i.zoom;var e=i.baseTileSize;T=fc.calcLoopParam(T,kz,e).col;return this.mapType+"_"+T+"_"+i.row+"_"+kz+"_"+i.useZoom},getTileUnits:function(e){var kz=this.map;var T=ev[kz.getMapType()];var i=T.baseUnits*Math.pow(2,T.zoomLevelBase-e);return i},getTilesUrl:function(kA,kJ,kK){var i=kA.x;var kL=kA.y;var kG=ka("ditu","normal");var kC=kG.ver;var kD=kG.udt;i=fc.calcLoopParam(i,kJ,kK).col;var kI=ev.B_NORMAL_MAP.vectorTileUrls;var kB=Math.abs(i+kL)%kI.length;var kH=kI[kB];if(window.offLineIPAddress){kI=[window.offLineIPAddress+"pvd/"];kH=kI[0]}var T="x="+i+"&y="+kL+"&z="+Math.floor(kJ);var kF=this.devicePixelRatio>1?"&scaler=2":"";var kE="&textimg=1";if(this.map.config.textRenderType==="canvas"){kE="&textimg=0"}var kz=this.map.config.style;if(typeof kz==="string"&&kz!=="default"){T+="&styleId="+E.mapStyleNameIdPair[kz]}T+="&styles=pl"+kE+kF+"&v="+kC+"&udt="+kD+"&json=0";var e=kH+"?qt=vtile&param="+window.encodeURIComponent(e5(T));return e},getRasterTilesUrl:function(T,kB,kz){var kA=ev[this.map.mapType];var i=this.map.config.style;var e=kA.tileUrls[Math.abs(kB+T)%kA.tileUrls.length]+"?qt=tile&x="+T+"&y="+kB+"&z="+kz+((i==="default"||typeof i!=="string")?"":("&styleId="+E.mapStyleNameIdPair[i]))+"&styles=pl&udt="+this.normalUdt+"&scaler="+this.scaler+"&p=1";e=e.replace(/-(\d+)/gi,"M$1");return e},getZoomState:function(){var T=this.map;var i=T.getZoom();var e=i-this.lastZoom;if(e>0){this.zoomState=1}else{if(e<0){this.zoomState=-1}}this.lastZoom=i;return this.zoomState},releaseOutViewTileData:function(e){var kA=this.map._workerMgr.releasePendingData(e);for(var kz=0,T=kA.length;kz<T;kz++){var kB=this.getTileKey(kA[kz]);this.tileCache.removeData(kB);this._checkTilesLoaded()}},loadLayerData:function(e,kz,i){this.hasZoomChange=i;this.curViewTilesInfo=e;if(this.ontology instanceof ek){this.loadTileData&&this.loadTileData(e,kz);return}this.mapStyleId=this.map.getMapStyleId();this.releaseOutViewTileData(e);var T=this.getZoomState();if(this.dataType===h2){if(kz){this.getVectorLayerDataFromCache(e,T)}else{this.loadVectorLayerData(e)}}else{this.loadRasterLayerData(e,kz)}},getVectorLayerDataFromCache:function(kF,kR){this.map.temp.isPermitSpotOver=false;this.tileLabels=[];var kU=this.map._displayOptions;if(this.mapType===BMAP_NORMAL_MAP){var kJ=this.map._customLabelMgr.virtualTiles.custom;if(kJ&&kJ instanceof Array){for(var kP=0;kP<kJ.length;kP++){this.tileLabels.push(kJ[kP].label);if(!kJ[kP].label.iconReady){var kL=false;var kT=kJ[kP].label.fixedLabel;for(var kN=0;kN<kT.length;kN++){var kE=kT[kN];if(!kE.iconPos){continue}else{if(!kE.iconPos.texcoord){kL=true;break}}}if(!kL){kJ[kP].label.iconReady=true}else{kJ[kP].label.iconReady=false;this.updateAllIconsTextureCoords(kJ[kP])}}}}}this.thumbCache={};var kS=-1;for(var kP=0,kK=kF.length;kP<kK;kP++){var kQ=kF[kP];var kA=kQ.col;var kB=kQ.row;var T=kQ.zoom;var kM=this._getTileTexImgKey(kQ);var kz=kQ.useZoom;kS=T;var kC=this.getTileKey(kQ);var kW=this.tileCache.getData(kC);if(kW&&kW.status==="ready"){var kX=kW;this.map._featureMgr.setData(kW,this.drawIndex,2);if(kU.poi&&kW.label){if(kW.label.status==="ready"){kW.label.tileInfo=kW.tileInfo;this.tileLabels.push(kW.label);if(kW.label.textureSources&&kW.label.textureSources[kz]&&this.map._webglMapScene){var kV=this.map._webglMapScene._painter;if(!kV._labelTextureAtlasOffset[kM]){kV._addToAsyncJob(kW.label.textureSources[kz])}}}else{if(kW.label.status!=="processing"){this.processLabelData(kW)}}}}else{var kO={tileInfo:kQ,dataType:h2,key:kC};this.map._featureMgr.setData(kO,this.drawIndex,2);if(this.useThumbData){this.setThumbData(kA,kB,T,kz,kR)}}}this.tileLabels.labelZoom=kS;this.updateLabels(kR);var kG=this.map.getZoom();var kD=Math.floor(kG);var kI=kG-kD;var kH=Math.floor(this.LAST_CALC_ZOOM);var e=this.LAST_CALC_ZOOM-kH;var kY=false;if(this.hasZoomChange){if(Math.abs(kG-this.LAST_CALC_ZOOM)>=0.5){kY=true}else{if(kI<0.5&&e>=0.5){kY=true}else{if(kI>=0.5&&e<0.5){kY=true}}}if(kY){this.cacheDataCollideLabels(0)}this.LAST_CALC_ZOOM=kG}else{if(this.tileLabels.length>0){this.cacheDataCollideLabels(e9.Browser.ie?50:30)}}},loadVectorLayerData:function(kF){this.map.temp.isPermitSpotOver=false;var kE=this;function kD(i,kG){var kI=kE.tileCache.getData(kG);if(!kI){return}if(!i||i.error){i.event&&bG.fetchDebug&&bG.fetchDebug.sendError({title:i.event.title,msg:i.event.msg,category:bG.fetchDebug.category.AJAX,level:bG.fetchDebug.levels.ERROR,url:i.event.title});var kH=new fW("ontileloaderror");i=i||{};kH.error=i.error||"";kH.message=i.message||"";kE.map.fire(kH);kI.status="init";kI.reloadTimer=setTimeout(function(){if(kI.retry<3){kI.retry++;kI.status="loading";kE.loadVectorTileData(i.tileInfo,kD)}else{kE.tileCache.removeData(kG);kE._checkTilesLoaded()}},4000);if(kE.map._featureMgr){kE.map._featureMgr.clearData(kE.drawIndex)}kE.getVectorLayerDataFromCache(kE.curViewTilesInfo,kE.getZoomState());return}if(kI.reloadTimer){clearTimeout(kI.reloadTimer);kI.reloadTimer=null}kE.callbackDataQueue.push([i,kG]);if(kE.processDataTimer){return}kE.processDataTimer=setTimeout(function(){while(kE.callbackDataQueue.length>0){var kK=kE.callbackDataQueue.shift();kE.vectorTileDataCbk(kK[0],kK[1]);kE._checkTilesLoaded()}if(kE.map._featureMgr){kE.map._featureMgr.clearData(kE.drawIndex)}kE.getVectorLayerDataFromCache(kE.curViewTilesInfo,kE.getZoomState());var kJ=new fW("onrefresh");kJ.source="webgllayer";kE.map.dispatchEvent(kJ);kE.processDataTimer=null},200)}for(var kC=0,kA=kF.length;kC<kA;kC++){var T=kF[kC];var kB=this.getTileKey(T);var e=this.tileCache.getData(kB);if(!e){e={status:"init",tileInfo:T,dataType:h2,key:kB,retry:0}}if(e.status!=="ready"&&e.status!=="loading"){this.numLoading++;this.numTileLoading++;e.status="loading";this.tileCache.setData(kB,e);var kz=this.getProcessedLabelZoom(T);if(kz){T.processedLabelZooms=kz}this.loadVectorTileData(T,kD)}}},setThumbData:function(i,kA,kz,e,T){if(T===1){if(this._findParentZoomTile(i,kA,kz,e,8)===false){this._findChildZoomTile(i,kA,kz,e,3)}}else{if(T===-1){if(this._findChildZoomTile(i,kA,kz,e,3)===false){this._findParentZoomTile(i,kA,kz,e,8)}}}this.map._featureMgr.sortThumbData(this.drawIndex)},_findParentZoomTile:function(kC,kL,kK,kA,kF){var kB=ev[this.getMapType()];var T=kB.minDataZoom;var e=kC;var kI=kL;var kG=kK;var kH=kA;for(var kE=1;kE<=kF;kE++){var kz=this.tileType.getParentTile(e,kI,kG,kH,T);if(kz===null){continue}var kJ=this.getTileKey(kz);var kD=this.tileCache.getData(kJ);if(kD&&kD.status==="ready"){if(this.thumbCache[kJ]){continue}this.map._featureMgr.setData(kD,this.drawIndex,0);this.thumbCache[kJ]=true;return true}e=kz.col;kI=kz.row;kG=kz.zoom;kH=kz.useZoom}return false},_findChildZoomTile:function(kD,kF,e,kA,kO){var kM=ev[this.getMapType()];var kI=kM.maxDataZoom;var kC=kD;var kE=kF;var kG=e;var kz=kA;var kB=true;for(var kL=1;kL<=kO;kL++){var kJ=false;var T=this.tileType.getChildTiles(kC,kE,kG,kz,kI,kL);if(!T){continue}for(var kK=0;kK<T.length;kK++){var kH=this.getTileKey(T[kK]);var kN=this.tileCache.getData(kH);if(kN&&kN.status==="ready"){if(!this.thumbCache[kH]){this.map._featureMgr.setData(kN,this.drawIndex,1);this.thumbCache[kH]=true}kJ=true}else{kB=false}}if(kJ){break}}return kB},loadVectorTileData:function(kM,kN){var kA=kM.col;var kB=kM.row;var e=kM.zoom;var kK=kM.baseTileSize;var kz=this.getTilesUrl(new fv(kA,kB),e,kK);var kC=this.map.getPrivateRegions();if(!this.processData&&this.map.getPrivateStatus()&&kC){var kI=kM.useZoom;var kH=this.tileType.getMercatorSize(kI);var kG=kA*kH;var kF=kB*kH;var kJ=new cG(kG+kH/2,kF+kH/2);var kE=new ij(new cG(kG,kF),new cG(kG+kH,kF+kH));var kD=gt()>=1.5?2:1;for(var kL=0;kL<kC.length;kL++){if(kC[kL] instanceof cV){if(kC[kL].crossPoint(kJ,kE,kI)){var kO={x:kA,y:kB,z:e,mapZoom:kI,scalerRadio:kD,textimg:this.map.config.textRenderType==="canvas"?0:1};var T=kC[kL].tileUrlFunction(kz,kO);if(T&&T.url){kz=T.url;T.header&&(kM.header=T.header)}break}}}}if(!kz){return}var kQ=this.getTileKey(kM);hz(this.map);if(!this.processData){if(!this.map||!this.map._workerMgr){return}this.map._workerMgr.loadTileData(kz,kM,kQ,kN);return}var kN="cbk"+kQ.replace(/-/g,"_");var kP=this;bG[kN]=function(i){var kR=(function(kS){return function(){kS.tileInfo=kM;var kY=kP.processData(kS);if(!kY.road){return}var kV={tileInfo:kM,renderData:{base:[]},status:"ready",key:kQ,mapType:kP.mapType};var k1=[];var k4=[];for(var kX=0;kX<kY.road.length;kX++){var k0=kY.road[kX];var kZ=-1;for(var kW=0;kW<k0.length;kW++){var k2=k0[kW];var k3=[];if(k1.length/7+k2[0].length/2>65536){kV.renderData.base.push({type:"line",data:[gD.toTileSolidLineVertices(k1,4000),new Uint16Array(k4)]});k1=[];k4=[]}for(var kU=0;kU<k2[0].length;kU+=2){k3[k3.length]=[k2[0][kU],k2[0][kU+1]]}var kT=k2[3];gD.buildData(k3,k2[1],k2[2],k1,k4,kT,k2[4],kX+20)}kV.renderData.base.push({type:"line",data:[gD.toTileSolidLineVertices(k1,4000),new Uint16Array(k4)]})}kP.tileCache.setData(kQ,kV);if(kP.map._featureMgr){kP.map._featureMgr.clearData(kP.drawIndex)}kP.getVectorLayerDataFromCache(kP.curViewTilesInfo,kP.getZoomState());kP.map.dispatchEvent(new fW("onrefresh"))}})(i);kP.map.jobScheduler.addJob(kR);delete bG[kN]};kz+="&fn="+encodeURIComponent(fF+"."+kN);g3.load(kz)},vectorTileDataCbk:function(kz,kA){var kE=new fW("ontileloaded");kE.perfStat=kz.perfStat||[];var e=this.map;e.fire(kE);var i=kz.tileInfo;var T=i.col;var kJ=i.row;var kI=i.zoom;var kH=i.baseTileSize;var kC=this.tileCache.getData(kA);if(!kC){return}if(!this.showLabel){kz.label=null}kC.renderData=kz;kC.tileInfo=i;var kB=fc.calcLoopParam(T,kI,kH);var kF=kB.geoOffsetX;kC.tileInfo.loopOffsetX=kF;kC.status="ready";kC.mapType=this.mapType;this.tileCache.setData(kA,kC);kC.label=kz.label;kz.label=null;if(kz.indoorData&&e._indoorMgr){e._indoorMgr.setData(kz.indoorData)}var kD="id_"+T+"_"+kJ+"_"+kI;if(!this.curViewTilesInfo[kD]){e.fire(new fW("ontilenotinview"));return}var kG=e._displayOptions;if(kG.poi){this.processLabelData(kC)}if(kz.indoorData&&e._indoorMgr&&e._indoorMgr.currentUid){this._refreshIndoorData(e._indoorMgr.currentUid,e._indoorMgr.currentFloor)}},_refreshIndoorData:function(kH,kG){var kJ=this.map._indoorMgr.getIndoorData(kH);if(this.map&&this.map.parking){this.map.parking.currentUid=kH;this.map.parking.currentFloor=kG}var kM=kJ.tileKeys;var kK=Math.floor(this.map.getZoom());for(var kE=0;kE<kM.length;kE++){var kB=kM[kE];var kD=this.tileCache.getData(kB);if(!kD||!kD.renderData){continue}var kL=kD.renderData;if(!kL){continue}kL.indoorBase=[];kL.indoorBaseContour=[];kL.indoorBorder3D=[];kL.indoorArea3D=[];kD.label.indoorLabel=[];this.labelProcessor.clearCollisionCache(kD.label);for(var kF in kL.indoorData){if(kF==="tileInfo"){continue}var e=kL.indoorData[kF];var kA=e.defaultFloor;if(kF===kH){kA=kG;e.currentFloor=kG}if(e.floors[kA]){if(e.floors[kA].base){for(var kC=0;kC<e.floors[kA].base.length;kC++){kL.indoorBase.push(e.floors[kA].base[kC])}}if(e.floors[kA].contour){for(var kC=0;kC<e.floors[kA].contour.length;kC++){kL.indoorBaseContour.push(e.floors[kA].contour[kC])}}if(e.floors[kA].indoorBorder3D){kL.indoorBorder3D.push(e.floors[kA].indoorBorder3D)}if(e.floors[kA].area3D){kL.indoorArea3D.push(e.floors[kA].area3D)}if(e.floors[kA].pois){kD.label.indoorLabel=kD.label.indoorLabel.concat(e.floors[kA].pois)}}}this.updateAllIconsTextureCoords(kD);var kI=this;this.labelProcessor.loadIconImages(kD,function(i){kI.updateAllIconsTextureCoords(i)},"indoor");var kz=kB.split("_");var T=parseInt(kz[kz.length-1],10);if(T!==kK){continue}kI.map._featureMgr.setData(kD,this.drawIndex,2)}this.dataBackCollideLabels();this.map.dispatchEvent(new fW("onrefresh"))},_removeIndoorData:function(i){if(!i.indoorData){return}for(var e in i.indoorData){if(e==="tileInfo"){continue}this.map._indoorMgr.removeData(e,i.key)}},getProcessedLabelZoom:function(kz){var kA=ku.baseZoomInfo[kz.zoom];if(!kA){return false}var T=[];for(var kB=0;kB<kA.length;kB++){var kC=this.getTileKey(kz,{useZoom:kA[kB]});var e=this.tileCache.getData(kC);if(e&&e.status==="ready"&&e.label&&e.label.status==="ready"){T.push(kA[kB])}}if(T.length){return T}else{return false}},getSameZoomDataFromCache:function(T){var kz=ku.baseZoomInfo[T.zoom];for(var kA=0;kA<kz.length;kA++){var kB=this.getTileKey(T,{useZoom:kz[kA]});if(T.useZoom===kz[kA]){continue}var e=this.tileCache.getData(kB);if(e&&e.status==="ready"&&e.label&&e.label.status==="ready"){return e}}return false},hasSameLabelData:function(kz,T){for(var e=0;e<T.length;e++){if(T[e].key===kz){return true}}return false},getDataByFloorName:function(T,kz){for(var e=0;e<T.length;e++){if(T[e].floorName===kz){return T[e]}}return null},mergeIndoorLabelData:function(kE,e){for(var kC in kE){if(kC==="tileInfo"){continue}if(e[kC]){var T=kE[kC].floors;var kF=e[kC].floors;for(var kA=0;kA<T.length;kA++){var kz=T[kA];var kD=kz.floorName;var kB=this.getDataByFloorName(kF,kD);if(kB){if(kB.pois){kB.pois=kB.pois.concat(kz.pois);kz.pois=kB.pois}else{kB.pois=kz.pois}}}}}},mergeSameZoomLabelData:function(kC){var kA=kC.label;if(!kA){return}var e=kC.tileInfo;var kB=this.getSameZoomDataFromCache(e);if(!kB){return}var kz=kB.label;if(!kz){return}for(var T=0;T<kA.fixedLabel.length;T++){if(!this.hasSameLabelData(kA.fixedLabel[T].key,kz.fixedLabel)){kz.hasNewData=true;kz.fixedLabel.push(kA.fixedLabel[T])}}for(var T=0;T<kA.lineLabel.length;T++){if(!this.hasSameLabelData(kA.lineLabel[T].key,kz.lineLabel)){kz.hasNewData=true;kz.lineLabel.push(kA.lineLabel[T])}}for(var T=0;T<kA.indoorLabel.length;T++){if(!this.hasSameLabelData(kA.indoorLabel[T].key,kz.indoorLabel)){kz.hasNewData=true;kz.indoorLabel.push(kA.indoorLabel[T])}}kC.label=kz;if(kB.renderData.indoorData&&kC.renderData.indoorData){this.mergeIndoorLabelData(kC.renderData.indoorData,kB.renderData.indoorData)}},processLabelData:function(kB){if(!kB.label){return}if(kB.label.status==="processing"){return}kB.label.status="processing";var kz=this;kz.updateAllIconsTextureCoords(kB);this.labelProcessor.loadIconImages(kB,function(kC){kz.updateAllIconsTextureCoords(kC)});if(this.map.config.textRenderType==="canvas"){var e=this.labelProcessor.drawLabelsOnCanvas(kB,function(kE,kG){var kD=kB.tileInfo;var kF=kz.map.config.mapStyleId;if(!bG["customStyleInfo_"+kF]){kz.mergeSameZoomLabelData(kB)}if(kE){if(!kB.label.textureHeights){kB.label.textureHeights=[]}kB.label.textureHeights[kD.useZoom]=kE.height}if(kG){if(!kB.label.indoorTextureHeights){kB.label.indoorTextureHeights=[]}kB.label.indoorTextureHeights[kD.useZoom]=kG.height}var kC=kz._getTileTexImgKey(kD);kz._doWorkAfterLabelImageLoad(kB,kE,kG,kC)});return}var T=kB.label.textImageBitmap||kB.label.textImgStr;var kA=kB.label.indoorTextImageBitmap||kB.label.indoorTextImgStr;this.labelProcessor.loadImgByStr(T,kA,function i(kH,kF){var kE=kB.label.textureHeight;var kI=kB.label.indoorTextureHeight;kB.label.textureHeight=undefined;kB.label.indoorTextureHeight=undefined;var kD=kB.tileInfo;kz.mergeSameZoomLabelData(kB);var kG=kB.label;kG.textImgStr="";kG.indoorTextImgStr&&(kG.indoorTextImgStr="");if(!kG.textureHeights){kG.textureHeights=[]}kG.textureHeights[kD.useZoom]=kE;if(!kG.indoorTextureHeights){kG.indoorTextureHeights=[]}kG.indoorTextureHeights[kD.useZoom]=kI;var kC=kz._getTileTexImgKey(kD);kz._doWorkAfterLabelImageLoad(kB,kH,kF,kC)})},_getTileTexImgKey:function(i){var T=i.style||this.mapStyleId||"default";var e=T+"_"+i.col+"_"+i.row+"_"+i.zoom;if(this.map.config.textRenderType==="canvas"){e+="_"+i.useZoom}return e},_doWorkAfterLabelImageLoad:function(kz,kC,e,kG){var kB=this;var kE=kz.label;kE.tileInfo=kz.tileInfo;kE.status="ready";if(kC||e){var T=kE.tileInfo;if(kC){kC.id=kG;if(!kE.textureSources){kE.textureSources=[]}kE.textureSources[T.useZoom]=kC}if(e){e.id=kG+"_indoor";if(!kE.indoorTextureSources){kE.indoorTextureSources=[]}kE.indoorTextureSources[T.useZoom]=e}if(kB.map._webglMapScene){var kF=kB.map._webglMapScene._painter;if(kC){kF._addToAsyncJob(kE.textureSources[T.useZoom])}}}if(kz.custom!==true){kB.tileLabels.push(kE)}else{if(!kC&&kB.tileLabels){for(var kA=0;kA<kB.tileLabels.length;kA++){var kD=kB.tileLabels[kA];this.labelProcessor.clearCollisionCache(kD)}}setTimeout(function(){kB.updateAllIconsTextureCoords(kz);kB.labelProcessor.loadIconImages(kz,function(i){kB.updateAllIconsTextureCoords(kz)},true);kB.map.dispatchEvent(new fW("onupdate"))},200)}if(kB.collisionTimer){return}kB.collisionTimer=setTimeout(function(){kB.dataBackCollideLabels();kB.collisionTimer=null},300)},_updateIconTextureCoords:function(kD,T){if(!kD){return}var kC=this.map;for(var kz=0;kz<kD.length;kz++){var kB=kD[kz];if(!kB.iconPos){continue}if(kC._webglMapScene){var e=kC._webglMapScene._painter;var kA=T+"_"+kB.iconPos.iconType;kB.iconPos.texcoord=e._iconTextureAtlasCoords[kA]||null}}},updateAllIconsTextureCoords:function(kA){if(this.map.viewAnimationTime){return}if(kA){if(kA.label){var i=kA.tileInfo.style;this._updateIconTextureCoords(kA.label.fixedLabel,i);this._updateIconTextureCoords(kA.label.indoorLabel,i)}}else{var kz=this.tileCache.getAllData();for(var T in kz){var e=kz[T].data;if(e.status==="ready"&&e.label){var i=e.tileInfo.style;this._updateIconTextureCoords(e.label.fixedLabel,i);this._updateIconTextureCoords(e.label.indoorLabel,i)}}}this.updateLabels();this.map.dispatchEvent(new fW("onrefresh"))},cacheDataCollideLabels:function(T){var kA=this;var i=this.map._featureMgr;function kz(){if(kA&&!kA.map.tileMgr&&!kA.map.tileMgr.isExitTileLayer(kA)){return}kA.cacheLabelTimer=null;var kB;var kC=kA.map.getTilt();var kE=kA.map.getHeading()%360;if(kA.tileLabels.length===0||(kA.tileLabels.length===1&&kA.tileLabels[0].tileInfo.zoom===0)){kB=i.getLabelData(kA.drawIndex);if(kB.length>0){kB=kA.labelProcessor.collisionTest(kB,-1)}}else{if(kC||kE){if(this._collisionTimer){if(!kC){clearTimeout(this._collisionTimer)}else{if(Date.now()-kA.lastCollisionTestTime>500){kA.lastCollisionTestTime=Date.now()}else{clearTimeout(this._collisionTimer)}}}this._collisionTimer=setTimeout(function(){if(kA&&!kA.map.tileMgr&&!kA.map.tileMgr.isExitTileLayer(kA)){kA._collisionTimer=null;return}kB=kA.labelProcessor.collisionTest(kA.tileLabels);if(kB){if(kA._isInnerLayer&&kA.map.stencil&&kA.map.stencil.isPoiMask){var kF=kA.isPoiInPolygon(kB);i.setLabelData(kF,kA.drawIndex)}else{i.setLabelData(kB,kA.drawIndex)}}kA.updateLabels();kA.map.dispatchEvent(new fW("onrefresh"));kA._collisionTimer=null},60);return}else{kB=kA.labelProcessor.getCachedLabels(kA.tileLabels)}}if(kB){if(kA._isInnerLayer&&kA.map.stencil&&kA.map.stencil.isPoiMask){var kD=kA.isPoiInPolygon(kB);i.setLabelData(kD,kA.drawIndex)}else{i.setLabelData(kB,kA.drawIndex)}}kA.updateLabels();kA.map.dispatchEvent(new fW("onrefresh"))}if(!T){clearTimeout(kA.cacheLabelTimer);kz()}else{if(kA.cacheLabelTimer){return}kA.cacheLabelTimer=setTimeout(function e(){kz()},T)}},isPoiInPolygon:function(T){var kS=this;var kI=kS.map.stencil;var kA=kS.map._featureMgr.result.eleData[9];var kz=[];for(var kN=0;kN<kA.length;kN++){var kJ=kA[kN].overlay.points;kz=kz.concat(kJ)}for(var kQ=0;kQ<T.length;kQ++){var kC=[];var kB=[];for(var kO=0;kO<T[kQ].fixedLabel.length;kO++){var kH=T[kQ].fixedLabel[kO];var kL=kH.pt;if(kH.pt&&aw(kL,kz)){kC.push(kH)}else{kB.push(kH)}}if(kI.showRegion==="inside"){T[kQ].fixedLabel=kC}else{if(kI.showRegion==="outside"){T[kQ].fixedLabel=kB}}var kM=[];var kE=[];for(var kN=0;kN<T[kQ].lineLabel.length;kN++){var kP=T[kQ].lineLabel[kN];var e=kP.pt;if(e&&aw(e,kz)){kM.push(kP)}else{kE.push(kP)}}if(kI.showRegion==="inside"){T[kQ].lineLabel=kM}else{if(kI.showRegion==="outside"){T[kQ].lineLabel=kE}}var kK=[];var kG=[];for(var kF=0;kF<T[kQ].indoorLabel.length;kF++){var kR=T[kQ].indoorLabel[kF];var kD=kR.pt;if(kD&&aw(kD,kz)){kK.push(kR)}else{kG.push(kR)}}if(kI.showRegion==="inside"){T[kQ].indoorLabel=kK}else{if(kI.showRegion==="outside"){T[kQ].indoorLabel=kG}}}return T},dataBackCollideLabels:function(){var T=this;if(T&&!T.map.tileMgr&&!T.map.tileMgr.isExitTileLayer(T)){return}if(!T.tileLabels||(T.tileLabels&&T.tileLabels.length===0)){return}var e;T.labelProcessor.calcLabelsCollision(T.tileLabels);e=T.labelProcessor.getCachedLabels(T.tileLabels);if(e){if(T._isInnerLayer&&T.map.stencil&&T.map.stencil.isPoiMask){var i=T.isPoiInPolygon(e);T.map._featureMgr.setLabelData(i,T.drawIndex)}else{T.map._featureMgr.setLabelData(e,T.drawIndex)}}T.updateLabels();T.map.dispatchEvent(new fW("onupdate"));if(b5()){this.labelProcessor._refreshSpotData()}},updateLabels:function(kA){var kB=this.map;if(!kB._featureMgr){return}var i=kB._featureMgr;var T=i.getLabelData(this.drawIndex);if(T.length>0){var kz=kB.getZoom();if(T.labelZoom-kz<3){this.labelProcessor.updateLabels(T);var e=this.labelProcessor.fixDataFormat(T);i.setOverlayData(e[0],2,this.drawIndex);i.setOverlayData(e[1],3,this.drawIndex);i.setOverlayData(e[2],4,this.drawIndex)}else{i.clearLabelOverlayData(this.drawIndex)}kB.temp.isPermitSpotOver=false;this.labelProcessor.curSpotAdded=false}},loadRasterLayerData:function(kE,kz){this.thumbCache={};var kF=this.getZoomState();if(kz){for(var kC=0,kA=kE.length;kC<kA;kC++){var T=kE[kC];var kB=this.getTileKey(T);var e=this.tileCache.getData(kB);if(e&&e.status==="ready"){if(T.tileTypeName==="xyz"){e.tileInfo=T}this.map._featureMgr.setData(e,this.drawIndex,2)}else{if(this.useThumbData){this.setThumbData(T.col,T.row,T.zoom,T.useZoom,kF)}}}return}for(var kC=0,kA=kE.length;kC<kA;kC++){var T=kE[kC];var kB=this.getTileKey(T);var e=this.tileCache.getData(kB);if(!e){this.numTileLoading++;this.tileCache.setData(kB,{});var kD=this;this.loadRasterTileData(T,function(i,kG){kD._checkLayerTilesLoaded();kD.rasterTileDataCbk(i,kG)})}}},loadRasterTileData:function(i,e){var kz=i.col;var kC=i.row;var kA=i.zoom;var T=this.getTilesUrl(new fv(kz,kC),kA,i);if(!T){return}var kB=this.getTileKey(i);this.loadTileImage(T,kB,e,i)},loadTileImage:function(kD,T,kB,e){var kz=new Image();kz.crossOrigin="anonymous";kz.tileInfo=e;var kA;var kC=this;function kE(){if(kC.retry){kA&&clearInterval(kA);kA=null}}if(this.retry){var i=1;kA=setInterval(function(){if(i>3){kE();return}kz.src=kD;i++},this.retryTime)}kz.onload=function(){kE();kB&&kB(this,T)};kz.onerror=function(){kE();bG.fetchDebug&&bG.fetchDebug.sendError({title:kD,msg:kD,category:bG.fetchDebug.category.RESOURCE,level:bG.fetchDebug.levels.ERROR,url:kD});kB&&kB(null,T)};kz.src=kD;return kz},rasterTileDataCbk:function(kD,kB){if(!kD||typeof kD==="string"){this.tileCache.removeData(kB);return}var T=kD.tileInfo;var kz=T.col;var kK=T.row;var kJ=T.zoom;var i=this.tileCache.getData(kB);if(!i){return}var kE="id_"+kz+"_"+kK+"_"+kJ;var kI=this;i.dataType=gW;i.tileInfo=T;if(T.tileTypeName==="xyz"){var kH=T.tileSize;i.textureSource=kD;i.renderData={vertexAll:[0,0,this.height,0,0,kH,0,this.height,1,0,kH,kH,this.height,1,1,0,0,this.height,0,0,kH,kH,this.height,1,1,0,kH,this.height,0,1]};kI.setRasterTileData(kB,i,kE)}else{i.textureSource=kD;var kC=fc.calcLoopParam(kz,kJ);var kG=kC.geoOffsetX;kD.tileInfo.loopOffsetX=kG;if(T.combine){var kA=0.0035;if(T.dataIndex>0){var kF=T.dataIndex/256;i.renderData={vertexAll:[0,0,this.height,0,0,T.dataIndex,0,this.height,kF-kA,0,T.dataIndex,256,this.height,kF-kA,1,0,0,this.height,0,0,T.dataIndex,256,this.height,kF-kA,1,0,256,this.height,0,1]}}else{var e=-T.dataIndex;var kF=e/256;i.renderData={vertexAll:[e,0,this.height,kF+kA,0,256,0,this.height,1,0,256,256,this.height,1,1,e,0,this.height,kF+kA,0,256,256,this.height,1,1,e,256,this.height,kF+kA,1]}}}else{i.renderData={vertexAll:[0,0,this.height,0,0,256,0,this.height,1,0,256,256,this.height,1,1,0,0,this.height,0,0,256,256,this.height,1,1,0,256,this.height,0,1]}}this.setRasterTileData(kB,i,kE)}},setRasterTileData:function(kA,e,kz){e.status="ready";this.tileCache.setData(kA,e);var T=false;if(this.curViewTilesInfo[kz]){e.dataType=gW;e.png8=this.png8||false;this.map._featureMgr.setData(e,this.drawIndex,2);T=true}if(T){var i=new fW("onrefresh");i.source="webgllayer";this.map.dispatchEvent(i)}},_checkLayerTilesLoaded:function(){this.numTileLoading--;if(this.firstTileLoad===false){this.dispatchEvent(new fW("ontilesloadstart"));this.firstTileLoad=true}var e=this;if(this.numTileLoading===0){if(this._checkTileLoadedTimer){clearTimeout(this._checkTileLoadedTimer);this._checkTileLoadedTimer=null}this._checkTileLoadedTimer=setTimeout(function(){if(e.numTileLoading===0){e.dispatchEvent(new fW("ontilesloadend"));e.firstTileLoad=false}e._checkTileLoadedTimer=null},60)}},_checkTilesLoaded:function(){this._checkLayerTilesLoaded();this.numLoading--;if(this.map.firstTileLoad===false){this.map.dispatchEvent(new fW("onfirsttilesloaded"));this.map.firstTileLoad=true}var e=this;if(this.numLoading===0){if(this._checkLoadedTimer){clearTimeout(this._checkLoadedTimer);this._checkLoadedTimer=null}this._checkLoadedTimer=setTimeout(function(){if(e.numLoading===0){e.map.dispatchEvent(new fW("ontilesloaded"));e.map.firstTileLoad=false}e._checkLoadedTimer=null},60)}},isClickableLabel:function(e){if(e.isDel){return false}if(e.zoom>9&&!e.guid){return false}if(e.zoom<=9&&!e.name&&!e.guid){return false}return true}};var aW=5;var jr=4;var gP=3;var P=2;var eC=1;var hN=0;function az(e){this._ratio=gt();this._iconCache={};this._map=e;this._drawingCanvasPool=[];this._drawingCanvasHeight=4096;this._bufferSpan=[5,5]}e9.extend(az.prototype,{_loadIcons:function(T,kF,kB){var kz=0;var kC=this;var kA=this._map.config.style;for(var kD in T){kz++;var kE=new Image();kE.id=kD;kE.crossOrigin="anonymous";kE.onload=function(){kC._iconCache[this.id].loaded=true;kz--;if(kz===0){kF()}this.onload=null};kE.onerror=function(){kC._iconCache[this.id]=null;kz--;if(kz===0){kF()}this.onerror=null};if(!kB){var e=E.getIconSetPath(kA)+kD+".png";var i=bH();if(i&&i.udt){e+="?udt="+i.udt}}else{var e=kD}kE.src=e;this._iconCache[kD]={loaded:false,image:kE}}},_getEmptyDrawingCanvas:function(){for(var T=0;T<this._drawingCanvasPool.length;T++){if(this._drawingCanvasPool[T]._free===true){this._drawingCanvasPool[T]._free=false;return this._drawingCanvasPool[T]}}var e=this._createNewDrawingCanvas();this._drawingCanvasPool.push(e);e._free=false;return e},_createNewDrawingCanvas:function(){var e=b6("canvas");e.width=512;e.height=this._drawingCanvasHeight;e._free=true;e._id=bG.getGUID();var i=e.getContext("2d",{colorSpace:"display-p3"});i.textBaseline="bottom";i.lineJoin="round";return e},drawLabelsOnCanvas:function(kR,kz){var kH=kR.label.fixedLabel.slice(0);var kN=kR.label.lineLabel.slice(0);var T=kR.label.indoorLabel.slice(0);if(kH.length===0&&kN.length===0&&T.length===0){kz();return}var kC=function(kW,i){return kW.styleId-i.styleId};kH.sort(kC);kN.sort(kC);T.sort(kC);var kQ={};var e=this._getEmptyDrawingCanvas();var kM=e.getContext("2d",{colorSpace:"display-p3"});kM.clearRect(0,0,e.width,e.height);var kU=0;var kI=null;var kB=0;if(kH.length>0){while(kB<kH.length&&!kH[kB].styleText[0]){kB++}if(kH[kB]&&kH[kB].styleText[0]){kI=kH[kB].styleText[0].fontSize+kH[kB].styleText[0].haloSize*2}}if(kI===null&&T.length>0){kB=0;while(kB<T.length&&!T[kB].styleText[0]){kB++}if(T[kB]&&T[kB].styleText[0]){kI=T[kB].styleText[0].fontSize+T[kB].styleText[0].haloSize*2}}if(kI===null&&kN.length>0){kB=0;while(kB<kN.length&&!kN[kB].styleText[0]){kB++}if(kN[kB]&&kN[kB].styleText[0]){kI=kN[kB].styleText[0].fontSize+kN[kB].styleText[0].haloSize*2}}if(kI===null||isNaN(kI)){kz();return}var kE=0;var kD=kI;kD+=this._bufferSpan[1];var kK={};var kV=0;var kL=[];for(var kP=0;kP<kH.length;kP++){var kG=kH[kP];var kJ=kG.name;var kO=kG.styleText;if(!kJ||kO.length===0){continue}var kA=kG.icon;if(kG.textOnIcon&&(!this._iconCache[kA]||this._iconCache[kA].loaded===false)){kL.push(kG);kV++;if(!kK[kA]){kK[kA]=true}continue}var kS=this._drawEachText(kM,kG,kU,kE,kD,kI,kQ);if(!kS){continue}kE=kS.curX;kD=kS.curY;kI=kS.curLineHeight;kU=kS.styleId}var kS=this._drawEachTypeOfLabels(kM,T,kU,kE,kD,kI,kQ);kU=kS.curStyleId;kE=kS.curX;kD=kS.curY;kI=kS.curLineHeight;var kS=this._drawEachTypeOfLabels(kM,kN,kU,kE,kD,kI,kQ);kU=kS.curStyleId;kE=kS.curX;kD=kS.curY;kI=kS.curLineHeight;if(kV>0){var kT=this;this._loadIcons(kK,function(){kS=kT._drawEachTypeOfLabels(kM,kL,kU,kE,kD,kI,kQ);kU=kS.curStyleId;kE=kS.curX;kD=kS.curY;kI=kS.curLineHeight;var i=kT._generateEachLabelCanvas(e,kD,kH,kN,T,kR);kz(i[0],i[1])});return}var kF=this._generateEachLabelCanvas(e,kD,kH,kN,T,kR);kz(kF[0],kF[1])},drawCustomLabelsOnCanvas:function(kE,kD,T){if(kE.length===0){kD();return}var kB={};var kA=false;for(var kz=0;kz<kE.length;kz++){var kC=null;if(kE[kz].textOnIcon&&kE[kz].icon){kC=kE[kz].icon}if(kC&&!kB[kC]&&(!this._iconCache[kC]||this._iconCache[kC].loaded===false)){kB[kC]=true;kA=true}}var e=this;if(kA){this._loadIcons(kB,function(){e._drawCustomLabel(kE,kD,T)},true)}else{e._drawCustomLabel(kE,kD,T)}},_drawCustomLabel:function(kM,kA,T){var kC;var kB;var kD;var kL;var kO;var e;var kH;var kz=0;var kK=kM.length;var kF=T?[]:null;var kG=this;for(var kI=0;kI<kM.length;kI++){if(!kM[kI].name){continue}var kN=kJ(kM[kI]);if(!kN){continue}if(kN.overHeight){if(T){kK=(kI-kz);kF.push(kE(kz,kK));kH=null;kz=kI;kK=kM.length;kI=kI-1}else{break}}kC=kN.curX+this._bufferSpan[0];kB=kN.curY;kD=kN.curLineHeight;kO=kN.styleId}if(!kH){kP({style:{}})}if(T){kK=kK-kz;kF.push(kE(kz,kK))}else{kF=kE(kz,kK)}kH=null;kA(kF);function kP(i){kC=0+kG._bufferSpan[0];kB=((i.style.fontSize||0)+(i.style.haloSize||0)*2)+kG._bufferSpan[1]||0;kD=kB-kG._bufferSpan[1];kL={};kO=-1;e=kG._getEmptyDrawingCanvas();kH=e.getContext("2d",{colorSpace:"display-p3"});kH.clearRect(0,0,e.width,e.height)}function kJ(i){if(!kH){kP(i)}if(T){i.cachedIsDel={}}var kQ=kG._drawEachText(kH,i,kO,kC,kB,kD,kL);return kQ}function kE(kU,kT){var kR=kB;var kQ=kG._copyToNewCanvas(e,kR+kG._bufferSpan[0]);for(var kS=kU;kS<kM.length&&kS<kU+kT;kS++){if(!kM[kS].name&&kM[kS].style.iconSize){kG._addFixedLabelBounds(kM[kS]);continue}if(!kM[kS].textSize){continue}kG._updateFixedLabelCoords(kM[kS],kR+kG._bufferSpan[0]);kG._addFixedLabelBounds(kM[kS])}kQ.range=[kU,kT];return kQ}},_drawEachTypeOfLabels:function(kI,kC,kG,kz,T,kA,kE){for(var kB=0;kB<kC.length;kB++){var kD=kC[kB];var kH=kD.name;var e=kD.styleText;if(!kH||e.length===0){continue}var kF=this._drawEachText(kI,kD,kG,kz,T,kA,kE);if(!kF){continue}kz=kF.curX+this._bufferSpan[0];T=kF.curY;kA=kF.curLineHeight;kG=kF.styleId;if(kF.curY>this._drawingCanvasHeight){return{curX:kz,curY:T,curLineHeight:kA,curStyleId:kG}}}return{curX:kz,curY:T,curLineHeight:kA,curStyleId:kG}},_drawIndoorTextLabelOnCanvas:function(kA){var e=this._getEmptyDrawingCanvas();var kH=e.getContext("2d",{colorSpace:"display-p3"});kH.clearRect(0,0,e.width,e.height);var kP=0;var kG=null;var kF=0;var kD;var kM={};var kL=[];for(var kB in kA){if(kB==="tileInfo"){continue}var kz=kA[kB];var kK=kz.defaultFloor;var kE=kz.floors;for(var kJ=0;kJ<kE.length;kJ++){if(kJ===kK){continue}var kN=kE[kJ];if(!kN.pois){continue}var kC=kN.pois;for(var kI=0;kI<kC.length;kI++){if(kG===null&&kC[kI].styleText[0]){kG=kC[kI].styleText[0].fontSize+kC[kI].styleText[0].haloSize*2;kD=kG}kL.push(kC[kI])}}}if(kG===null){return null}kL.sort(function(kQ,i){return i.rank-kQ.rank||kQ.styleId-i.styleId});var kO=this._drawEachTypeOfLabels(kH,kL,kP,kF,kD,kG,kM);kP=kO.curStyleId;kF=kO.curX;kD=kO.curY;kG=kO.curLineHeight;var T=this._copyToNewCanvas(e,kD);return T},_updateIndoorLabelsCoords:function(kG,kH){for(var kF in kG){if(kF==="tileInfo"){continue}var e=kG[kF];var kB=e.defaultFloor;var kC=e.floors;for(var kD=0;kD<kC.length;kD++){if(kD===kB){continue}var T=kC[kD];if(!T.pois){continue}var kA=T.pois;for(var kz=0;kz<kA.length;kz++){var kE=kA[kz];if(kE.name&&(!kE.textSize||kE.textSize.length===0)){kA.splice(kz,1);kz--;continue}this._updateFixedLabelCoords(kE,kH);this._addFixedLabelBounds(kE)}}}},_generateEachLabelCanvas:function(kC,kB,kD,e,kF,T){kB=Math.min(kB,this._drawingCanvasHeight);var kE=this._copyToNewCanvas(kC,kB);var kz=null;if(T.renderData.indoorData){kz=this._drawIndoorTextLabelOnCanvas(T.renderData.indoorData);if(kz){this._updateIndoorLabelsCoords(T.renderData.indoorData,kz.height)}}for(var kA=0;kA<kD.length;kA++){if(!kD[kA].textSize){continue}this._updateFixedLabelCoords(kD[kA],kB);this._addFixedLabelBounds(kD[kA])}for(var kA=0;kA<kF.length;kA++){if(!kF[kA].textSize){continue}this._updateFixedLabelCoords(kF[kA],kB);this._addFixedLabelBounds(kF[kA])}for(var kA=0;kA<e.length;kA++){this._updateLineLabelCoords(e[kA],kB)}return[kE,kz]},_copyToNewCanvas:function(T,i){if(i===0){return null}var kz=b6("canvas");kz.width=T.width;kz.height=i;var e=kz.getContext("2d",{colorSpace:"display-p3"});e.drawImage(T,0,0,512,i,0,0,512,i);kz._id=T._id;T._free=true;return kz},_drawEachText:function(kS,kD,T,kU,kT,k1,kA){var k0=kD.name;var kI=kD.styleText?kD.styleText[0]:kD.style;if(!kI){return null}var kL=kI.fontSize||0;var k5=kI.fontWeight;var li=kI.haloSize||0;var lm=kI.padding||[0,0];if(!kN){}if(kI.fontRgba){var lp=kI.fontRgba[3]/255;var kH=[];kH[3]=lp;for(var lo=0;lo<3;lo++){kH[lo]=kI.fontRgba[lo]}}if(kI.haloRgba){var lp=kI.haloRgba[3]/255;var kO=[];kO[3]=lp;for(var lo=0;lo<3;lo++){kO[lo]=kI.haloRgba[lo]}}var lc=kH?"rgba("+kH.join(",")+")":kI.color;var kC=kO?"rgba("+kO.join(",")+")":kI.strokeColor;var lk=kD.styleId||0;if(li>4){li=4}var k2=[];var kQ=[];var kY=0;if(kA&&!kA[lk]){kA[lk]={}}var kK=kL+li*2+lm[0]*2;var k3=kK;if(kD.containDescendings){k3+=4}if(li===0){k3+=2}if(kD.textOnIcon){k3=Math.max(k3,kD.iconSize[1])}if(lk!==T||k3>k1){T=lk;if(k5>=10&&k5%10===0){kS.font=k5*10+" "+kL+"px sans-serif"}else{kS.font=kL+"px sans-serif"}if(k3>k1){var kZ=k3-k1;k1+=kZ;kT+=kZ}if(li>0){kS.lineWidth=li*2;kS.strokeStyle=kC}kS.fillStyle=lc}if(kD.type==="line"){var kF=k0.split("");for(var ll=0;ll<kF.length;ll++){var le=kF[ll];var kV;var k6;if(kA[lk][le]){var kN=kA[lk][le];kV=kN.displaySize;k6=kN.curWordPosition}else{var kz=Math.ceil(kS.measureText(le).width);if(kU+kz>512){kU=0+this._bufferSpan[0];kT+=k3;kT+=this._bufferSpan[1];k1=k3}if(kT+this._bufferSpan[1]>this._drawingCanvasHeight){return{curX:kU,curY:kT,curLineHeight:k1,styleId:lk}}var lf=kU;if(li>0){kz+=li;lf-=Math.round(li/2);kS.strokeText(le,kU,kT)}kS.fillText(le,kU,kT);var lb=[kz,k3];kV=[Math.round(lb[0]/2),Math.round(lb[1]/2)];k6=[lf,kT-k3];kA[lk][le]={displaySize:kV,curWordPosition:k6,totalHeight:kY};kU+=kz+2}k2.push(kV);kQ.push(k6)}kY=Math.round(k2[0][1])}else{if(kA[lk][k0]){var kN=kA[lk][k0];k2=kN.textSize;kQ=kN.labelImagePosition;kY=kN.totalHeight}else{var kM=k0.split("\\");if(kM.length>1&&kD.textOnIcon){var ln=0;var lj=0;var lq=[];var kW=8;for(var ll=0;ll<kM.length;ll++){var k0=kM[ll];var kJ=Math.ceil(kS.measureText(k0).width);if(kJ>ln){ln=kJ}lq.push(Math.round(kJ/2));lj+=k3}var kG=ln+2*kW;var lh=lj+2*kW;if(kU+kG>512){kU=0+this._bufferSpan[0];kT+=k1;kT+=this._bufferSpan[1]}kT+=lj-k3+2*kW;var la=kU;var kX=kT-lh;var e=Math.round(kG/2);var kP=this._iconCache[kD.icon].image;this.drawStretchedIcon(kS,kP,[la,kX],kW,ln,lj);for(var ll=0;ll<kM.length;ll++){var k0=kM[ll];var lg=la+(e-lq[ll]);var ld=kX+4+(ll+1)*k3;kS.fillText(k0,lg,ld)}k2.push([Math.round(kG/2),Math.round(lh/2)]);kQ.push([la,kX]);kU+=kG;k1=lh;kY=Math.round(lh/2)}else{for(var ll=0;ll<kM.length;ll++){var k0=kM[ll];var kJ=Math.ceil(kS.measureText(k0).width);if(kJ>512&&kM.length==1){kM[ll]=k0.substring(0,Math.floor(k0.length/2));kM[ll+1]=k0.substring(Math.floor(k0.length/2));ll--;continue}var kG=kJ;var kB=0;if(kD.textOnIcon){kB=10;kG+=kB*2;if(kD.styleId===519){kG=kD.iconSize[0];kB=Math.round((kG-kJ)/2)}}if(kU+kG>512){kT+=k3;kT+=this._bufferSpan[1];if(kT+this._bufferSpan[1]>this._drawingCanvasHeight){kT-=k3;kT-=this._bufferSpan[1];return{overHeight:true,curX:kU,curY:kT,curLineHeight:k1,styleId:lk}}kU=0+this._bufferSpan[0];k1=k3}else{if(kT+this._bufferSpan[1]>this._drawingCanvasHeight){return{overHeight:true,curX:kU,curY:kT,curLineHeight:k1,styleId:lk}}}var la=kU;var kX=kT-k3;var k9=kU;var k8=kT;if(kD.containDescendings){k8-=4}if(kD.textOnIcon){var k4=false;var kP=this._iconCache[kD.icon].image;var k7=kD.iconSize.concat([]);if(kK>=k7[1]){k7[1]=kK;k4=true;k3+=kB*2;var kZ=k3-k1;if(kZ>0){kT+=kZ;k1=k3;k8+=(kZ-kB);kX+=(kZ-kB*2)}else{k8-=kB;kX-=kB*2}}if(kJ>=k7[0]){k7[0]=kJ}if(kD.styleId===519){kS.drawImage(kP,0,0,k7[0],k7[1],la,kX,k7[0],k7[1])}else{if(kD.noStretch){k8-=kK/2;var kR=kJ+kB*2;kS.drawImage(kP,0,0,kP.width,kP.height,la,kX,kR,kK)}else{if(k4){this.drawStretchedIcon(kS,kP,[la,kX],kB,kJ,k7[1])}else{this.draw3StretchedIcon(kS,kP,[la,kX],kB,kJ,k7[1])}}}k9+=kB;if(kD.iconSize[1]>kK){k8-=(kD.iconSize[1]-kK)/2-1}}if(li>0){if(lk===71028){k3-=2}if(lk===32){k3-=2}kS.strokeText(k0,k9,k8)}kS.fillText(k0,k9,k8);var kE=[kG,k3];var kV=[Math.round(kE[0]/2),Math.round(kE[1]/2)];k2.push(kV);kQ.push([la,kX]);kY+=Math.round(kV[1]);kU+=kG}}kA[lk][k0]={textSize:k2,labelImagePosition:kQ,totalHeight:kY}}}kD.textSize=k2;kD.labelImagePosition=kQ;kD.totalHeight=kY;return{curX:kU,curY:kT,curLineHeight:k1,styleId:lk}},drawStretchedIcon:function(e,T,kz,kC,kD,i){var kB=kz[0];var kA=kz[1];e.drawImage(T,0,0,kC,kC,kB,kA,kC,kC);e.drawImage(T,kC,0,1,kC,kB+kC,kA,kD,kC);e.drawImage(T,T.width-kC,0,kC,kC,kB+kD+kC,kA,kC,kC);e.drawImage(T,0,kC,kC,1,kB,kA+kC,kC,i);e.drawImage(T,kC,kC,1,1,kB+kC,kA+kC,kD,i);e.drawImage(T,T.width-kC,kC,kC,1,kB+kD+kC,kA+kC,kC,i);e.drawImage(T,0,T.height-kC,kC,kC,kB,kA+i+kC,kC,kC);e.drawImage(T,kC,T.height-kC,1,kC,kB+kC,kA+i+kC,kD,kC);e.drawImage(T,T.width-kC,T.height-kC,kC,kC,kB+kD+kC,kA+i+kC,kC,kC)},draw3StretchedIcon:function(e,i,T,kB,kD,kC){var kA=T[0];var kz=T[1];e.drawImage(i,0,0,kB,i.height,kA,kz,kB,i.height);e.drawImage(i,kB,0,1,i.height,kA+kB,kz,kD,i.height);e.drawImage(i,i.width-kB,0,kB,i.height,kA+kB+kD,kz,kB,i.height)},_updateFixedLabelCoords:function(kA,kP){if(kP===0){return}var kK=[];var kW=[];var kX=0;var kN=kA.totalHeight;var k5=kA.textSize.length;var kB=kA.direction;if(typeof kB!=="number"){kB=0}for(var kY=0;kY<k5;kY++){var kQ=kA.labelImagePosition[kY];var kO=kA.textSize[kY];var kM=kQ[0];var kz=kQ[1];var kC=kO[0];var kH=kO[1];var kJ=0;var kV=0;if(typeof kA.textMargin==="number"){kV=kA.textMargin}var kI;var e;var kE=0;var kL=0;if(!kA.iconPos){if(!kA.custom){kB=jr}}else{kE=kA.iconPos.width;kL=kA.iconPos.height}switch(kB){case gP:var T=kN/2-kH+kJ*(k5-1)/2;kI=Math.round(-kE/2-kC-kV);e=Math.round(T-kX-kJ*kY);break;case eC:var T=kN/2-kH+kJ*(k5-1)/2;kI=Math.round(kE/2+kV);e=Math.round(T-kX-kJ*kY);break;case P:var T=kL/2+kN-kH+kJ*k5;kI=Math.round(-kC/2);e=Math.round(T-kX-kJ*kY);break;case hN:var T=-kL/2-kJ-kH;kI=Math.round(-kC/2);e=Math.round(T-kX-kJ*kY);break;case jr:var T=-kN/2-kJ*(k5-1)/2;kI=Math.round(-kC/2);e=Math.round(T-kX-kJ*kY);break}kX+=kH;var kG=kI+kC;var k6=e;var kF=kG;var k4=k6+kH;var kD=kI;var k3=k4;kK.push(kI,e,kG,k6,kF,k4,kI,e,kF,k4,kD,k3);var k2=kM/512;var kU=(kP-kz-kH*2)/kP;var k1=(kM+kC*2)/512;var kT=kU;var k0=k1;var kS=(kP-kz)/kP;var kZ=k2;var kR=kS;kW.push(k2,kU,k1,kT,k0,kS,k2,kU,k0,kS,kZ,kR)}if(!kA.textPos){kA.textPos={}}kA.textPos.vertex=kK;kA.textPos.texcoord=kW},_addFixedLabelBounds:function(kF){var kB=1000;var kz=1000;var T=-1000;var e=-1000;if(kF.iconPos){var kD=kF.iconPos["vertex"];for(var kE=0,kA=kD.length;kE<kA;kE+=2){var kJ=kD[kE];var kH=kD[kE+1];if(kJ<kB){kB=kJ}if(kJ>T){T=kJ}if(kH<kz){kz=kH}if(kH>e){e=kH}}}if(kF.custom&&kF.style.iconSize&&!kF.name){var kG=kF.style.iconSize;var kI=kF.direction;switch(kI){case jr:kB=-Math.round(kG[0]/2);kz=-Math.round(kG[1]/2);T=Math.round(kG[0]/2);e=Math.round(kG[1]/2);break;case P:kB=-Math.round(kG[0]/2);kz=0;T=Math.round(kG[0]/2);e=kG[1];break}}if(kF.textPos){var kC=kF.textPos["vertex"];for(var kE=0,kA=kC.length;kE<kA;kE+=2){var kJ=kC[kE];var kH=kC[kE+1];if(kJ<kB){kB=kJ}if(kJ>T){T=kJ}if(kH<kz){kz=kH}if(kH>e){e=kH}}}kF.bds=[kB,kz,T,e]},_updateLineLabelCoords:function(kQ,kG){if(kG===0){return}var kz=kQ.wordsInfo;var kN=kQ.wordCount;if(!kQ.labelImagePosition){return}var kI=kQ.labelImagePosition.slice(0);if(kQ.reverse){kI.reverse()}var kZ=1000;var kW=1000;var kX=-1000;var kV=-1000;for(var kR=0;kR<kN;kR++){var k0=kI[kR];var kY=k0[0];var kO=k0[1];var kM=kQ.textSize[kR];var kF=kM[0];var e=kM[1];var kE=kY/512;var kL=(kG-kO-e*2)/kG;var kC=(kY+kF*2)/512;var kK=kL;var kA=kC;var kJ=(kG-kO)/kG;var T=kE;var kH=kJ;kz[kR].size=[kF,e];kz[kR].texcoord=[kE,kL,kC,kK,kA,kJ,kE,kL,kA,kJ,T,kH];var kU=kz[kR].offset[0];var kT=kz[kR].offset[1];var kS=kU-kF/2;var kD=kT+e/2;var kB=kT-e/2;var kP=kU+kF/2;if(kS<kZ){kZ=kS}if(kP>kX){kX=kP}if(kB<kW){kW=kB}if(kD>kV){kV=kD}}kQ.bds=[kZ,kW,kX,kV]}});var gh={0:"00000000",16:"00010000",32:"00100000",48:"00110000",64:"01000000",96:"01100000"};function et(kB,kD,kz){var kA=kB.bds;if(!kA){return false}var kC=kB.tracer;var T;if(kC){if(!gh[kC]){T=kC.toString(2);if(T.length<8){T=new Array(8-T.length+1).join("0")+T}gh[kC]=T}T=gh[kC];var e=ku.mapZoomStartZoomMapping[kD];var kE=kD>20?21:kD;return T[kE-e]==="1"}var i=kB.displayRange;if(kz>=i[0]&&kz<=i[1]){return true}return false}function jx(i,e){this.map=i.map;this.layer=i;e=e||[];this.allLabels=[];this._spotData=[];this._strategyInfo=null;this.RANK1=1000000;this.RANK2=2000000;this.RANK3=3000000;this.RANK4=4000000;this.RANK5=5000000;this._ratio=gt();this._useRound=true;this._sharpenRender=false;if(this._ratio>h4.HIGH_RES_MIN_RATIO){this._useRound=false;this._sharpenRender=true}this._mapIsMoving=false;this._onMapIdleCallback=e.onMapIdleCallback;this.map.temp.isPermitSpotOver=true;this.currentSelectedLabel=null;this.map._labelProcessor=this;this.iconCache=new aC((b5()||e9.Browser.ie)?64:128,{clearCallback:function(T){}});this.fixedLabelData=[];this.lineLabelData=[];this.highlightLabelData=[];this._iconLoadTimer=null;this._labelTextCanvas=null;if(this.map.config.textRenderType==="canvas"){this._labelTextCanvas=this.map.tileMgr.getLabelTextCanvas()}this.bind()}e9.extend(jx.prototype,{bind:function(){var T=this.map;var i=this;T.addEventListener("mapstatusbusy_inner",function(kz){i._mapIsMoving=true;if(i._ratio>h4.HIGH_RES_MIN_RATIO){i._sharpenRender=false}else{i._useRound=false}});T.addEventListener("mapstatusidle_inner",function(kz){if(i._ratio>h4.HIGH_RES_MIN_RATIO){i._sharpenRender=true}else{i._useRound=true}i._mapIsMoving=false});T.addEventListener("onspotmouseover",function(kB){if(!this.temp.isPermitSpotOver){return}if(kB.spots.length>0){var kA=kB.spots[0].userdata.uid;var kC=kB.spots[0].userdata.tilePosStr;var kz=i.getLabelByUid(kA,kC);kz&&kz.formatedData&&i._toHighlightColor(kz.formatedData)}});T.addEventListener("onspotmouseout",function(kB){if(!this.temp.isPermitSpotOver){return}if(kB.spots.length>0){var kA=kB.spots[0].userdata.uid;var kC=kB.spots[0].userdata.tilePosStr;var kz=i.getLabelByUid(kA,kC);kz&&kz.formatedData&&i._toDefaultColor(kz.formatedData)}});T.addEventListener("spotclick",function(kB){if(kB.spots&&kB.spots.length>0){if(kB.spots[0].userdata.zoom<10){return}var kA=kB.spots[0].userdata.uid;var kC=kB.spots[0].userdata.tilePosStr;if(i.currentSelectedLabel&&(i.currentSelectedLabel.uid!==kA||i.currentSelectedLabel.tilePosStr!==kC)){i._recoverNormalState()}var kz=i.getLabelByUid(kA,kC);kz&&i._changeBaseMapState(kz)}else{i._recoverNormalState()}});T.on("spot_status_reset",function(){i._recoverNormalState()});T.on("spot_highlight",function(kA){var kz=i.getLabelByUid(kA.uid,kA.tilePosStr);kz&&kz.formatedData&&i._toHighlightColor(kz.formatedData)});T.addEventListener("mousemove",function(kz){if(i.curSpotAdded){return}if(this.currentOperation!==ep.idle||i._mapIsMoving===true){return}i._refreshSpotData();this.temp.isPermitSpotOver=true;i.curSpotAdded=true});if(b5()){function e(){i._refreshSpotData()}T.addEventListener("mapstatusidle_inner",e)}T.on("style_loaded",function(){if(i.map.config.textRenderType==="canvas"&&!i._labelTextCanvas){i._labelTextCanvas=i.map.tileMgr.getLabelTextCanvas()}});T.on("destroy",function(){i.iconCache.clear();for(var kz=0;kz<i.fixedLabelData.length;kz++){i.fixedLabelData[kz]=null}i.fixedLabelData=[];i.lineLabelData=[];i.highlightLabelData=[];for(var kz=0;kz<i.allLabels.length;kz++){i.allLabels[kz]._mcBds=null;i.allLabels[kz]=null}i.allLabels=[];for(var kz=0;kz<i._spotData.length;kz++){i._spotData[kz].pt=null;i._spotData[kz].userdata.iconPoint=null;i._spotData[kz]=null}i._spotData=[]})},getLabelByUid:function(kD,kE){var e=this.map._featureMgr.getResult().tileLabels[this.layer.drawIndex]||[];for(var kC=0;kC<e.length;kC++){var kz=e[kC].fixedLabel;for(var kB=0;kB<kz.length;kB++){if(e[kC].fixedLabel[kB].guid===kD&&e[kC].fixedLabel[kB].tilePosStr===kE){return e[kC].fixedLabel[kB]}}var kA=e[kC].indoorLabel;for(var T=0;T<kA.length;T++){if(e[kC].indoorLabel[T].guid===kD&&e[kC].indoorLabel[T].tilePosStr===kE){return e[kC].indoorLabel[T]}}}return null},getTileByLabelUid:function(kD){var e=this.map._featureMgr.getResult().tileLabels[this.layer.drawIndex]||[];for(var kC=0;kC<e.length;kC++){var kz=e[kC].fixedLabel;for(var kB=0;kB<kz.length;kB++){if(e[kC].fixedLabel[kB].guid===kD){return e[kC]}}var kA=e[kC].indoorLabel;for(var T=0;T<kA.length;T++){if(e[kC].indoorLabel[T].guid===kD){return e[kC]}}}return null},_toHighlightColor:function(T){if(T.tempRank&&T.tempRank===this.RANK5){return}var e=this.map._featureMgr.getResult().eleData[4][this.layer.drawIndex]||[];var kA=false;for(var kz=0;kz<e.length;kz++){if(e[kz]===T||(e[kz].guid===T.guid&&e[kz].tilePosStr===T.tilePosStr&&e[kz].zoom===T.zoom)){kA=true;break}}if(kA){return}e.push(T);this.map._featureMgr.setOverlayData(e,4,this.layer.drawIndex);this.map.dispatchEvent(new fW("onrefresh"))},_toDefaultColor:function(T){if(T.tempRank&&T.tempRank===this.RANK5){return}var e=this.map._featureMgr.getResult().eleData[4][this.layer.drawIndex]||[];for(var kz=0;kz<e.length;kz++){if(T===e[kz]||(T.guid===e[kz].guid&&T.tilePosStr===e[kz].tilePosStr&&T.zoom===e[kz].zoom)){e.splice(kz,1);break}}this.map._featureMgr.setOverlayData(e,4,this.layer.drawIndex);this.map.dispatchEvent(new fW("onrefresh"))},_changeBaseMapState:function(i){var kA=i.guid;var kE=i.formatedData.guidExt;var kF={guid:kA,tilePosStr:i.tilePosStr,guidExt:kE};this._strategyInfo=kF;this.currentSelectedLabel=i;var kz=this.map._featureMgr;var e=kz.getLabelData(this.layer.drawIndex);e=this.collisionTest(e);this.updateLabels(e);var kG=this.fixDataFormat(e);kz.setOverlayData(kG[0],2,this.layer.drawIndex);kz.setOverlayData(kG[1],3,this.layer.drawIndex);kz.setOverlayData(kG[2],4,this.layer.drawIndex);var T=this.getTileByLabelUid(kA);this.currentSelectedLabel.tileInfo=T.tileInfo;var kD=this.layer.tileCache.getAllData();for(var kC in kD){var kB=kD[kC].data;if(!kB.label){continue}this.clearCollisionCache(kB.label)}this.map.dispatchEvent(new fW("onrefresh"))},_recoverNormalState:function(){this._strategyInfo=null;var kD=false;var kB=this.map._featureMgr.getLabelData(this.layer.drawIndex);if(this.currentSelectedLabel){var T=this.currentSelectedLabel.guid;this.clearCollisionCache(this.getTileByLabelUid(T));var kA=this.layer.tileCache.getAllData();for(var kz in kA){if(Object.prototype.hasOwnProperty.call(kA,kz)){var kC=kA[kz].data;if(!kC.label){continue}this.clearCollisionCache(kC.label)}}this.currentSelectedLabel.tempRank=null;this.currentSelectedLabel=null;kD=true}kB=this.collisionTest(kB);this.updateLabels(kB);var e=this.fixDataFormat(kB);var i=this.map._featureMgr;i.setOverlayData(e[0],2,this.layer.drawIndex);i.setOverlayData(e[1],3,this.layer.drawIndex);i.setOverlayData([],4,this.layer.drawIndex);this.map.dispatchEvent(new fW("onrefresh"));if(kD){this.curSpotAdded=false;this._refreshSpotData()}},loadIconImages:function(kM,kC,T){var kL=kM.label;var kO=kM.tileInfo.style;var kA=kL.fixedLabel;if(T==="indoor"){kA=[]}var kK=kL.indoorLabel;var kJ=kA.length+kK.length;var kP=this;var kN=0;var kH=200;for(var kI=0;kI<kJ;kI++){var kF;if(kI<kA.length){kF=kA[kI]}else{kF=kK[kI-kA.length]}if(!kF.iconPos){var kE=this.loadSVGSymbol(kF,kO);if(!kE){continue}else{if(kE!==true){var kD=kF.iconPos.iconType;var e=kO+"_"+kD;this.iconCache.setData(e,{loaded:false,image:kE});kF.iconPos.img=kE}}}var kD=kF.iconPos.iconType;var e=kO+"_"+kD;kN++;if(this.iconCache.getData(e)){if(this.iconCache.getData(e).loaded){kC(kM)}else{if(kF.iconPos.img){kF.iconPos.img.id=e;kF.iconPos.img.iconUrl=kD;this.iconCache.setData(e,{loaded:true,image:kF.iconPos.img});this._addToIconTexture(kF.iconPos.img);kC(kM)}else{}}continue}if(!T||T==="indoor"){var kB=E.getIconSetPath(this.map.config.style)+kD+".png";var kG=bH();if(kG&&kG.udt){kB+="?udt="+kG.udt}}else{var kB=kD}var kz=new Image();kz.id=e;kz.iconUrl=kB;kz.crossOrigin="anonymous";kz.onload=function(){if(kP.iconCache.getData(this.id)){kP.iconCache.getData(this.id).loaded=true;kP._addToIconTexture(this)}if(!kP._iconLoadTimer){kP._iconLoadTimer=setTimeout(function(){kC();kP._iconLoadTimer=null},kH)}this.onload=null};kz.onerror=function(){if(!kP._iconLoadTimer){kP._iconLoadTimer=setTimeout(function(){kC();kP._iconLoadTimer=null},kH)}kP.iconCache.removeData(this.id);this.onerror=null;bG.fetchDebug&&bG.fetchDebug.sendError({title:this.iconUrl,msg:this.iconUrl,category:bG.fetchDebug.category.RESOURCE,level:bG.fetchDebug.levels.ERROR,url:this.iconUrl})};kz.src=kB;this.iconCache.setData(e,{loaded:false,image:kz})}return kN},_addToIconTexture:function(kB){if(!this.map._webglMapScene){return}var kD=this.map._webglMapScene._painter;var e=kD._iconTextureAtlas.addTexture(kB);if(e===false){this.map.fire(new fW("onlayer_clear"))}if(!e){return}kD._iconTextureAtlasOffset[kB.id]=e;var kG=0*kB.width/1024+e.width;var kA=0*kB.height/1024+e.height;var kF=kB.width/1024+e.width;var kz=kA;var kE=kF;var T=kB.height/1024+e.height;var kC=kG;var i=T;kD._iconTextureAtlasCoords[kB.id]=[kG,kA,kF,kz,kE,T,kG,kA,kE,T,kC,i]},loadSVGSymbol:function(kz,T){var i=kz.symbol||{};var kC=dU.generateKey(i.path,i);if(!kC){return null}var kB=this.iconCache.getData(T+"_"+kC);if(kB&&kB.loaded){kz.iconPos=this.createVertex(kB.image.width/2,kB.image.height/2,kC);return true}var kA=new dU(i.path,i);kA.add();var e=kA.render();if(!e){return null}kz.iconPos=this.createVertex(kA.size.width,kA.size.height,kC);return kA.data},createVertex:function(kB,kF,T){var kA=Math.round(-kB/2);var kH=Math.round(-kF/2);var kz=kA+kB;var kG=kH;var i=kz;var kE=kG+kF;var e=kA;var kD=kE;var kC={vertex:[kA,kH,kz,kG,i,kE,kA,kH,i,kE,e,kD],texcoord:null,width:kB,height:kF,iconType:T};return kC},loadImgByStr:function(kz,kA,kB){if(!kz&&!kA){kB&&kB(null,null);return}if(typeof kz==="object"&&typeof kA==="object"){kB(kz,kA);return}var i=0;var T=null;var e=null;if(kz){i++;T=new Image();T.onload=function(){i--;if(i===0){kB&&kB(this,e)}this.onload=null};T.src=kz}if(kA){i++;e=new Image();e.onload=function(){i--;if(i===0){kB&&kB(T,this)}this.onload=null};e.src=kA}},collisionTest:function(lr,kK,kR){if(this.map.viewAnimationTime){return[]}if(!lr){return[]}if(this.layer.ontology&&this.layer.ontology.noCollision){for(var k2=0;k2<lr.length;k2++){var lF=lr[k2].fixedLabel;for(var k0=0;k0<lF.length;k0++){var kC=lF[k0];var lH=this.layer.ontology.getLayerVisible(kC.layerName);kC.isDel=!lH}}return lr}var kN=this.map;var lv=kN.getHeading();lv=this.calcLoopHeading(lv);var ld=kN.height;var k5=this.allLabels;for(var k2=0;k2<k5.length;k2++){k5[k2]._mcBds=null}k5.length=0;lr.sort(function(ll,i){var lJ=ll.tileInfo;var lI=i.tileInfo;if(lJ.col*lJ.row<lI.col*lI.row){return -1}else{return 1}});var kO=kN.getTilt();var lw=kN.getZoom();if(this.layer.ontology){lw+=(this.layer.spanLevel||0)}var kY;if(kR){kY=kR}else{kY=this.getZoomStep()}for(var k2=0,kW=lr.length;k2<kW;k2++){var T=lr[k2];var k6=T.tileInfo;var kZ=k6.zoom;var le=k6.loopOffsetX/Math.pow(2,18-kZ);if(!lv&&!kO){if(T.unnecessaryCollisionTest&&T.unnecessaryCollisionTest[kR]){continue}}var lF=T.fixedLabel||[];for(var k0=0,lC=lF.length;k0<lC;k0++){var kC=lF[k0];kC.zoom=kZ;if(kK===-1&&kC.isDel){continue}if(this.layer.ontology){var lH=this.layer.ontology.getLayerVisible(kC.layerName);if(!lH){continue}}if(!et(kC,k6.useZoom,lw)){kC.isDel=true;continue}this.calcCollisionBounds(kC,kY,le,ld);k5.push(kC)}var k1=T.indoorLabel||[];for(var kX=0,k9=k1.length;kX<k9;kX++){var k8=k1[kX];k8.zoom=kZ;if(kK===-1&&k8.isDel){continue}if(!et(k8,k6.useZoom)){k8.isDel=true;continue}this.calcCollisionBounds(k8,kY,le,ld);k5.push(k8)}var lB=T.lineLabel||[];for(var k4=0,kP=lB.length;k4<kP;k4++){var ln=lB[k4];if(kK===-1&&ln.isDel){continue}if(!et(ln,k6.useZoom)){ln.isDel=true;continue}var kD=ln.pt;var lm=kN.pointToPixelIn(kD,{zoom:kY,useRound:this._useRound});var lE=lm.x+le;var lD=ld-lm.y;var kA=ln.bds;var lp=kA[0];var lo=kA[1];var kT=kA[2];var kS=kA[3];var kM=lp;var kL=lo;var lA=kT;var lz=kS;if((lv>=0&&lv<45)||(lv>=315&&lv<360)){kM=lp;kL=lo;lA=kT;lz=kS}else{if(lv>=45&&lv<135){kM=lo;kL=-kT;lA=kS;lz=-lp}else{if(lv>=135&&lv<225){kM=-kT;kL=-kS;lA=-lp;lz=-lo}else{if(lv>=225&&lv<315){kM=-kS;kL=lp;lA=-lo;lz=kT}}}}ln._tempBds=[lE+kM,lD+kL,lE+lA,lD+lz];var lt=kN.pixelToPointIn(new fv(ln._tempBds[0],lm.y+kL),{zoom:kY});var lk=kN.pixelToPointIn(new fv(ln._tempBds[2],lm.y+lz),{zoom:kY});ln._mcBds=[lt,lk];k5.push(ln)}}var lj=this._strategyInfo;if(lj){var k3=lj.guid;var kU=lj.guidExt;var lh=false;for(var kV=0,kJ=k5.length;kV<kJ;kV++){var kB=k5[kV];delete kB.tempRank;if(!this.layer.isClickableLabel(kB)||(kU===1&&!kB.guidExt)){continue}if(k3===kB.guid&&lj.tilePosStr===kB.tilePosStr){kB.tempRank=this.RANK5;lh=true}}if(!lh&&this.currentSelectedLabel){this.currentSelectedLabel.tempRank=this.RANK5;var k7=this.currentSelectedLabel.tileInfo;if(k7){var kQ=k7.zoom;var lu=k7.loopOffsetX/Math.pow(2,18-kQ);this.calcCollisionBounds(this.currentSelectedLabel,kY,lu,ld);k5.push(this.currentSelectedLabel)}}}else{for(var kz=0,kI=k5.length;kz<kI;kz++){var kF=k5[kz];if(kF.type==="line"||!kF.iconPos){continue}delete kF.tempRank}}k5.sort(function(lI,ll){var lJ=lI.tempRank?lI.tempRank:lI.rank;var i=ll.tempRank?ll.tempRank:ll.rank;return i-lJ||lI.startZoom-ll.startZoom||ll.pt.lng-lI.pt.lng||ll.pt.lat-lI.pt.lat});var ly=0;if(kO>0){ly=6}lw=kN.getZoom();if(lw>=8&&lw<9){lw<8.5?(ly=6):(ly=3)}if(kN._displayOptions.labelMargin>0){ly=kN._displayOptions.labelMargin}var lf=2;if(lw<6&&lw>=5){lf=-1}for(var li=0,kH=k5.length;li<kH;li++){var lx=k5[li];var lq=lx._tempBds;lx.isDel=false;lx._intersectIdx=[];for(var lb=li+1;lb<kH;lb++){var lc=k5[lb];var lG=lc._tempBds;if(!(lq[2]+ly+lf<lG[0]-ly||lq[0]-ly>lG[2]+ly+lf||lq[3]+ly+lf<lG[1]-ly||lq[1]-ly>lG[3]+ly+lf)){lx._intersectIdx.push(lb)}}}for(var lg=0,kG=k5.length;lg<kG;lg++){var kE=k5[lg];if(kE.isDel===false){var e=kE._intersectIdx;for(var la=0,ls=e.length;la<ls;la++){k5[e[la]].isDel=true;if(k5[e[la]].cachedIsDel){k5[e[la]].cachedIsDel[kR]=true}}}}return lr},calcCollisionBounds:function(kF,kD,i,kE){var kB=kF.ptFix||kF.pt;var kz=this.map;var kA=kz.pointToPixelIn(kB,{zoom:kD,useRound:this._useRound});var T=kA.x+i;var kH=kE-kA.y;var e=kF.bds;kF._tempBds=[T+e[0],kH+e[1],T+e[2],kH+e[3]];var kC=kz.pixelToPointIn(new fv(kF._tempBds[0],kA.y+e[1]),{zoom:kD});var kG=kz.pixelToPointIn(new fv(kF._tempBds[2],kA.y+e[3]),{zoom:kD});kF._mcBds=[kC,kG]},getZoomStep:function(){var T=this.map.getZoom();var e=Math.floor(T);var i=T-e>=0.5?e+0.5:e;return i},clearCollisionCache:function(e){if(!e){return}e.cacheState=null;e.unnecessaryCollisionTest=null},getCachedLabels:function(e){e=e||[];var T=this.getZoomStep();var kB=false;for(var kz=0;kz<e.length;kz++){var kA=e[kz];if(!kA.cacheState||!kA.cacheState[T]){kB=true;break}if(kA.hasNewData){kB=true;break}}if(kB){this.calcLabelsCollision(e)}return e},calcLabelsCollision:function(T){var kA=this.getZoomStep();var kB={};var kI;var kz;var kK;var kM;var kL;var kJ;T=this.collisionTest(T,undefined,kA);a2.addLabelIntoAreaSpots(T);for(var kF=0;kF<T.length;kF++){kI=T[kF];kz=kI.tileInfo;kM=kz.col+","+kz.row;kB[kM]=1}var e={};for(var kD=0;kD<T.length;kD++){kI=T[kD];if(!kI.cacheState){kI.cacheState={}}kz=kI.tileInfo;kL=kz.col;kJ=kz.row;kM=kL+","+kJ;if(kI.cacheState[kA]==="stable"){e[kM]=1;if(!kI.hasNewData){continue}}for(var kE=0;kE<kI.fixedLabel.length;kE++){kK=kI.fixedLabel[kE];if(!kK.cachedIsDel){kK.cachedIsDel={}}kK.cachedIsDel[kA]=kK.isDel}for(var kH=0;kH<kI.indoorLabel.length;kH++){kK=kI.indoorLabel[kH];if(!kK.cachedIsDel){kK.cachedIsDel={}}kK.cachedIsDel[kA]=kK.isDel}for(var kG=0;kG<kI.lineLabel.length;kG++){kK=kI.lineLabel[kG];if(!kK.cachedIsDel){kK.cachedIsDel={}}kK.cachedIsDel[kA]=kK.isDel}if(kB[(kL-1)+","+(kJ-1)]&&kB[(kL-1)+","+kJ]&&kB[(kL-1)+","+(kJ+1)]&&kB[kL+","+(kJ-1)]&&kB[kL+","+(kJ+1)]&&kB[(kL+1)+","+(kJ-1)]&&kB[(kL+1)+","+kJ]&&kB[(kL+1)+","+(kJ+1)]){kI.cacheState[kA]="stable";e[kM]=1}else{if(!kI.cacheState[kA]){kI.cacheState[kA]="unstable"}}}for(var kC=0;kC<T.length;kC++){kI=T[kC];kz=kI.tileInfo;kM=kz.col+","+kz.row;kL=+kz.col;kJ=+kz.row;if(e[(kL-1)+","+(kJ-1)]&&e[(kL-1)+","+kJ]&&e[(kL-1)+","+(kJ+1)]&&e[kL+","+(kJ-1)]&&e[kL+","+(kJ+1)]&&e[(kL+1)+","+(kJ-1)]&&e[(kL+1)+","+kJ]&&e[(kL+1)+","+(kJ+1)]){if(!kI.unnecessaryCollisionTest){kI.unnecessaryCollisionTest={}}kI.unnecessaryCollisionTest[kA]=1}}T.hasNewData=false},updateLabels:function(kA){var T=this.map;var kG=T.getZoom();var kI=T.getHeading();kI=this.calcLoopHeading(kI);var kH=T.getTilt();var kB=this.getZoomStep();for(var kF=0,kC=kA.length;kF<kC;kF++){var kE=kA[kF];var kz=kE.tileInfo;var kD=kz.loopOffsetX||0;var e={zoom:kG,mcOffsetX:kD};this.updateFixedLabel(kE.fixedLabel,kH,kI,kE,kB,e);e={zoom:kG,mcOffsetX:0};this.updateFixedLabel(kE.indoorLabel,kH,kI,kE,kB,e);this.updateLineLabel(kE.lineLabel,kH,kI,kE,kB)}},updateFixedLabel:function(kF,kI,i,kL,kB,kG){if(kF.length===1){}var e=kG.zoom;var kA=kG.mcOffsetX;var kQ;for(var kM=0,kD=kF.length;kM<kD;kM++){var kH=kF[kM];if(!kH.cachedIsDel){continue}if(!kI&&!i&&kL.cacheState&&kL.cacheState[kB]){kH.isDel=kH.cachedIsDel[kB];if(typeof kH.isDel==="undefined"){kH.isDel=kH.cachedIsDel[kB]=true}}if(kH.startScale>e){kH.isDel=true}if(kH.isDel){continue}var kP=kH.pt;var T=(kH.hue||0)?gG(kH.hue):0;var kz=kH.iconPos;if(kz&&kz.texcoord){if(!kz.rtVertex){kz.rtVertex=[];kQ=kz.vertex;var kE=i3(kP.lng);var kO=i3(kP.lat);kz.rtVertex=[kE[0],kO[0],kE[1],kO[1],0,kQ[0],kQ[1],0,0,kz.texcoord[0],kz.texcoord[1],T,kE[0],kO[0],kE[1],kO[1],0,kQ[2],kQ[3],0,0,kz.texcoord[2],kz.texcoord[3],T,kE[0],kO[0],kE[1],kO[1],0,kQ[4],kQ[5],0,0,kz.texcoord[4],kz.texcoord[5],T,kE[0],kO[0],kE[1],kO[1],0,kQ[6],kQ[7],0,0,kz.texcoord[6],kz.texcoord[7],T,kE[0],kO[0],kE[1],kO[1],0,kQ[8],kQ[9],0,0,kz.texcoord[8],kz.texcoord[9],T,kE[0],kO[0],kE[1],kO[1],0,kQ[10],kQ[11],0,0,kz.texcoord[10],kz.texcoord[11],T]}}if(!kH.textOnIcon){T=0}var kN=kH.textPos;if(kN){if(!kN.rtVertex){kN.rtVertex=[];kQ=kN.vertex;var kC=kN.rtVertex;var kK=i3(kP.lng);var kT=i3(kP.lat);var kS=i3(kA);for(var kJ=0,kR=kQ.length;kJ<kR;kJ+=12){kC.push(kK[0],kT[0],kK[1],kT[1],0,kQ[kJ],kQ[kJ+1],kS[0],kS[1],kN.texcoord[0],kN.texcoord[1],T);kC.push(kK[0],kT[0],kK[1],kT[1],0,kQ[kJ+2],kQ[kJ+3],kS[0],kS[1],kN.texcoord[2],kN.texcoord[3],T);kC.push(kK[0],kT[0],kK[1],kT[1],0,kQ[kJ+4],kQ[kJ+5],kS[0],kS[1],kN.texcoord[4],kN.texcoord[5],T);kC.push(kK[0],kT[0],kK[1],kT[1],0,kQ[kJ+6],kQ[kJ+7],kS[0],kS[1],kN.texcoord[6],kN.texcoord[7],T);kC.push(kK[0],kT[0],kK[1],kT[1],0,kQ[kJ+8],kQ[kJ+9],kS[0],kS[1],kN.texcoord[8],kN.texcoord[9],T);kC.push(kK[0],kT[0],kK[1],kT[1],0,kQ[kJ+10],kQ[kJ+11],kS[0],kS[1],kN.texcoord[10],kN.texcoord[11],T)}}}}},updateLineLabel:function(kE,k7,kX,kS,kT){kE=kE||[];var kN=this.map;var kH=kN.getZoomUnits();for(var k6=0,k4=kE.length;k6<k4;k6++){var kD=kE[k6];if(!kD.cachedIsDel){continue}if(!k7&&!kX&&kS.cacheState&&kS.cacheState[kT]){kD.isDel=kD.cachedIsDel[kT];if(typeof kD.isDel==="undefined"){kD.isDel=kD.cachedIsDel[kT]=true}}if(kD.isDel){continue}if(!kD.styleText||kD.styleText.length===0){continue}var kF=kD.mcInTile;var k0=kF.x;var kY=kF.y;var kR=kD.wordsInfo;var kP=kD.labelAngle;var kL=false;var kZ=0;if(kX!==0){var kM=kR[0].angle;var k3=this.calcLoopHeading(kM-kX);if(k3>45&&k3<315){if(k3>45&&k3<=135){kZ=270}else{if(k3>135&&k3<=225){kZ=180}else{if(k3>225&&k3<315){kZ=90}}}if(kP>225&&kP<=315&&kZ<=180){kL=true}else{if((kP>=0&&kP<=45||kP>=315&&kP<360)&&kZ>=180){kL=true}}}}for(var k5=0,kI=kR.length;k5<kI;k5++){var k2=kR[k5];var kK=k2.calcInfo;var kW=k2.offset[0];var kU=k2.offset[1];if(!k2.size){continue}var e=k2.size[0];var T=k2.size[1];var kJ=k2.angle;if(!kK){kK={}}if(kX!==kK.mapHeading||kH!==kK.zoomUnits){kK.mapHeading=kX;kK.zoomUnits=kH;if(kL){var kO=kR[kI-1-k5];kW=kO.offset[0];kU=kO.offset[1];kJ=kO.angle}var kA=k0+kW*kH;var kz=kY+kU*kH;kK.rotationCenter={lng:kA,lat:kz};kK.calcHeading=kZ;kK.angle=kJ;kK.offsetX=kW;kK.offsetY=kU;k2.calcInfo=kK}if(!k2.rtVertex){k2.rtVertex=[]}k2.rtVertex.length=0;var kQ=kK.calcHeading+kK.angle;var kB=kK.rotationCenter;kW=kK.offsetX;kU=kK.offsetY;var kC=Math.round(kW-e/2);var k1=Math.round(kW+e/2);var kV=Math.round(kU+T/2);var kG=Math.round(kU-T/2);k2.rtVertex.push(k0,kY,k2.z,kC,kG,kB.lng,kB.lat,kQ,k2.texcoord[0],k2.texcoord[1],k0,kY,k2.z,k1,kG,kB.lng,kB.lat,kQ,k2.texcoord[2],k2.texcoord[3],k0,kY,k2.z,k1,kV,kB.lng,kB.lat,kQ,k2.texcoord[4],k2.texcoord[5],k0,kY,k2.z,kC,kG,kB.lng,kB.lat,kQ,k2.texcoord[6],k2.texcoord[7],k0,kY,k2.z,k1,kV,kB.lng,kB.lat,kQ,k2.texcoord[8],k2.texcoord[9],k0,kY,k2.z,kC,kV,kB.lng,kB.lat,kQ,k2.texcoord[10],k2.texcoord[11])}}},calcLoopHeading:function(e){while(e>=360){e-=360}while(e<0){e+=360}return e},fixDataFormat:function(kH){var kz=this.fixedLabelData;var e=this.lineLabelData;var T=this.highlightLabelData;var kP=0;var kD=0;var kM=0;var kN;if(this.currentSelectedLabel){var kC=this.getLabelByUid(this.currentSelectedLabel.guid,this.currentSelectedLabel.tilePosStr);if(!kC||kC.isDel){kz[kP]=this.currentSelectedLabel.formatedData;kP++;T[kM]=this.currentSelectedLabel.formatedData;kM++}}for(var kL=0;kL<kH.length;kL++){var kF=kH[kL];var kE=kF.fixedLabel;var kA=kF.indoorLabel;var kK=kF.lineLabel;var kO={highlightLabelData:T,highlightLabelDataLen:kM};kN=this.fixFixedLabelDataFormat(kE,kF,kz,kP,kO);kP=kN[0];kM=kN[1];if(this.map._displayOptions.indoor){kN=this.fixFixedLabelDataFormat(kA,kF,kz,kP,kO,true);kP=kN[0];kM=kN[1]}e[kD]={tileInfo:kF.tileInfo,lineLabels:[]};for(var kJ=0;kJ<kK.length;kJ++){if(kK[kJ].isDel){continue}var kG=kK[kJ].wordsInfo;if(kG){for(var kI=0;kI<kG.length;kI++){if(!kG[kI].rtVertex){continue}var kB=kG[kI].formatedData;if(!kB){kB={textureSource:kF.textureSources[kK[kJ].processedInZoom],textureHeight:kF.textureHeights[kK[kJ].processedInZoom],renderData:{vertex:kG[kI].rtVertex,textureCoord:kG[kI].texcoord}};kG[kI].formatedData=kB}e[kD].lineLabels.push(kB)}}}kD++}kz.length=kP;e.length=kD;T.length=kM;return[e,kz,T]},fixFixedLabelDataFormat:function(kD,kG,kH,kE,T,kF){var kB=T.highlightLabelData;var e=T.highlightLabelDataLen;for(var i=0;i<kD.length;i++){if(kD[i].isDel){continue}var kC=kD[i].textPos;var kA=kD[i].iconPos;var kz=null;if(kC&&kC.rtVertex){if(!kD[i].formatedData){kz={guid:kD[i].guid,guidExt:kD[i].guidExt,tilePosStr:kD[i].tilePosStr,zoom:kD[i].zoom,tempRank:kD[i].tempRank,textureSource:kG.textureSources?kG.textureSources[kD[i].processedInZoom]:[],textureHeight:kG.textureHeights?kG.textureHeights[kD[i].processedInZoom]:[],renderData:{vertex:kC.rtVertex,textureCoord:kC.texcoord}};if(kF&&kD[i].onDefaultFloor===false){kz.textureSource=kG.indoorTextureSources[kD[i].processedInZoom];kz.textureHeight=kG.indoorTextureHeights[kD[i].processedInZoom]}kD[i].formatedData=kz}else{kz=kD[i].formatedData;kz.tempRank=kD[i].tempRank}if(this.currentSelectedLabel&&kz.guid===this.currentSelectedLabel.guid&&kz.tilePosStr===this.currentSelectedLabel.tilePosStr){kB[e]=kz;e++}}if(kA&&kA.rtVertex){if(kz){if(!kz.iconRenderData){kz.iconRenderData={vertex:kA.rtVertex,textureCoord:kA.texcoord}}}else{kz={guid:kD[i].guid,guidExt:kD[i].guidExt,zoom:kD[i].zoom,tempRank:kD[i].tempRank,iconRenderData:{vertex:kA.rtVertex,textureCoord:kA.texcoord}};kD[i].formatedData=kz}}kH[kE]=kz;kE++}return[kE,e]},_refreshSpotData:function(){this._spotData.length=0;var kE=this.map;var kC=Math.floor(kE.getZoom());var T=this.map._featureMgr.getLabelData(this.layer.drawIndex);if(this.layer.drawIndex!==0){return}if(T){for(var kA=0,kz=T.length;kA<kz;kA++){this._addFixedSpotData(T[kA].fixedLabel,kC);this._addFixedSpotData(T[kA].indoorLabel,kC)}}var kF=this.currentSelectedLabel;if(kF&&!this.getTileByLabelUid(kF.guid,kF.tilePosStr)){var kB=this._getSpotDataFromLabel(this.currentSelectedLabel);if(kB){this._spotData.push(kB)}}var kD=new fW("onspotsdataready");kD.spots=this._spotData;kD.index=this.layer.drawIndex;kE._spotDataOnCanvas=this._spotData;kE.dispatchEvent(kD)},_addFixedSpotData:function(kA,kz){for(var e=0;e<kA.length;e++){var T=kA[e];if(!this.layer.isClickableLabel(T)||(T.guidExt===1&&T.startScale>kz)){continue}var i=kA[e].spot||this._getSpotDataFromLabel(kA[e]);if(i){this._spotData.push(i)}}},_getSpotDataFromLabel:function(T){var kB=this.map;if(!T.bds){return null}var e=T.bds.slice(0);var kz=null;if(T.iconPos){kz=new cG(T.pt.lng,T.pt.lat)}var i=T.name?T.name.replace("\\\\","<br>"):"";if(T.iconPos&&T.iconPos.iconType.indexOf("ditie")>-1&&kB.getZoom()>14){i=""}var kA={n:i,pt:new cG(T.pt.lng,T.pt.lat),userdata:{iconPoint:kz,uid:T.guid,name:i,mapPoi:true,type:T.iconPos?T.iconPos.iconType:"",rank:T.rank,zoom:T.zoom,tilePosStr:T.tilePosStr},bd:e,tag:"MAP_SPOT_INFO"};T.spot=kA;return kA},drawLabelsOnCanvas:function(i,e){if(this._labelTextCanvas){this._labelTextCanvas.drawLabelsOnCanvas(i,e)}}});function jq(e){this._map=e;this.virtualTiles={};this.virtualTile={custom:true,label:{fixedLabel:[],indoorLabel:[],lineLabel:[],textureHeights:[],status:"ready"},tileInfo:{col:0,row:0,zoom:0,useZoom:0,loopOffsetX:0},status:"ready"};this._task={};this.init()}jq.prototype.init=function(){var T=this._map;var i=this;function e(kz){i.updateLabels(kz)}T.addEventListener("add_tile_labels",e);T.addEventListener("onremove_tile_labels",e);T.addEventListener("onclear_labels",e);T.addEventListener("onlayer_clear",e)};jq.prototype.updateLabels=function(kC){var kG=this._map.tileMgr.getLabelTextCanvas();var T=this._map;var kE=this;var kD=dc();if(kC&&kC.model==="mvt"){var kI=kC.data;var kH="mvt_"+kC.index;if(!this._task[kH]){this._task[kH]=[kD]}else{this._task[kH].push(kD)}}else{var kI=T._customTileLabels;var kH="custom";if(!this._task[kH]){this._task[kH]=[kD]}else{this._task[kH].push(kD)}}var kB=JSON.parse(JSON.stringify(kI));for(var kA=0;kA<kB.length;kA++){var kF=kB[kA];kF.guid=kF.guid||kF.uid;kF.iconPos=this.getIconVertexData(kF.style,1);var kz={textMargin:kF.textMargin,textOnIcon:kF.textOnIcon,iconSize:kF.iconSize,style:{color:kF.style.color,strokeColor:kF.style.strokeColor,fontSize:kF.style.fontSize,haloSize:kF.style.haloSize,}};kB[kA].styleId=kB[kA].styleId||q(kz)}kB.taskId=kD;kG.drawCustomLabelsOnCanvas(kB,function(kN){var kO=true;for(var kL=0;kL<kE._task[kH].length;kL++){if(kE._task[kH][kL]===kB.taskId){kE._task[kH].splice(0,kL+1);kO=false;break}}if(kO){return}if(!kN||!kB||kB.length===0){var e=JSON.parse(JSON.stringify(kE.virtualTile));e.label.tileInfo=e.tileInfo;var kJ=null;e.label.fixedLabel=kB;kE.virtualTiles[kH]={};var kM=new fW("oncustom_labels_ready");kM.virtualTile=e;kM.labelCanvas=kJ;kM.model=kH;kM.imgKey=bG.getGUID("custom_labels_");T.dispatchEvent(kM);return}else{kE.virtualTiles[kH]=[]}for(var kL=0;kL<kN.length;kL++){var e=JSON.parse(JSON.stringify(kE.virtualTile));e.label.tileInfo=e.tileInfo;var kJ=kN[kL];var kK=kB.slice(kJ.range[0],kJ.range[0]+kJ.range[1]);if(kJ){e.label.textureHeights[0]=[kJ.height]}e.label.fixedLabel=kK;kE.virtualTiles[kH].push(e);var kM=new fW("oncustom_labels_ready");kM.virtualTile=e;kM.labelCanvas=kJ;kM.model=kH;kM.imgKey=bG.getGUID("custom_labels_");T.dispatchEvent(kM)}},true)};jq.prototype.getIconVertexData=function(kI,kB){if(!kI||!kI.icon||!kI.iconSize||kI.iconSize.length<2){return null}var kC=2;var kA=kI.iconSize[0]/kC*kB;var kF=kI.iconSize[1]/kC*kB;var kz=Math.round(-kA/2);var kH=Math.round(-kF/2);var T=kz+kA;var kG=kH;var i=T;var kE=kG+kF;var e=kz;var kD=kE;return{vertex:[kz,kH,T,kG,i,kE,kz,kH,i,kE,e,kD],texcoord:null,width:kA,height:kF,iconType:kI.icon}};bG.register(function(e){e._customLabelMgr=new jq(e)});var f0=function(kQ,kP){var kO={"\x65\x61\x6c\x61\x64":"\x65\x6d\x61","\x65\x61\x6d\x68\x61":function(kS,e){return kS!==e},"\x68\x69\x65\x65\x78":"\x65\x61\x61\x68","\x65\x63\x69\x65\x69":"\x61\x6c\x6d","\x6c\x61\x65\x64\x6d":function(kS,e){return kS<e},"\x64\x68\x64\x78\x61":function(kS,e){return kS(e)},"\x68\x65\x64\x6c\x65":"\x78\x65\x6d","\x63\x68\x64\x69\x78":function(kS,e){return kS+e},"\x78\x6c\x68\x61\x68":function(kS,e){return kS+e},"\x65\x6d\x61\x65\x64":function(kT,kS,e){return kT(kS,e)}};var kL="\x31\x2e\x31\x2e\x32";function kJ(kS,kX){var kV=kO["\x65\x61\x6c\x61\x64"];while(kO["\x65\x61\x6d\x68\x61"](kV,kO["\x68\x69\x65\x65\x78"])){switch(kV){case kO["\x65\x63\x69\x65\x69"]:for(var e=0;kO["\x6c\x61\x65\x64\x6d"](e,kT);e++){var kW=kO["\x64\x68\x64\x78\x61"](kX,kS[e]);kU["\x70\x75\x73\x68"](kW)}kV="\x69\x61\x68";break;case"\x69\x61\x68":return kU;case kO["\x68\x65\x64\x6c\x65"]:var kU=[];kV=kO["\x65\x63\x69\x65\x69"];break;case kO["\x65\x61\x6c\x61\x64"]:var kT=kS["\x6c\x65\x6e\x67\x74\x68"];kV=kO["\x68\x65\x64\x6c\x65"];break}}}var kN,kM,kK,kI,kH,kG=decodeURIComponent,kF="\x43\x68\x61\x72",kE="";var kD=[f0];kN="\x64\x65";kM="\x66\x72";kK="\x6f";kH=kO["\x78\x6c\x68\x61\x68"](kM,kK)+"\x6d";kI="\x43\x6f"+kN;var kC=function(e){return kO["\x63\x68\x64\x69\x78"](e,kE)["\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72"][kO["\x63\x68\x64\x69\x78"](kO["\x78\x6c\x68\x61\x68"](kH,kF),kI)](e)};var kB=function(kS){var e={"\x65\x6d\x63\x64\x61":function(kU,kT){return kU(kT)}};return kO["\x65\x6d\x61\x65\x64"](kJ,kS,function(kT){return e["\x65\x6d\x63\x64\x61"](kC,kT)})};var kA=kB["\x63\x61\x6c\x6c"](kC,[39,34,37,96,60,120,97,65,98,66,99,67,100,68,101,69,102,70,103,110,109,111,112,48,49,50,51,52,53,54,55,56,57]);var kz=kJ([28782,27702,26416,25167,24183],function(e){return kG(e)});var T=kB["\x63\x61\x6c\x6c"](kz,[22354,22749,24415,23346,22257,22688,24306,25174,23595,25547,22984,25690,22212,27547,21594,27210,23090,29193,22394,29368,29532,29459,29530,24146,24500,26352,27441,28788,29370,27673,26925,25249,24430]),i={};kz=kB(kz);var kR=new RegExp(kz["\x6a\x6f\x69\x6e"]("\x7c"));for(var kN=0;kO["\x6c\x61\x65\x64\x6d"](kN,kA["\x6c\x65\x6e\x67\x74\x68"]);kN++){i[T[kN]]=kA[kN]}kP=kO["\x65\x6d\x61\x65\x64"](kJ,kP["\x73\x70\x6c\x69\x74"](kE),function(e){return i[e]||e})["\x6a\x6f\x69\x6e"](kE);return kO["\x65\x6d\x61\x65\x64"](kJ,kP["\x73\x70\x6c\x69\x74"](kR),function(e){return kG(e)})}(this,"\x5f\u735a\u5ef2\x72\x73\x69\u72b8\u577a\x54\x69\x6c\u545a\x4b\u545a\x79\u6730\u59c8\x69\u545a\x69\x6c\u624f\u5ef2\u59c8\u5ef2\u59c8\x68\u624f\x6c\u7313\u5ef2\u56c4\x54\x69\x6c\u545a\u6b9b\u5ef2\x74\u5ef2\u624f\x74\x69\x6c\u545a\x49\u72b8\u5a32\u7313\u6c36\x74\x69\x6c\u545a\x4b\u545a\x79\u624f\x6c\u5ef2\u5ef2\u545a\u5ef2\u706e\u5ef2\u59c8\u735c\x6c\u58a0\u6c36\u5ef2\u735c\u59c8\u624f\u56c4\x6c\x68\x6c\u5ef2\u6c36\x6c\u545a\u72b8\u577a\x74\x68\u5e77\u5ef2\x6c\u545a\x6c\x6c\u6730\x69\u58a0\u735c\u5ef2\x69\u624f\u56c4\u5ef2\x74\u5ef2\u624f\u545a\x6c\x69\u545a\u545a\u706e\x5f\x69\x73\u63cb\x75\x73\x79\u6c36\u59c8\u735c\u735c\x69\x68\u624f\u7313\u72b8\x72\u545a\u5a32\x72\u545a\x73\x68\u6c36\u56c4\x6c\x69\u56c4\u545a\u5e77\x6c\u545a\x68\u58a0\x69\u706e\x68\u545a\u58a0\u624f\u59c8\u5ef2\u545a\u5ef2\x6c\u5e77\x73\u7313\x75\x72\u59c8\u545a\u6730\u59c8\u5ef2\u58a0\u58a0\u59c8\u624f\u545a\u545a\u5ef2\u545a\u59c8\u706e\u59c8\u5c2b\x6b\u5e77\u5ef2\u59c8\u59c8\u5ef2\u545a\u6c36\x68\u5ef2\u5ef2\u6730\u58a0\u545a\u545a\u735c\u59c8\u624f\u59c8\u545a\x68\u735c\u56c4\u5e77\u59c8\u59c8\u5ef2\x69\u56c4\u5e77\u59c8\x68\u58a0\x6c\x6c\u6730\u545a\u5ef2\u545a\u56c4\u5ef2\u5e77\u545a\u545a\u5ef2\u5e77\x6c\u5ef2\u58a0\u58a0\u59c8\u5e77\x69\x73\x53\u545a\u72b8\u56c4\u7209\x53\u5e77\x6c\x68\x6c\u545a\x68\u6730\u5ef2\x6c\u58a0\u6730\x68\u59c8\u735c\u545a\u5ef2\u624f\u545a\u59c8\x68\u56c4\x69\u706e\u735c\x69\x69\u545a\u58a0\u6730\u56c4\u545a\x68\u6730\u5ef2\u58a0\u58a0\u58a0\x69\u624f\u59c8\u735c\u735c\x69\u58a0\u624f\u56c4\u545a\x73\x74\x72\u7313\x79\u6c36\u56c4\u58a0\u545a\u59c8\u735c\u6730\x69\u735c\x68\u545a\x6c\u6c36\u5ef2\u56c4\u735c\u5e77\x6c\u735c\u545a\u5e77\x6c\u58a0\u5ef2\u706e\x69\x68\u735c\u6730\u545a\x6c\u5ef2\x69\u58a0\u6730\u59c8\u545a\u545a\x6c\u5ef2\u624f\x74\u545a\x72\u735c\x69\u72b8\u5ef2\x74\u545a\u624f\x68\x6c\u545a\u56c4\x6c\u6730\u56c4\u545a\u545a\u5ef2\u545a\u706e\x6b\u545a\x79\x73\u6730\x68\x68\u5ef2\u59c8\x68\u706e\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x69\u545a\u56c4\x49\u72b8\u56c4\u7313\u7313\x72\x53\x74\x79\x6c\u545a\u706e\x68\u5ef2\x69\u58a0\x68\u624f\u59c8\u58a0\u58a0\x69\u545a\u706e\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x69\u545a\u56c4\u7209\u545a\u5ef2\x74\x75\x72\u545a\x53\x74\x79\x6c\u545a\u6730\x69\u72b8\u56c4\u545a\u58a0\x4f\u5a32\u624f\u5ef2\u5ef2\u58a0\u545a\u5ef2\u6730\u545a\u59c8\u545a\u5e77\u735c\x68\x6c\u6c36\u5ef2\u58a0\u5ef2\x68\u59c8\u6c36\x68\u5ef2\u56c4\u59c8\u545a\u6c36\u735c\u5ef2\u545a\x69\x69\u624f\x6c\u545a\x68\u5ef2\u624f\x6c\u5ef2\u56c4\x68\u545a\u6730\u735c\u5ef2\x69\u6730\u5ef2\x68\u56c4\u624f\x69\u56c4\x5f\u6730\x74\x69\x6c\u545a\x54\x79\u735a\u545a\x4e\u5ef2\u735c\u545a\u624f\u59c8\x69\u5ef2\u59c8\u59c8\u6730\u59c8\u7313\x6c\u6c36\x7a\u7313\u7313\u735c\u6c36\x73\u735a\x6c\x69\u59c8\u545a\u624f\u545a\x69\u59c8\u5e77\u56c4\x69\u5ef2\u5e77\u58a0\u735c\u59c8\u6c36\x69\u59c8\u7313\u72b8\x53\u545a\x74\x49\u72b8\u5a32\u7313\u624f\u58a0\x6c\u735c\u624f\u58a0\u545a\x69\u624f\u735c\u56c4\x69\u706e\x6c\u545a\u5ef2\u624f\x69\u5ef2\x68\u6730\u735c\u545a\u735c\u6c36\u5ef2\u545a\u545a\u624f\u5ef2\u58a0\u59c8\u706e\u56c4\u59c8\u735c\u6730\u545a\u545a\u545a\u624f\u545a\u56c4\u545a\x68\u6c36\x6c\u59c8\u5ef2\u6730\u58a0\u5ef2\x69\u6c36\u5ef2\u545a\u58a0\u6c36\u56c4\u56c4\u5ef2\u5e77\u545a\x69\x6c\u706e\x69\u545a\u735c\u624f\u545a\x6c\u545a\u6730\x6c\u56c4\u545a\u6c36\u58a0\u5ef2\u545a\u706e\u735c\u56c4\u735c\u624f\u58a0\u545a\x68\u706e\u545a\u58a0\u735c\u6c36\u58a0\x68\u545a\u624f\x6c\u5ef2\u5ef2\u624f\u5ef2\x68\u58a0\u5e77\u56c4\u5ef2\u59c8\u5e77\u59c8\x6c\u5ef2\u6730\u5ef2\x72\u545a\u5ef2\x53\x74\x79\x6c\u545a\x49\u56c4\u624f\x6c\x6c\u545a\u56c4\u5ef2\u6c36\x68\u59c8\u5ef2\u5ef2\u59c8\u624f\x6c\u5ef2\u5ef2\x69\x69\u624f\x68\u5ef2\u58a0\u545a\u5ef2\u624f\u59c8\u545a\u58a0\u56c4\u58a0\u706e\x68\u735c\u735c\u56c4\u735c\u6730\u735c\x68\x69\u624f\u545a\x68\u5ef2\u5ef2\u5ef2\u5e77\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x79\u706e\u58a0\u545a\u545a\u5ef2\u735c\u6c36\u545a\u5ef2\u5ef2\u5ef2\u5ef2\u6c36\x5f\u5ef2\x75\x74\x68\u6730\u735c\u56c4\x69\u56c4\u545a\u6c36\x68\x6c\u5ef2\x6c\x69\u5e77\u58a0\u545a\u545a\u735c\u545a\u624f\x73\x68\u7313\x77\u645a\x75\x73\x74\u7313\u735c\x49\u72b8\u56c4\u7313\u7313\x72\u706e\u735c\u58a0\u5ef2\u59c8\u59c8\u706e\x73\x68\u7313\x77\x56\u545a\u59c8\x74\u7313\x72\x4c\x69\u72b8\u545a\u706e\u5ef2\x6c\x69\u735c\u545a\u6c36\u59c8\x69\u545a\x68\u5ef2\u706e\u7209\u545a\u5ef2\x74\x75\x72\u545a\x53\x74\x79\x6c\u545a\u624f\u545a\x69\u545a\x69\u545a\u624f\u59c8\x6c\x68\u56c4\x69\u5e77\u5ef2\x68\u545a\u59c8\u545a\u5e77\u56c4\u545a\u56c4\u58a0\u735c\u6c36\u5ef2\x69\u5ef2\x68\u735c\u5e77\u59c8\x75\x73\x74\u7313\u735c\x53\x74\x79\x6c\u545a\x49\u72b8\u5a32\u7313\x5f\u5e77\x69\u56c4\u5ef2\x68\u5ef2\u6730\u735c\u5ef2\u735c\x6c\u545a\u6730\x69\u56c4\u56c4\u56c4\u5ef2\u5e77\u56c4\x6c\u5ef2\x69\u545a\u6c36\x6c\u5ef2\u5ef2\u56c4\u5ef2\u6730\u545a\u735c\u5ef2\u6c36\x5f\u56c4\x69\x73\u735a\x6c\u5ef2\x79\x4f\u735a\x74\x69\u7313\u72b8\x73\u5e77\u735a\u7313\x69\u6c36\u545a\u5ef2\u545a\u545a\u58a0\u706e\x69\u59c8\u7313\u72b8\x49\u72b8\u5a32\u7313\u624f\x69\u545a\u545a\u5e77\u735a\u7313\x69\x54\u545a\u58a0\x74\u624f\u58a0\x69\u58a0\u735c\u545a\u624f\u5ef2\x72\u545a\u5ef2\x4d\u5ef2\u735a\x53\x74\x79\x6c\u545a\u6730\u735c\x69\x6c\u5e77\u58a0\u59c8\x6c\u735c\x69\u6730\u56c4\u59c8\x6c\u624f\u59c8\u545a\u735c\u735c\x68\u706e\u577a\u545a\x74\x49\u56c4\x6c\u545a\x57\u7313\x72\x6b\u545a\x72\u706e\u5ef2\u59c8\u59c8\u545a\u59c8\u624f\x6c\x6c\u545a\x69\u735c\u6730\x69\u56c4\u5ef2\x68\u735c\u6c36\x69\u72b8\u56c4\u7313\u7313\x72\x53\x74\x79\x6c\u545a\u6c36\x5f\u735a\u5ef2\x72\x73\x69\u72b8\u577a\x54\x69\x6c\u545a\x49\u72b8\u5a32\u7313\u5e77\x69\x69\x68\u5ef2\x69\u5e77\u5ef2\x6c\x68\u59c8\u59c8\u706e\u58a0\u59c8\x6c\u6730\u59c8\x6c\u5ef2\x68\u59c8\u5e77\u735c\u5ef2\u545a\u545a\u5ef2\u5e77\u545a\u59c8\u56c4\u624f\x6c\x69\u59c8\u545a\x6c\u6730\u735c\u545a\u56c4\u624f\u545a\u59c8\u5ef2\u545a\u59c8\u5e77\u577a\u545a\x74\x4d\u5ef2\u735a\x53\x74\x79\x6c\u545a\x49\u56c4\u5e77\x69\u735c\u545a\u58a0\u58a0\u6c36\x6c\u545a\x6c\u58a0\u58a0\u6c36\u577a\u545a\x74\u6256\x72\u545a\u5ef2\x53\x74\x79\x6c\u545a\x49\u56c4\u6730\u545a\u545a\x6c\u6730\x6c\u545a\x6c\u5e77\x69\u58a0\u545a\u545a\u59c8\u706e\u735c\u5ef2\u735a\x54\x79\u735a\u545a\u706e\x73\x68\u7313\x77\x56\u545a\u59c8\x74\u7313\x72\x53\x74\x72\u545a\u545a\x74\x4c\u5ef2\x79\u545a\x72\u6730\u5c2b\x75\x69\x6c\u56c4\x69\u72b8\u577a\x53\x69\u56c4\u545a\x47\x72\u5ef2\u56c4\u5ef2\x74\x69\u7313\u72b8\u5e77\u59c8\u56c4\u59c8\u5e77\u56c4\u5ef2\x68\u5ef2\x69\u5e77\u56c4\u56c4\x68\u624f\x69\x6c\u58a0\u6730\x73\u545a\x74\x57\u7313\x72\x6b\u545a\x72\u645a\u7313\u72b8\u5a32\x69\u577a\u706e\u735c\u545a\u56c4\u59c8\u5e77\u59c8\u545a\u545a\x68\u58a0\u5e77\u5ef2\x6c\u5ef2\u56c4\u58a0\u5e77\u59c8\x68\u545a\u6730\x68\u5ef2\x73\x4f\x77\u72b8\x50\x72\u7313\u735a\u545a\x72\x74\x79\u6730\u545a\u545a\u5ef2\u5ef2\u5ef2\u6730\u545a\u58a0\x74\u545a\u72b8\u56c4\u624f\u735a\x72\u7313\x74\u7313\x74\x79\u735a\u545a\u6c36\u7313\u72b8\u545a\x72\x72\u7313\x72\u6730\x6c\x69\u545a\u545a\u59c8\u6c36\u5ef2\u5ef2\u545a\u6c36\u58a0\x69\u5ef2\u735c\u5e77\u59c8\u56c4\u545a\u624f\x69\u735c\u735a\u7313\x72\x74\x53\u59c8\x72\x69\u735a\x74\x73\x28\u5f5f\u66f0\u66f0\u706e\u5ef2\u735a\u735a\x6c\x69\u59c8\u5ef2\x74\x69\u7313\u72b8\u5f5f\u66f0\u7209\x6a\u5ef2\x76\u5ef2\x73\u59c8\x72\x69\u735a\x74\u706e\u56c4\x6c\x68\u5e77\u5ef2\x68\u58a0\u5ef2\u6730\x68\u545a\x68\u6c36\u735c\u545a\u5ef2\u706e\u56c4\u545a\u58a0\u624f\u545a\u5ef2\x68\u5e77\u59c8\x72\u545a\u5ef2\x74\u545a\x4f\u5c2b\x6a\u545a\u59c8\x74\x55\x52\x4c\u6730\u56c4\u59c8\u56c4\u5ef2\u545a\u624f\u58a0\u58a0\x69\x6c\u56c4\u624f\u58a0\u59c8\x68\u58a0\x68\u5e77\x68\u56c4\u5ef2\u56c4\x68\u5e77\u545a\u59c8\u5ef2\u59c8\u735c\u624f\u5ef2\u58a0\u58a0\u58a0\x6c\u624f\u5ef2\u5ef2\u5ef2\x6c\u735c\u6c36\u5ef2\u735a\u735a\u545a\u72b8\u56c4\u624f\u5ef2\u59c8\u5ef2\u5ef2\u5ef2\u706e\u56c4\u735c\x68\u735c\x68\u6730\u63cb\x6c\u7313\u5c2b\u63cb\x75\x69\x6c\u56c4\u545a\x72\u5e77\u5ef2\u545a\u59c8\u624f\x55\x52\x4c\u6730\x77\u545a\u5c2b\x6b\x69\x74\x55\x52\x4c\u5e77\x69\u72b8\x69\x74\u5e77\u58a0\x6c\u545a\u5e77\u59c8\u545a\u735c\u6c36\u545a\u56c4\u58a0\u624f\u58a0\x68\u735c\u5ef2\u706e\x6c\u5ef2\u545a\u5e77\x69\x68\u5ef2\u706e\u59c8\x68\u5ef2\u624f\u58a0\x68\x6c\u5ef2\u6730\x69\u59c8\u59c8\u624f\u735c\u735c\x69\u735c\u6c36\x73\x74\x72\x69\u72b8\u577a\u624f\u59c8\x6c\u545a\u5ef2\x72\x53\x74\x79\x6c\u545a\u645a\u5ef2\u59c8\x68\u545a\u6730\x69\u545a\u545a\u5ef2\u5e77\x69\u59c8\u735c\u706e\u58a0\x68\x68\u6c36\u59c8\u545a\u56c4\u624f\u5ef2\u545a\u735c\u6c36\u58a0\u56c4\u59c8\u6730\u56c4\x6c\u56c4\u545a\u6c36\x6c\u545a\x68\u6730\u5ef2\x69\x68\u6c36\u5ef2\u545a\x68\u706e\u545a\u59c8\x6c\u6c36\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x69\u545a\u56c4\x49\u59c8\u7313\u72b8\x53\u545a\x74\x49\u72b8\u5a32\u7313\u5e77\u7313\u72b8\x73\x74\x79\x6c\u545a\x5f\x6c\u7313\u5ef2\u56c4\u545a\u56c4\u6c36\u735c\u5ef2\u735a\u706e\u5ef2\x72\x72\x50\u545a\u72b8\u56c4\x69\u72b8\u577a\u6b9b\u5ef2\x74\u5ef2\u6c36\u735c\u5ef2\u58a0\u5e77\u545a\u56c4\u735c\u545a\x69\u6c36\u735c\u5ef2\u56c4\u5ef2\x68\u6c36\u5ef2\x72\x72\x57\u7313\x72\x6b\u545a\x72\u6c36\x72\u5ef2\x74\x69\u7313\u5e77\x77\u7313\x72\u56c4\x53\u735a\u5ef2\u59c8\u545a\x52\u5ef2\x74\x69\u7313\u706e\x74\u545a\u58a0\x74\x53\x69\x7a\u545a\x52\u5ef2\x74\x69\u7313\u6c36\x69\u735c\u59c8\u5ef2\u5ef2\u6c36\u59c8\u7313\u72b8\u5a32\x69\u577a\u6730\x73\x74\x79\x6c\u545a\u6c36\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x69\u545a\u56c4\u645a\x75\x73\x74\u7313\u735c\x53\x74\x79\x6c\u545a\x49\u72b8\u5a32\u7313\u6c36\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x69\u545a\u56c4\u645a\x75\x73\x74\u7313\u735c\x53\x74\x79\x6c\u545a\x49\u72b8\u5a32\u7313\x5a\u7313\u7313\u735c\u6c36\x73\x74\x72\x69\u72b8\u577a\x69\u5a32\x69\u545a\u56c4\u6256\x72\u545a\u5ef2\x53\x74\x79\x6c\u545a\x49\u72b8\u5a32\u7313\u6730\u58a0\u5ef2\u735c\u58a0\u735c\u706e\x69\u56c4\u59c8\u624f\u545a\x6c\u545a\u545a\x68\u624f\u58a0\u58a0\u59c8\u59c8\u58a0\u5e77\u56c4\u56c4\u58a0\u735c\u545a\u6730\u5ef2\u545a\u59c8\u735c\u735c\u706e\x69\u58a0\u5ef2\u5e77\u58a0\x68\u5ef2\x69\u59c8\u706e\u735c\x69\u5ef2\u624f\u56c4\u545a\x6c\u59c8\u5ef2\u6c36\u5ef2\x6c\u545a\u5e77\x77\u7313\x72\x6b\u545a\x72\u735c\u577a\x72\u6730\u545a\u58a0\x68\u706e\u59c8\x6c\u5ef2\u735c\u58a0\u706e\u56c4\u545a\u58a0\u58a0\u58a0\u624f\x68\u5ef2\u59c8\u58a0\u735c\u6c36\u5ef2\u5ef2\u59c8\x6c\u545a\u5e77\u735a\x75\x73\x68\u624f\x68\u545a\u5ef2\u545a\u735c\u6730\u7313\u72b8\u735c\u545a\x73\x73\u5ef2\u577a\u545a\u5e77\u58a0\u545a\u58a0\u59c8\u545a\u5e77\x5f\u59c8\u5c2b\x6b\u6730\u5ef2\u735c\u545a\x69\u59c8");(function(kz,T){var i=function(e){while(--e){kz.push(kz.shift())}};i(++T)}(f0,482));var fZ=function(kz,T){kz=kz-0;var i=f0[kz];return i};function j7(kA){var kz={"\x6c\x69\x65\x65\x63":function(kB,i){return kB(i)}};var T=null;try{if(G(kA)){T=new Worker(kA);T[fZ("0x0")]=function(i){i["\x70\x72\x65\x76\x65\x6e\x74\x44\x65\x66\x61\x75\x6c\x74"]();T=kz[fZ("0x1")](gO,kA)}}else{T=gO(kA)}}catch(e){T=kz[fZ("0x1")](gO,kA)}return T}function gO(kA){var kz={"\x64\x63\x64\x61\x65":fZ("0x2"),"\x78\x78\x69\x6c\x64":fZ("0x3"),"\x65\x65\x65\x68\x64":fZ("0x4"),"\x64\x6d\x68\x6d\x68":fZ("0x5"),"\x78\x63\x68\x78\x68":"\x22\x29\x3b","\x68\x64\x61\x64\x68":fZ("0x6"),"\x65\x63\x61\x63\x6d":fZ("0x7"),"\x65\x78\x68\x61\x6c":function(kI,kH){return kI!==kH},"\x61\x78\x78\x78\x6c":fZ("0x8"),"\x61\x61\x61\x6c\x6d":fZ("0x9"),"\x61\x63\x61\x61\x61":function(kI,kH){return kI+kH},"\x6c\x61\x61\x6d\x64":fZ("0xa"),"\x6c\x63\x78\x6d\x68":fZ("0xb")};var T=null;try{var i=fZ("0xc");while(i!=="\x78\x69\x61\x6d"){switch(i){case fZ("0xb"):var e=kC[fZ("0xd")](kD);i=fZ("0x2");break;case kz[fZ("0xe")]:T=new Worker(e);i=kz[fZ("0xf")];break;case kz["\x65\x65\x65\x68\x64"]:try{kD=new Blob([kz["\x64\x6d\x68\x6d\x68"]+kA+kz[fZ("0x10")]],{type:kz[fZ("0x11")]})}catch(kG){var kF=kz[fZ("0x12")];while(kz["\x65\x78\x68\x61\x6c"](kF,kz[fZ("0x13")])){switch(kF){case kz[fZ("0x14")]:kE[fZ("0x15")](kz[fZ("0x16")](kz[fZ("0x17")]+kA,kz[fZ("0x10")]));kF=kz["\x6c\x61\x61\x6d\x64"];break;case fZ("0xa"):kD=kE["\x67\x65\x74\x42\x6c\x6f\x62"](kz[fZ("0x11")]);kF=kz["\x61\x78\x78\x78\x6c"];break;case fZ("0x7"):var kE=new (window[(fZ("0x18"))]||window["\x57\x65\x62\x4b\x69\x74\x42\x6c\x6f\x62\x42\x75\x69\x6c\x64\x65\x72"]||window["\x4d\x6f\x7a\x42\x6c\x6f\x62\x42\x75\x69\x6c\x64\x65\x72"])();kF=fZ("0x9");break}}}i=fZ("0x19");break;case fZ("0xc"):var kD;i=fZ("0x4");break;case fZ("0x19"):var kC=window[fZ("0x1a")]||window[fZ("0x1b")];i=kz["\x6c\x63\x78\x6d\x68"];break}}}catch(kB){}return T}function jS(e){this[fZ("0x1c")](e)}var ho={"\x69\x6e\x69\x74":function(T){var i={"\x78\x61\x6d\x78\x6d":"\x61\x69\x6c","\x78\x64\x63\x63\x6d":fZ("0x1d"),"\x65\x6c\x65\x65\x68":fZ("0x1e"),"\x78\x78\x63\x63\x78":fZ("0x1f"),"\x64\x64\x78\x6d\x65":fZ("0x20"),"\x61\x65\x63\x6d\x6d":function(kB,kA){return kB>kA},"\x78\x68\x61\x69\x63":fZ("0x21"),"\x64\x65\x6c\x63\x61":"\x6d\x65\x61","\x63\x6c\x61\x6d\x78":(window.location.protocol === "http:" ? "http:" : "https:") + "//api.map.baidu.com/res/webgl/10/worker_asm_ncwra3.js","\x64\x65\x78\x78\x78":fZ("0x22"),"\x68\x61\x63\x78\x6d":function(kB,kA){return kB(kA)},"\x61\x61\x63\x6c\x65":fZ("0x23"),"\x68\x65\x61\x65\x6d":fZ("0x24"),"\x65\x65\x61\x65\x63":function(kB,kA){return kB>kA},"\x69\x61\x61\x61\x69":function(kB,kA){return kB!==kA},"\x78\x65\x65\x6d\x63":fZ("0x25"),"\x63\x65\x68\x6d\x64":fZ("0x26"),"\x63\x63\x61\x69\x64":"\x61\x6c\x78","\x63\x68\x78\x6c\x6c":function(kB,kA){return kB!==kA},"\x65\x61\x65\x64\x61":fZ("0x27"),"\x6c\x61\x78\x78\x63":function(kA,kB){return kA<kB},"\x6c\x68\x6c\x65\x68":fZ("0x28"),"\x68\x63\x6d\x65\x61":"\x65\x65\x61","\x65\x63\x68\x64\x69":function(kB,kA){return kB!==kA},"\x6d\x69\x69\x65\x78":fZ("0x29"),"\x64\x61\x65\x69\x6d":fZ("0x2a"),"\x61\x78\x78\x78\x69":fZ("0x2b"),"\x63\x69\x65\x6d\x78":function(kB,kA){return kB<kA},"\x6d\x61\x63\x65\x6c":fZ("0x2c"),"\x63\x6d\x6d\x69\x78":fZ("0x2d"),"\x68\x65\x61\x65\x68":fZ("0x2e"),"\x64\x78\x65\x63\x6d":function(kB,kA){return kB!==kA},"\x69\x6d\x68\x65\x6c":fZ("0x2f"),"\x68\x61\x69\x78\x68":fZ("0x30"),"\x65\x6c\x61\x69\x78":function(kB,kA){return kB>=kA},"\x63\x65\x65\x6c\x61":fZ("0x31"),"\x68\x6c\x65\x64\x6c":fZ("0x32"),"\x64\x65\x65\x61\x65":"\x61\x6c\x65","\x68\x68\x61\x63\x68":fZ("0x33"),"\x63\x78\x78\x69\x65":function(kB,kA){return kB<kA},"\x6d\x61\x64\x61\x68":function(kB,kA){return kB>kA},"\x61\x61\x78\x65\x61":fZ("0x34"),"\x65\x64\x6d\x65\x69":function(kA){return kA()},"\x69\x6d\x63\x61\x61":function(kB,kA){return kB===kA},"\x61\x63\x63\x61\x65":fZ("0x35"),"\x65\x68\x78\x78\x63":"\x6f\x6e\x73\x74\x79\x6c\x65\x7a\x6f\x6f\x6d\x75\x70\x64\x61\x74\x65"};var e=this;this[fZ("0x36")]=T;this[fZ("0x37")]=[];var kz=Math[fZ("0x38")](navigator["\x68\x61\x72\x64\x77\x61\x72\x65\x43\x6f\x6e\x63\x75\x72\x72\x65\x6e\x63\x79"]-2,0)||4;if((i[fZ("0x39")](b5)||e9["\x42\x72\x6f\x77\x73\x65\x72"]["\x69\x65"])&&i[fZ("0x3a")](kz,2)){kz=2}this[fZ("0x3b")]=[];this[fZ("0x3c")]=i[fZ("0x39")](gt);this[fZ("0x3d")]=this["\x72\x61\x74\x69\x6f"];if(this[fZ("0x3c")]>1){this[fZ("0x3e")]=2}else{this[fZ("0x3e")]=1}if(i[fZ("0x3f")](typeof this["\x6d\x61\x70"][fZ("0x40")][fZ("0x41")],"\x73\x74\x72\x69\x6e\x67")){this[fZ("0x42")]=null;this[fZ("0x43")]=[];this[fZ("0x44")]=null}fG["\x63\x61\x6e\x55\x73\x65\x57\x65\x62\x41\x73\x73\x65\x6d\x62\x6c\x79"](function(kH){var kF={"\x78\x65\x78\x63\x65":function(kK,kJ){return kK!==kJ},"\x63\x6d\x6d\x69\x68":i[fZ("0x45")],"\x61\x6d\x65\x69\x63":i["\x78\x64\x63\x63\x6d"],"\x63\x69\x65\x69\x6c":fZ("0x46"),"\x61\x63\x61\x63\x68":i[fZ("0x47")],"\x6c\x61\x61\x65\x61":i[fZ("0x48")],"\x61\x63\x6d\x6c\x78":i[fZ("0x49")],"\x64\x6c\x68\x6c\x61":function(kK,kJ){return i[fZ("0x4a")](kK,kJ)},"\x61\x6c\x65\x6c\x6c":"\x68\x65\x78","\x6d\x64\x61\x63\x69":fZ("0x4b"),"\x64\x6c\x69\x64\x65":i[fZ("0x4c")],"\x69\x78\x6d\x61\x69":fZ("0x4d"),"\x65\x6c\x69\x65\x65":i[fZ("0x4e")],"\x63\x61\x65\x61\x6c":fZ("0x4f"),"\x6c\x65\x68\x78\x69":"\x61\x63\x64","\x63\x61\x78\x78\x63":fZ("0x50"),"\x61\x78\x61\x6d\x61":fZ("0x51")};var kA;if(kH){kA=(window.location.protocol === "http:" ? "http:" : "https:") + "//api.map.baidu.com/res/webgl/10/worker_wasm_cimp12.js"}else{kA=i[fZ("0x52")]}for(var kI=0;kI<kz;kI++){var kG=i[fZ("0x53")];while(kG!=="\x78\x68\x6c\x61"){switch(kG){case i[fZ("0x53")]:var kE=i[fZ("0x54")](j7,kA);kG=fZ("0x2");break;case i[fZ("0x55")]:e["\x61\x72\x72\x57\x6f\x72\x6b\x65\x72"][fZ("0x56")](kE);kG=i[fZ("0x57")];break;case"\x61\x61\x65":kE[fZ("0x58")]=function kB(kN){var kM=fZ("0x4d");while(kF[fZ("0x59")](kM,fZ("0x20"))){switch(kM){case kF["\x63\x6d\x6d\x69\x68"]:this[fZ("0x5a")]=null;kM="\x69\x78\x61";break;case kF[fZ("0x5b")]:this[fZ("0x5a")]&&this[fZ("0x5a")](null,this[fZ("0x5c")]);kM=kF[fZ("0x5d")];break;case kF[fZ("0x5e")]:e[fZ("0x5f")](kJ["\x75\x72\x6c"],kJ[fZ("0x60")],kJ[fZ("0x61")],kK);kM=kF[fZ("0x62")];break;case fZ("0x51"):T["\x66\x69\x72\x65"](kL);kM=kF[fZ("0x63")];break;case fZ("0x64"):if(kF[fZ("0x65")](e[fZ("0x37")][fZ("0x66")],0)){kM=kF[fZ("0x67")];break}kM=fZ("0x1f");break;case kF["\x6d\x64\x61\x63\x69"]:this["\x5f\x70\x61\x72\x73\x69\x6e\x67\x54\x69\x6c\x65\x49\x6e\x66\x6f"]=null;kM=kF["\x64\x6c\x69\x64\x65"];break;case kF[fZ("0x68")]:kM=kN[fZ("0x69")]?kF[fZ("0x6a")]:kF[fZ("0x5b")];break;case kF[fZ("0x5d")]:this[fZ("0x6b")]=![];kM=kF[fZ("0x6c")];break;case fZ("0x1f"):var kL=new fW(fZ("0x6d"));kM=kF["\x63\x61\x65\x61\x6c"];break;case kF[fZ("0x6e")]:this[fZ("0x5c")]=null;kM="\x61\x6d\x63";break;case fZ("0xa"):this[fZ("0x5a")]&&this[fZ("0x5a")](kN[fZ("0x69")],this[fZ("0x5c")]);kM=fZ("0x46");break;case kF[fZ("0x6f")]:var kK=kJ["\x63\x62\x6b"];kM=kF[fZ("0x5e")];break;case fZ("0x70"):var kJ=e["\x61\x72\x72\x50\x65\x6e\x64\x69\x6e\x67\x44\x61\x74\x61"]["\x73\x68\x69\x66\x74"]();kM=kF[fZ("0x6f")];break;case kF[fZ("0x71")]:kL[fZ("0x72")]=kF[fZ("0x73")];kM=kF["\x61\x78\x61\x6d\x61"];break}}};kG=i[fZ("0x55")];break}}}if(i[fZ("0x74")](e[fZ("0x37")][fZ("0x66")],0)){for(var kD=0;kD<Math["\x6d\x69\x6e"](e["\x61\x72\x72\x50\x65\x6e\x64\x69\x6e\x67\x44\x61\x74\x61"][fZ("0x66")],kz);kD++){var kC=e[fZ("0x37")]["\x73\x68\x69\x66\x74"]();e[fZ("0x5f")](kC["\x75\x72\x6c"],kC[fZ("0x60")],kC[fZ("0x61")],kC[fZ("0x75")])}}});T["\x6f\x6e"](i[fZ("0x76")],function(){var kC=fZ("0x77");while(i["\x69\x61\x61\x61\x69"](kC,fZ("0x26"))){switch(kC){case i[fZ("0x78")]:e[fZ("0x44")]=null;kC=i[fZ("0x79")];break;case i[fZ("0x7a")]:if(i[fZ("0x7b")](typeof this[fZ("0x40")][fZ("0x41")],i[fZ("0x7c")])){kC=fZ("0x7d");break}kC=i[fZ("0x79")];break;case fZ("0x77"):for(var kB=0,kA=e[fZ("0x3b")][fZ("0x66")];i[fZ("0x7e")](kB,kA);kB++){e[fZ("0x3b")][kB][fZ("0x7f")]=![];e[fZ("0x3b")][kB]["\x70\x6f\x73\x74\x4d\x65\x73\x73\x61\x67\x65"]({"\x61\x63\x74\x69\x6f\x6e":i[fZ("0x80")]})}kC=fZ("0x81");break;case i["\x64\x65\x6c\x63\x61"]:e[fZ("0x43")]=[];kC=i[fZ("0x78")];break;case i[fZ("0x82")]:e[fZ("0x42")]=null;kC=fZ("0xa");break}}});T["\x6f\x6e"](i["\x65\x68\x78\x78\x63"],function(){var kC=fZ("0x2b");while(i[fZ("0x83")](kC,i[fZ("0x84")])){switch(kC){case fZ("0x2d"):e["\x73\x74\x72\x69\x6e\x67\x69\x66\x69\x65\x64\x43\x75\x73\x74\x6f\x6d\x53\x74\x79\x6c\x65\x49\x6e\x66\x6f\x5a\x6f\x6f\x6d"]=[];kC="\x69\x63\x6d";break;case i["\x64\x61\x65\x69\x6d"]:e["\x73\x74\x72\x69\x6e\x67\x69\x66\x69\x65\x64\x41\x72\x65\x61\x53\x74\x79\x6c\x65\x49\x6e\x66\x6f"]=null;kC=i[fZ("0x84")];break;case"\x63\x65\x64":if(typeof this["\x63\x6f\x6e\x66\x69\x67"][fZ("0x41")]!==i[fZ("0x7c")]){kC=fZ("0x85");break}kC=i[fZ("0x84")];break;case i[fZ("0x86")]:for(var kB=0,kA=e[fZ("0x3b")][fZ("0x66")];i["\x63\x69\x65\x6d\x78"](kB,kA);kB++){e["\x61\x72\x72\x57\x6f\x72\x6b\x65\x72"][kB]["\x69\x73\x53\x65\x6e\x64\x46\x53"]=![]}kC=i["\x6d\x61\x63\x65\x6c"];break;case fZ("0x85"):e[fZ("0x42")]=null;kC=i[fZ("0x87")];break}}});T["\x6f\x6e"](fZ("0x88"),function(){var kB=i["\x68\x65\x61\x65\x68"];while(i[fZ("0x89")](kB,i[fZ("0x8a")])){switch(kB){case fZ("0x8b"):e[fZ("0x43")]=[];kB=fZ("0x8c");break;case fZ("0x8c"):e["\x73\x74\x72\x69\x6e\x67\x69\x66\x69\x65\x64\x41\x72\x65\x61\x53\x74\x79\x6c\x65\x49\x6e\x66\x6f"]=null;kB=fZ("0x8d");break;case fZ("0x32"):e[fZ("0x3b")][fZ("0x66")]=0;kB=fZ("0x8e");break;case i["\x68\x61\x69\x78\x68"]:for(var kA=kC[fZ("0x66")]-1;i[fZ("0x8f")](kA,0);kA--){kC[kA]=null}kB=i[fZ("0x90")];break;case fZ("0x2e"):for(var kA=0;kA<e[fZ("0x3b")][fZ("0x66")];kA++){if(e[fZ("0x3b")][kA]){e[fZ("0x3b")][kA][fZ("0x91")]()}}kB=i[fZ("0x92")];break;case i[fZ("0x93")]:e["\x73\x74\x72\x69\x6e\x67\x69\x66\x69\x65\x64\x43\x75\x73\x74\x6f\x6d\x53\x74\x79\x6c\x65\x49\x6e\x66\x6f"]=null;kB=fZ("0x8b");break;case fZ("0x8d"):var kD=Object[fZ("0x94")](e);kB=i[fZ("0x95")];break;case fZ("0x31"):e[fZ("0x96")]=null;kB=i[fZ("0x93")];break;case fZ("0x8e"):var kC=e[fZ("0x37")];kB=i[fZ("0x97")];break;case fZ("0x33"):for(var kA=0;i[fZ("0x98")](kA,kD[fZ("0x66")]);kA++){if(i[fZ("0x74")](kD[kA]["\x69\x6e\x64\x65\x78\x4f\x66"](fZ("0x99")),-1)||i[fZ("0x3a")](kD[kA][fZ("0x9a")](i[fZ("0x9b")]),-1)){delete e[kD[kA]]}}kB=i[fZ("0x8a")];break}}})},"\x67\x65\x74\x49\x64\x6c\x65\x57\x6f\x72\x6b\x65\x72":function(){var kA={"\x61\x78\x61\x68\x63":function(kC,kB){return kC<kB},"\x68\x61\x64\x63\x65":fZ("0x9c"),"\x6d\x61\x65\x69\x69":function(kC,kB){return kC!==kB},"\x6c\x61\x64\x68\x65":fZ("0x9d")};for(var kz=0,T=this[fZ("0x3b")][fZ("0x66")];kA[fZ("0x9e")](kz,T);kz++){var i=kA[fZ("0x9f")];while(kA[fZ("0xa0")](i,fZ("0xa1"))){switch(i){case kA[fZ("0xa2")]:e["\x5f\x69\x73\x42\x75\x73\x79"]=!![];i="\x61\x68\x64";break;case fZ("0x9c"):var e=this["\x61\x72\x72\x57\x6f\x72\x6b\x65\x72"][kz];i=fZ("0xa3");break;case fZ("0xa3"):if(!e[fZ("0x6b")]){i=fZ("0x9d");break}i=fZ("0xa1");break;case fZ("0xa4"):return e}}}return null},"\x72\x65\x6c\x65\x61\x73\x65\x50\x65\x6e\x64\x69\x6e\x67\x44\x61\x74\x61":function(T){var e={"\x64\x6d\x61\x61\x68":function(kF,kE){return kF!==kE},"\x65\x65\x78\x6c\x69":function(kF,kE){return kF+kE},"\x63\x69\x61\x63\x63":fZ("0xa5")};var kD=[];var kC=this[fZ("0x37")];for(var kB=kC["\x6c\x65\x6e\x67\x74\x68"]-1;kB>=0;kB--){var kA=kC[kB];var kz=kA[fZ("0x60")];if(e["\x64\x6d\x61\x61\x68"](T[fZ("0xa6")],kz["\x74\x69\x6c\x65\x54\x79\x70\x65\x4e\x61\x6d\x65"])){continue}var i=e["\x65\x65\x78\x6c\x69"](e["\x65\x65\x78\x6c\x69"](e[fZ("0xa7")]+kz[fZ("0xa8")]+"\x5f"+kz["\x72\x6f\x77"],"\x5f"),kz[fZ("0xa9")]);if(!T[i]){kC[fZ("0xaa")](kB,1);kD["\x70\x75\x73\x68"](kz)}}return kD},"\x6c\x6f\x61\x64\x54\x69\x6c\x65\x44\x61\x74\x61":function(kK,kI,kG,kD){var kA={"\x6c\x6c\x65\x64\x61":fZ("0xab"),"\x68\x63\x61\x61\x63":"\x64\x64\x68","\x6c\x61\x61\x69\x69":"\x65\x61\x61","\x68\x61\x78\x65\x61":fZ("0xac"),"\x63\x65\x78\x64\x78":"\x69\x61\x6d","\x68\x6d\x6d\x64\x6d":fZ("0xad"),"\x65\x68\x61\x61\x61":fZ("0x34"),"\x78\x65\x65\x61\x6d":function(kP,kO){return kP+kO},"\x65\x61\x61\x61\x61":fZ("0xae"),"\x6d\x64\x69\x64\x65":fZ("0xaf"),"\x68\x6c\x61\x6c\x69":fZ("0xb0"),"\x78\x65\x65\x6d\x65":fZ("0xb1"),"\x6d\x65\x6d\x68\x65":fZ("0xa"),"\x63\x6c\x61\x68\x63":fZ("0xb2"),"\x6d\x78\x61\x63\x63":fZ("0x5f"),"\x61\x6c\x69\x6d\x65":fZ("0xb3"),"\x78\x6c\x68\x61\x78":fZ("0xb4"),"\x63\x69\x65\x68\x61":fZ("0x99"),"\x65\x69\x65\x69\x65":fZ("0xb5"),"\x63\x6c\x68\x64\x69":function(kP,kO){return kP+kO},"\x61\x68\x65\x63\x65":fZ("0xb6"),"\x64\x65\x64\x78\x6d":function(kP,kO){return kP+kO},"\x61\x69\x61\x68\x6d":"\x61\x65\x68","\x69\x64\x61\x68\x61":fZ("0xb7"),"\x6d\x61\x6d\x6c\x65":fZ("0xb8"),"\x69\x64\x64\x64\x61":"\x65\x6d\x78","\x64\x6c\x61\x69\x65":fZ("0xb9"),"\x6c\x61\x61\x64\x61":function(kO){return kO()},"\x65\x61\x65\x65\x78":fZ("0xba"),"\x78\x69\x78\x6d\x65":fZ("0x7d"),"\x61\x6c\x63\x64\x68":fZ("0xbb"),"\x78\x63\x6c\x6d\x69":fZ("0xbc"),"\x63\x65\x6d\x6d\x68":fZ("0xbd"),"\x61\x63\x63\x65\x63":"\x65\x6d\x61","\x78\x65\x69\x63\x78":fZ("0xbe"),"\x6c\x6c\x65\x69\x6d":function(kO,kP){return kO+kP},"\x69\x64\x61\x68\x6d":"\x78\x63\x6c","\x6d\x69\x6c\x6d\x6d":fZ("0xbf"),"\x6d\x6c\x65\x64\x6c":"\x6c\x65\x6c","\x65\x64\x64\x68\x65":fZ("0xc0"),"\x69\x65\x65\x63\x61":fZ("0xc1"),"\x69\x69\x68\x61\x69":fZ("0xc2"),"\x61\x6c\x68\x63\x63":"\x63\x75\x73\x74\x6f\x6d\x53\x74\x79\x6c\x65\x49\x6e\x66\x6f\x5f","\x6d\x61\x65\x65\x61":fZ("0xc3"),"\x6c\x69\x63\x65\x6c":fZ("0xc4"),"\x65\x63\x61\x65\x63":"\x6d\x69\x6c","\x61\x61\x6c\x65\x65":"\x43\x75\x73\x74\x6f\x6d","\x69\x6d\x65\x78\x78":fZ("0xc5"),"\x6c\x65\x6c\x78\x78":fZ("0xc6"),"\x69\x78\x65\x65\x63":fZ("0xc7"),"\x64\x61\x68\x61\x69":fZ("0xc8"),"\x61\x65\x68\x6d\x6d":"\x63\x64\x63","\x78\x64\x65\x65\x69":fZ("0xc9")};var kF=fZ("0xca");while(kF!==fZ("0xb9")){switch(kF){case fZ("0xc1"):kz[fZ("0xcb")]=kE;kF=kA[fZ("0xcc")];break;case kA[fZ("0xcd")]:if(!kL[fZ("0x7f")]){kF=fZ("0xb4");break}kF=kA[fZ("0xce")];break;case kA[fZ("0xcf")]:if(kM&&this[fZ("0x44")]){kF=kA[fZ("0xd0")];break}kF=kA[fZ("0xd1")];break;case fZ("0xd2"):this[kA[fZ("0xd3")]+kB]=JSON[fZ("0xd4")](bG[kA[fZ("0xd5")](kA[fZ("0xd6")],kB)]);kF="\x61\x65\x68";break;case"\x69\x6d\x65":var kC=this[fZ("0x36")]["\x70\x61\x72\x6b\x69\x6e\x67"][fZ("0xd7")];kF=kA[fZ("0xd8")];break;case kA[fZ("0xd9")]:kz["\x63\x75\x73\x74\x6f\x6d\x4d\x61\x70\x53\x74\x79\x6c\x65"]=this["\x73\x74\x72\x69\x6e\x67\x69\x66\x69\x65\x64\x43\x75\x73\x74\x6f\x6d\x53\x74\x79\x6c\x65\x49\x6e\x66\x6f"];kF="\x64\x69\x61";break;case kA[fZ("0xda")]:if(!(kM&&!this["\x6d\x61\x70"][fZ("0x40")][fZ("0xdb")])){kF=kA["\x6d\x65\x6d\x68\x65"];break}kF=kA["\x63\x6c\x61\x68\x63"];break;case kA[fZ("0xd8")]:var kz={"\x61\x63\x74\x69\x6f\x6e":kA[fZ("0xdc")],"\x75\x72\x6c":kK,"\x74\x69\x6c\x65\x49\x6e\x66\x6f":kI,"\x74\x69\x6c\x65\x4b\x65\x79":kG,"\x69\x73\x54\x65\x78\x74":kN,"\x69\x73\x50\x6f\x69":i,"\x62\x75\x69\x6c\x64\x69\x6e\x67\x53\x69\x64\x65\x47\x72\x61\x64\x61\x74\x69\x6f\x6e":e,"\x68\x61\x73\x50\x6f\x6c\x79":T?![]:!![],"\x68\x61\x73\x4c\x69\x6e\x65":T?this[fZ("0x36")]["\x63\x6f\x6e\x66\x69\x67"][fZ("0xdd")]:!![],"\x63\x61\x72\x70\x6f\x72\x74":kC};kF=kA[fZ("0xde")];break;case kA["\x78\x6c\x68\x61\x78"]:if(!this[kA[fZ("0xd5")](kA[fZ("0xdf")],kH)]&&bG[fZ("0xe0")+kH]){kF=kA[fZ("0xe1")];break}kF="\x61\x78\x63";break;case fZ("0xb5"):this[kA[fZ("0xe2")](kA[fZ("0xdf")],kH)]=JSON["\x73\x74\x72\x69\x6e\x67\x69\x66\x79"](bG[kA[fZ("0xe2")]("\x46\x65\x61\x74\x75\x72\x65\x53\x74\x79\x6c\x65",kH)]);kF=kA[fZ("0xe3")];break;case fZ("0xb6"):if(!this[kA[fZ("0xe4")](fZ("0x34"),kB)]){kF=fZ("0xd2");break}kF=kA[fZ("0xe5")];break;case fZ("0xbf"):if(kM&&bG[kA[fZ("0xe4")](fZ("0xe6"),kH)]){kF=fZ("0xbd");break}kF=fZ("0xc4");break;case kA[fZ("0xe7")]:if(kM){kF=kA[fZ("0xe8")];break}kF="\x65\x78\x6d";break;case kA[fZ("0xe9")]:this[fZ("0x37")][fZ("0x56")](kJ);kF=kA[fZ("0xea")];break;case fZ("0xc9"):kA[fZ("0xeb")](kD);kF=kA[fZ("0xcd")];break;case fZ("0xec"):var i=this[fZ("0x36")][fZ("0xed")][fZ("0xee")];kF=kA[fZ("0xef")];break;case"\x78\x6d\x63":kz[fZ("0xf0")]={"\x77\x6f\x72\x64\x53\x70\x61\x63\x65\x52\x61\x74\x69\x6f":this[fZ("0x3d")],"\x74\x65\x78\x74\x53\x69\x7a\x65\x52\x61\x74\x69\x6f":this[fZ("0x3e")]};kF=fZ("0xf1");break;case kA["\x65\x61\x65\x65\x78"]:var kN=i?this[fZ("0x36")][fZ("0xed")][fZ("0xf2")]:![];kF=kA[fZ("0xf3")];break;case kA[fZ("0xd0")]:kz[fZ("0xf4")]=this["\x73\x74\x72\x69\x6e\x67\x69\x66\x69\x65\x64\x41\x72\x65\x61\x53\x74\x79\x6c\x65\x49\x6e\x66\x6f"];kF=fZ("0xad");break;case fZ("0xf5"):if(this[fZ("0x99")+kH]){kF=fZ("0xbe");break}kF=kA["\x61\x6c\x63\x64\x68"];break;case kA[fZ("0xf6")]:var kM=!!(kH[fZ("0x9a")]("\x63\x75\x73\x74\x6f\x6d")===0);kF=fZ("0xf7");break;case fZ("0xb2"):if(kM&&this[fZ("0x42")]){kF=kA[fZ("0xd9")];break}kF=fZ("0xac");break;case kA[fZ("0xf8")]:if(!this[fZ("0x42")]){kF="\x78\x61\x65";break}kF=fZ("0xc4");break;case fZ("0xca"):var kL=this[fZ("0xf9")]();kF=kA[fZ("0xfa")];break;case kA["\x78\x65\x69\x63\x78"]:kz["\x66\x65\x61\x74\x75\x72\x65\x53\x74\x79\x6c\x65"]=this[kA[fZ("0xfb")](fZ("0x99"),kH)];kF=fZ("0xbb");break;case"\x78\x61\x69":kz["\x69\x63\x6f\x6e\x53\x65\x74\x49\x6e\x66\x6f"]=this[kA["\x65\x68\x61\x61\x61"]+kB];kF=fZ("0xb1");break;case kA[fZ("0xfc")]:this[fZ("0x96")]=JSON[fZ("0xd4")](bG[fZ("0xfd")]);kF=kA["\x6d\x69\x6c\x6d\x6d"];break;case kA["\x6d\x6c\x65\x64\x6c"]:kL[fZ("0xfe")]=kI;kF=kA["\x65\x64\x64\x68\x65"];break;case"\x69\x65\x65":kz["\x6d\x61\x70\x53\x74\x79\x6c\x65\x49\x64"]=kH;kF=kA["\x69\x65\x65\x63\x61"];break;case kA[fZ("0xff")]:this[fZ("0x42")]=JSON[fZ("0xd4")](bG[kA[fZ("0xfb")](kA[fZ("0x100")],kH)]);kF=fZ("0xc4");break;case fZ("0x32"):if(!this["\x73\x74\x72\x69\x6e\x67\x69\x66\x69\x65\x64\x49\x6e\x64\x6f\x6f\x72\x53\x74\x79\x6c\x65"]){kF=fZ("0x101");break}kF="\x69\x65\x6d";break;case fZ("0xa"):kz[fZ("0xfd")]=this[fZ("0x96")];kF=kA[fZ("0x102")];break;case kA[fZ("0x103")]:if(this[fZ("0x36")]["\x70\x61\x72\x6b\x69\x6e\x67"]){kF="\x69\x6d\x65";break}kF=fZ("0xaf");break;case fZ("0x104"):var kJ={"\x75\x72\x6c":kK,"\x74\x69\x6c\x65\x49\x6e\x66\x6f":kI,"\x74\x69\x6c\x65\x4b\x65\x79":kG,"\x63\x62\x6b":kD};kF=kA[fZ("0xe9")];break;case kA[fZ("0xcc")]:kL[fZ("0x7f")]=!![];kF=kA[fZ("0xce")];break;case kA[fZ("0xce")]:kL["\x70\x6f\x73\x74\x4d\x65\x73\x73\x61\x67\x65"](kz);kF=kA[fZ("0xea")];break;case kA[fZ("0x105")]:if(kM&&bG["\x63\x75\x73\x74\x6f\x6d\x53\x74\x79\x6c\x65\x49\x6e\x66\x6f\x5f"+kE]){kF=fZ("0x106");break}kF=kA[fZ("0x107")];break;case kA[fZ("0xde")]:var kH=this[fZ("0x36")][fZ("0x108")]();kF=fZ("0xc6");break;case kA[fZ("0xe8")]:kB=kA["\x61\x61\x6c\x65\x65"];kF=kA[fZ("0x109")];break;case kA[fZ("0x10a")]:var kE=this[fZ("0x36")][fZ("0x10b")]();kF=kA["\x78\x63\x6c\x6d\x69"];break;case fZ("0x10c"):kL[fZ("0x5a")]=kD;kF=fZ("0x10d");break;case fZ("0xf7"):var kB=kH;kF=kA[fZ("0xe7")];break;case kA[fZ("0x10e")]:var T=this[fZ("0x36")][fZ("0x10f")]!==BMAPGL_NORMAL_MAP&&this[fZ("0x36")]["\x63\x6f\x6e\x66\x69\x67"][fZ("0x110")];kF=fZ("0xc3");break;case kA["\x64\x61\x68\x61\x69"]:this[fZ("0x44")]=JSON[fZ("0xd4")](bG[fZ("0xe6")+kE]);kF=fZ("0xf5");break;case kA[fZ("0xf3")]:var e=this[fZ("0x36")][fZ("0xed")][fZ("0x111")];kF=fZ("0x112");break;case kA["\x61\x65\x68\x6d\x6d"]:kF=kL?"\x65\x65\x6c":fZ("0x104");break;case fZ("0xc0"):kL[fZ("0x5c")]=kG;kF=kA[fZ("0x10e")];break;case fZ("0x106"):if(!this["\x73\x74\x72\x69\x6e\x67\x69\x66\x69\x65\x64\x41\x72\x65\x61\x53\x74\x79\x6c\x65\x49\x6e\x66\x6f"]){kF=kA[fZ("0x113")];break}kF=kA[fZ("0x107")];break;case kA[fZ("0x109")]:if(kM&&bG[kA[fZ("0xfb")](fZ("0xe6"),kH)]&&!bG[kA[fZ("0x100")]+kH]["\x62\x61\x73\x65\x46\x73"]){kF=kA["\x78\x64\x65\x65\x69"];break}kF=fZ("0x114");break}}},"\x73\x65\x74\x57\x6f\x72\x6b\x65\x72\x43\x6f\x6e\x66\x69\x67":function(i){var e={"\x61\x61\x65\x61\x6c":fZ("0x115"),"\x64\x69\x6d\x64\x63":fZ("0x116"),"\x61\x6c\x63\x65\x65":"\x63\x68\x65","\x65\x65\x61\x61\x61":"\x65\x61\x64","\x63\x65\x65\x68\x78":function(kD,kC){return kD<kC},"\x61\x6c\x61\x64\x78":fZ("0x117")};var kB=e["\x61\x61\x65\x61\x6c"];while(kB!==fZ("0x117")){switch(kB){case"\x69\x6c\x78":var kA={"\x61\x63\x74\x69\x6f\x6e":e["\x64\x69\x6d\x64\x63"]};kB=e["\x61\x6c\x63\x65\x65"];break;case e["\x65\x65\x61\x61\x61"]:for(var kz=0;e[fZ("0x118")](kz,this[fZ("0x3b")]["\x6c\x65\x6e\x67\x74\x68"]);kz++){this[fZ("0x3b")][kz]["\x70\x6f\x73\x74\x4d\x65\x73\x73\x61\x67\x65"](kA)}kB=e[fZ("0x119")];break;case fZ("0x11a"):for(var T in i){if(i[fZ("0x11b")](T)){kA[T]=i[T]}}kB=e[fZ("0x11c")];break}}}};e9[fZ("0x11d")](jS[fZ("0x11e")],ho);function jb(i){this.tileLayers=[];this.map=i;var e=this.config=ev[this.map.mapType];this.errorUrl=e.errorUrl;this.tileSize=e.tileSize;this.baseUnits=e.baseUnits;this.baseZoomLevel=e.zoomLevelBase;this.tileURLs=e.tileUrls;this.tilesInfoCache={};this.loadDelay=10;this._labelTextCanvas=null}bG.register(function(i){if(i._renderType!=="webgl"){return}var e=i.tileMgr=new jb(i);i.addEventListener("addtilelayer",function(kz){e.addWebGLLayer(kz.target)});i.addEventListener("removetilelayer",function(kz){e.removeWebGLLayer(kz.target)});i.on("update",function T(kA){if(i.getFeatureStyleTags().length===0||!(i.customLoaded&&i.areaCustomLoaded)){return}var kz=false;if(kA.changedStatus&&kA.changedStatus.onzoom_changed){kz=true}e.loadLayersData({zoomChanged:kz})});i.on("style_changed",function(){e.loadLayersData()});i.on("destroy",function(){for(var kz=0;kz<e.tileLayers.length;kz++){e.tileLayers[kz].remove();e.tileLayers[kz].destroyDrawData();e.tileLayers[kz]=null}e.tilesInfoCache={};e.tileLayers=[];e._labelTextCanvas=null;e.map=null;e.requestTime=null})});e9.extend(jb.prototype,{addWebGLLayer:function(T){this.tileLayers.push(T);T.initDrawData();if(this.tileLayers.length>1){for(var e=1;e<this.tileLayers.length;e++){if(this.tileLayers[e].isFlat){this.map.setDisplayOptions({isFlat:true});break}}}if(this.map.getFeatureStyleTags().length>0&&this.map.customLoaded&&this.map.areaCustomLoaded){this.loadLayersData()}else{var kz=this;this.map.loadMapStyleFiles(function(){var i=new fW("onlayer_update");i.name="na";kz.map.fire(i);kz.loadLayersData()})}},removeWebGLLayer:function(kB){var kC=false;for(var kA=0,kz=this.tileLayers.length;kA<kz;kA++){if(kB===this.tileLayers[kA]){kC=true;this.tileLayers.splice(kA,1);break}}if(kC===false){return}kB.destroyDrawData();if(this.map.getFeatureStyleTags().length>0){this.loadLayersData()}if(this.tileLayers.length===1){this.map.setDisplayOptions({isFlat:false})}else{var e=false;for(var kA=1;kA<this.tileLayers.length;kA++){if(this.tileLayers[kA].isFlat){e=true;break}}this.map.setDisplayOptions({isFlat:e})}var T=new fW("onrefresh");T.source="removewebgllayer";this.map.fire(T)},getLabelTextCanvas:function(){if(!this._labelTextCanvas){this._labelTextCanvas=new az(this.map)}return this._labelTextCanvas},loadLayersData:function(i){if(!this.map||this.map.suspendLoad){return}var kA=this;i=i||{};var kz=!!i.zoomChanged;var e=(kz===true||this.map.getTilt()>50);if(!e){if(!this.syncLoadTimer){this.syncLoadTimer=setTimeout(function(){kA._loadLayersFromCache(kz);kA.syncLoadTimer=null},40)}}else{this._loadLayersFromCache(kz)}if(!kA.map.viewAnimationTime){this.timer&&window.clearTimeout(this.timer)}if(!this.requestTime){this.requestTime=new Date().getTime()}else{if(new Date().getTime()-this.requestTime>=1000){T()}}function T(){if(!kA.map){return}if(kA.map.viewAnimationTime){if(new Date().getTime()-kA.map.viewAnimationTime<1000){return}kA.map.viewAnimationTime=new Date().getTime()}var kC=kA.tileLayers.length;kA.tilesInfoCache={};for(var kE=0;kE<kC;kE++){var kG=kA.tileLayers[kE];var kF=kG.tileType;var kB=null;var kD=kA._getTilesInfoKey(kF,kG);if(kA.tilesInfoCache[kD]){kB=kA.tilesInfoCache[kD]}else{kB=kA.calcTilesInfo(kF,kG);kA.tilesInfoCache[kD]=kB}kB&&kG.loadLayerData(kB,false,kz)}kA.timer=null;kA.requestTime=null}this.timer=window.setTimeout(T,this.loadDelay);if((b5()||e9.Browser.ie)&&kz){this.loadDelay=200}else{this.loadDelay=80}},_getTilesInfoKey:function(i,T){var e=i.getName();e+=("_"+(T.transform?T.transform.source:"default"));e+=("_"+T.spanLevel||0);return e},_loadLayersFromCache:function(kB){if(!this.map){return}this.map._featureMgr.clearData();this.map.tileLabels=[];var kE=this.tileLayers;kE.sort(function(kF,i){return kF.zIndex-i.zIndex>0});var T=kE.length;this.tilesInfoCache={};for(var kA=0;kA<T;kA++){var kD=kE[kA];var kC=kD.tileType;var e=null;var kz=this._getTilesInfoKey(kC,kD);if(this.tilesInfoCache[kz]){e=this.tilesInfoCache[kz]}else{e=this.calcTilesInfo(kC,kD);this.tilesInfoCache[kz]=e}e&&kD.loadLayerData(e,true,kB)}},calcTilesInfo:function(kM,ld){var kZ=this.map;var k5=kZ.getMapType();var k0=ev[k5];var kU=kZ.getZoom();var e=Math.floor(kU);var kC=kM.getDataZoom(kU);var lh=kM.getName();kC=ck(kC,k0.minDataZoom,k0.maxDataZoom);var k8=e;if(kM._name==="web"||kM._name==="xyz"){k8=kC}else{if(k8<3){k8=3}}var kY=kM.getTileSize(kU);var kB=kM.getBaseTileSize(kU);var kW=kZ.getBoundsIn();if(!kW){return}var kQ=kM.getMercatorSize(kU,kC);var kP;var k7;var kX;var la;var k1=kZ.getCenterIn();k1=fc.calcLoopCenterPoint(k1);if(lh==="xyz"){return this.calcXYZTilesInfo(k1,kW,kC,lh,ld,kZ)}var kV=Math.floor(k1.lng/kQ);var kE=Math.floor(k1.lat/kQ);var k3=0;var kz=0;kW=fc.calcLoopMapBounds(kW,k1);if(kW.ne.lng>fc._mc180X){var kK=fc.getSpaceDistanceInPixel(kC);k3=Math.ceil(kK/kB)}if(kW.sw.lng<fc._mcM180X){var kK=fc.getSpaceDistanceInPixel(kC);kz=Math.ceil(kK/kB)}if(kW.ne.lat>19505879.362428114||kW.sw.lat<-15949096.637571886){kW.ne.lat=19505879.362428114;kW.sw.lat=-15949096.637571886}var kG=[Math.floor(kW.sw.lng/kQ)-kz,Math.floor(kW.sw.lat/kQ)];var lf=[Math.floor(kW.ne.lng/kQ)+k3,Math.floor(kW.ne.lat/kQ)];kP=kG[0];k7=lf[0]+1;kX=kG[1];la=lf[1]+1;var kL=[];for(var kI=kP;kI<k7;kI++){if(fc.isTileBlank(kI,kC,kB)===true){continue}for(var kN=kX;kN<la;kN++){var lc=false;var kH=256;if(lh==="web"){var kS=this._webTileRaste180(kI,kN,kC);lc=kS.combine;kH=kS.dataIndex}var kJ={col:kI,row:kN,zoom:kC,useZoom:k8,tileTypeName:lh,loopOffsetX:0,tileSize:kY,baseTileSize:kB,mercatorSize:kQ,combine:lc,dataIndex:kH};kL.push(kJ);var k4="id_"+kI+"_"+kN+"_"+kC;kL[k4]=true}}if(kC<=5){for(var le=0,lb=kL.length;le<lb;le++){var kI=kL[le].col;var kN=kL[le].row;var k6=fc.calcLoopParam(kI,kC);var kD=k6.T;var kR=kI>=0?kI-kD:kI+kD;var kT="id_"+kR+"_"+kN+"_"+kC;if(fc.isTileBlank(kR,kC,kB)===true){continue}if(!kL[kT]){var lc=false;var kH=256;if(lh==="web"){var kS=this._webTileRaste180(kR,kN,kC);lc=kS.combine;kH=kS.dataIndex}var kJ={col:kR,row:kN,zoom:kC,useZoom:k8,loopOffsetX:0,tileSize:kY,baseTileSize:kB,mercatorSize:kQ,combine:lc,dataIndex:kH};kL.push(kJ);kL[kT]=true}}}if(this.map._tilt>0&&(lh!=="web"||kU>=8)){for(var le=0;le<kL.length;le++){var kF=kL[le];var k9=kF.col;var lg=kF.row;var k2=[];k2.minX=k9*kQ;k2.maxX=(k9+1)*kQ;k2.minY=lg*kQ;k2.maxY=(lg+1)*kQ;var kA=new cG(0,0);kA.lng=(k2.minX+k2.maxX)/2;kA.lat=(k2.minY+k2.maxY)/2;var kO=kZ.pointToPixelIn(kA);if(kO.x>0&&kO.x<this.map.width&&kO.y>0&&kO.y<this.map.height){continue}if(k2.minX<k1.lng&&k2.maxX>k1.lng&&k2.minY<k1.lat&&k2.maxY>k1.lat){continue}if(!this.ifTileInMapBounds(k2,kW,k9,lg)){kL.splice(le,1);le--}}}kL.sort((function(i){return function(T,li){return((0.4*Math.abs(T.col-i[0])+0.6*Math.abs(T.row-i[1]))-(0.4*Math.abs(li.col-i[0])+0.6*Math.abs(li.row-i[1])))}})([kV,kE]));kL.zoom=kC;kL.tileTypeName=lh;return kL},_webTileRaste180:function(T,kE,e){var i=this.map;var kB=false;var kC=256;var kA=fc.calcLoopParam(T,e);var kD={col:kA.col,row:kE,baseTileSize:256,zoom:e};var kz=jv.prototype.tileToBound(kD,i.getCenter());if(Math.ceil(kz.LL.sw.lng)*Math.floor(kz.LL.ne.lng)<0){kB=true;kC=fc.pixelWidth(kz.MC.sw.lng,e);if(kD.col<0){kC=-kC}}return{combine:kB,dataIndex:kC}},calcXYZTilesInfo:function(kK,kD,kJ,kO,kC,kR){var kF=kR.width;var kP=kR.height;var kE=Math.floor(kJ);var kG=null;if(kC.transform.target==="EPSG3857"){var kz=dL.transformBDmcPoint(kK,kC.transform);var kA=dL.getRangeExtent(kz,kF,kP,kE,kC.transform);kG=[kA.minX,kA.minY,kA.maxX,kA.maxY]}else{if(kC.transform.source==="BD09MC"){var kz=[kK.lng,kK.lat];kG=[kD.sw.lng,kD.sw.lat,kD.ne.lng,kD.ne.lat]}else{var kz=dL.transformBDmcPoint(kK,kC.transform);var kB=dL.transformBDmcPoint(kD.ne,kC.transform);var kI=dL.transformBDmcPoint(kD.sw,kC.transform);kG=dL.getLoopBox(kz,[kI[0],kI[1],kB[0],kB[1]])}}if(!kz||!kG){return[]}kE=kE+kC.spanLevel;var T=dL.getTileRangeForExtentFactory(kG,kE,kC.transform);var e=[];var kS=dL.getResolutionScale(kE,kC.transform);for(var kN=T.minX;kN<=T.maxX;kN++){for(var kL=T.minY;kL<=T.maxY;kL++){var kM={col:kN,row:kL,zoom:kE,useZoom:kE,tileTypeName:kO,loopOffsetX:0,tileSize:256*kS,transform:kC.transform,combine:false,dataIndex:0};e.push(kM);var kH="id_"+kN+"_"+kL+"_"+kE;e[kH]=true}}var kQ=dL.getTileCoordForCoordAndZ(kz,kE);e.sort((function(i){return function(kT,kU){return((0.4*Math.abs(kT.col-i[0])+0.6*Math.abs(kT.row-i[1]))-(0.4*Math.abs(kU.col-i[0])+0.6*Math.abs(kU.row-i[1])))}})([kQ[1],kQ[2]]));e.zoom=kE;e.tileTypeName=kO;return e},getCurrentViewTilesInfo:function(T,kz){var i=this._getTilesInfoKey(T,kz);var e=this.tilesInfoCache[i];if(!e){return this.calcTilesInfo(T,kz)}return e},ifTileInMapBounds:function(e,kB,T,kA){var i=kB.normalizedBottomLeft;var kM=kB.normalizedTopRight;var kE=kB.normalizedTopLeft;var kC=kB.normalizedBottomRight;var kz=false;var kL=new cG(e.minX,e.minY);var kI=new cG(e.maxX,e.maxY);var kD=new cG(kI.lng,kL.lat);var kJ=new cG(kL.lng,kI.lat);var kG=[kJ,kI,kD,kL];for(var kK=0,kF=kG.length;kK<kF;kK++){var kH=kK+1;if(kH===kF){kH=0}var kN=kK;var kO=ju(kG[kH],kG[kN],kE,i);if(kO){kz=true;break}kO=ju(kG[kH],kG[kN],kC,kM);if(kO){kz=true;break}kO=ju(kG[kH],kG[kN],kM,kE);if(kO){kz=true;break}kO=ju(kG[kH],kG[kN],i,kC);if(kO){kz=true;break}}return kz},getTileLayer:function(kA){for(var kz=0,e=this.tileLayers.length;kz<e;kz++){var T=this.tileLayers[kz];if(T.mapType===kA){return T}}return null},isExitTileLayer:function(kA){for(var kz=0,e=this.tileLayers.length;kz<e;kz++){var T=this.tileLayers[kz];if(T===kA){return true}}return false},getZoomState:function(i){var e=i-this.lastZoom;if(e>0){this.zoomState=1}else{if(e<0){this.zoomState=-1}}this.lastZoom=i;return this.zoomState}});function iV(e){this.map=e;this.gl=null;this.layers=[];this.mouseEventThrottle=this.throttle(this.pick,100).bind(this);this.mousePointerThrottle=this.throttle(this.mouseStatus,300).bind(this);this.base=new cG(12069475.280738307,3929271.1724863998);this.iconCache=new aC((b5()||e9.Browser.ie)?64:128,{clearCallback:function(i){}})}bG.register(function(i){if(i._renderType!=="webgl"){return}var e=i._normalLayerMgr=new iV(i);i.toFormatCoords=function(kB,kE){var kD=[];var kC=e.base;if(kE&&kE.center){kC=jv.convertLL2MC(kE.center)}for(var kA=0;kA<kB.length;kA++){var T=jv.convertLL2MC(new cG(kB[kA][0],kB[kA][1]));var kz=[T.lng-kC.lng,T.lat-kC.lat];kD.push(kz)}return kD};i.indexToRgb=function(kz){kz++;var T=Math.floor(kz/65536);kz-=T*65536;var kB=Math.floor(kz/256);kz-=kB*256;var kA=kz;return[kA,kB,T]};i.addEventListener("addnormallayer",function(T){e.addWebGLLayer(T.target)});i.addEventListener("removenormallayer",function(T){e.removeWebGLLayer(T.target)});i.addEventListener("update",function(kC){if(kC.changedStatus&&kC.changedStatus.onsize_changed){if(e.gl){e.clearFramebuffer();var kB=i.getSize();var kA=kB.width;var T=kB.height;var kz=i.config.ratio;kA=Math.round(kA*kz);T=Math.round(T*kz);e.pickFBO=e.createFramebuffer(kA,T)}}});i.addEventListener("onmousemove",e._layerMouseEvent.bind(e));i.addEventListener("onclick",e._layerClickEvent.bind(e));i.addEventListener("ondblclick",e._layerDBLClickEvent.bind(e));i.addEventListener("onrightclick",e._layerRightClickEvent.bind(e));i.on("destroy",function(){e.removeAllLayers(true);i.indexToRgb=null;i.toFormatCoords=null;e.pickFBO=null;e.preFramebuffer=null;e.gl=null;e.iconCache.clear()});i.on("glmoduleloaded",function(){e.gl=i._webglPainter.gl;e.pickFBO=e.createFramebuffer();for(var T=0;T<e.layers.length;T++){e.layers[T].onInit(i,e.gl)}i.dispatchEvent(new fW("onupdate"))});i.addEventListener("layer_clear",function(T){e.iconCache.clear()})});e9.extend(iV.prototype,{init:function(){var e=this;this.map.toFormatCoords=function(kB){var kC=[];for(var kA=0;kA<kB.length;kA++){var T=jv.convertLL2MC(new cG(kB[kA][0],kB[kA][1]));var kz=[T.lng-e.base.lng,T.lat-e.base.lat];kC.push(kz)}return kC};this.map.indexToRgb=function(kz){kz++;var T=Math.floor(kz/65536);kz-=T*65536;var kB=Math.floor(kz/256);kz-=kB*256;var kA=kz;return[kA,kB,T]};this.pickFBO=this.createFramebuffer();var i=this;this.map.addEventListener("addnormallayer",function(T){i.addWebGLLayer(T.target)});this.map.addEventListener("removenormallayer",function(T){i.removeWebGLLayer(T.target)});this.map.addEventListener("onmousemove",this._layerMouseEvent.bind(this));this.map.addEventListener("onclick",this._layerClickEvent.bind(this));this.map.addEventListener("onrightclick",this._layerRightClickEvent.bind(this));this.map.addEventListener("ondblclick",this._layerDBLClickEvent.bind(this));this.map.on("destroy",function(){i.removeAllLayers(true);i.map.indexToRgb=null;i.map.toFormatCoords=null;i.pickFBO=null;i.preFramebuffer=null})},addWebGLLayer:function(T){var kz=false;for(var e=0;e<this.layers.length;e++){if(this.layers[e]===T){kz=true;break}}if(!kz){this.layers.push(T);if(this.gl){T.onInit(this.map,this.gl)}this.map.dispatchEvent(new fW("onupdate"))}},removeWebGLLayer:function(T){for(var e=0;e<this.layers.length;e++){if(this.layers[e]===T){this.map._featureMgr.removeLayer(T.zIndex);this.layers.splice(e,1);T.onDestroy();this.map.dispatchEvent(new fW("onupdate"));break}}},removeAllLayers:function(kz){for(var T=0;T<this.layers.length;T++){var e=this.layers[T];if(e.visible){this.map._featureMgr.removeLayer(e.zIndex)}if(kz){e.onKill&&e.onKill()}e.onDestroy()}this.layers=[];this.map.dispatchEvent(new fW("onupdate"))},sortLayer:function(){this.layers.sort(function(i,e){return i.zIndex-e.zIndex>0})},_layerMouseEvent:function(i){this.mouseEventThrottle(i,"onmousemove")},_layerClickEvent:function(i){this.pick(i,"onclick")},_layerDBLClickEvent:function(i){this.pick(i,"ondblclick")},_layerRightClickEvent:function(i){this.pick(i,"onrightclick")},throttle:function(T,e){var kz=null;var i=Date.now();return function(){var kD=Date.now();var kC=e-(kD-i);var kB=this;var kA=arguments;if(kz){clearTimeout(kz)}if(kC<=0){T.apply(kB,kA);i=Date.now()}else{kz=setTimeout(function(){T.apply(kB,kA)},kC)}}},pick:function(kE,kC){if(!this.layers.length){return false}var kz=false;var T=false;for(var kB=0;kB<this.layers.length;kB++){var kA=this.layers[kB];if(kA.doRender()&&kA.testEvent()){T=true;if(kA.pick){if(kC==="onmousemove"||kA.hasEvent(kC)){var kD=kA.pick(kE.x,kE.y,kC)}else{continue}if(kD&&kD.dataIndex!==-1){if(kC==="onmousemove"){kz=true}if(kA.hasEvent(kC)){kA.dispatcher(kE,kD,kC)}if(!kA.popEvent){break}}else{if(kA.hasEvent(kC)){kA.dispatcher(kE,kD,kC)}}}}}if(kC==="onmousemove"&&T){this.mousePointerThrottle(kz)}this.map.dispatchEvent(new fW("onupdate"))},mouseStatus:function(e){if(e){this.map.platform.style.cursor=this.map.config.overlayMoveCursor}else{this.map.platform.style.cursor=this.map.config.defaultCursor}},saveFramebuffer:function(){var e=this.gl;this.preFramebuffer=e.getParameter(e.FRAMEBUFFER_BINDING)},bindFramebuffer:function(e){var i=this.gl;if(e){i.bindFramebuffer(i.FRAMEBUFFER,e)}else{i.bindFramebuffer(i.FRAMEBUFFER,null)}},clear:function(e){var i=this.gl;i.clearColor(0,0,0,0);if(e instanceof Array){i.clearColor(e[0],e[1],e[2],e[3])}i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},restoreFramebuffer:function(){var i=this.gl;if(this.map&&this.map._webglPainter){var e=this.map._webglPainter.background||[1,1,1,1];i.clearColor(e[0]/255,e[1]/255,e[2]/255,e[3]/255)}i.bindFramebuffer(i.FRAMEBUFFER,this.preFramebuffer)},clearFramebuffer:function(){if(this.pickFBO){var e=this.gl;e.deleteTexture(this.pickFBO.texture);e.deleteFramebuffer(this.pickFBO)}},createFramebuffer:function(kz,i){var kD=this.gl;kz=kz||kD.canvas.width;i=i||kD.canvas.height;var kB=kD.createFramebuffer();var kA=kD.createTexture();kD.bindTexture(kD.TEXTURE_2D,kA);kD.texImage2D(kD.TEXTURE_2D,0,kD.RGBA,kz,i,0,kD.RGBA,kD.UNSIGNED_BYTE,null);kD.texParameteri(kD.TEXTURE_2D,kD.TEXTURE_MAG_FILTER,kD.LINEAR);kD.texParameteri(kD.TEXTURE_2D,kD.TEXTURE_MIN_FILTER,kD.LINEAR);kD.texParameteri(kD.TEXTURE_2D,kD.TEXTURE_WRAP_S,kD.CLAMP_TO_EDGE);kD.texParameteri(kD.TEXTURE_2D,kD.TEXTURE_WRAP_T,kD.CLAMP_TO_EDGE);kB.texture=kA;var T=kD.createRenderbuffer();kD.bindRenderbuffer(kD.RENDERBUFFER,T);kD.renderbufferStorage(kD.RENDERBUFFER,kD.DEPTH_STENCIL,kz,i);kB.depthBuffer=T;kD.bindFramebuffer(kD.FRAMEBUFFER,kB);kD.framebufferTexture2D(kD.FRAMEBUFFER,kD.COLOR_ATTACHMENT0,kD.TEXTURE_2D,kA,0);kD.framebufferRenderbuffer(kD.FRAMEBUFFER,kD.DEPTH_STENCIL_ATTACHMENT,kD.RENDERBUFFER,T);var kC=kD.checkFramebufferStatus(kD.FRAMEBUFFER);if(kD.FRAMEBUFFER_COMPLETE!==kC){console.log("Frame buffer object is incomplete: "+kC.toString());this._clearBuffer(kD);return}this._clearBuffer(kD);return kB},_clearBuffer:function(e){e.bindFramebuffer(e.FRAMEBUFFER,null);e.bindTexture(e.TEXTURE_2D,null);e.bindRenderbuffer(e.RENDERBUFFER,null)},loadIconImages:function(kz,kG){var kH=kz;var kI=kH.length;var kC=this;var T=0;var kF=200;for(var kA=0;kA<kI;kA++){var kB=kH[kA];var e=kB.icon;var kE=e;if(e instanceof HTMLCanvasElement){kE=e.id;if(!this.iconCache.getData(kE)){this._addToIconTexture(e);this.iconCache.setData(kE,{loaded:true,image:e})}continue}T++;if(this.iconCache.getData(kE)){if(this.iconCache.getData(kE).loaded){kG(kz)}continue}var kD=new Image();kD.id=kE;kD.iconUrl=e;kD.crossOrigin="anonymous";kD.onload=function(){if(kC.iconCache.getData(this.id)){kC.iconCache.getData(this.id).loaded=true;kC._addToIconTexture(this)}if(!kC._iconLoadTimer){kC._iconLoadTimer=setTimeout(function(){kG(kz);kC._iconLoadTimer=null},kF)}this.onload=null};kD.onerror=function(){if(!kC._iconLoadTimer){kC._iconLoadTimer=setTimeout(function(){kG(kz);kC._iconLoadTimer=null},kF)}kC.iconCache.removeData(this.id);this.onerror=null};kD.src=e;this.iconCache.setData(kE,{loaded:false,image:kD})}kG(kz)},_addToIconTexture:function(kB){if(!this.map._webglMapScene){return}var kD=this.map._webglMapScene._painter;var e=kD._iconTextureAtlas.addTexture(kB);if(e===false){this.map.fire(new fW("onlayer_clear"));return}if(!e){return}kD._iconTextureAtlasOffset[kB.id]=e;var kG=0*kB.width/1024+e.width;var kA=0*kB.height/1024+e.height;var kF=kB.width/1024+e.width;var kz=kA;var kE=kF;var T=kB.height/1024+e.height;var kC=kG;var i=T;kD._iconTextureAtlasCoords[kB.id]=[kG,kA,kF,kz,kE,T,kC,i]}});var hW=(function(){function kF(k6,lb,k7,k8,ld){k7=k7||2;var k9=lb&&lb.length;var k4=k9?lb[0]*k7:k6.length;var la=kU(k6,0,k4,k7,true);var k3=ld||[];if(!la){return k3}var k2;var k1;var k0;var kZ;var le;var lc;var lf;k8=k8||0;if(k9){la=kO(k6,lb,la,k7)}if(k6.length>80*k7){k2=k0=k6[0];k1=kZ=k6[1];for(var k5=k7;k5<k4;k5+=k7){le=k6[k5];lc=k6[k5+1];if(le<k2){k2=le}if(lc<k1){k1=lc}if(le>k0){k0=le}if(lc>kZ){kZ=lc}}lf=Math.max(k0-k2,kZ-k1)}T(la,k3,k7,k2,k1,lf,null,k8);return k3}function kU(k3,k5,kZ,k4,k0){var k1;var k2;if(k0===(kY(k3,k5,kZ,k4)>0)){for(k1=k5;k1<kZ;k1+=k4){k2=kC(k1,k3[k1],k3[k1+1],k2)}}else{for(k1=kZ-k4;k1>=k5;k1-=k4){k2=kC(k1,k3[k1],k3[k1+1],k2)}}if(k2&&kI(k2,k2.next)){kQ(k2);k2=k2.next}return k2}function kM(k2,kZ){if(!k2){return k2}if(!kZ){kZ=k2}var k1=k2;var k0;do{k0=false;if(!k1.steiner&&(kI(k1,k1.next)||kS(k1.prev,k1,k1.next)===0)){kQ(k1);k1=kZ=k1.prev;if(k1===k1.next){return null}k0=true}else{k1=k1.next}}while(k0||k1!==kZ);return kZ}function T(k0,k2,k5,k3,kZ,k9,k8,k6){if(!k0){return}if(!k8&&k9){kH(k0,k3,kZ,k9)}var k7=k0;var k1;var k4;while(k0.prev!==k0.next){k1=k0.prev;k4=k0.next;if(k9?kX(k0,k3,kZ,k9):kP(k0)){k2.push(k1.i/k5+k6);k2.push(k0.i/k5+k6);k2.push(k4.i/k5+k6);kQ(k0);k0=k4.next;k7=k4.next;continue}k0=k4;if(k0===k7){if(!k8){T(kM(k0),k2,k5,k3,kZ,k9,1,k6)}else{if(k8===1){k0=kL(k0,k2,k5,k6);T(k0,k2,k5,k3,kZ,k9,2,k6)}else{if(k8===2){kK(k0,k2,k5,k3,kZ,k9,k6)}}}break}}}function kP(k1){var k0=k1.prev;var kZ=k1;var k3=k1.next;if(kS(k0,kZ,k3)>=0){return false}var k2=k1.next.next;while(k2!==k1.prev){if(kJ(k0.x,k0.y,kZ.x,kZ.y,k3.x,k3.y,k2.x,k2.y)&&kS(k2.prev,k2,k2.next)>=0){return false}k2=k2.next}return true}function kX(k4,k5,k3,lb){var k8=k4.prev;var k7=k4;var k6=k4.next;if(kS(k8,k7,k6)>=0){return false}var lc=k8.x<k7.x?(k8.x<k6.x?k8.x:k6.x):(k7.x<k6.x?k7.x:k6.x);var k9=k8.y<k7.y?(k8.y<k6.y?k8.y:k6.y):(k7.y<k6.y?k7.y:k6.y);var k2=k8.x>k7.x?(k8.x>k6.x?k8.x:k6.x):(k7.x>k6.x?k7.x:k6.x);var k1=k8.y>k7.y?(k8.y>k6.y?k8.y:k6.y):(k7.y>k6.y?k7.y:k6.y);var k0=e(lc,k9,k5,k3,lb);var la=e(k2,k1,k5,k3,lb);var kZ=k4.nextZ;while(kZ&&kZ.z<=la){if(kZ!==k4.prev&&kZ!==k4.next&&kJ(k8.x,k8.y,k7.x,k7.y,k6.x,k6.y,kZ.x,kZ.y)&&kS(kZ.prev,kZ,kZ.next)>=0){return false}kZ=kZ.nextZ}kZ=k4.prevZ;while(kZ&&kZ.z>=k0){if(kZ!==k4.prev&&kZ!==k4.next&&kJ(k8.x,k8.y,k7.x,k7.y,k6.x,k6.y,kZ.x,kZ.y)&&kS(kZ.prev,kZ,kZ.next)>=0){return false}kZ=kZ.prevZ}return true}function kL(k5,k1,k4,k3){var k2=k5;do{var k0=k2.prev;var kZ=k2.next.next;if(!kI(k0,kZ)&&i(k0,k2,k2.next,kZ)&&kT(k0,kZ)&&kT(kZ,k0)){k1.push(k0.i/k4+k3);k1.push(k2.i/k4+k3);k1.push(kZ.i/k4+k3);kQ(k2);kQ(k2.next);k2=k5=kZ}k2=k2.next}while(k2!==k5);return k2}function kK(kZ,k1,k3,k2,k0,k8,k4){var k7=kZ;do{var k6=k7.next.next;while(k6!==k7.prev){if(k7.i!==k6.i&&kR(k7,k6)){var k5=kG(k7,k6);k7=kM(k7,k7.next);k5=kM(k5,k5.next);T(k7,k1,k3,k2,k0,k8,null,k4);T(k5,k1,k3,k2,k0,k8,null,k4);return}k6=k6.next}k7=k7.next}while(k7!==kZ)}function kO(k1,k8,k4,k3){var k5=[];var k2;var k6;var kZ;var k0;var k7;for(k2=0,k6=k8.length;k2<k6;k2++){kZ=k8[k2]*k3;k0=k2<k6-1?k8[k2+1]*k3:k1.length;k7=kU(k1,kZ,k0,k3,false);if(k7===k7.next){k7.steiner=true}k5.push(kD(k7))}k5.sort(kE);for(k2=0;k2<k5.length;k2++){kB(k5[k2],k4);k4=kM(k4,k4.next)}return k4}function kE(k0,kZ){return k0.x-kZ.x}function kB(k1,k0){k0=kV(k1,k0);if(k0){var kZ=kG(k0,k1);kM(kZ,kZ.next)}}function kV(kZ,k3){var k0=k3;var k5=kZ.x;var k4=kZ.y;var k2=-Infinity;var k1;do{if(k4<=k0.y&&k4>=k0.next.y){var k8=k0.x+(k4-k0.y)*(k0.next.x-k0.x)/(k0.next.y-k0.y);if(k8<=k5&&k8>k2){k2=k8;if(k8===k5){if(k4===k0.y){return k0}if(k4===k0.next.y){return k0.next}}k1=k0.x<k0.next.x?k0:k0.next}}k0=k0.next}while(k0!==k3);if(!k1){return null}if(k5===k2){return k1.prev}var k7=k1;var lb=k1.x;var k9=k1.y;var la=Infinity;var k6;k0=k1.next;while(k0!==k7){if(k5>=k0.x&&k0.x>=lb&&kJ(k4<k9?k5:k2,k4,lb,k9,k4<k9?k2:k5,k4,k0.x,k0.y)){k6=Math.abs(k4-k0.y)/(k5-k0.x);if((k6<la||(k6===la&&k0.x>k1.x))&&kT(k0,kZ)){k1=k0;la=k6}}k0=k0.next}return k1}function kH(k3,kZ,k2,k0){var k1=k3;do{if(k1.z===null){k1.z=e(k1.x,k1.y,kZ,k2,k0)}k1.prevZ=k1.prev;k1.nextZ=k1.next;k1=k1.next}while(k1!==k3);k1.prevZ.nextZ=null;k1.prevZ=null;kA(k1)}function kA(k5){var k2;var k1;var k0;var k4;var k6;var kZ;var k7;var k3;var k8=1;do{k1=k5;k5=null;k6=null;kZ=0;while(k1){kZ++;k0=k1;k7=0;for(k2=0;k2<k8;k2++){k7++;k0=k0.nextZ;if(!k0){break}}k3=k8;while(k7>0||(k3>0&&k0)){if(k7===0){k4=k0;k0=k0.nextZ;k3--}else{if(k3===0||!k0){k4=k1;k1=k1.nextZ;k7--}else{if(k1.z<=k0.z){k4=k1;k1=k1.nextZ;k7--}else{k4=k0;k0=k0.nextZ;k3--}}}if(k6){k6.nextZ=k4}else{k5=k4}k4.prevZ=k6;k6=k4}k1=k0}k6.nextZ=null;k8*=2}while(kZ>1);return k5}function e(k0,k3,kZ,k2,k1){k0=32767*(k0-kZ)/k1;k3=32767*(k3-k2)/k1;k0=(k0|(k0<<8))&16711935;k0=(k0|(k0<<4))&252645135;k0=(k0|(k0<<2))&858993459;k0=(k0|(k0<<1))&1431655765;k3=(k3|(k3<<8))&16711935;k3=(k3|(k3<<4))&252645135;k3=(k3|(k3<<2))&858993459;k3=(k3|(k3<<1))&1431655765;return k0|(k3<<1)}function kD(k1){var k0=k1;var kZ=k1;do{if(k0.x<kZ.x){kZ=k0}k0=k0.next}while(k0!==k1);return kZ}function kJ(k3,k2,k5,k4,kZ,k6,k1,k0){return(kZ-k1)*(k2-k0)-(k3-k1)*(k6-k0)>=0&&(k3-k1)*(k4-k0)-(k5-k1)*(k2-k0)>=0&&(k5-k1)*(k6-k0)-(kZ-k1)*(k4-k0)>=0}function kR(k0,kZ){return k0.next.i!==kZ.i&&k0.prev.i!==kZ.i&&!kN(k0,kZ)&&kT(k0,kZ)&&kT(kZ,k0)&&kz(k0,kZ)}function kS(k1,k0,kZ){return(k0.y-k1.y)*(kZ.x-k0.x)-(k0.x-k1.x)*(kZ.y-k0.y)}function kI(k0,kZ){return k0.x===kZ.x&&k0.y===kZ.y}function i(k1,kZ,k0,k2){if((kI(k1,kZ)&&kI(k0,k2))||(kI(k1,k2)&&kI(k0,kZ))){return true}return kS(k1,kZ,k0)>0!==kS(k1,kZ,k2)>0&&kS(k0,k2,k1)>0!==kS(k0,k2,kZ)>0}function kN(k0,kZ){var k1=k0;do{if(k1.i!==k0.i&&k1.next.i!==k0.i&&k1.i!==kZ.i&&k1.next.i!==kZ.i&&i(k1,k1.next,k0,kZ)){return true}k1=k1.next}while(k1!==k0);return false}function kT(k0,kZ){return kS(k0.prev,k0,k0.next)<0?kS(k0,kZ,k0.next)>=0&&kS(k0,k0.prev,kZ)>=0:kS(k0,kZ,k0.prev)<0||kS(k0,k0.next,kZ)<0}function kz(k1,k0){var k4=k1;var kZ=false;var k3=(k1.x+k0.x)/2;var k2=(k1.y+k0.y)/2;do{if(((k4.y>k2)!==(k4.next.y>k2))&&(k3<(k4.next.x-k4.x)*(k2-k4.y)/(k4.next.y-k4.y)+k4.x)){kZ=!kZ}k4=k4.next}while(k4!==k1);return kZ}function kG(k1,k0){var kZ=new kW(k1.i,k1.x,k1.y);var k2=new kW(k0.i,k0.x,k0.y);var k4=k1.next;var k3=k0.prev;k1.next=k0;k0.prev=k1;kZ.next=k4;k4.prev=kZ;k2.next=kZ;kZ.prev=k2;k3.next=k2;k2.prev=k3;return k2}function kC(k0,kZ,k3,k1){var k2=new kW(k0,kZ,k3);if(!k1){k2.prev=k2;k2.next=k2}else{k2.next=k1.next;k2.prev=k1;k1.next.prev=k2;k1.next=k2}return k2}function kQ(kZ){kZ.next.prev=kZ.prev;kZ.prev.next=kZ.next;if(kZ.prevZ){kZ.prevZ.nextZ=kZ.nextZ}if(kZ.nextZ){kZ.nextZ.prevZ=kZ.prevZ}}function kW(k0,kZ,k1){this.i=k0;this.x=kZ;this.y=k1;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false}kF.deviation=function(k4,k9,k6,k1){var k7=k9&&k9.length;var k3=k7?k9[0]*k6:k4.length;var k0=Math.abs(kY(k4,0,k3,k6));if(k7){for(var k5=0,k8=k9.length;k5<k8;k5++){var kZ=k9[k5]*k6;var k2=k5<k8-1?k9[k5+1]*k6:k4.length;k0-=Math.abs(kY(k4,kZ,k2,k6))}}var ld=0;for(k5=0;k5<k1.length;k5+=3){var lc=k1[k5]*k6;var lb=k1[k5+1]*k6;var la=k1[k5+2]*k6;ld+=Math.abs((k4[lc]-k4[la])*(k4[lb+1]-k4[lc+1])-(k4[lc]-k4[lb])*(k4[la+1]-k4[lc+1]))}return k0===0&&ld===0?0:Math.abs((ld-k0)/k0)};function kY(k3,k5,kZ,k4){var k2=0;for(var k1=k5,k0=kZ-k4;k1<kZ;k1+=k4){k2+=(k3[k0]-k3[k1])*(k3[k1+1]+k3[k0+1]);k0=k1}return k2}kF.flatten=function(k3){var k4=k3[0][0].length;var kZ={vertices:[],holes:[],dimensions:k4};var k1=0;for(var k2=0;k2<k3.length;k2++){for(var k0=0;k0<k3[k2].length;k0++){for(var k5=0;k5<k4;k5++){kZ.vertices.push(k3[k2][k0][k5])}}if(k2>0){k1+=k3[k2-1].length;kZ.holes.push(k1)}}return kZ};return kF})();function cL(i,e){this.id=gi();this.workerPool=i;this.actors=[];this.currentActorIndex=0;this.ready=false;this.init(e)}cL.prototype.init=function(kB){const e=this.workerPool.acquire(this.id);for(var kz=0;kz<e.length;kz++){const kC=e[kz];const kA=new jN(kC,kB,this.id);kA.name="Worker "+kz;this.actors.push(kA)}var T=this;this.broadcast("hasReady",null,function(){T.ready=true})};cL.prototype.broadcast=function(i,T,e){e=e||function(){};m(this.actors,function(kA,kz){kA.send(i,T,kz)},e)};cL.prototype.getActor=function(){const e=this.actors.filter(function(i){return !i.busy})[0];if(e){return e}this.currentActorIndex=(this.currentActorIndex+1)%this.actors.length;return this.actors[this.currentActorIndex]};cL.prototype.stop=function(){for(var e=0;e<this.actors.length;e++){var T=this.actors[e];T.stop()}};cL.prototype.remove=function(){for(var e=0;e<this.actors.length;e++){var T=this.actors[e];T.remove()}this.actors.length=0;this.workerPool.release(this.id)};function jN(T,i,e){this.target=T;this.parent=i;this.mapId=e;this.busy=false;this.taskQueue=[];this.callbacks={};this.init()}jN.prototype.init=function(){this.receive=this.receive.bind(this);this.target.addEventListener("message",this.receive,false)};jN.prototype.setBusy=function(e){this.busy=e;if(!e&&this.taskQueue.length){var i=this.taskQueue.shift();this.send(i.action,i.data,i.callback,i.targetMapId,i.mustQueue,i.callbackMetadata)}};jN.prototype.receive=function(kz){const kA=kz.data;const kD=kA.id;if(!kD){return}if(kA.targetMapId&&this.mapId!==kA.targetMapId){return}if(kA.action==="<response>"){this.setBusy(false);const kC=this.callbacks[kD];delete this.callbacks[kD];if(kC){if(kA.error){kC(iw(kA.error))}else{kC(null,iw(kA.data))}}}else{var T=this;const i=[];const e=kA.hasCallback?function(kE,kF){T.target.postMessage({id:kD,action:"<response>",sourceMapId:T.mapId,error:kE?jO(kE):null,data:jO(kF,i)},i)}:function(kE){};const kB=iw(kA.data);if(this.parent[kA.action]){this.parent[kA.action](kA.sourceMapId,kB,e)}}};jN.prototype.send=function(i,T,kC,kz,kA,kD){if(i==="release"){this.releasePendingData(T,kC);return}if(this.busy){this.taskQueue.push({action:i,data:T,callback:kC,targetMapId:kz,mustQueue:kA,callbackMetadata:kD});return}this.setBusy(true);var kB=Math.round((Math.random()*1000000000000000000)).toString(36).substring(0,10);const e=this.mapId+"_"+i+"_"+kB;if(kC){kC.metadata=kD;this.callbacks[e]=kC}const kE=[];this.target.postMessage({id:e,action:i,hasCallback:!!kC,targetMapId:kz,mustQueue:kA,sourceMapId:this.mapId,data:jO(T,kE)},kE);return{cancel:function(){if(kC){delete this.callbacks[e]}this.target.postMessage({id:e,action:"<cancel>",targetMapId:kz,sourceMapId:this.mapId})}}};jN.prototype.stop=function(){this.taskQueue.length=0;this.busy=false;this.callbacks={}};jN.prototype.remove=function(){this.taskQueue.length=0;this.busy=false;this.target.removeEventListener("message",this.receive,false)};jN.prototype.releasePendingData=function(e,kC){var T=[];var kA=this.taskQueue;for(var kz=kA.length-1;kz>=0;kz--){var kB=kA[kz]["data"];if(!kB||!kB.layerId){break}if(kB.layerId!==e.layerId){continue}if(!e["id_"+kB.x+"_"+kB.y+"_"+kB.z]){kA.splice(kz,1);T.push(kB)}}kC(null,T)};var kp;function hE(){if(!kp){kp=new hK()}return kp}function hK(){this.active={}}hK.prototype.acquire=function(i){if(!this.workers){this.workers=[];var T=(window.location.protocol === "http:" ? "http:" : "https:") + "//api.map.baidu.com/res/webgl/10/worker_mvt_xyk5ez.js";while(this.workers.length<hK.workerCount){var e=j7(T);this.workers.push(e)}}this.active[i]=true;return this.workers.slice()};hK.prototype.release=function(T){delete this.active[T];if(this.numActive()===0){for(var e=0;e<this.workers.length;e++){this.workers[e].terminate()}this.workers=null}};hK.prototype.numActive=function(){return Object.keys(this.active).length};hK.workerCount=2;function hL(e){this._map=e;this._spotsId={};this._init()}hL.prototype._init=function(){var i=this._map;var e=this;i.addEventListener("onspotsdataready",function(kz){var T=kz.spots;if(e._spotsId[kz.index]){i.removeSpots(e._spotsId[kz.index])}e._spotsId[kz.index]=i.addSpots(T)});i.addEventListener("onspotsdataremove",function(T){if(e._spotsId[T.index]){i.removeSpots(e._spotsId[T.index])}})};bG.register(function(e){if(!e.config.enableIconClick){return}e._mapIcon=new hL(e)});function dg(e){this._indoorData={};this._map=e;this.currentUid=null;this.currentFloor=null;this._indoorControl=null;this.enterMethod=null;this.showMask=true;this._isMobile=b5();this._autoEnterZoom=19;if(this._isMobile){this._autoEnterZoom=17}this._init(e);window._indoorMgr=this}dg.prototype._init=function(i){var e=this;i.on("indoor_status_changed",function(kC){var T=kC.uid;var kA=kC.floor;if(T===null){T=e.currentUid;if(e._indoorData[T]){kA=e._indoorData[T].defaultFloor}if(e._indoorControl){e._indoorControl.hide()}e.currentUid=null;e.currentFloor=null;e.enterMethod=null}else{if(e._indoorData[T]){var kB=e._indoorData[T];kA=(typeof kA==="number")?kA:kB.defaultFloor;if(!e._indoorControl){if((i.config.showControls||i.config.indoorControl)&&i._displayOptions.indoor){e._indoorControl=new ax(i,kB)}}else{e._indoorControl.setInfo(kB);e._indoorControl.show()}e.currentUid=T;e.currentFloor=kA}}if(!e._indoorData||!e._indoorData[T]||e._indoorData[T].currentFloor===kA){this.fire(new fW("onrefresh"));return}var kz=new fW("onindoor_data_refresh");kz.uid=T;kz.floor=kA;kz.tileKey=e._indoorData[T].tileKey;e._indoorData[T].currentFloor=kA;e.currentFloor=kA;this.fire(kz);hP.sendMessage(a1(4,3,4),["layer","indoor"])});i.on("spotclick",function(kz){var T=null;if(kz.curAreaSpot&&this.areaSpots[kz.curAreaSpot]){T=this.areaSpots[kz.curAreaSpot].userData.uid}if(T===e.currentUid){if(kz.curAreaSpot){e.enterMethod="byClick"}return}if(T===null){if(e.currentUid&&e.enterMethod==="byClick"){i.showIndoor(null);e.enterMethod=null}}else{e.enterMethod="byClick";if(e.currentUid){i.showIndoor(e.currentUid,e._indoorData[e.currentUid].defaultFloor)}i.showIndoor(T,e._indoorData[T].defaultFloor)}});i.on("moveend",function(){if(this.getZoom()>=e._autoEnterZoom){e._checkIndoorByMove()}});i.on("zoomend",function(){if(this.getZoom()>=e._autoEnterZoom){e._checkIndoorByMove()}else{if(e.enterMethod!=="byClick"&&e.currentUid!==null){this.showIndoor(null)}}})};dg.prototype._checkIndoorByMove=function(){var T=this._map;var kF=T.getSize();var kK={x:kF.width/2,y:kF.height/2};var kJ=Math.max(kF.width,kF.height);var kL=[];for(var kG in this._indoorData){var e=this._indoorData[kG].center;var kz=T.pointToPixelIn(new bG.Point(e[0],e[1]));var kC=cr(kK,kz);kL.push({uid:kG,distance:kC})}if(kL.length===0){return}kL.sort(function(kM,i){return kM.distance-i.distance});var kB=kL[0];var kH=T.getCenterIn();var kA=false;for(var kE=0;kE<this._indoorData[kB.uid].contour.length;kE++){if(bT([kH.lng,kH.lat],this._indoorData[kB.uid].contour[kE])){kA=true;break}}if(kA===false&&kB.uid==="e96b44200baa3b4082288acc"){var kD=this._indoorData[kB.uid].boundsMin;var kI=this._indoorData[kB.uid].boundsMax;if(kH.lng>kD[0]&&kH.lat>kD[1]&&kH.lng<kI[0]&&kH.lat<kI[1]){kA=true}}if(kA){if(this.enterMethod!=="byClick"){if(this.currentUid!==null&&this.currentUid!==kB.uid){this._map.showIndoor(this.currentUid,this._indoorData[this.currentUid].defaultFloor)}if(this.currentUid!==kB.uid){this._map.showIndoor(kB.uid,this._indoorData[kB.uid].defaultFloor)}this.enterMethod="byMove"}}else{if(this.enterMethod!=="byClick"){this._map.showIndoor(null)}}};dg.prototype.setData=function(kz){if(kz===null){return}for(var T in kz){if(T==="tileInfo"){continue}var kA=kz[T].tileKey;if(this._indoorData[T]){if(!this._indoorData[T][kA]){this._indoorData[T].tileKeys.push(kA);this._indoorData[T][kA]=true}}else{this._indoorData[T]=kz[T];this._indoorData[T].tileKeys=[kz[T].tileKey];this._indoorData[T][kA]=true;for(var e=0;e<this._indoorData[T].contour.length;e++){this._map.addAreaSpot(this._indoorData[T].contour[e],{id:T+e,userData:{uid:T}})}}}if(this._map.getZoom()>=this._autoEnterZoom){this._checkIndoorByMove()}};dg.prototype.removeData=function(T,kA){if(!this._indoorData[T]){return}var kz=this._indoorData[T];for(var e=0;e<kz.tileKeys.length;e++){if(kz.tileKeys[e]===kA){kz.tileKeys.splice(e,1);break}}delete kz[kA];if(kz.tileKeys.length===0){delete this._indoorData[T]}};dg.prototype.getIndoorData=function(e){return this._indoorData[e]||null};dg.prototype.getData=function(){return this._indoorData};bG.register(function(e){e._indoorMgr=new dg(e)});var a3=(function(){var kz={};var kI={};var kE={};function kG(kK){if(Object.prototype.toString.call(kK)==="[object Object]"){for(var kJ in kK){return false}return true}else{return false}}function kF(kQ,kR,kU,kN,kT){var kJ=kJ||null;kN=kN||kJ;var kL;if(kU>21){kU=21}if(kN){kL=kH(kQ,kR,kU,kN)}else{kL=T(kQ,kR,kU,kT)}var kP=kL.drawId;var kK=kL.style;var kS=kL.styleUpdate;var kV=[];if(!kP){return kV}for(var kM=0;kM<kP.length;kM++){var kO=kS[kP[kM]]||kK[kP[kM]];if(kO){switch(kR){case"polygon":kO=kA(kO,kQ);break;case"line":kO=kD(kO,kQ);break;case"pointText":kO=kB(kO,kQ);break;case"point":kO=e(kO,kQ);break;case"polygon3d":kO=kC(kO,kQ);break}if(kO){kO.did=kP[kM];kV[kV.length]=kO}}}return kV}function kH(kK,kM,kN,kJ){var kL=kJ[2];switch(kM){case"point":kL=kL[0];break;case"pointText":kL=kL[1];break;case"line":kL=kL[3];break;case"polygon":kL=kL[4];break;case"polygon3d":kL=kL[5];break}var kP=kN-1;if(kM==="line"&&kN===12){kP=kN}var kQ=kJ[1][kP][0];var kO=kQ[kK];if(!kO&&kN<21){if(kM==="point"||kM==="pointText"){kQ=kJ[1][kN][0];kO=kQ[kK]}}return{drawId:kO,style:kL,styleUpdate:[]}}function T(kN,kO,kR,kQ){if(!kQ||!kQ.baseFs){return{drawId:null,style:[],styleUpdate:[]}}var kP;var kL=kQ.baseFs;if(kG(kQ.zoomRegion)){kP=kQ.StyleBody||[]}else{kP=kQ.zoomStyleBody[kR]||[]}var kK=kL[2];switch(kO){case"point":kK=kK[0];kP=kP[0]||{};break;case"pointText":kK=kK[1];kP=kP[1]||{};break;case"line":kK=kK[3];kP=kP[3]||{};break;case"polygon":kK=kK[4];kP=kP[4]||{};break;case"polygon3d":kK=kK[5];kP=kP[5]||{};break}var kJ=kL[1][kR-1][0];var kM=kJ[kN];if(!kM&&kR<21){if(kO==="point"||kO==="pointText"){kJ=kL[1][kR][0];kM=kJ[kN]}}return{drawId:kM,style:kK,styleUpdate:kP}}function kB(kK,kJ){if(!kK||kK.length===0){return null}return{sid:kJ,fontRgba:i(kK[0]),haloRgba:i(kK[1]),backRgba:i(kK[2]),fontSize:kK[3],haloSize:kK[4],fontWeight:kK[5],fontStyle:kK[6],density:kK[7]}}function e(kL,kJ){var kK=null;if(kL[kL.length-1]&&kL[kL.length-1] instanceof Array&&kL[kL.length-1][0]==="openmap"){kK=kL[kL.length-1][1]?kL[kL.length-1][1]:null}return{sid:kJ,rank:kL[0],ucflag:kL[1],icon:kL[2],iconType:kL[3],nineGG:kL[4],density:kL[5],zoom:kL[6],hue:kK>>>0}}function kD(kL,kJ){var kK=null;if(kL[kL.length-1]&&kL[kL.length-1] instanceof Array&&kL[kL.length-1][0]==="openmap"){kK=kL[kL.length-1][1]?kL[kL.length-1][1]:null}return{sid:kJ,borderRgba:i(kL[0]),fillRgba:i(kL[1]),borderWidth:kL[2],fillWidth:kL[3],borderCap:kL[4],fillCap:kL[5],haveBorderLine:kL[6],haveBorderTexture:kL[7],haveFillTexture:kL[8],isUseBorderRgba:kL[9],isUseFillRgba:kL[10],borderTexture:kL[11],fillTexture:kL[12],borderTextureType:kL[13],fillTextureType:kL[14],isRealWidth:kL[15],haveArrow:kL[16],needRound:kL[17],realBorderWidth:kL[18],hue:i(kK)}}function kA(kL,kJ){var kK=null;var kM=null;if(kL[kL.length-1]&&kL[kL.length-1] instanceof Array&&kL[kL.length-1][0]==="openmap"){kK=kL[kL.length-1][1]?kL[kL.length-1][1]:null;kM=kL[kL.length-1][2]?kL[kL.length-1][2]:null}return{sid:kJ,fillRgba:i(kL[0]),borderRgba:i(kL[1]),borderWidth:kL[2],borderTexture:kL[3],borderTextureType:kL[4],waterStyle:kL[5],haloStyle:kL[6],textureStyle:kL[7],thickRgba:i(kL[8]),fillTexture:kM,hue:i(kK)}}function kC(kK,kJ){return{sid:kJ,filter:kK[0],ratio:kK[1],haveBorder:kK[2],borderWidth:kK[3],borderRgba:i(kK[4]),fillTop:i(kK[5]),fillSide:i(kK[6]),polyTexture:kK[7]}}function i(kO){var kN=kO;if(kE[kN]){return kE[kN]}kO=kO>>>0;var kM=(kO)&255;var kL=(kO>>8)&255;var kJ=(kO>>16)&255;var kK=(kO>>24)&255;kE[kN]=[kM,kL,kJ,kK];return kE[kN]}return{getStyleFromCache:function(kQ,kL,kO,kP,kK,kN,kJ){kQ=kQ||"default";var kM=kQ+"-"+kL+"-"+kO+"-"+kP;if(kN){kM+="-indoor"}if(kK){if(!kI[kM]){kI[kM]=kF(kL,kO,kP,kK)}return kI[kM]}if(!kz[kM]){kz[kM]=kF(kL,kO,kP,kK,kJ)}return kz[kM]},clearStyleFromCache:function(){kz={};kI={}}}})();bG.register(function(i){var e=new iv(i)});function iv(e){e.container.appendChild(this.render());this.bind(e)}iv.prototype.render=function(){var i=document.createElement("div");i.className="click-ripple-container";var e=document.createElement("div");e.className="click-ripple";i.appendChild(e);this._div=i;this._ripple=e;return i};iv.prototype.bind=function(i){var e=this;i.addEventListener("spotclick",function(T){if(!T.spots||T.spots.length===0){return}e._div.style.left=T.pixel.x+"px";e._div.style.top=T.pixel.y+"px";e9.ac(e._ripple,"ripple-playing")});i.addEventListener("hotclick",function(T){if(!T||!T.pixel||!(T.pixel instanceof fv)){return}e._div.style.left=T.pixel.x+"px";e._div.style.top=T.pixel.y+"px";e9.ac(e._ripple,"ripple-playing")});e9.on(e._ripple,"transitionend",function(){e9.rc(e._ripple,"ripple-playing")})};function b4(e){dh.call(this);if(!e){return}this._opts={};this._map=e;this._maxLat=84.6;this._minLat=-80.6;this._maxLatMC=jv.convertLL2MC(new cA(this._maxLat,0)).lat;this._minLatMC=jv.convertLL2MC(new cA(this._minLat,0)).lat}b4.inherits(dh,"ToolbarItem");e9.extend(b4.prototype,{open:function(){if(this._isOpen==true){return true}if(this._map._toolInUse){return false}this._map._toolInUse=true;this._isOpen=true;return true},close:function(){if(!this._isOpen){return}this._map._toolInUse=false;this._isOpen=false},_checkStr:function(e){if(!e){return""}return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}});function co(T,i){b4.call(this,T);i=i||{};this._opts=e9.extend(e9.extend(this._opts||{},{autoClear:false,tips:"测距",followText:"单击确定起点，双击结束绘制",unit:"metric",showResult:true,lineColor:"blue",lineStroke:2,opacity:1,lineStyle:"solid",cursor:E.distCursor,styleCodes:{lnCode:0,spCode:0,slCode:0,tlCode:0},enableMassClear:true}),i);if(this._opts.showResult===false){if(typeof i.tips==="undefined"){this._opts.tips="绘制折线"}if(!i.cursor){this._opts.cursor="crosshair"}}if(this._opts.lineStroke<=0){this._opts.lineStroke=2}if(this._opts.opacity>1){this._opts.opacity=1}else{if(this._opts.opacity<0){this._opts.opacity=0}}if(this._opts.lineStyle!=="solid"&&this._opts.lineStyle!=="dashed"){this._opts.lineStyle="solid"}this._checked=false;this._drawing=null;this.followTitle=null;this._totalDis={};this._points=[];this._paths=[];this._dots=[];this._segDistance=[];this._overlays=[];this._units={metric:{name:"metric",conv:1,incon:1000,u1:"米",u2:"公里"},us:{name:"us",conv:3.2808,incon:5279.856,u1:"英尺",u2:"英里"}};if(!this._units[this._opts.unit]){this._opts.unit="metric"}this._dLineColor="#ff6319";this._dLineStroke=3;this._dOpacity=0.8;this._dLineStyle="solid";this._dCursor=E.distCursor;if(this._opts.showResult){this._opts.followText="单击确定起点"}this._followTextM="单击确定地点，双击结束";this._sectionMarkerTip="单击可删除此点，拖拽可调整位置";this._movingTimerId=null;if(this._opts.showResult){this.text="测距"}else{this.text="绘线"}this._isOpen=false;var e=this;hl.load("tools",function(){e._draw()})}co.inherits(b4,"PolylineTItem");e9.extend(co.prototype,{setLineColor:function(e){this._opts.lineColor=e},setLineStroke:function(e){if(Math.round(e)>0){this._opts.lineStroke=Math.round(e)}},setOpacity:function(e){if(e>=0&&e<=1){this._opts.opacity=e}},setLineStyle:function(e){if(e==="solid"||e==="dashed"){this._opts.lineStyle=e}},clear:function(){for(var T=0,e=this._overlays.length;T<e;T++){if(this._overlays[T]){this._map.removeOverlay(this._overlays[T])}}this._overlays.length=0;for(var T=0,e=this._dots.length;T<e;T++){if(this._dots[T]&&this._dots[T].parentNode){this._dots[T].parentNode.removeChild(this._dots[T])}}this._dots.length=0},setCursor:function(e){if(this._opts.showResult===true){return}this._opts.cursor=e},getCursor:function(){if(this._opts.showResult===true){return this._dCursor}var e=this._opts.cursor.match(/^url\((.+)\)(,.*)?/);if(e!==null){return e[1]}else{return this._opts.cursor}},showResult:function(e){this._opts.showResult=!!e}});function bL(){var kA=3;var kH=256;var kz=Math.pow(2,18-kA)*kH;var kI=2;var kG=(kI+1)*kz;var T=jv.convertLL2MC(new cG(180,0));var kE=T.lng;var kC=kG-kE;var kF=-3;var e=kF*kz;var kB=jv.convertLL2MC(new cG(-180,0));var kD=kB.lng;var i=kD-e;this._validPixels=kE/Math.pow(2,18-kA);this._mc180X=kE;this._mcM180X=kD;this._loopOffset=kC+i;this._mcTSpan=kE-kD;this._spaceDistance=kC;this._mSpaceDistance=i}bL.prototype={calcLoopParam:function(kz,i,kG){kG=kG||256;var kD=0;var kA=3;var kC=6;var kB=kC*Math.pow(2,(i-kA))*256/kG;var kF=kB/2-1;var kE=-kB/2;while(kz>kF){kz-=kB;kD-=this._loopOffset}while(kz<kE){kz+=kB;kD+=this._loopOffset}var e=kD;kD=Math.round(kD/Math.pow(2,18-i));return{offsetX:kD,geoOffsetX:e,col:kz,T:kB,maxCol:kF,minCol:kE}},calcLoopCenterPoint:function(i){var e=i.lng;while(e>this._mc180X){e-=this._mcTSpan}while(e<this._mcM180X){e+=this._mcTSpan}i.lng=e;return i},calcLoopMapBounds:function(T,kz){var i=kz||T.getCenter();var e=T.sw.lng;var kA=T.ne.lng;while(i.lng>this._mc180X){i.lng-=this._mcTSpan;e-=this._mcTSpan;kA-=this._mcTSpan}while(i.lng<this._mcM180X){i.lng+=this._mcTSpan;e+=this._mcTSpan;kA+=this._mcTSpan}T.sw.lng=e;T.ne.lng=kA;if(T.pointBottomLeft){T.pointBottomLeft=this.calcLoopCenterPoint(T.pointBottomLeft);T.pointTopLeft=this.calcLoopCenterPoint(T.pointTopLeft);T.pointTopRight=this.calcLoopCenterPoint(T.pointTopRight);T.pointBottomRight=this.calcLoopCenterPoint(T.pointBottomRight)}return T},calcLoopTiles:function(kH,e,kL,kE){kL=kL||256;var kA=kE||Math.pow(2,18-e)*kL;var kG=Math.floor(this._mc180X/kA);var kC=Math.floor(this._mcM180X/kA);var kI=Math.floor(this._loopOffset/kA);var kJ=[];for(var kD=0;kD<kH.length;kD++){var kK=kH[kD];var kz=kK[0];var kM=kK[1];if(kz>=kG){var kF=kz+kI;if(this.isTileBlank(kF,e,kL)===true){continue}var T="id_"+kF+"_"+kM+"_"+e;if(!kH[T]){kH[T]=true;kJ.push([kF,kM,e,0])}}else{if(kz<=kC){var kF=kz-kI;if(this.isTileBlank(kF,e,kL)===true){continue}var T="id_"+kF+"_"+kM+"_"+e;if(!kH[T]){kH[T]=true;kJ.push([kF,kM,e,0])}}}}for(var kD=0,kB=kJ.length;kD<kB;kD++){kH.push(kJ[kD])}for(var kD=kH.length-1;kD>=0;kD--){var kz=kH[kD][0];if(this.isTileBlank(kz,e,kL)){kH.splice(kD,1)}}return kH},isTileBlank:function(T,kA,e){var kB=Math.pow(2,kA-3);var i=Math.round(this._validPixels*kB);var kz=6*kB*256/e;while(T>kz/2-1){T-=kz}while(T<-(kz/2)){T+=kz}if(T>0&&T*e>i){return true}if(T<0&&Math.abs((T+1)*e)>i){return true}return false},isAddWidth:function(e,i){return e<this._mcM180X||i>this._mc180X},pixelWidth:function(e,i){if(e<0){e=-e}return Math.abs(e-this._mc180X)/(Math.pow(2,18-i))},getSpaceDistanceInPixel:function(i){var e=Math.round((this._spaceDistance+this._mSpaceDistance)/Math.pow(2,18-i));return e}};var fc=new bL();function eA(){this._id=undefined;this._type=undefined;this.grid=undefined;this.layerName=undefined;this.geojson=undefined;this._geometry=null;this._properties={};this._box=null;this._state={};this._style=null;this._visible=true;this.renderData={};return this}eA.prototype.serialize=function(){return{id:this.getId(),type:this.getType(),grid:this.grid,layerName:this.layerName,geojson:this.geojson,renderData:this.renderData,geometry:this.getGeometry(),box:this.getBox(),properties:this.getProperties(),state:this.getState(),visible:this._visible}};eA.prototype.deserialize=function(e){this.setId(e.id);this.setType(e.type);this.grid=e.grid;this.layerName=e.layerName;this.geojson=e.geojson;this.setProperties(e.properties);this.setState(e.state);this._visible=e.visible||true;this.renderData=e.renderData;this.setGeometry(e.geometry);this.setBox(e.box);return this};eA.prototype.getType=function(){return this._type};eA.prototype.getGeometry=function(){return this._geometry};eA.prototype.getId=function(){return this._id};eA.prototype.getProperties=function(){return this._properties};eA.prototype.getBox=function(){return this._box};eA.prototype.getState=function(){if(Object.keys(this._state).length>0){return this._state}else{return null}};eA.prototype.getStyle=function(){return this._style};eA.prototype.getStyleFunction=function(){return this._styleFunction};eA.prototype.setType=function(e){return this._type=e};eA.prototype.setGeometry=function(e){this._geometry=e};eA.prototype.setStyle=function(e){if(!e||Object.keys(e).length===0){return}for(var i in e){this.set(i,e[i],this._style)}};eA.prototype.setState=function(e){for(var i in e){this.set(i,e[i],this._state)}};eA.prototype.setId=function(e){this._id=e};eA.prototype.setProperties=function(e){for(var i in e){this.set(i,e[i],this._properties)}};eA.prototype.setBox=function(e){return this._box=e};eA.prototype.isPointInBox=function(e){return this._pointInBox(e,this._box)};eA.prototype.getPointGeoJSON=function(kz){var kI=this.renderData;if(kI){var kC=kI.active;if(!kI[kC]||!kI[kC]["poi"]){return null}var kH=[];var kE=kI[kC]["poi"];for(var kF=0;kF<kE.length;kF++){if(kE[kF].bds&&kE[kF].bds.length===4){var kA=kz.pointToPixelIn(kE[kF].pt);var kD=kA.x-kE[kF].bds[0];var kB=kA.y-kE[kF].bds[1];var T=kA.x-kE[kF].bds[2];var e=kA.y-kE[kF].bds[3];kH.push([[kD,kB],[T,kB],[T,e],[kD,e],[kD,kB]])}}if(kH.length===0){return null}else{var kG="Polygon";if(kH.length>0){kG="MultiPolygon"}return{type:"Feature",properties:{},geometry:{type:kG,coordinates:[kH]}}}}};eA.prototype._pointInBox=function(e,i){if(i[0]>e[0]||i[1]>e[1]||i[2]<e[0]||i[3]<e[1]){return false}else{return true}};eA.prototype._pixelPnpoint=function(kA,kE,e){var kF=false;if(kE){var kz=kE.active;if(!kE[kz]||!kE[kz]["poi"]){return kF}var kB=kE[kz]["poi"];for(var kC=0;kC<kB.length;kC++){if(kB[kC].bds&&kB[kC].bds.length===4){var T=e.pointToPixelIn(kB[kC].pt);if((kA.x-T.x<kB[kC].bds[2]&&kA.x-T.x>kB[kC].bds[0])&&(T.y-kA.y<kB[kC].bds[3]&&T.y-kA.y>kB[kC].bds[1])){if(e.getTilt()>55){var kD=e.pointToOverlayPixelIn(kB[kC].pt);if(kD.outOfFrustum){continue}}kF=true;break}}}}return kF};eA.prototype._pixelPnpoly=function(kA,kC){var e=kC.length;var T=0;var kB=false;for(var kz=0;kz<e;kz++){T=(kz===e-1)?0:T+1;if((kC[kz].lat!==kC[T].lat)&&(((kA.lat>=kC[kz].lat)&&(kA.lat<kC[T].lat))||((kA.lat>=kC[T].lat)&&(kA.lat<kC[kz].lat)))&&(kA.lng<(kC[T].lng-kC[kz].lng)*(kA.lat-kC[kz].lat)/(kC[T].lat-kC[kz].lat)+kC[kz].lng)){kB=!kB}}return kB};eA.prototype._getProximity=function(kJ,kF){var T,kz,kI,kD,kC,kH,kG;var kM=kF.length;if(kM>1){for(var kK=1;kK<kM;kK++){var kE=kF[kK-1];var kQ=kF[kK];if(!kE||!kQ){continue}if(kE.lng!=kQ.lng){var kP=(kQ.lat-kE.lat)/(kQ.lng-kE.lng);var kN=kQ.lat-kP*kQ.lng;kG=Math.abs(kP*kJ.lng+kN-kJ.lat)/Math.sqrt(kP*kP+1)}else{kG=Math.abs(kJ.lng-kQ.lng)}var kL=Math.pow(kQ.lat-kE.lat,2)+Math.pow(kQ.lng-kE.lng,2);var kA=Math.pow(kQ.lat-kJ.lat,2)+Math.pow(kQ.lng-kJ.lng,2);var kO=Math.pow(kE.lat-kJ.lat,2)+Math.pow(kE.lng-kJ.lng,2);var kB=Math.pow(kG,2);var e=kA-kB+kO-kB;if(e>kL){kG=Math.sqrt(Math.min(kA,kO))}if((T==null)||(T>kG)){kz=Math.sqrt(kO-kB)/Math.sqrt(kL);kI=Math.sqrt(kA-kB)/Math.sqrt(kL);T=kG;kH=kK}T=Math.min(T,kG)}}return{dist:T}};eA.prototype.isPointInGeometry=function(T,kE){var e=false;switch(this._type){case f3.POINT:e=this._pixelPnpoint(T,this.renderData,kE);break;case f3.LINE_STRING:var kA=this._getProximity({lng:T[0],lat:T[1]},this._geometry);var kD=this.renderData[this.renderData.active];if(!kD||!kD.line||!kD.line[0]||!kD.line[0].width){var kC=2}else{var kC=this.renderData[this.renderData.active]["line"][0].width;if(this.grid===ek.GridModel.GOOGLEWEB){kC=Math.max(kC/2*dL.gridScaleFromBDMCTo3857,2)}else{kC=Math.max(kC/2,2)}}if(kA.dist<kC){e=true}break;case f3.POLYGON:e=this._pixelPnpoly({lng:T[0],lat:T[1]},this._geometry);break;case f3.MULTI_POLYGON:for(var kB=0;kB<this._geometry.length;kB++){if(this._geometry[kB][0] instanceof cG){e=this._pixelPnpoly({lng:T[0],lat:T[1]},this._geometry[kB])}else{e=this._pixelPnpoly({lng:T[0],lat:T[1]},this._geometry[kB][0]);if(e){for(var kz=1;kz<this._geometry[kB].length;kz++){e=this._pixelPnpoly({lng:T[0],lat:T[1]},this._geometry[kB][kz]);if(e){e=false;break}}}}if(e){break}}break;case f3.MULTI_LINE_STRING:var kD=this.renderData[this.renderData.active];if(!kD||!kD.line||!kD.line[0]||!kD.line[0].width){var kC=6}else{var kC=this.renderData[this.renderData.active]["line"][0].width;kC=Math.max(kC/2*dL.gridScaleFromBDMCTo3857,6)}for(var kB=0;kB<this._geometry.length;kB++){if(this._geometry[kB][0] instanceof cG){var kA=this._getProximity({lng:T[0],lat:T[1]},this._geometry[kB]);if(kA.dist<kC){e=true;break}}}break;case f3.MULTI_POINT:e=this._pixelPnpoint(T,this.renderData,kE);break;default:throw new Error("geojson类型错误: "+this._type)}return e};eA.prototype.set=function(i,T,kz){var e=kz||(kz={});e[i]=T};var gN=(function(){function kG(kM){var kL=kM?kM:{};if(kL.reference){this.reference=kL.reference}else{this.reference=null}return this}kG.prototype.readFeatureFromObject=function(kM,kP){var kL=null;if(kM.type&&kM.type.toLowerCase()==="feature"){kL=kM}else{kL={type:"Feature",geometry:kM,properties:null,}}kP=kP||{};kP.reference=(kP.reference===undefined?this.reference:kP.reference);if(kP.isPoints){kP.onlyGeometry=true}var kQ=T(kL.geometry,kP,kL.properties);var kO=e(kB(kL),kP);if(!kQ){return null}if(kP&&kP.onlyGeometry&&!kP.isPoints){return{geometry:kQ,type:kL.geometry["type"],bBox:kO}}if(kQ instanceof Array&&!(kQ[0] instanceof cG)){for(var kN=0;kN<kQ.length;kN++){if(kP.isPoints){kQ[kN]={points:kQ[kN],properties:kL.properties,index:kP.__index,brotherIndex:kN}}else{kQ[kN]["properties"]=kL.properties}}}else{if(kP.isPoints){kQ={points:kQ,properties:kL.properties,index:kP.__index,brotherIndex:-1}}else{kQ.properties=kL.properties}}return kQ};kG.prototype.readFeaturesFromObject=function(kO,kW,kL){var kT=kO;var kM=null;if(kT.type&&kT.type.toLowerCase()==="featurecollection"){var kQ=kO;kM=[];var kS=kQ.features;var kN=kW||{};for(var kR=0,kU=kS.length;kR<kU;++kR){kN.__index=kR;var kV=this.readFeatureFromObject(kS[kR],kW);if(kV instanceof Array){for(var kP=0;kP<kV.length;kP++){kL&&kL(kV[kP]);kM.push(kV[kP])}}else{kL&&kL(kV);kM.push(kV)}}}else{var kV=this.readFeatureFromObject(kO,kW);if(kV instanceof Array){kM=[];for(var kR=0;kR<kV.length;kR++){kL&&kL(kV[kR]);kM.push(kV[kR])}}else{kL&&kL(kV);kM=[kV]}}return kM};function T(kL,kN,kM){if(!kL){return null}var kO;switch(kL.type){case f3.POINT:kO=kD(kL,kN,kM);break;case f3.LINE_STRING:kO=kz(kL,kN,kM);break;case f3.POLYGON:kO=kE(kL,kN,kM);break;case f3.MULTI_POINT:kO=kF(kL,kN,kM);break;case f3.MULTI_LINE_STRING:kO=kI(kL,kN,kM);break;case f3.MULTI_POLYGON:kO=kJ(kL,kN,kM);break;default:throw new Error("geojson类型错误: "+kL.type)}return kO}function kD(kM,kP,kN){var kQ=kM.coordinates;if(kP.reference&&kP.reference!=="BD09LL"){kQ=gcoord.transform(kQ,kP.reference||"WGS84",gcoord.BD09LL)}if(kP&&kP.onlyGeometry){return new cG(kQ[0],kQ[1])}var kO=kP;if(kP.markerStyle){kO=kP.markerStyle;if(kP.markerStyle instanceof Function){kO=kP.markerStyle(kN)||{}}}var kL=new u(new cG(kQ[0],kQ[1]),kO);return kL}function kK(kP,kM){if(!kP){return[]}var kO=[];for(var kL=0;kL<kP.length;kL++){var kN=kP[kL];if(kM.reference&&kM.reference!=="BD09LL"){kN=gcoord.transform(kN,kM.reference||"WGS84",gcoord.BD09LL)}kO.push(new cG(kN[0],kN[1]))}return kO}function kz(kM,kP,kN){var kQ=kM.coordinates;if(kP&&kP.onlyGeometry){return kK(kQ,kP)}var kO=kP;if(kP.polylineStyle){kO=kP.polylineStyle;if(kP.polylineStyle instanceof Function){kO=kP.polylineStyle(kN)||{}}}var kL=new bu(kK(kQ,kP),kO);return kL}function kE(kL,kP,kN){var kQ=kL.coordinates;if(kP&&kP.onlyGeometry){return kK(kQ[0],kP)}var kO=kP;if(kP.polygonStyle){kO=kP.polygonStyle;if(kP.polygonStyle instanceof Function){kO=kP.polygonStyle(kN)||{}}}var kM=new i1(kK(kQ[0],kP),kO);return kM}function kF(kN,kT,kQ){var kR=kN.coordinates;var kL=[];for(var kP=0;kP<kR.length;kP++){var kS=kR[kP];if(kT.reference&&kT.reference!=="BD09LL"){kS=gcoord.transform(kS,kT.reference||"WGS84",gcoord.BD09LL)}if(kT&&kT.onlyGeometry){kL.push(new cG(kS[0],kS[1]))}else{var kM=kT;if(kT.markerStyle){kM=kT.markerStyle;if(kT.markerStyle instanceof Function){kM=kT.markerStyle(kQ)||{}}}var kO=new u(new cG(kS[0],kS[1]),kM);kL.push(kO)}}return kL}function kI(kM,kQ,kO){var kS=kM.coordinates;var kR=[];for(var kN=0;kN<kS.length;kN++){if(kQ&&kQ.onlyGeometry){kR.push(kK(kS[kN],kQ))}else{var kP=kQ;if(kQ.polylineStyle){kP=kQ.polylineStyle;if(kQ.polylineStyle instanceof Function){kP=kQ.polylineStyle(kO)||{}}}var kL=new bu(kK(kS[kN],kQ),kP);kR.push(kL)}}return kR}function kJ(kO,kV,kS){var kU=kO.coordinates;var kL=[];for(var kR=0;kR<kU.length;kR++){var kW=[];for(var kP=0,kN=kU[kR];kP<kN.length;kP++){var kQ=kK(kN[kP],kV);if(kV&&kV.onlyGeometry){if(kN.length===1){kL.push(kQ)}else{kW.push(kQ)}}else{if(kN.length===1){var kM=kV;if(kV.polygonStyle){kM=kV.polygonStyle;if(kV.polygonStyle instanceof Function){kM=kV.polygonStyle(kS)||{}}}var kT=new i1(kQ,kM);kL.push(kT)}else{kW.push(kQ)}}}if(kN.length!==1){if(kV&&kV.onlyGeometry){kL.push(kW)}else{var kM=kV;if(kV.polygonStyle){kM=kV.polygonStyle;if(kV.polygonStyle instanceof Function){kM=kV.polygonStyle(kS)||{}}}var kT=new i1(kW,kM);kL.push(kT)}}}return kL}function kA(kL){}function e(kP,kM){var kO=[];for(var kL=0;kL<kP.length;kL+=2){var kN=[kP[kL],kP[kL+1]];if(kM.reference&&kM.reference!=="BD09LL"){kN=gcoord.transform(kN,kM.reference||"WGS84",gcoord.BD09LL)}kO.push(kN[0]);kO.push(kN[1])}return kO}function kB(kL){var kM=[Infinity,Infinity,-Infinity,-Infinity];kC(kL,function(kN){if(kM[0]>kN[0]){kM[0]=kN[0]}if(kM[1]>kN[1]){kM[1]=kN[1]}if(kM[2]<kN[0]){kM[2]=kN[0]}if(kM[3]<kN[1]){kM[3]=kN[1]}});return kM}function kC(kU,kZ){var kQ,kN,kM,kT,kL,kW,kY,kX,kP,kS,kO=(kU.type&&kU.type.toLowerCase()==="featurecollection"),kR=(kU.type&&kU.type.toLowerCase()==="feature"),kV=kO?kU.features.length:1;for(kQ=0;kQ<kV;kQ++){kP=(kO?kU.features[kQ]["geometry"]:(kR?kU.geometry:kU));kS=kP.type==="GeometryCollection";kY=kS?kP.geometries.length:1;for(kT=0;kT<kY;kT++){kW=kS?kP.geometries[kT]:kP;kX=kW.coordinates;if(kW.type==="Point"){kZ(kX)}else{if(kW.type==="LineString"||kW.type==="MultiPoint"){for(kN=0;kN<kX.length;kN++){kZ(kX[kN])}}else{if(kW.type==="Polygon"||kW.type==="MultiLineString"){for(kN=0;kN<kX.length;kN++){for(kM=0;kM<kX[kN].length;kM++){kZ(kX[kN][kM])}}}else{if(kW.type==="MultiPolygon"){for(kN=0;kN<kX.length;kN++){for(kM=0;kM<kX[kN].length;kM++){for(kL=0;kL<kX[kN][kM].length;kL++){kZ(kX[kN][kM][kL])}}}}else{throw new Error("类型错误")}}}}}}}function i(kU,kZ){var kQ,kN,kM,kT,kL,kW,kY,kX,kP,kS,kO=kU.type==="FeatureCollection",kR=kU.type==="Feature",kV=kO?kU.features.length:1;for(kQ=0;kQ<kV;kQ++){kP=(kO?kU.features[kQ]["geometry"]:(kR?kU.geometry:kU));kS=kP.type==="GeometryCollection";kY=kS?kP.geometries.length:1;for(kT=0;kT<kY;kT++){kW=kS?kP.geometries[kT]:kP;kX=kW.coordinates;if(kW.type==="Point"){kX=kZ(kX)}else{if(kW.type==="LineString"||kW.type==="MultiPoint"){for(kN=0;kN<kX.length;kN++){kX[kN]=kZ(kX[kN])}}else{if(kW.type==="Polygon"||kW.type==="MultiLineString"){for(kN=0;kN<kX.length;kN++){for(kM=0;kM<kX[kN].length;kM++){kX[kN][kM]=kZ(kX[kN][kM])}}}else{if(kW.type==="MultiPolygon"){for(kN=0;kN<kX.length;kN++){for(kM=0;kM<kX[kN].length;kM++){for(kL=0;kL<kX[kN][kM].length;kL++){kX[kN][kM][kL]=kZ(kX[kN][kM][kL])}}}}else{throw new Error("类型错误")}}}}}}}function kH(kM){var kL=kM.type==="FeatureCollection";var kN=kM.type==="Feature";var kO=(kL?kM.features[0]["geometry"]:(kN?kM.geometry:kM));if(kO.type){return kO.type}else{throw new Error("类型错误")}}kG.bbox=kB;kG.coordEachReplace=i;kG.getType=kH;return kG})();const c8={point:{symbolPath:{format:"string",defaultValue:""},symbolFillColor:{format:"string",defaultValue:"#000"},symbolFillOpacity:{format:"number",defaultValue:1},symbolScale:{format:"number",defaultValue:1},symbolRotation:{format:"number",defaultValue:0},symbolStrokeColor:{format:"string",defaultValue:"#000"},symbolStrokeOpacity:{format:"number",defaultValue:0},symbolStrokeWeight:{format:"number",defaultValue:0},icon:{format:"string",defaultValue:""},iconSize:{format:"array",defaultValue:[32,32]},uid:{format:"string",defaultValue:"custom-vector-0"},name:{format:"string",defaultValue:""},fontSize:{format:"number",defaultValue:22},color:{format:"string",defaultValue:"#0d20c9"},haloSize:{format:"number",defaultValue:2},strokeColor:{format:"string",defaultValue:"#fff"},textOnIcon:{format:"string",defaultValue:false},textOnIconSize:{format:"array",defaultValue:[32,32]},textOnIconUrl:{format:"string",defaultValue:""},textMargin:{format:"number",defaultValue:0},direction:{format:"number",defaultValue:0},rank:{format:"number",defaultValue:50000},visibility:{format:"boolean",defaultValue:true},nodeType:{format:"number",defaultValue:0},shapeType:{format:"number",defaultValue:0},anchor:{format:"number",defaultValue:0},size:{format:"number",defaultValue:32},scale:{format:"number",defaultValue:1},offset:{format:"object",defaultValue:[0,0]},rotation:{format:"number",defaultValue:0},opacity:{format:"number",defaultValue:1},strokeWeight:{format:"number",defaultValue:0}},polyline:{strokeLineJoin:{format:"string",defaultValue:"miter"},strokeLineCap:{format:"string",defaultValue:"round"},strokeColor:{format:"string",defaultValue:"#142655"},strokeWeight:{format:"number",defaultValue:2},strokeOpacity:{format:"number",defaultValue:1},borderColor:{format:"string",defaultValue:"rgba(27, 142, 236, 1)"},borderWeight:{format:"number",defaultValue:0},strokeTextureUrl:{format:"string",defaultValue:""},strokeTextureWidth:{format:"number",defaultValue:16},strokeTextureHeight:{format:"number",defaultValue:16},strokeStyle:{format:"string",defaultValue:"solid"},dashArray:{format:"object",defaultValue:[8,4]},shapeType:{format:"number",defaultValue:0},visibility:{format:"boolean",defaultValue:true}},polygon:{fillColor:{format:"string",defaultValue:"#142655"},fillOpacity:{format:"number",defaultValue:1},patternMapping:{format:"string",defaultValue:"0, 0, 32, 32"},patternScale:{format:"number",defaultValue:1},patternOffset:{format:"string",defaultValue:"0, 0"},strokeWeight:{format:"number",defaultValue:0},strokeLineJoin:{format:"string",defaultValue:"bevel"},strokeLineCap:{format:"string",defaultValue:"round"},strokeColor:{format:"string",defaultValue:"#dec41b"},strokeOpacity:{format:"number",defaultValue:1},strokeStyle:{format:"string",defaultValue:"solid"},dashArray:{format:"object",defaultValue:[8,4]},visibility:{format:"boolean",defaultValue:true}}};const cB=(function(i){var e={};for(var kz in i){e[kz]={};for(var T in i[kz]){e[kz][T]=i[kz][T].defaultValue}}return e})(c8);const f3={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",CIRCLE:"Circle",};function fT(e){return e&&typeof ArrayBuffer!=="undefined"&&(e instanceof ArrayBuffer||(e.constructor&&e.constructor.name==="ArrayBuffer"))}function gy(e){if(self){if(self.ImageBitmap&&e instanceof self.ImageBitmap){return true}}else{if(window&&window.ImageBitmap){if(e instanceof window.ImageBitmap){return true}}}return false}const jp={};function aJ(i,kz,T){var e=T||{};Object.defineProperty(i,"_classRegistryKey",{value:kz,writeable:false});jp[kz]={_class:i,escape:e.escape||[]}}aJ(Object,"Object");aJ(cG,"Point");function jO(kE,kC){if(kE===null||kE===undefined||typeof kE==="boolean"||typeof kE==="number"||typeof kE==="string"||kE instanceof Boolean||kE instanceof Number||kE instanceof String||kE instanceof Date||kE instanceof RegExp){return kE}if(fT(kE)){if(kC){kC.push(kE)}return kE}if(gy(kE)){if(kC){var kH=kC.filter(function(i){if(i===kE){return true}else{return false}});!kH&&kC.push(kE)}return kE}if(ArrayBuffer.isView(kE)){const kD=kE;if(kC){kC.push(kD.buffer)}return kD}if(kE instanceof ImageData){if(kC){var kH=kC.filter(function(i){if(i===kE.data.buffer){return true}else{return false}});!kH&&kC.push(kE.data.buffer)}return kE}if(Array.isArray(kE)){const T=[];for(var kz=0;kz<kE.length;kz++){var kI=kE[kz];T.push(jO(kI,kC))}return T}if(typeof kE==="object"){const kA=kE.constructor;const e=kA._classRegistryKey;if(!e){throw new Error("不能被序列化")}const kB=kA.serialize?kA.serialize(kE,kC):{};if(!kA.serialize){for(var kG in kE){if(!kE.hasOwnProperty(kG)){continue}if(jp[e]["escape"].indexOf(kG)>=0){continue}const kF=kE[kG];kB[kG]=jO(kF,kC)}if(kE instanceof Error){kB.message=kE.message}}if(e!=="Object"){kB["_$name"]=e}return kB}else{if(kE instanceof Function){return null}}throw new Error("不能被序列化")}function iw(kB){if(kB===null||kB===undefined||typeof kB==="boolean"||typeof kB==="number"||typeof kB==="string"||kB instanceof Boolean||kB instanceof Number||kB instanceof String||kB instanceof Date||kB instanceof RegExp||fT(kB)||gy(kB)||ArrayBuffer.isView(kB)||kB instanceof ImageData){return kB}if(Array.isArray(kB)){var e=kB["_$name"];if(e){var kz=jp[e]["_class"];if(!kz){throw new Error("不能被反序列化")}if(kz.deserialize){return kz.deserialize(kB)}}const kA=[];for(var T=0;T<kB.length;T++){var kE=kB[T];kA.push(iw(kE))}return kA}if(typeof kB==="object"){var e=kB["_$name"]||"Object";var kz=jp[e]["_class"];if(!kz){throw new Error("不能被反序列化")}if(kz.deserialize){return kz.deserialize(kB)}const kG=Object.create(kz.prototype);const kF=Object.keys(kB);for(var T=0;T<kF.length;T++){const kD=kF[T];if(kD==="_$name"){continue}const kC=kB[kD];kG[kD]=iw(kC)}return kG}throw new Error("不能被反序列化")}function m(kD,kB,kC){if(!kD.length){return kC(null,[])}var kA=kD.length;const kz=new Array(kD.length);var e=null;for(var T=0;T<kD.length;T++){kB(kD[T],function(kE,i){if(kE){e=kE}kz[T]=i;if(--kA===0){kC(e,kz)}},T)}}function gn(kE,kB,kD){if(!kE.length){return kD(null,[])}var kA=kE.length;const kz=new Array(kE.length);var e=null;var T=0;function kC(){kB(kE[T],function(kF,i){if(kF){e=kF}kz[T]=i;if(--kA===0){kD(e,kz)}else{T++;kC()}},T)}kC()}var j0=(function(){var i=true;var kA=256;var e=true;var kC=ka("ditu","normalTraffic");var kz=kC.udt;var kD="//its.map.baidu.com/traffic/";var kB=[[2,"79,210,125,1",3,2,0,[],0,0],[2,"79,210,125,1",3,2,0,[],0,0],[2,"79,210,125,1",4,2,0,[],0,0],[2,"79,210,125,1",5,2,0,[],0,0],[2,"79,210,125,1",6,2,0,[],0,0],[2,"255,208,69,1",3,2,0,[],0,0],[2,"255,208,69,1",3,2,0,[],0,0],[2,"255,208,69,1",4,2,0,[],0,0],[2,"255,208,69,1",5,2,0,[],0,0],[2,"255,208,69,1",6,2,0,[],0,0],[2,"232,14,14,1",3,2,0,[],0,0],[2,"232,14,14,1",3,2,0,[],0,0],[2,"232,14,14,1",4,2,0,[],0,0],[2,"232,14,14,1",5,2,0,[],0,0],[2,"232,14,14,1",6,2,0,[],0,0],[2,"181,0,0,1",3,2,0,[],0,0],[2,"181,0,0,1",3,2,0,[],0,0],[2,"181,0,0,1",4,2,0,[],0,0],[2,"181,0,0,1",5,2,0,[],0,0],[2,"181,0,0,1",6,2,0,[],0,0],[2,"255,255,255,1",4,0,0,[],0,0],[2,"255,255,255,1",5.5,0,0,[],0,0],[2,"255,255,255,1",7,0,0,[],0,0],[2,"255,255,255,1",8.5,0,0,[],0,0],[2,"255,255,255,1",10,0,0,[],0,0]];var T=new hO({transparentPng:true,dataType:2,cacheSize:256,clipTile:true,isFlat:true});T.zIndex=2;T.getTilesUrl=function(kG,kH){if(!kG||kH<7){return null}var kF=kG.x;var kI=kG.y;var kE=kD+"TrafficTileService?level="+kH+"&x="+kF+"&y="+kI+"&time="+(+new Date());if(this.map.getRenderType()==="webgl"){kE=kD+"?qt=vtraffic&z="+kH+"&x="+kF+"&y="+kI+"&udt="+kz}return kE};T.setColors=function(kE){for(var kH=0;kH<kB.length;kH++){var kG=Math.floor(kH/5);var kF=kE[kG];if(kF){if(Object.prototype.toString.call(kF)==="[object String]"){kF=hV.parseCSSColor(kF)}kB[kH][1]=[kF[0],kF[1],kF[2],kF[3]/255].join(",")}}};T.setEdge=function(kE){e=!!kE};T.processData=function(kH){var kL=kH.content;var kJ=10;if(typeof kH.precision==="number"){kJ=kH.precision*10}var kS={road:[[],[]]};if(!kL){return kS}var kQ=kL.tf;if(!kQ){return kS}for(var kI=0;kI<kQ.length;kI++){var kR=kQ[kI][1];var kP=[];var kN=0;var kM=0;var kO=kB[kQ[kI][3]];for(var kG=0,kE=kR.length;kG<kE/2;kG++){kN+=kR[kG*2]/kJ;kM+=kR[kG*2+1]/kJ;kP.push(kN,256-kM)}var kF=kO[1].split(",");kF[3]=kF[3]*255;var kK=kO[2]/2;if(e){kS.road[0].push([kP,1,2,[255,255,255,255],kK+2])}kS.road[1].push([kP,1,2,kF,kK])}return kS};return T})();function jC(){hP.sendMessage(a1(4,3,3),["layer","traffic"])}jC.prototype=j0;function ea(e){eM.call(this);e=e||{};this._opts={};this._opts.districts=e.name||"";this._opts.kind=e.kind||0;this._config={};this._config.strokeColor=e.strokeColor||"#00f";this._config.strokeOpacity=typeof e.strokeOpacity==="number"?e.strokeOpacity:1;ck(this._config.strokeOpacity,0,1);this._config.fillColor=e.fillColor||"#ff0";this._config.fillOpacity=typeof e.fillOpacity==="number"?e.fillOpacity:0.6;ck(this._config.fillOpacity,0,1);this._config.strokeWeight=e.strokeWeight||1;this._config.viewport=e.viewport||false;this.disOverlays=[];this.eventAndCallback={};hP.sendMessage(a1(4,3,6),["layer","district"]);var i=this;hl.load("layer",function(){i._asyncSearch()})}ea.inherits(dh,"DistrictLayer");e9.extend(ea.prototype,{initialize:function(e){this._map=e;this.addDistrict()},removeDistrict:function(i,e){this._map=i;this.deleteDistrict(e)},toString:function(){return"DistrictLayer"}});function aQ(e,i){i=i||{};this.layerName=e||"unknown";this.reference=i.reference;this.level=i.level||-99;this.visible=(i.visible===undefined?true:!!i.visible);this.minZoom=i.minZoom||3;this.maxZoom=i.maxZoom||21;this.markerStyle=i.markerStyle||{};this.polylineStyle=i.polylineStyle||{};this.polygonStyle=i.polygonStyle||{};this.overlayData=[];this._onMap=false;this.clickDistrict=5;this.setData(i.dataSource);hP.sendMessage(a1(4,3,12),["layer","geojson"])}aQ.inherits(e9.BaseClass,"GeoJSONLayer");aQ.prototype.init=function(kC){if(this.map){return}this.map=kC;var kA=this;this._onZoomEvent=function(){if(kA.map.getZoom()>=kA.minZoom&&kA.map.getZoom()<=kA.maxZoom){if(!kA._onMap){kA.addDataToMap();kA._onMap=true}}else{if(kA._onMap){kA.removeDataFromMap();kA._onMap=false}}};this.map.on("zoomend",this._onZoomEvent);var kA=this;var e=false;var kz={x:0,y:0};this._layerMouseEvent=function(kF){if(!kA.map||!kA._listeners||!kA.visible||!kA._onMap){return}if(!kA._listeners.onmousemove||Object.keys(kA._listeners.onmousemove).length===0){return}var kE=kA.pickOverlays(kF);var i;if(kE&&kE.length>0){i=new fW("onmousemove");i.features=kE;kA.map.platform.style.cursor=kA.map.config.overlayMoveCursor;e=true}else{if(!e||!kA._listeners.onmouseout||Object.keys(kA._listeners.onmouseout).length===0){return}kA.map.platform.style.cursor=kA.map.config.defaultCursor;i=new fW("onmouseout");i.features=null;e=false}if(i){i.point=kF.point;i.pixel=kF.pixel;i.latLng=kF.latlng;kA.dispatchEvent(i)}};this._layerClickEvent=function(kG){if(!kA.map||!kA._listeners||!kA.visible){return}if((!kA._listeners.onclick&&!kA._listeners.dblclick)||(Object.keys(kA._listeners.onclick).length===0&&Object.keys(kA._listeners.dblclick).length===0)){return}var kE={x:kG.clientX,y:kG.clientY};if(Math.abs(kE.x-kz.x)>kA.clickDistrict||Math.abs(kE.y-kz.y)>kA.clickDistrict){return}var kF=kA.pickOverlays(kG);var i=new fW(kG.type);i.point=kG.point;i.pixel=kG.pixel;i.latLng=kG.latlng;i.features=kF;kA.dispatchEvent(i)};this._layerMouseDownEvent=function(i){kz={x:i.clientX,y:i.clientY}};kC.addEventListener("onmousemove",this._layerMouseEvent);kC.addEventListener("onmouseout",this._layerMouseEvent);kC.addEventListener("onmousedown",this._layerMouseDownEvent);var kB=["onclick"];for(var T=0;T<kB.length;T++){var kD=kB[T];kC.addEventListener(kD,this._layerClickEvent)}this._onZoomEvent()};aQ.prototype.remove=function(){if(this.map){this.removeDataFromMap();this.map.removeEventListener("onmousemove",this._layerMouseEvent);this.map.removeEventListener("onmouseout",this._layerMouseEvent);this.map.removeEventListener("onclick",this._layerClickEvent);this.map.removeEventListener("onmousedown",this._layerMouseDownEvent);this.map.removeEventListener("onzoomend",this._onZoomEvent)}this.map=null};aQ.prototype.destroy=function(){if(this.map){this.clearData();this.map.removeEventListener("onmousemove",this._layerMouseEvent);this.map.removeEventListener("onmouseout",this._layerMouseEvent);this.map.removeEventListener("onclick",this._layerClickEvent);this.map.removeEventListener("onmousedown",this._layerMouseDownEvent);this.map.removeEventListener("onzoomend",this._onZoomEvent)}this.map=null};aQ.prototype.setData=function(e){if(!this.gParse){this.gParse=new gN({reference:this.reference})}if(!e){return}if(this.dataSource&&this.overlayData.length>0){this.clearData()}this.dataSource=e;this.overlayData=this.gParse.readFeaturesFromObject(e,{markerStyle:this.markerStyle,polylineStyle:this.polylineStyle,polygonStyle:this.polygonStyle},this._register.bind(this));this.addDataToMap()};aQ.prototype._register=function(e){e.layerName=this.layerName;e.setZIndex(this.level)};aQ.prototype.resetStyle=function(){for(var e=0;e<this.overlayData.length;e++){if(this.overlayData[e] instanceof u){var i=this.markerStyle;if(this.markerStyle instanceof Function){i=this.markerStyle(this.overlayData[e].properties)||{}}}if(this.overlayData[e] instanceof bu){var i=this.polylineStyle;if(this.polylineStyle instanceof Function){i=this.polylineStyle(this.overlayData[e].properties)||{}}}if(this.overlayData[e] instanceof i1){var i=this.polygonStyle;if(this.polygonStyle instanceof Function){i=this.polygonStyle(this.overlayData[e].properties)||{}}}if(i){this.overlayData[e].setOptions(i)}}};aQ.prototype.getData=function(){return this.overlayData};aQ.prototype.addOverlay=function(e){var kC=e;if(!(e instanceof Array)){kC=[e]}for(var kz=0;kz<kC.length;kz++){var T=kC[kz];if(T.__proto__ instanceof aU){this._register(T);this.overlayData.push(T);this.map.addOverlay(T)}else{var kB=this.gParse.readFeaturesFromObject(T,{markerStyle:this.markerStyle,polylineStyle:this.polylineStyle,polygonStyle:this.polygonStyle},this._register.bind(this));for(var kA=0;kA<kB.length;kA++){this.overlayData.push(kB[kA]);this.map.addOverlay(kB[kA])}}}};aQ.prototype.removeOverlay=function(kz){var kA=kz;if(!(kz instanceof Array)){kA=[kz]}for(var T=0;T<kA.length;T++){var i=kA[T];var e=this.findItemIndex(i);if(e>=0){this.overlayData.splice(e,1);this.map.removeOverlay(i)}}};aQ.prototype.findItemIndex=function(T){var i=-1;for(var e=0;e<this.overlayData.length;e++){if(this.overlayData[e].hashCode===T.hashCode){i=e;break}}return i};aQ.prototype.addDataToMap=function(){if(this.visible&&this.map&&this.map.getZoom()>=this.minZoom&&this.map.getZoom()<=this.maxZoom){for(var e=0;e<this.overlayData.length;e++){this.map.addOverlay(this.overlayData[e])}}};aQ.prototype.removeDataFromMap=function(){if(this.map&&this.overlayData.length>0){for(var e=0;e<this.overlayData.length;e++){this.map.removeOverlay(this.overlayData[e])}}};aQ.prototype.clearData=function(){this.dataSource=null;if(this.map&&this.overlayData.length>0){this.removeDataFromMap()}this.overlayData=[]};aQ.prototype.pickOverlays=function(kD){var kC=[];if(!this.visible||!this._onMap){return null}for(var kA=0;kA<this.overlayData.length;kA++){var kB=this.overlayData[kA];var kz;if(!kB&&!kB.isVisible()){continue}if(kB.toString()==="Marker"){kz=kB._getInPnBox(kD.pixel);if(kz){kC.push(kB)}continue}if(kB.toString()!=="Polyline"){kz=kB._getInPnpoly(kD.point)}else{kz=kB._getProximity(kD.point)}var T=kz.dist;if(T>=0&&T<kB._config.mouseOverTolerance){kC.push(kB)}}return kC.length>0?kC:null};aQ.prototype.setLevel=function(e){if(e>-999&&e<9999){this.level=e;for(var T=0;T<this.overlayData.length;T++){this.overlayData[T].setZIndex(this.level)}if(this.map){this.map.fire(new BMapGL.Event("onupdate","line"))}}};aQ.prototype.setClickDistrict=function(e){this.clickDistrict=e||5};aQ.prototype.getLevel=function(){return this.level};aQ.prototype.setVisible=function(i){var e=!!i;if(this.visible!==e){this.visible=e;if(e){this.addDataToMap()}else{this.removeDataFromMap()}}};aQ.prototype.getVisible=function(){return this.visible};aQ.prototype.toString=function(){return"GeoJSONLayer"};function km(i){var i=i||{};var kB=i.transform||{source:"EPSG3857",target:"BD09MC"};if(!kB.source){kB.target="EPSG3857"}if(!kB.target){kB.target="BD09MC"}const kz=i.tileUrlTemplate||"";const kF=i.xTemplate||function(kM,kO,kN){return kM};const kJ=i.yTemplate||(i.tms?function(kM,kO,kN){return Math.pow(2,kN)-kO-1}:function(kM,kO,kN){return kO});const kD=i.zTemplate||function(kM,kO,kN){return kN};const kI=i.bTemplate||function(kM,kP,kO){const kN=dL.getTileRangeExtent([kO,kM,kP]);return kN.minX+","+kN.minY+","+kN.maxX+","+kN.maxY};const kA=i.wTemplate||function(kM,kO,kN){return 512};const kE=i.hTemplate||function(kM,kO,kN){return 512};var kK=i.extent||[];const kC=i.extentCRSIsWGS84||false;var T=i.minZoom||0;var kG=i.maxZoom||23;var kH=i.spanLevel||0;if(!i.showRegion||"insideoutside".indexOf(i.showRegion)===-1){i.showRegion="inside"}var kL=new hO({transform:kB,png8:i.png8||false,height:i.height||0,retry:i.retry||false,retryTime:i.retryTime||600,transparentPng:true,dataType:i.dataType||1,spanLevel:kH,tileTypeName:"xyz",cacheSize:i.cacheSize||256,customLayer:true,clipTile:false,isTop:i.isTop||false,isLowText:i.isLowText||false,boundary:i.boundary||false,showRegion:i.showRegion,useThumbData:i.useThumbData||false});if(i.zIndex){kL.zIndex=i.zIndex}(kK.length===4)&&kC&&(kK=dL.fromEPSG4326(kK));kL.getTilesUrl=function(kT,kN,kR){if(!kT||kN<0||kN<(T+kH)||kN>(kG+kH)){kL.tileCache.clear();return null}if(kB.source!=="BD09MC"){kT.x=dL.getTilesLoop(kN,kT.x)}if(kK.length===4){var kS=dL.getTileRangeExtent([kN,kT.x,kT.y]);var kU=e([kS.minX,kS.minY,kS.maxX,kS.maxY]);if(!kU){return null}}var kO="";if(kz){kO=kz;var kQ=/[^\{}]*\{(.*)\}[^\}]*/;kO.match(kQ);var kP=[];if(RegExp.$1){kP=RegExp.$1.split(",")}var kM=kD(kT.x,kT.y,kN);if(!kM){return null}kO=kO.replace(/\{(.*)\}/,kP[(kT.x+kT.y)%kP.length]);kO=kO.replace(/\[x\]/gi,kF(kT.x,kT.y,kN));kO=kO.replace(/\[y\]/gi,kJ(kT.x,kT.y,kN));kO=kO.replace(/\[z\]/gi,kM);kO=kO.replace(/\[b\]/gi,kI(kT.x,kT.y,kN));kO=kO.replace(/\[w\]/gi,kA(kT.x,kT.y,kN));kO=kO.replace(/\[h\]/gi,kE(kT.x,kT.y,kN))}else{return null}return kO};function e(kM){if(kK&&kK instanceof Array&&kK.length===4){if((kK[0]<=kM[2]&&kK[1]<=kM[3])&&(kK[2]>=kM[0]&&kK[3]>=kM[1])){return true}else{return false}}return true}hP.sendMessage(a1(4,3,7),["layer","xyz"]);return kL}function dB(i){this.src=dc();this.tileMaskUvCache=new aC(64,{clearCallback:function(kB){}});var kA=6;if(i.pixelMap){this.opacity=typeof i.pixelMap.opacity==="number"?i.pixelMap.opacity:1;ck(this.opacity,0,1);if(this.opacity<1){i.useThumbData=false}var kz=i.pixelMap||{};this.colors=kz.colors||["#F9F871","#FFC75F","#FF9671","#FF6F91","#D65DB1","#845EC2"];this.positions=kz.positions||[0,0.2,0.4,0.6,0.8,1];this.domain=kz.domain||[0,255];this.clamp=kz.clamp||this.domain;this.noData=(kz.noData!==undefined)?kz.noData:-99999;this.fomularC=kz.fomularC||"float generateValue(vec4 pixel){return pixel.r * 255.;}";this.fomularJS=kz.fomularJS||function(kB){return kB.r};this.maskPng=kz.maskPng||null;if(this.maskPng){this.loadMaskPng(this.maskPng)}this.maskData=kz.maskData||-1;this.maskCoord=kz.maskCoord||null;this.fHashcode=q({str:this.fomularC});var e=this.canPixelMap();if(e){this.isPixelMap=true;this.setPixelMap()}kA=i.pixelMap.cacheSize||kA}var T=new km(i);T.ontology=this;this.layer=T;this.cacheSize=kA;this.tileCache=new aC(this.cacheSize,{clearCallback:function(kB){}});this.tileImageDataCache=new aC(this.cacheSize,{clearCallback:function(kB){}});hP.sendMessage(a1(4,3,16),["layer","pixel"])}dB.inherits(e9.BaseClass,"PixelLayer");e9.extend(dB.prototype,{canPixelMap:function(){if(this.colors&&this.positions){return true}return false},setPixelMap:function(){if(!this.isPixelMap||!this.canPixelMap()){return}var i=this.colors;var e=this.positions;this.pHashcode=q({colors:i,positions:e});this.pixelColorMap=hV.generateColorRamp(i,e)},setDomain:function(e){if(e instanceof Array&&e.length===2){this.domain=e;this.doOnceDraw()}},setClamp:function(e){if(e instanceof Array&&e.length===2){this.clamp=e;this.doOnceDraw()}},setNoData:function(e){this.noData=e;this.doOnceDraw()},setPositions:function(e){this.positions=e;this.setPixelMap();this.doOnceDraw()},setColors:function(e){this.colors=e;this.setPixelMap();this.doOnceDraw()},setFomular:function(e,i){if(e&&i){this.fomularJS=e;this.fomularC=i;this.fHashcode=q({str:this.fomularC});this.doOnceDraw()}},setOpacity:function(e){this.opacity=e;this.doOnceDraw()},setIsPixelMap:function(e){this.isPixelMap=e;this.doOnceDraw()},setMaskPng:function(e){this.maskPng=e;this.loadMaskPng(this.maskPng);this.doOnceDraw()},setMaskData:function(e){this.maskData=e;this.doOnceDraw()},setMaskCoord:function(e){this.maskCoord=e||null;this.calMaskBox();this.doOnceDraw()},setZIndex:function(e){if(this.layer&&parseInt(e)>0){this.layer.setZIndex(e)}},getZIndex:function(){if(this.layer){return this.layer.zIndex}},setUpLevel:function(){if(this.layer){var e=this.layer._getAdjoinZIndex("up");if(this.layer.zIndex!==e){this.layer.setZIndex(e)}}},setDownLevel:function(){if(this.layer){var e=this.layer._getAdjoinZIndex("down");if(this.layer.zIndex!==e){this.layer.setZIndex(e)}}},setZIndexTop:function(){if(this.layer){this.layer.setZIndexTop()}},doOnceDraw:function(){if(this.layer.map){var e=new fW("onupdate");this.layer.map.dispatchEvent(e)}},_getInLayer:function(kH){if(!this.map){return null}var kG=Math.floor(this.map.getZoom());var kz=dL.transformBDmcPoint(kH,this.layer.transform);var kD=dL.getTileCoordForXYAndZ_(kz[0],kz[1],kG,false);var T=kD.join("-");var e=this.tileCache.getData(T);if(e){return e}var kA=this.layer.zIndex;var kC=this.map._featureMgr.result.bkData;var kE=kC[kA][2];var kI=null;for(var kB=0;kB<kE.length;kB++){var kD=kE[kB];var kF=kD.tileInfo.zoom+"-"+kD.tileInfo.col+"-"+kD.tileInfo.row;if(T===kF){kI=kD;break}}this.tileCache.setData(T,kI);return kI},_initEvent:function(kA){this.map=kA;var T=this;this._layerMouseEvent=function(kE){if(!T.map){return}var kC;var i=kE.point;var kD=T._getInLayer(i);if(kD){T.prox=kD;kC=new fW("onmousemove");T.map.platform.style.cursor=T.map.config.overlayMoveCursor}else{T.map.platform.style.cursor=T.map.config.defaultCursor;T.prox=null}if(kC){kC.point=kE.point;kC.pixel=kE.pixel;kC.latLng=kE.latlng;T.dispatchEvent(kC)}};this._layerClickEvent=function(kE){if(!T.map){return}var kC;var i=kE.point;var kD=T.getImagePixel(i);if(kD){kC=new fW(kE.type);kC.point=i;kC.pixel=kE.pixel;kC.latLng=kE.latlng;kC.color=kD;kC.value=T.getValue(kC.color);T.dispatchEvent(kC)}};kA.addEventListener("onmousemove",this._layerMouseEvent);var kz=["onclick","dblclick"];for(var e=0;e<kz.length;e++){var kB=kz[e];kA.addEventListener(kB,this._layerClickEvent)}kA.addEventListener("removetilelayer",function(i){if(i.target&&i.target.ontology){if(i.target.ontology.src===T.src){kA.removeEventListener("onmousemove",T._layerMouseEvent);kA.removeEventListener("onclick",T._layerClickEvent);kA.removeEventListener("ondblclick",T._layerClickEvent);T._clearCache()}}});kA.on("destroy",function(){T._clearCache()})},_clearCache:function(){var e=this;e.prox=null;e.tileCache.clear();e.tileImageDataCache.clear();e.tileMaskUvCache.clear();e._layerMouseEvent=null;e._layerClickEvent=null;e.imageMaskObject=null;e.pHashcode=null;e.pixelColorMap=null;e.layer.ontology=null;e.layer=null},getImagePixel:function(kE){if(!this.map){return null}var kz=dL.transformBDmcPoint(kE,this.layer.transform);var kD=this._getInLayer(kE);if(!kD){return null}if(!this.getImageMaskPixel(kz)){return null}var kB=[kD.tileInfo.zoom,kD.tileInfo.col,kD.tileInfo.row];var kC=dL.getTileRangeExtent(kB);var e=this.getImageObject(kD.textureSource,kB.join("-"));var T=Math.floor((kz[0]-kC.minX)/(kC.maxX-kC.minX)*e.width);var i=Math.floor((-kz[1]+kC.maxY)/(kC.maxY-kC.minY)*e.height);var kA=Math.floor((i*e.width+T)*4);return[e.data.data[kA],e.data.data[kA+1],e.data.data[kA+2],e.data.data[kA+3],]},getImageObject:function(kA,kz){var kB=this.tileImageDataCache.getData(kz);if(kB){return kB}var i=document.createElement("canvas");i.width=kA.width;i.height=kA.height;var T=i.getContext("2d");T.drawImage(kA,0,0,kA.width,kA.height);var e={width:kA.width,height:kA.height,data:T.getImageData(0,0,kA.width,kA.height)};this.tileImageDataCache.setData(kz,e);T=null;i=null;return e},getValue:function(i){if(this.isPixelMap&&i&&this.fomularJS){if(!(i instanceof Array)){i=this.getImagePixel(i.point)}var e=this.fomularJS({r:i[0],g:i[1],b:i[2],a:i[3]});if(e>=this.clamp[0]&&e<=this.clamp[1]){return e}}return null},setMaskImageObject:function(T){var e=document.createElement("canvas");e.width=T.width;e.height=T.height;var i=e.getContext("2d");i.drawImage(T,0,0,T.width,T.height);this.imageMaskObject={width:T.width,height:T.height,data:i.getImageData(0,0,T.width,T.height)};i=null;e=null},getImageMaskPixel:function(e){if(!this.imageMaskObject||!this.maskBox){return true}var kz=[e];var kE=this.maskBox||[];var kB=kE[1][0]-kE[0][0];var kA=kE[1][1]-kE[0][1];var T=Math.floor((kz[0][0]-kE[0][0])/kB*this.imageMaskObject.width);var i=Math.floor((-kz[0][1]+kE[1][1])/kA*this.imageMaskObject.height);var kD=Math.floor((i*this.imageMaskObject.width+T)*4);if(T>this.imageMaskObject.width||T<0){return null}if(i>this.imageMaskObject.height||i<0){return null}var kC=this.imageMaskObject.data.data;if(kD+3>kC.length){return false}if(kC[kD+3]>0){if(this.maskData>-1&&this.maskData!==kC[kD]){return false}return true}return false},calMaskBox:function(){var T=this.maskCoord||[];if(this.hasMaskPng&&T&&T.length===2){var e=[];for(var kz=0;kz<T.length;kz++){e[kz]=dL.transformBDmcPoint(jv.convertLL2MC(T[kz]),this.layer.transform)}this.maskBox=e;this.tileMaskUvCache.clear()}else{this.maskBox=null}},buildFillMaskVertex:function(kF,kD,kC){var kE=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];if(!this.maskBox){return kE}var kH=[kF,kD,kC].join("-");var e=this.tileMaskUvCache.getData(kH);if(e){return e}if(this.hasMaskPng){var kK=this.maskBox||[];var kB=[kC,kF,kD];var kG=dL.getTileRangeExtent(kB);var kA=kK[1][0]-kK[0][0];var T=kK[1][1]-kK[0][1];var kJ=(kG.minX-kK[0][0])/kA;var kI=(kG.minY-kK[0][1])/T;var kz=(kG.maxX-kK[0][0])/kA;var i=(kG.maxY-kK[0][1])/T;kE=[kJ,kI,kz,kI,kz,i,kJ,kI,kz,i,kJ,i]}this.tileMaskUvCache.setData(kH,kE);return kE},loadMaskPng:function(T){var e=this;function i(kA,kz){e.maskTextureSource=kz?kA:null;if(kz){e.hasMaskPng=true;e.setMaskImageObject(kA);e.calMaskBox();e.doOnceDraw()}else{e.hasMaskPng=false}}this.imageLoad(T,i)},imageLoad:function(i,kA){if(!i){kA&&kA(null,false)}var e=new Image();e.crossOrigin="anonymous";e.onload=function kz(){kA&&kA(this,true)};e.onerror=function T(){kA&&kA(null,false)};e.src=i},toString:function(){return"PixelLayer"}});function jw(i,e){this.id=i;this.layerName=e;this.properties=null}function ek(e){this._opt=e||{};this._layerId=dc();this._opt.defaultOrder=(this._opt.defaultOrder===undefined)?true:this._opt.defaultOrder;this.minZoom=this._opt.minZoom||3;this.maxZoom=this._opt.maxZoom||23;this.useThumb=(this._opt.useThumb===undefined)?true:this._opt.useThumb;this.gridModel=this._opt.gridModel||ek.GridModel.BAIDUWEB;this.noCollision=(this._opt.noCollision===undefined)?true:this._opt.noCollision;if(this.gridModel===ek.GridModel.BAIDUWEB){this._opt.reference="BD09MC"}else{if(!this._opt.transform){this._opt.transform={source:"BD09MC",target:"BD09MC"};this._opt.reference="BD09MC"}else{this._opt.reference=this._opt.transform.source||"GCJ02";if(this._opt.reference==="EPSG3857"){this._opt.reference="WGS84"}}}this.loadModule=false;if(this._opt.useWorker===undefined){this._opt.useWorker=true}this.upStyle=this._opt.useWorker?false:"useMain";this._stateCube={};hP.sendMessage(a1(4,3,8),["layer","mvt"]);var i=this;hl.load("mvtParse",function(){i._async()},true);i.init(this._opt)}ek.GridModel={BAIDUWEB:0,GOOGLEWEB:1};ek.LayerTypes={POINT:"point",LINE:"line",FILL:"fill"};ek.inherits(e9.BaseClass,"MVTLayer");e9.extend(ek.prototype,{_async:function(){this.loadModule=true;this.mvt=new ek.MVTParse(this._opt);this.resolveStyle(this._opt);if(this.upStyle){this.doOnceDraw()}},init:function(i){var T=b5()?64:256;i.dataType=2;i.cacheSize=Math.max(i.cacheSize||T,16);if(i.spanLevel===undefined||typeof i.spanLevel!=="number"){i.spanLevel=0}if(this.gridModel===ek.GridModel.BAIDUWEB){var e=this.createTileLayer(i);i.spanLevel=0;this.spanLevel=0}else{if(this.gridModel===ek.GridModel.GOOGLEWEB){var e=new km(i);this.spanLevel=i.spanLevel}}var kA={type:"vector",layerId:this._layerId,g:this.gridModel,mc:this._opt.reference==="BD09MC"?true:false,};this.layerOption=Object.assign(kA,this._opt);if(i.index&&i.index>0){e.zIndex=i.index}e.loadTileData=this._loadTile.bind(this);e.ontology=this;this.layer=e;var kz=this;e.addEventListener("ontilesloadstart",function(){kz.dispatchEvent(new fW("ontilesloadstart"))});e.addEventListener("ontilesloadend",function(){kz.dispatchEvent(new fW("ontilesloadend"))})},createTileLayer:function(i){const kz=i.tileUrlTemplate||"";const kE=i.xTemplate||function(kL,kN,kM){return kL};const kJ=i.yTemplate||function(kL,kN,kM){return kN};const kC=i.zTemplate||function(kL,kN,kM){return kM};const kI=i.bTemplate||function(kL,kO,kN){const kM=jv.tileToBoundRange({col:kL,row:kO,zoom:kN,baseTileSize:256});return kM.MC.sw.lng+","+kM.MC.sw.lat+","+kM.MC.ne.lng+","+kM.MC.ne.lat};var kK=i.extent||[];const kD=i.extentCRSIsWGS84||false;var T=i.minZoom||0;var kG=i.maxZoom||23;var kH=i.spanLevel||0;var kF=new hO({transparentPng:true,dataType:2,spanLevel:kH,tileTypeName:"web",cacheSize:i.cacheSize||256,customLayer:true,clipTile:false,boundary:false,useThumbData:i.useThumbData||false});if(kK.length===4){if(kD){kK=dL.fromEPSG4326(kK)}var kA=dL.transformPointArr([kK[0],kK[1]],"EPSG3857","BD09MC");var kB=dL.transformPointArr([kK[2],kK[3]],"EPSG3857","BD09MC");kK=[kA[0],kA[1],kB[0],kB[1]]}kF.getTilesUrl=function(kS,kM,kR){if(!kS||kM<0||kM<(T+kH)||kM>(kG+kH)){kF.tileCache.clear();return null}if(kK.length===4){const kQ=jv.tileToBoundRange({col:x,row:y,zoom:z,baseTileSize:256});var kT=e([kQ.MC.getMin().lng,kQ.MC.getMin().lat,kQ.MC.getMax().lng,kQ.MC.getMax().lat]);if(!kT){return null}}var kN="";if(kz){kN=kz;var kP=/[^\{}]*\{(.*)\}[^\}]*/;kN.match(kP);var kO=[];if(RegExp.$1){kO=RegExp.$1.split(",")}var kL=kC(kS.x,kS.y,kM);if(!kL){return null}kN=kN.replace(/\{(.*)\}/,kO[(kS.x+kS.y)%kO.length]);kN=kN.replace(/\[x\]/gi,kE(kS.x,kS.y,kM));kN=kN.replace(/\[y\]/gi,kJ(kS.x,kS.y,kM));kN=kN.replace(/\[z\]/gi,kC(kS.x,kS.y,kM));kN=kN.replace(/\[b\]/gi,kI(kS.x,kS.y,kM))}else{return null}return kN};function e(kL){if(kK&&kK instanceof Array&&kK.length===4){if((kK[0]<=kL[2]&&kK[1]<=kL[3])&&(kK[2]>=kL[0]&&kK[3]>=kL[1])){return true}else{return false}}return true}return kF},compileExpress:function(i,e){var i=ek.ExpressParse.normalizePropertyExpression(i,e);return i},resolveStyle:function(kB){var kz=kB||{};if(kz.style){var kA={};if(!kz.layers||kz.layers.length===0){var kD=ek.LayerTypes.POINT;var i=ek.LayerTypes.LINE;var kC=ek.LayerTypes.FILL;if(kz.style[kD]){kz.style[kD].type="point"}if(kz.style[i]){kz.style[i].type="polyline"}if(kz.style[kC]){kz.style[kC].type="polygon"}}for(var T in kz.style){if(kz.style.hasOwnProperty(T)){var e=kz.style[T];this._styleFormat(e.type,e.painter,T,kA)}}this.styleExpress=kA}},_styleFormat:function(kA,e,i,kz){var kC={};var kD=c8[kA];if(!kD){return}for(var T in e){if(e.hasOwnProperty(T)){var kB=this.compileExpress(e[T],kD[T]);kC[T]=kB}}kz[i]={type:kA,painter:kC}},evaluateContext:function(e,T,kz){var i=e+"_"+T.getId();var kA=this._stateCube[i];if(kA){T.setState(kA)}else{T._state={}}return{properties:function(){return T&&T.getProperties()},featureState:kz===true?{}:(T&&T.getState())}},evaluates:function(i,kz,kA){if(!this.styleExpress||!this.styleExpress.hasOwnProperty(i)){return null}var kC=this.styleExpress[i].painter;var e={};for(var T in kC){if(kC.hasOwnProperty(T)){var kB=kC[T].evaluate(this.evaluateContext(i,kz,kA));e[T]=kB}}return e},_updateState:function(T,kz,e){if(T instanceof jw&&T.layerName&&T.id){var i=T.layerName+"_"+T.id;if(e){this._set(kz,this._stateCube,i)}else{this._stateCube[i]=kz}this._stateCube[i].rank=(this._stateCube[i].rank||0)+1}else{if(typeof T==="string"){if(e){this._set(kz,this._stateCube,T)}else{this._stateCube[T]=kz}this._stateCube[T].rank=(this._stateCube[T].rank||0)+1}}},updateState:function(kA,kB,e){var T=JSON.stringify(this._stateCube);if(!(kB&&typeof kB==="object"&&Object.keys(kB).length>0)){return}if(!e){this._stateCube={}}if(kA instanceof Array){for(var kz=0;kz<kA.length;kz++){this._updateState(kA[kz],kB,e)}}else{this._updateState(kA,kB,e)}var kC=JSON.stringify(this._stateCube);if(T!==kC){this.doOnceDraw()}},replaceAllState:function(e){var i=JSON.stringify(this._stateCube);this._stateCube=e;var T=JSON.stringify(this._stateCube);if(i!==T){this.doOnceDraw()}},getAllState:function(){return this._stateCube},getStateByLayerName:function(){},removeState:function(kz){var e=JSON.stringify(this._stateCube);if(kz instanceof Array){for(var T=0;T<kz.length;T++){if(kz[T] instanceof jw&&kz[T].layerName){delete this._stateCube[kz[T].layerName+"_"+kz[T].id]}else{if(typeof kz[T]==="string"){delete this._stateCube[kz[T]]}}}}else{if(kz instanceof jw&&kz.layerName){delete this._stateCube[kz.layerName+"_"+kz.id]}else{if(typeof kz==="string"){delete this._stateCube[kz]}}}var kA=JSON.stringify(this._stateCube);if(e!==kA){this.doOnceDraw()}},clearState:function(){var e=JSON.stringify(this._stateCube);if(e!=="{}"){this._stateCube={};this.doOnceDraw()}},_set:function(i,kA,T){var kz=kA[T]||(kA[T]={});for(var e in i){kz[e]=i[e]}},doOnceDraw:function(){if(this.map){var e=new fW("onupdate");this.map.dispatchEvent(e)}},_releaseOutViewTileData:function(e){if(!this.map||!this.map.dispatcher){return}var i=this;e.layerId=this._layerId;this.map.dispatcher.broadcast("release",e,function(kB,T){for(var kA=0;kA<T.length;kA++){for(var kz=0;kz<T[kA].length;kz++){i.layer.tileCache.removeData(T[kA][kz].tileKey);i.layer._checkLayerTilesLoaded()}}})},_loadTile:function(kC,T){this.curViewTilesInfo=kC;if(!this.loadModule||!this.upStyle){return}var kN=this.layer.map;this._releaseOutViewTileData(kC);var kD=kN.getZoom();if(kD<this.minZoom||kD>this.maxZoom){kN._featureMgr.clearData(this.layer.drawIndex);kN._featureMgr.clearLabelOverlayData(this.layer.drawIndex);kN._featureMgr.clearLabelData(this.layer.drawIndex);return}var kE=this.layer.getZoomState();if(T){this.thumbCache={};var kL=-1;this.layer.tileLabels=[];var kH=kN._customLabelMgr.virtualTiles["mvt_"+this.layer.drawIndex];if(kH&&kH.label){this.layer.tileLabels.push(kH.label)}for(var kJ=0,kI=kC.length;kJ<kI;kJ++){var kK=kC[kJ];var kA=this.layer.getTileKey(kK);var kM=this.layer.tileCache.getData(kA);kL=kK.zoom;if(this.useThumb){this._setThumbData(kM,kK,kE)}else{if(kM&&kM.status==="ready"){kN._featureMgr.setData(kM,this.layer.drawIndex,2);this._loadCacheLabel(kK,kM)}}}this.layer.tileLabels.labelZoom=kL;this.layer.updateLabels(kE);if(!this.noCollision){var kB=Math.floor(kD);var kG=kD-kB;var kF=Math.floor(this.layer.LAST_CALC_ZOOM);var e=this.layer.LAST_CALC_ZOOM-kF;var kP=false;if(this.layer.hasZoomChange){if(Math.abs(kD-this.layer.LAST_CALC_ZOOM)>=0.5){kP=true}else{if(kG<0.5&&e>=0.5){kP=true}else{if(kG>=0.5&&e<0.5){kP=true}}}if(kP){this.layer.cacheDataCollideLabels(0)}this.layer.LAST_CALC_ZOOM=kD}else{if(this.layer.tileLabels.length>0){this.layer.cacheDataCollideLabels(e9.Browser.ie?50:30)}}}else{this.layer.cacheDataCollideLabels(0)}return}for(var kJ=0,kI=kC.length;kJ<kI;kJ++){var kK=kC[kJ];var kz=this.layer.getTilesUrl(new fv(kK.col,kK.row),kK.zoom,kK);if(!kz){return}var kA=this.layer.getTileKey(kK);var kM=this.layer.tileCache.getData(kA);if(!kM){kM={status:"init",retry:0};this.layer.numTileLoading++}if(kM.status!=="ignore"&&kM.status!=="ready"&&kM.status!=="loading"){kM.status="loading";this.layer.tileCache.setData(kA,kM);if(this.upStyle==="useMain"){var kO=this;this._loadTileData(kK,function(kQ,kR,i){kO._tileDataCbk(kQ,kR,i)})}else{if(this.upStyle){this._loadTileDataByWorker(kK)}}}}},_loadCacheLabel:function(T,i){var kA=i.tileData.hasChangeLabel();if(kA){i.label.status="init"}if(i.label.status==="ready"){i.label.tileInfo=i.tileInfo;this.layer.tileLabels.push(i.label);if(i.label.textureSources&&i.label.textureSources[T.zoom]&&this.map._webglMapScene){var kz=this.map._webglMapScene._painter;var e=i.label.imgKey;if(!kz._labelTextureAtlasOffset[e]){kz._addToAsyncJob(i.label.textureSources[T.zoom])}}}else{if(i.label.status!=="processing"){this._processLabelData(i)}}},getLayerVisible:function(i){var T=this._opt.style;if(!T||!T[i]){return true}else{if(T[i].visible===false){return false}else{var kA=this._opt.style[i].minZoom||3;var e=this._opt.style[i].maxZoom||23;var kz=this.map.getZoom();if(kz<kA||kz>e){return false}return true}}},_setThumbData:function(i,e,T){if(T===1){this._dataFitGrid(i,e,3)}else{if(T===-1){if(i&&i.status==="ready"){this.map._featureMgr.setData(i,this.layer.drawIndex,2);this._loadCacheLabel(e,i)}else{this._findChildZoomTile(e,3)}}}},_findParent:function(kz,kC){var T=this.minZoom;var e=kz.col;var kF=kz.row;var kE=kz.zoom;for(var kD=1;kD<=kC;kD++){var kA=this._getParentTiles(e,kF,kE,T);if(kA===null){continue}kA.tileSize=kz.tileSize;kA.tileTypeName=kz.tileTypeName;kA.transform=kz.transform;var kG=this.layer.getTileKey(kA);var kB=this.layer.tileCache.getData(kG);if(kB&&kB.status==="ready"){kB.key=kG;return kB}e=kA.col;kF=kA.row;kE=kA.zoom}return false},_findChild:function(i,kC){var kE=this.maxZoom;var e=i.col;var kF=i.row;var kD=i.zoom;var kA=this._getChildTiles(e,kF,kD,kE,kC);if(!kA){return false}for(var kz=0;kz<kA.length;kz++){var T=this.layer.getTileKey(kA[kz]);var kB=this.layer.tileCache.getData(T);if(this.curViewTilesInfo["id_"+kA[kz].col+"_"+kA[kz].row+"_"+kA[kz].zoom]&&(!kB||kB.status!=="ready")){return false}}return true},_dataFitGrid:function(T,i,kz){var e=this._findParent(i,kz);if(e){if(this.thumbCache[e.key]){this.map._featureMgr.setData(T,this.layer.drawIndex,2);this._loadCacheLabel(i,T)}else{if(this.thumbCache[e.key]===undefined){if(this._findChild(e.tileInfo,i.zoom-e.tileInfo.zoom)){this.thumbCache[e.key]=true;this.map._featureMgr.setData(T,this.layer.drawIndex,2);this._loadCacheLabel(i,T)}else{this.thumbCache[e.key]=false;this.layer.map._featureMgr.setData(e,this.layer.drawIndex,0);this._loadCacheLabel(e.tileInfo,e)}}}}else{if(T&&T.status==="ready"){this.map._featureMgr.setData(T,this.layer.drawIndex,2);this._loadCacheLabel(i,T)}}},_findChildZoomTile:function(T,kD){var kG=this.maxZoom;var e=T.col;var kH=T.row;var kF=T.zoom;for(var kE=1;kE<=kD;kE++){var kI=false;var kB=this._getChildTiles(e,kH,kF,kG,kE);if(!kB){continue}for(var kA=0;kA<kB.length;kA++){var kz=this.layer.getTileKey(kB[kA]);var kC=this.layer.tileCache.getData(kz);if(kC&&kC.status==="ready"){this.layer.map._featureMgr.setData(kC,this.layer.drawIndex,1);this._loadCacheLabel(kB[kA],kC);kI=true}}if(kI){break}}},_getParentTiles:function(e,T,i,kz){if(i-1<kz){return null}return{col:Math.floor(e/2),row:Math.floor(T/2),zoom:i-1,useZoom:i-1,loopOffsetX:0}},_getChildTiles:function(kz,kI,kH,kG,kC){var kJ=[];if(kH+kC>kG){return null}var kF=Math.pow(2,kC);var e=kz*kF;var kE=kI*kF;var kD=kH+kC;var kJ=[];for(var kA=0;kA<kF;kA++){var kB=e+kA;for(var T=0;T<kF;T++){var i=kE+T;kJ.push({col:kB,row:i,zoom:kD,useZoom:kD,loopOffsetX:0})}}return kJ},_loadTileDataByWorker:function(i){if(!this.map||!this.map.dispatcher){return}var kB=this.map.dispatcher.getActor();if(!kB){return}var T=i.col;var kG=i.row;var kF=i.zoom;var e=this.layer.getTilesUrl(new fv(T,kG),kF,i);if(!e){return}var kA=this.layer.getTileKey(i);var kD="id_"+T+"_"+kG+"_"+kF;var kC=this._opt.header||null;if(this._opt.header instanceof Function){kC=this._opt.header(e)}if(this._opt.urlCallback instanceof Function){e=this._opt.urlCallback(e)}var kz={type:"vector",layerId:this._layerId,x:T,y:kG,z:kF,tileKey:kA,tileUrl:e,spanLevel:this._opt.spanLevel,header:kC,encrypt:this._opt.encrypt||false};var kE=this;kB.send("loadTile",kz,function(kJ,kI){if(!kE.layer.tileCache){kE.layer._checkLayerTilesLoaded();return}var kH=kE.layer.tileCache.getData(kA);if(!kH){kE.layer._checkLayerTilesLoaded();return}if(kJ||!kI){kH.status="ignore";kE.layer._checkLayerTilesLoaded()}else{var kK=new ek.TileFamilyParse(kE.layerOption,kz).deserialize(kI,kE);kH.tileInfo=i;kH.tileData=kK;kE._processLabelData(kH);kE.layer.callbackDataQueue.push([kA,kH,kD]);if(kE.processDataTimer){return}kE.processDataTimer=setTimeout(function(){while(kE.layer&&kE.layer.callbackDataQueue.length>0){kE.layer._checkLayerTilesLoaded();var kM=kE.layer.callbackDataQueue.shift();kE._setTileData(kM[0],kM[1],kM[2])}var kL=new fW("onupdate");kE.map.dispatchEvent(kL);kE.processDataTimer=null},0)}})},_loadTileData:function(i,e){var kz=i.col;var kD=i.row;var kA=i.zoom;var T=this.layer.getTilesUrl(new fv(kz,kD),kA,i);if(!T){return}var kC=this.layer.getTileKey(i);var kB=new XMLHttpRequest();kB.open("GET",T,true);kB.responseType="arraybuffer";kB.timeout=3000;kB.ontimeout=function(){e&&e(null,kC,i)};kB.onreadystatechange=function(kE){if(this.readyState===4){if(this.status===200){e&&e(kB.response,kC,i);return}if(this.status>=400||this.status===0){e&&e(null,kC,i)}else{e&&e(null,kC,i)}}};kB.send()},_tileDataCbk:function(kA,kC,i){var e=this.layer.tileCache.getData(kC);if(!e){return}var kB=this.layer.map;var T=this;if(!kA||typeof kA==="string"){e.status="init";e.reloadTimer=setTimeout(function(){if(e.retry<3){e.retry++;e.status="loading";T._loadTileData(i,function(kE,kF,kD){T._tileDataCbk(kE,kF,kD)})}else{e.status="ignore"}},3000);return}if(e.reloadTimer){clearTimeout(e.reloadTimer);e.reloadTimer=null}var kz=(function(kD){return function(){var kE=i.col;var kH=i.row;var kF=i.zoom;var kG="id_"+kE+"_"+kH+"_"+kF;e.tileInfo=i;e.tileData=T.mvt.readFeatures(kD,T,kB,{x:kE,y:kH,z:kF,g:T.gridModel,mc:T._opt.transform&&T._opt.transform.source==="BD09MC"?true:false});T._processLabelData(e);T.layer.callbackDataQueue.push([kC,e,kG]);if(T.processDataTimer){return}T.processDataTimer=setTimeout(function(){while(T.layer.callbackDataQueue.length>0){var kI=T.layer.callbackDataQueue.shift();T._setTileData(kI[0],kI[1],kI[2])}T.doOnceDraw();T.processDataTimer=null},200)}})(kA);kB.jobScheduler.addJob(kz)},_setTileData:function(T,e,i){e.status="ready";this.layer.tileCache.setData(T,e);if(this.layer.curViewTilesInfo[i]){e.dataType=h2}},_processLabelData:function(T){if(!T.tileData){return}T.label=T.tileData.getTileLabels();if(!T.label){return}if(T.label.status==="processing"){return}var i=T.tileInfo;var e=this._getTileTexImgKey(i);T.label.imgKey=e;T.label.status="processing";var kz=this;kz.layer.updateAllIconsTextureCoords(T);this.layer.labelProcessor.loadIconImages(T,function(kB){kz.layer.updateAllIconsTextureCoords(kB)},true);var kA=this.layer.map.tileMgr.getLabelTextCanvas();kA.drawCustomLabelsOnCanvas(T.label.fixedLabel,function(kB){if(kB){if(!T.label.textureHeights){T.label.textureHeights=[]}T.label.textureHeights[i.useZoom]=kB.height}kz.layer._doWorkAfterLabelImageLoad(T,kB,null,e)})},_getTileTexImgKey:function(i){var e="mvt_"+this.layer.drawIndex+"_"+i.col+"_"+i.row+"_"+i.zoom+"_";e=bG.getGUID(e);return e},_updateBRushCube:function(kC){var kE=kC.tileData;for(var T in kE){if(kE.hasOwnProperty(T)){var e=kE[T];for(var kA=0;kA<e.length;kA++){var kz=e[kA];var kB=kz.getBox();var kD={minX:kB[0],minY:kB[1],maxX:kB[2],maxY:kB[3],lN:T,f:kz}}}}},intersectFeatures:function(e){var kB=this._geojsonToSouceXY(e);var T=this._bboxTile(kB);T=this._intersectTile(kB,T);if(!T){return null}var kD=this.layer.map._featureMgr.result.bkData[this.layer.drawIndex][2];var kz=[];var kI=null;for(var kE=0;kE<kD.length;kE++){var kA=kD[kE].tileInfo;var kJ=kA.zoom+"_"+kA.col+"_"+kA.row;if(T[kJ]){if(!kD[kE].tileData||!kD[kE].tileData.layers){continue}var kC=kD[kE].tileData.layers;var kH=null;for(var kG in kC){var kF=kC[kG];if(T[kJ][4]){this._featuresInter(kG,kF.features,kz)}else{if(kF.layerType==="Point"||kF.layerType==="MultiPoint"){if(!kI){kI=this._geojsonToScreenXY(e)}this._pointFeaturesInter(kG,kF.features,kz,kI)}else{if(!kH){kH=this._geojsonToTileXY(kB,T[kJ])}if(!kH){continue}this._noPointFeaturesInter(kG,kF.features,kz,kH)}}}}}return kz.length===0?null:kz},_featuresInter:function(T,kz,kA){for(var i in kz){if(!kz[i]._visible){continue}if(kA[T+"_"+kz[i].getId()]){continue}kz[i].layerName=T;var e=new jw(kz[i].getId(),T);e.properties=kz[i].getProperties();kA.push(e);kA[T+"_"+kz[i].getId()]=true}},_pointFeaturesInter:function(kA,kB,kC,kz){for(var T in kB){if(!kB[T]._visible){continue}if(kC[kA+"_"+kB[T].getId()]){continue}var kD=kB[T].getPointGeoJSON(this.layer.map);if(!kD){continue}var i=ek.booleanDisjoint(kD,kz);if(!i){kB[T].layerName=kA;var e=new jw(kB[T].getId(),kA);e.properties=kB[T].getProperties();kC.push(e);kC[kA+"_"+kB[T].getId()]=true}}},_noPointFeaturesInter:function(kA,kB,kC,kz){for(var T in kB){if(!kB[T]._visible){continue}if(kC[kA+"_"+kB[T].getId()]){continue}var i=ek.booleanDisjoint(kB[T].geojson,kz);if(!i){kB[T].layerName=kA;var e=new jw(kB[T].getId(),kA);e.properties=kB[T].getProperties();kC.push(e);kC[kA+"_"+kB[T].getId()]=true}}},pickFeatures:function(kM,kA){if(this.running){return}var T=Math.floor(this.map.getZoom()+this.spanLevel);if(this.gridModel===ek.GridModel.BAIDUWEB){var kK=Math.pow(2,18-T);var kB=Math.floor(kM.lng/kK/256);var kE=Math.floor(kM.lat/kK/256);var kz=kM.lng/kK-kB*256;var kF=kM.lat/kK-kE*256;var kD=[kz,kF];var kS=[T,kB,kE]}else{var kQ=dL.transformBDmcPoint(kM,this.layer.transform);var kL=dL.getPointPixelCoor(kM,T,this.layer.transform);var kS=dL.getTileCoordForCoordAndZ(kQ,T);var kD=dL.getRelativePixelCoor(kS,kL)}var kT=this.layer.map._featureMgr.result.bkData[this.layer.drawIndex][2];var kJ=kS.join("_");var kG=[];for(var kO=0;kO<kT.length;kO++){var kP=kT[kO].tileInfo;var kU=kP.zoom+"_"+kP.col+"_"+kP.row;if(kJ===kU){this.running=true;if(!kT[kO].tileData||!kT[kO].tileData.layers){continue}var kH=kT[kO].tileData.layers;for(var kR in kH){var kC=kH[kR].features;for(var kN in kC){if(!kC[kN]._visible){continue}if(kG[kR+"_"+kC[kN].getId()]){continue}if(kC[kN].getType()===f3.POINT||kC[kN].getType()===f3.MULTI_POINT){var e=kC[kN].isPointInGeometry(kA,this.layer.map)}else{var e=kC[kN].isPointInBox(kD);if(e){e=kC[kN].isPointInGeometry(kD)}}if(e){kC[kN].layerName=kR;var kI=new jw(kC[kN].getId(),kR);kI.properties=kC[kN].getProperties();kG.push(kI);kG[kR+"_"+kC[kN].getId()]=true}}}break}}this.running=false;return kG},_geojsonToScreenXY:function(T){var i=JSON.parse(JSON.stringify(T));var e=this;gN.coordEachReplace(i,function(kB){var kz=jv.convertLL2MC(new cG(kB[0],kB[1]));var kA=e.map.pointToPixelIn(kz);return[kA.x,kA.y]});return i},_geojsonToTileXY:function(T,kA){if(kA.length<4){return null}var i=JSON.parse(JSON.stringify(T));var kz=Math.floor(this.map.getZoom()+this.spanLevel);if(this.gridModel===ek.GridModel.BAIDUWEB){var e=Math.pow(2,(18-kz))}else{var e=dL.resolutions[kz]}gN.coordEachReplace(i,function(kB){return[(kB[0]-kA[2])/e,(kB[1]-kA[3])/e]});return i},_geojsonToSouceXY:function(T){var i=JSON.parse(JSON.stringify(T));var e=this;gN.coordEachReplace(i,function(kB){var kz=jv.convertLL2MC(new cG(kB[0],kB[1]));var kA=[kz.lng,kz.lat];if(e.gridModel!==ek.GridModel.BAIDUWEB){kA=dL.transformBDmcPoint(kz,e.layer.transform)}return kA});return i},_bboxTile:function(T){var kC=gN.bbox(T);var kH=Math.floor(this.map.getZoom()+this.spanLevel);if(this.gridModel===ek.GridModel.BAIDUWEB){var kF=new cG(kC[0],kC[1]);var kI=new cG(kC[2],kC[3]);var kD=Math.pow(2,18-kH);var kJ=Math.floor(kF.lng/kD/256);var kB=Math.floor(kF.lat/kD/256);var kA=Math.floor(kI.lng/kD/256);var i=Math.floor(kI.lat/kD/256);return[kH,kJ,kB,kA,i]}else{var e=[kC[0],kC[3]];var kE=[kC[2],kC[1]];var kG=dL.getTileCoordForCoordAndZ(e,kH);var kz=dL.getTileCoordForCoordAndZ(kE,kH);return[kG[0],kG[1],kG[2],kz[1],kz[2]]}},_intersectTile:function(e,kC){var kJ={};if(kC.length<5){return null}var kF=gN.getType(e);var kK=false;if(e.type==="Feature"&&kF==="Polygon"){kK=true}for(var kA=kC[1];kA<=kC[3];kA++){for(var kz=kC[2];kz<=kC[4];kz++){if(this.gridModel===ek.GridModel.BAIDUWEB){var kE=jv.tileToBoundRange({col:kA,row:kz,zoom:kC[0],baseTileSize:256});var kB=[kE.MC.sw.lng,kE.MC.sw.lat,kE.MC.ne.lng,kE.MC.ne.lat]}else{var kE=dL.getTileRangeExtent([kC[0],kA,kz]);var kB=[kE.minX,kE.minY,kE.maxX,kE.maxY]}var kD={type:"Feature"};kD.bbox=kB;kD.geometry={type:"Polygon",coordinates:[[[kB[0],kB[1]],[kB[2],kB[1]],[kB[2],kB[3]],[kB[0],kB[3]],[kB[0],kB[1]],]]};var T=ek.booleanDisjoint(kD,e);if(!T){var kI=kC[0]+"_"+kA+"_"+kz;var kH=[kA,kz,kB[0],kB[1],false];if(kK){var kG=ek.booleanContains(e,kD);if(kG){kH[4]=true}}kJ[kI]=kH}}}return Object.keys(kJ).length===0?null:kJ},_initEvent:function(kC){this.map=kC;if(!this.map.dispatcher){this.map.dispatcher=new cL(hE(),ek)}var kA=this;this.map.dispatcher.broadcast("setLayerStyle",kA.layerOption,function(kE,i){kA.upStyle=true;if(kA.loadModule){kA.doOnceDraw()}});var kz=this;var e=false;this._layerMouseEvent=function(kG){if(!kz.map||!kz._listeners){return}if(!kz._listeners.onmousemove||Object.keys(kz._listeners.onmousemove).length===0){return}var kE;var i=kG.point;var kF=kz.pickFeatures(i,kG.pixel);if(kF&&kF.length>0){kE=new fW("onmousemove");kE.value=kF;kz.map.platform.style.cursor=kz.map.config.overlayMoveCursor;e=true}else{kz.map.platform.style.cursor=kz.map.config.defaultCursor;if(!e||!kz._listeners.onmouseout||Object.keys(kz._listeners.onmouseout).length===0){return}kE=new fW("onmouseout");e=false}if(kE){kE.point=kG.point;kE.pixel=kG.pixel;kE.latLng=kG.latlng;kz.dispatchEvent(kE)}};this._layerClickEvent=function(kG){if(!kz.map||!kz._listeners){return}if((!kz._listeners.onclick&&!kz._listeners.dblclick)||(Object.keys(kz._listeners.onclick).length===0&&Object.keys(kz._listeners.dblclick).length===0)){return}var kE;var i=kG.point;var kF=kz.pickFeatures(i,kG.pixel);kE=new fW(kG.type);kE.point=i;kE.pixel=kG.pixel;kE.latLng=kG.latlng;kE.value=kF;kz.dispatchEvent(kE)};kC.addEventListener("onmousemove",this._layerMouseEvent);var kB=["onclick","dblclick"];for(var T=0;T<kB.length;T++){var kD=kB[T];kC.addEventListener(kD,this._layerClickEvent)}kC.addEventListener("removetilelayer",function(i){if(i.target&&i.target.ontology){if(i.target.ontology===kz){kz.layer.tileCache.clear();kz.stateCube={};kz.upStyle=false;kC.removeEventListener("onmousemove",kz._layerMouseEvent);kC.removeEventListener("onclick",kz._layerClickEvent);kC.removeEventListener("ondblclick",kz._layerClickEvent);kz.layer.ontology=null;kz.layer=null;if(kC.dispatcher){kC.dispatcher.broadcast("removeLayer",kz.layerOption,function(kG,kE){var kI=kC.tileMgr.tileLayers;var kF=false;for(var kH=0;kH<kI.length;kH++){if(kI[kH].ontology instanceof ek){kF=true;break}}if(!kF&&kC.dispatcher){kC.dispatcher.remove();kC.dispatcher=null}})}}}});kC.on("destroy",function(){if(kz.map&&kz.map.dispatcher){kz.map.dispatcher.remove();kz.map.dispatcher=null}kz.layer.ontology=null;kz.layer=null});this.addEventListener("onmousemove",function(){})},setStyle:function(e){this._opt.style=e;if(!this.map||!this.loadModule){return}this.resolveStyle(this._opt);var i=this;if(this.upStyle===true){this.map.dispatcher.stop();this.map.dispatcher.broadcast("stop",null,function(kz,T){i.layerOption=Object.assign(i.layerOption,i._opt);i.map.dispatcher.broadcast("setLayerStyle",i.layerOption,function(kB,kA){i.layer.tileCache.clear();i.doOnceDraw()})})}else{i.layer.tileCache.clear();i.doOnceDraw()}},setZIndex:function(e){if(this.layer&&parseInt(e)>0){this.layer.setZIndex(e)}},getZIndex:function(){if(this.layer){return this.layer.zIndex}},setZIndexTop:function(){if(this.layer){this.layer.setZIndexTop()}},setUpLevel:function(){if(this.layer){var e=this.layer._getAdjoinZIndex("up");if(this.layer.zIndex!==e){this.layer.setZIndex(e)}}},setDownLevel:function(){if(this.layer){var e=this.layer._getAdjoinZIndex("down");if(this.layer.zIndex!==e){this.layer.setZIndex(e)}}},toString:function(){return"MVTLayer"}});ek._generateTexture=function(kC,kB,T){var kA=document.createElement("canvas");var e;var kz;if(kB.strokeStyle==="dashed"){e=16;kz=e*8}else{if(kB.strokeStyle==="dotted"){e=32;kz=e*2}}kA.width=e;kA.height=kz;var i=kA.getContext("2d");i.fillStyle=kB.strokeColor;i.globalAlpha=kB.strokeOpacity;var kD=kB.strokeWeight*2;if(kB.strokeStyle==="dashed"){kD=ek._drawDashArrayTexture(i,e,kz,kB)}else{if(kB.strokeStyle==="dotted"){kD=ek._drawDottedTexture(i,e,kz,kB.strokeWeight)}}if(window.createImageBitmap&&!kB.sync){createImageBitmap(kA,{imageOrientation:"flipY"}).then(function(kE){T(null,{totalDashLen:kD,texture:kE,textureSize:[e,kz]})})}else{T(null,{totalDashLen:kD,texture:kA.toDataURL(),textureSize:[e,kz]})}};ek._drawDashArrayTexture=function(kF,kz,kB,T){var kD=T.dashArray;if(!kD){kF.fillRect(0,0,kz,kB/2);return T.strokeWeight*4}else{var kE=0;if(kD.length%2!==0){kD=kD.concat(kD)}for(var kA=0;kA<kD.length;kA++){kE+=kD[kA]}var e=0;for(var kA=0;kA<kD.length;kA++){var kC=kD[kA]/kE*kB;if(kA%2===0){kF.fillRect(0,e,kz,kC)}e+=kC}return kE}};ek._drawDottedTexture=function(i,e,T,kz){i.beginPath();i.arc(e/2,e/2,e/2,0,2*Math.PI);i.fill();i.closePath();return kz*2};var X=function(e){var e=e||{};this.inputCRS=e.inputCRS||"EPSG3857";this.outCRS=e.outCRS||"EPSG3857";this.minZoom=e.minZoom||3;this.maxZoom=e.maxZoom||19;this.retry=e.retry||false;this.retryTime=e.retryTime||600;this.useThumbData=e.useThumbData||true;this.lastZoom=3;this.cacheSize=e.cacheSize||128;this.tileType=ik.getInstance("web");this._mapCenter={};this._featureMgr=[[],[],[]];this._gridRefs={row:{},col:{}};this.tileCache=new aC(this.cacheSize,{clearCallback:function(i){}})};X.inherits(dh,"BaiduLayer");e9.extend(X.prototype,{fetch:function(i,kz,kA){var kz=Math.ceil(kz)||3;var i=i||[];if(i.length!==4||kz>19){kA(null);return}var e=this.getZoomState(kz);var T=this.calCoord(i,kz,e);this.curViewTilesInfo=this.calTilesOrders(T.sw,T.ne,kz);this.clearData();this.clearRefs();this.loadLayerData(this.curViewTilesInfo,e,true,kA)},calCoord:function(T,kz,i){if(T.length!==4){return}var e=gcoord.transform([T[0],T[1]],gcoord[this.inputCRS],gcoord.BD09MC);var kA=gcoord.transform([T[2],T[3]],gcoord[this.inputCRS],gcoord.BD09MC);if(kA[1]>19505879.362428114||e[1]<-15949096.637571886){kA[1]=19505879.362428114;e[1]=-15949096.637571886}this._mapCenter[kz]=new cG((e[0]+kA[0])/2,(e[1]+kA[1])/2);return{sw:e,ne:kA}},calTilesOrders:function(kE,kK,kG){var kH=this.tileType.getMercatorSize(kG,kG);var kC=[Math.floor(kE[0]/kH),Math.floor(kE[1]/kH)];var i=[Math.floor(kK[0]/kH),Math.floor(kK[1]/kH)];var kD=kC[0]-1;var kB=i[0]+2;var kA=kC[1]-1;var kJ=i[1]+2;var kF=[];for(var kz=kD;kz<kB;kz++){for(var kI=kA;kI<kJ;kI++){var T={col:kz,row:kI,zoom:kG,useZoom:kG,tileTypeName:"web",loopOffsetX:0,tileSize:256,baseTileSize:256,mercatorSize:kH,combine:false,dataIndex:256};kF.push(T);var e="id_"+kz+"_"+kI+"_"+kG;kF[e]=true}}kF.sort((function(kL){return function(kM,kN){return((0.4*Math.abs(kM.col-kL[0])+0.6*Math.abs(kM.row-kL[1]))-(0.4*Math.abs(kN.col-kL[0])+0.6*Math.abs(kN.row-kL[1])))}})([(kD+kB)/2,(kA+kJ)/2]));kF.zoom=kG;kF.tileTypeName="web";return kF},getZoomState:function(i){var e=i-this.lastZoom;if(e>0){this.zoomState=1}else{if(e<0){this.zoomState=-1}}this.lastZoom=i;return this.zoomState||0},loadLayerData:function(kG,kz,kA,kF){this.thumbCache={};if(kA){for(var kD=0,kB=kG.length;kD<kB;kD++){var T=kG[kD];var kC=this.getTileKey(T);var e=this.tileCache.getData(kC);if(e&&e.status==="ready"){e.key=kC;this.setData(e,2)}else{if(this.useThumbData){kz===1&&this.setThumbData(T.col,T.row,T.zoom,T.useZoom,kz)}}}this.calOutData(kF)}for(var kD=0,kB=kG.length;kD<kB;kD++){var T=kG[kD];var kC=this.getTileKey(T);var e=this.tileCache.getData(kC);if(!e){this.tileCache.setData(kC,{});var kE=this;this.loadRasterTileData(T,function(i,kH){kE.rasterTileDataCbk(i,kH,kF)})}}},loadRasterTileData:function(i,e){var T=new Image();var kA=i.col;var kD=i.row;var kB=i.zoom;var kz=this.getTilesUrl(new fv(kA,kD),kB);if(!kz){return}var kC=this.getTileKey(i);T=this.loadTileImage(kz,i,kC,e);T.tileInfo=i},loadTileImage:function(kD,e,T,kB){var kz=new Image();kz.crossOrigin="anonymous";var kC=this;var kA;function kE(){if(kC.retry){kA&&clearInterval(kA);kA=null}}if(this.retry){var i=1;kA=setInterval(function(){if(i>3){kE();return}var kF=kC.getTilesUrl(new fv(e.col,e.row),e.zoom,i);kz.src=kF;i++},this.retryTime)}kz.onload=function(){kE();kB&&kB(this,T)};kz.onerror=function(){kE();kB&&kB(null,T)};kz.src=kD;return kz},rasterTileDataCbk:function(kA,kz,kD){if(!kA||typeof kA==="string"){this.tileCache.removeData(kz);return}var i=kA.tileInfo;var T=i.col;var kF=i.row;var kE=i.zoom;var e=this.tileCache.getData(kz);if(!e){return}e.textureSource=kA;e.dataType=gW;e.tileInfo=i;e.status="ready";this.tileCache.setData(kz,e);var kB="id_"+T+"_"+kF+"_"+kE;var kC=false;if(this.curViewTilesInfo[kB]){e.png8=this.png8||false;e.key=kz;this.setData(e,2);kC=true}if(kC){this.calOutData(kD,e)}},getTilesUrl:function(kA,kH,i){var kC=i||0;var T=kA.x;var kI=kA.y;var kE=ka("ditu","normal");var kD=kE.udt;var kG=ev.B_NORMAL_MAP.tileUrls;var kB=Math.abs(T+kI+kC)%kG.length;var kF=kG[kB];if(T<0){T="M"+(-T)}if(kI<0){kI="M"+(-kI)}var kz="x="+T+"&y="+kI+"&z="+Math.floor(kH);kz+="&styles=pl&scaler=2&udt="+kD+"&from=jsapi3_0";var e=kF+"?qt=vtile&"+kz;return e},calOutData:function(kF,T){if(!T){for(var kC=0;kC<this._featureMgr.length;kC++){var e=this._featureMgr[kC];for(var kA=0;kA<e.length;kA++){var kz=e[kA].tileInfo;if(kC===2){var kD=e[kA].extent;if(kD){this.addRefs(kD,kz.col,kz.row)}else{var kE=this.calBoxCoord(kz);if(!kE){continue}e[kA].extent=this.findRefs(kE,kz.col,kz.row)}}}}kF({size:this.curViewTilesInfo.length,zoom:this.lastZoom,data:this._featureMgr})}else{var kB=this.calBoxCoord(T.tileInfo);if(!kB){return}T.extent=this.findRefs(kB,T.tileInfo.col,T.tileInfo.row);kF({zoom:this.lastZoom,size:this.curViewTilesInfo.length,data:[[],[],[T]]})}},calOutData_back:function(kH,kz){if(!kz){var kB;var kI;var kF;for(var kD=0;kD<this._featureMgr.length;kD++){var T=this._featureMgr[kD];for(var kC=0;kC<T.length;kC++){var kA=T[kC].tileInfo;if(kD===2){if(kC===0){var kE=this.calBoxCoord(kA);T[0].extent=kE;kB=T[0];kI=kE[2]-kE[0];kF=kE[3]-kE[1]}else{if(kB&&kI&&kF){var e=(kA.row-kB.tileInfo.row)*kF;var kG=(kA.col-kB.tileInfo.col)*kI;var kE=kB.extent;T[kC].extent=[kE[0]+kG,kE[1]+e,kE[2]+kG,kE[3]+e]}}}else{var kE=this.calBoxCoord(kA);T[kC].extent=kE}}}kH({size:this.curViewTilesInfo.length,zoom:this.lastZoom,data:this._featureMgr})}else{if(this._featureMgr[2].length===1){var kE=this.calBoxCoord(kz.tileInfo);kz.extent=kE;this.featureCell=kz;this.cellW=kE[2]-kE[0];this.cellH=kE[3]-kE[1]}else{var e=(kz.tileInfo.row-this.featureCell.tileInfo.row)*this.cellH;var kG=(kz.tileInfo.col-this.featureCell.tileInfo.col)*this.cellW;var kE=this.featureCell.extent;kz.extent=[kE[0]+kG,kE[1]+e,kE[2]+kG,kE[3]+e]}kH({zoom:this.lastZoom,size:this.curViewTilesInfo.length,data:[[],[],[kz]]})}},calBoxCoord:function(e){var i=jv.prototype.tileToBound(e,this._mapCenter[e.zoom]).LL;var T=gcoord.transform([i.sw.lng,i.sw.lat],gcoord.BD09LL,gcoord[this.outCRS]);var kz=gcoord.transform([i.ne.lng,i.ne.lat],gcoord.BD09LL,gcoord[this.outCRS]);return[T[0],T[1],kz[0],kz[1]]},clearData:function(){this._featureMgr=[[],[],[]]},addRefs:function(i,e,T){this._gridRefs.row[T]=i[1];this._gridRefs.row[T+1]=i[3];this._gridRefs.col[e]=i[0];this._gridRefs.col[e+1]=i[2]},findRefs:function(i,e,kz){var T=[];this._gridRefs.row[kz]&&(T[1]=this._gridRefs.row[kz]);this._gridRefs.row[kz+1]&&(T[3]=this._gridRefs.row[kz+1]);this._gridRefs.col[e]&&(T[0]=this._gridRefs.col[e]);this._gridRefs.col[e+1]&&(T[2]=this._gridRefs.col[e+1]);!this._gridRefs.row[kz]&&(this._gridRefs.row[kz]=i[1])&&(T[1]=i[1]);!this._gridRefs.row[kz+1]&&(this._gridRefs.row[kz+1]=i[3])&&(T[3]=i[3]);!this._gridRefs.col[e]&&(this._gridRefs.col[e]=i[0])&&(T[0]=i[0]);!this._gridRefs.col[e+1]&&(this._gridRefs.col[e+1]=i[2])&&(T[2]=i[2]);return T},clearRefs:function(){this._gridRefs={row:{},col:{}}},destroy:function(){this.tileCache.clear();this.clearData();this.clearRefs();this._mapCenter={}},setData:function(kA,T){var e=this._featureMgr[T];for(var kz=0;kz<e.length;kz++){if(e[kz].key&&e[kz].key===kA.key){e[kz]=kA;return}}e.push(kA)},getTileKey:function(e,kz){kz=kz||{};var i=typeof kz.useZoom==="number"?kz.useZoom:e.useZoom;var T="default";return"web_"+T+"_"+e.col+"_"+e.row+"_"+e.zoom+"_"+i},setThumbData:function(i,kA,kz,e,T){if(T===1){if(this._findParentZoomTile(i,kA,kz,e,8)===false){this._findChildZoomTile(i,kA,kz,e,3)}}else{if(T===-1){if(this._findChildZoomTile(i,kA,kz,e,3)===false){this._findParentZoomTile(i,kA,kz,e,8)}}}this.sortThumbData()},_findParentZoomTile:function(kC,kL,kK,kA,kF){var kB="web";var T=3;var e=kC;var kI=kL;var kG=kK;var kH=kA;for(var kE=1;kE<=kF;kE++){var kz=this.tileType.getParentTile(e,kI,kG,kH,T);if(kz===null){continue}var kJ=this.getTileKey(kz);var kD=this.tileCache.getData(kJ);if(kD&&kD.status==="ready"){if(this.thumbCache[kJ]){continue}kD.key=kJ;this.setData(kD,0);this.thumbCache[kJ]=true;return true}e=kz.col;kI=kz.row;kG=kz.zoom;kH=kz.useZoom}return false},_findChildZoomTile:function(kD,kF,e,kA,kO){var kM="web";var kI=21;var kC=kD;var kE=kF;var kG=e;var kz=kA;var kB=true;for(var kL=1;kL<=kO;kL++){var kJ=false;var T=this.tileType.getChildTiles(kC,kE,kG,kz,kI,kL);if(!T){continue}for(var kK=0;kK<T.length;kK++){var kH=this.getTileKey(T[kK]);var kN=this.tileCache.getData(kH);if(kN&&kN.status==="ready"){if(!this.thumbCache[kH]){kN.key=kH;this.setData(kN,1);this.thumbCache[kH]=true}kJ=true}else{kB=false}}if(kJ){break}}return kB},sortThumbData:function(){var e=this._featureMgr;if(!e){return}if(e[0]&&e[0].length>0){e[0].sort(function(T,i){return T.tileInfo.useZoom-i.tileInfo.useZoom})}}});function dH(T,i){aU.call(this,i);if(!b0(T)){throw new Error("createDOM参数类型错误，请检查是否为Function")}var e=i||{};this.config={};this.config.enableMassClear=false;this.config.minZoom=e.minZoom||3;this.config.maxZoom=e.maxZoom||21;this.config.zIndex=e.zIndex||0;this.config.nextTick=e.nextTick||false;this.config.offsetX=e.offsetX||0;this.config.offsetY=e.offsetY||0;this.config.fixBottom=e.fixBottom||false;this.config.anchors=e.anchors||[0.5,1];this.config.coordinate=e.coordinate||"BD09";this.config.enableDraggingMap=e.enableDraggingMap||false;this.config.visible=e.visible===undefined?true:!!e.visible;this.sliceRepeat=e.sliceRepeat||false;this.createDOM=T;this.data=e.data||null;this.overlaysList=[];this.retainOverlays=[];this._eventList={};hP.sendMessage(a1(4,3,13),["layer","overlay"])}dH.inherits(dh,"CustomHtmlLayer");e9.extend(dH.prototype,{initialize:function(i){this.map=i;this.addToMap();this.initEvent(i);var e=this;this.map.on("destory",function(){e._distory()})},initEvent:function(){if(!this.overlaysList||!this.map){return}this._overlayEvent()},setStyleOptions:function(e){e=e||{};Object.assign(this.config,e);this.updateData(this.data)},addEventListener:function(e,i){if(!this._eventList[e]){this._eventList[e]=[i]}else{this._eventList[e].push(i)}this._overlayEvent()},_overlayEvent:function(){if(!this.overlaysList||!this.map){return}var kE=this.overlaysList;var e=this.overlaysList.length;var kD=Object.keys(this._eventList);for(var kC=0;kC<kD.length;kC++){var kz=kD[kC];var kB=this._eventList[kz];for(var kA=0;kA<kB.length;kA++){for(var T=0;T<e;T++){kE[T].addEventListener(kz,kB[kA])}}}if(this.sliceRepeat&&this.retainOverlays.length>0){this.overlaysList=this.overlaysList.concat(this.retainOverlays);this.retainOverlays=[]}},show:function(){this.config.visible=true;this.updateData(this.data)},hide:function(){this.config.visible=false;this.updateData(this.data)},addToMap:function(){if(!this.overlaysList||!this.map){return}var e=this.overlaysList.length;var kz=this.overlaysList;if(e>0){for(var T=0;T<e;T++){this.map.addOverlay(kz[T])}}},render:function(i){this.config.enableMassClear=false;this.config.point=i.points;this.config.properties=i.properties;var e=new bU(this.createDOM,this.config);return e},dataCompare:function(kC){var kF=kC.features;var e=this.data.features;var kD=[];var kE=[];var kH=[];this.retainOverlays=[];for(var kB=0;kB<kF.length;kB++){var kG=false;for(var kA=0;kA<e.length;kA++){if(kF[kB].id===e[kA].id){kH.push(e[kA].id);kG=true;break}}if(!kG){kF[kB].properties.__id=kF[kB].id;kE.push(kF[kB])}}for(var kB=0;kB<e.length;kB++){var kG=false;for(var kA=0;kA<kF.length;kA++){if(e[kB].id===kF[kA].id){kG=true;break}}if(!kG){kD.push(e[kB].id)}}for(var kB=0;kB<this.overlaysList.length;kB++){var kz=this.overlaysList[kB];var T=kz._id;if(kD.indexOf(T)>-1){this.map.removeOverlay(kz)}else{if(kH.indexOf(T)>-1){this.retainOverlays.push(kz)}}}if(kE.length>0){this.overlaysList=[];return{type:"FeatureCollection",features:kE}}else{if(this.retainOverlays.length>0){this.overlaysList=this.retainOverlays;this.retainOverlays=[]}return null}},setData:function(e){if(!e.features||e.features.length===0){this.removeAllOverlays();return}var kz=[];if(this.sliceRepeat&&this.data!==null){kz=this.dataCompare(e);this.data=e;if(!kz){return}}else{this.data=e;kz=e;this.removeAllOverlays()}var kA=this;if(!e){this.data=null;return}var T=gN.getType(kz);if(T.toLowerCase()==="point"){var i=new gN({reference:this.config.coordinate});i.readFeaturesFromObject(kz,{isPoints:true},function(kC){var kB=kA.render(kC);if(kA.sliceRepeat){kB._id=kC.properties.clusterId}kB.id="cus_"+parseInt(Math.random()*1000000,10);kA.overlaysList.push(kB)});i=null}this.addToMap();this.initEvent()},clearData:function(){this.removeAllOverlays();this.data=null},updateData:function(e){this.removeAllOverlays();this.data=null;this.setData(e)},removeLayer:function(T){if(!(T instanceof dH)||!this.map){return}var kz=T.overlaysList;for(var e=0;e<kz.length;e++){this.map.removeOverlay(kz[e])}this._distory(T)},removeAllOverlays:function(){if(!this.map||!this.overlaysList){return}var T=this.overlaysList;for(var e=0;e<T.length;e++){this.map.removeOverlay(T[e])}this.overlaysList=[]},removeOverlay:function(T){if(!this.map||!(this.overlaysList)||this.overlaysList.length<=0){return}var e=this.overlaysList.length;var kA=this.overlaysList;if(typeof T==="string"){for(var kz=0;kz<e;kz++){if(kA[kz].id===T){this.map.removeOverlay(kA[kz]);kA.splice(kz,1)}}}else{if(T instanceof aU){for(var kz=0;kz<e;kz++){if(T===kA[kz]){this.map.removeOverlay(T);this.overlaysList.splice(kz,1);return}}}}},_distory:function(){var T=this.overlaysList;for(var e=0;e<T.length;e++){T[e].div=null}this.overlaysList=[];this.createDOM=null;this.config=null;this.data=null},getCustomOverlays:function(){return this.overlaysList},toString:function(){return"CustomHtmlLayer"}});function iG(e){aU.call(this,e);var e=e||{};this.options={};this.options.callback=e.callback?e.callback:null;this._auth=false;this._remove=false;this.currentFloor=e.floor||1;this.currentFloorName="B1";this.currentFloorKV=[];this.currentFloorStr="";this.currentUid="";this.currentCityId=0;this.floorsCache=[];this.spotFillCache=[];this.spotFillLayer;this.spotFillData=[];this.spotOutFillLayer;this.spotOutFillData=[];this.cusInLabelUids=[];this.cusInBubbleUids=[];this.cusOutLabelUids=[];this.cusOutBubbleUids=[];this.labels=[];this.labelDatas=[];this.outLabels=[];this.outLabelDatas=[];this.bubbleDatas=[];this.jixieDatas=[];this.indoorUids;this.outdoorUids;this.indoorChange=true;this.cityChange=true;hP.sendMessage(a1(4,3,14),["layer","parking"])}iG.inherits(dh,"ParkingSpot");e9.extend(iG.prototype,{initialize:function(e){this.map=e;this.map.parking=this;this._verify()},_verify:function(){var e=this;if(window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]){var i={qt:d4}}else{var i={qt:d4,ak:eZ}}ki.request(function(kz){if(kz&&kz.result&&!kz.result["error"]&&kz.content&&!kz.content["errno"]){var kA=kz.content["data"];e._auth=true;e.indoorUids=kA.support_indoor;e.outdoorUids=kA.support_outdoor;e._bindCityChange();e._bindIndoorChange();setInterval(function(){e.getIndoorDataByUid(e.currentUid,e.currentFloorName)},60000);var T=new aK(e.map);if(T&&T._getIdByLoc){T._getIdByLoc(T._loc,function(kB){e.currentCityId=kB;e.getOutdoorDataByCityId(e.currentCityId);setInterval(function(){e.getOutdoorDataByCityId(e.currentCityId)},60000)})}}else{console.error("你未开通智能停车高级服务！")}},i)},_initGraph:function(e){if(e==="indoor"){this.spotFillLayer=new ed({crs:"BD09LL",enablePicked:true,autoSelect:true,zIndex:1,selectedColor:"#e5e7eb",pickWidth:2,pickHeight:2,style:{fillColor:["match",["get","state"],1,"#ffbfbb",2,"#ddf4d7","#e5e7eb"],fillOpacity:1,strokeWeight:1,strokeColor:"#fff"}})}else{this.spotOutFillLayer=new ed({crs:"BD09LL",enablePicked:true,autoSelect:true,zIndex:1,selectedColor:"#e5e7eb",pickWidth:2,pickHeight:2,style:{fillColor:["match",["get","state"],1,"#ffbfbb",2,"#ddf4d7","#e5e7eb"],fillOpacity:1,strokeWeight:1,strokeColor:"#fff"}})}},_bindCityChange:function(){var e=this;this.map.addEventListener("citychange",function(i){e.cityChange=true;if(e.currentCityId!==i.code){e.currentCityId=i.code;e.getOutdoorDataByCityId(i.code)}})},_bindIndoorChange:function(){var e=this;var i=function(kD){var kC=kD._indoorData[e.currentUid]?kD._indoorData[e.currentUid].floors:[];var kB=[];for(var kA=0;kA<kC.length;kA++){if(kC[kA].floorName.charAt(0)==="B"||kC[kA].floorName.charAt(0)==="M"){e.currentFloorKV[kC[kA].floorName]=kA;kB.push(kC[kA].floorName)}}e.currentFloorStr=kB.join(",");e.getDataBefore(e.currentUid,e.currentFloorStr)};if(e.currentUid||e.map._indoorMgr.currentUid){var kz=e.map._indoorMgr;e.currentUid=kz.currentUid;e.currentFloor=kz.currentFloor;i(kz);var T=kz.getIndoorData(e.currentUid);e.currentFloorName=T.floors[e.currentFloor]?T.floors[e.currentFloor].floorName:"";e.getIndoorDataByUid(e.currentUid,e.currentFloorName,true)}map.on("indoor_status_changed",function(kD){var kA=kD.uid;var kB=kD.floor;e.indoorChange=true;e.hideLayer("indoor");var kE=e.map._indoorMgr;if(e.currentUid||e.map._indoorMgr.currentUid){var kE=e.map._indoorMgr;e.currentUid=kE.currentUid;e.currentFloor=kE.currentFloor;i(kE)}if(!kA){e.hideLabel()}else{if(this._indoorMgr&&this._indoorMgr._indoorData[kA]){var kC=this._indoorMgr._indoorData[kA];e.currentUid=kA;e.currentFloor=kB;e.currentFloorName=kC.floors[kB].floorName;if(e.currentFloorName.charAt(0)==="F"){e.hideLabel()}e.getIndoorDataByUid(kA,e.currentFloorName,e.indoorChange)}}})},_unzip:function(kA){if(!kA||typeof kA!=="string"){return}var e=atob(kA);var kB=new Uint8Array(e.length);for(var kz=0;kz<e.length;kz++){kB[kz]=e.charCodeAt(kz)}var T=pako.inflate(kB,{to:"string"});return JSON.parse(T)},getDataBefore:function(T,kz){if(!T||!kz||this._remove){return}var e=this;var i=kz.split(",");if(window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]){var kA={qt:D,building_uid:T,floor:kz}}else{var kA={qt:D,ak:eZ,building_uid:T,floor:kz}}ki.request(function(kD){if(kD&&kD.result&&!kD.result["error"]&&kD.content){var kF=kD.content;if(!kF){return}for(var kC=0;kC<i.length;kC++){if(kF[i[kC]]){var kE=e._unzip(kF[i[kC]]);var kB=e.currentFloorKV[i[kC]];e.floorsCache[kB]=kE}}e.spotFillCache[T]=e.floorsCache}else{console.log("获取室内车位数据失败，请检查是否已开通智能停车服务！")}},kA)},getOutdoorDataByCityId:function(T){if(T&&typeof T==="number"){T=T.toString()||"131"}if(!this.outdoorUids[T]||this._remove){return}var e=this;if(window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]){var i={qt:D,city_id:T}}else{var i={qt:D,ak:eZ,city_id:T}}ki.request(function(kz){if(kz&&kz.result&&!kz.result["error"]&&kz.content){var kA=e._unzip(kz.content);if(!kA||!kA.carport_data){return}e.spotOutFillData=e._parseParkingData(kA);if(e.cityChange){if(e.cusOutLabelUids){e.map.removeLabelsFromMapTile(e.cusOutLabelUids)}e._addLabels(kA.carport_data,"outdoor");e.cityChange=false}if(e.cusOutBubbleUids){e.map.removeLabelsFromMapTile(e.cusOutBubbleUids)}e._addJixieLabels(kA.bubble_data);if(!e.spotOutFillLayer){e._addLabels(kA.carport_data,"outdoor");e._initGraph("outdoor");e._initEvent("outdoor",e.options.callback);e.addToMap("outdoor")}else{e.spotOutFillLayer.setData(e.spotOutFillData)}}else{console.log("获取室外车位数据失败，请检查是否已开通智能停车服务！")}},i)},getIndoorDataByUid:function(kz,kB,i){if(!kz||!kB||this._remove||!this.indoorUids[this.currentCityId]||(this.indoorUids[this.currentCityId]&&!this.indoorUids[this.currentCityId].includes(kz))){return}var T=this;var kC=function(kE){if(T.cusInBubbleUids){T.map.removeLabelsFromMapTile(T.cusInBubbleUids)}if(kE.bubble_data&&kE.bubble_data.length>0){T._addBubbles(kE.bubble_data)}if(T.cusInLabelUids){T.map.removeLabelsFromMapTile(T.cusInLabelUids)}T._addLabels(kE.carport_data,"indoor")};if(this.spotFillCache[kz]&&this.spotFillCache[kz][this.currentFloor]&&i){var kA=this.spotFillCache[kz][this.currentFloor];var e=T._parseParkingData(kA);T.spotFillLayer.setData(e);kC(kA)}if(window._BMapSecurityConfig&&window._BMapSecurityConfig["serviceHost"]){var kD={qt:D,building_uid:kz,floor:kB}}else{var kD={qt:D,ak:eZ,building_uid:kz,floor:kB}}ki.request(function(kE){if(kE&&kE.result&&!kE.result["error"]&&kE.content){var kF=T._unzip(kE.content[kB]);if(!kF||!kF.carport_data){return}T.spotFillData=T._parseParkingData(kF);if(kF&&kF.carport_data.length>0){T.floorsCache[T.currentFloor]=kF;T.spotFillCache[kz]=T.floorsCache}if(!T.spotFillLayer){T._addLabels(kF.carport_data,"indoor");T._addBubbles(kF.bubble_data);T._initGraph("indoor");T._initEvent("indoor",T.options.callback);T.addToMap("indoor")}else{if(kF&&kF.carport_data.length>0){T.spotFillLayer.setData(T.spotFillData)}}kC(kF)}else{console.log("获取室内车位数据失败，请检查是否已开通智能停车服务！")}},kD)},addToMap:function(e){if(!this.map){return}if(e==="indoor"&&this.spotFillLayer){this.map.addNormalLayer(this.spotFillLayer);this.spotFillLayer.setData(this.spotFillData)}else{if(this.spotOutFillLayer){this.map.addNormalLayer(this.spotOutFillLayer);this.spotOutFillLayer.setData(this.spotOutFillData)}}},_parseParkingData:function(kz){if(!kz){return}var T=kz.carport_data;var e={type:"FeatureCollection",features:[]};if(!T){var i={type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[]}};e.features.push(i);return e}T.forEach(function(kA){if(kA.geo&&typeof kA.geo==="string"){kA.geo=JSON.parse(kA.geo)}var kB={type:"Feature",properties:{center:[kA.x,kA.y],state:kA.carport_state,type:kA.carport_type,name:kA.carport_name,uid:kA.carport_uid,floor:kA.floor,angle:kA.angle,label:kA.label},geometry:{type:"Polygon",coordinates:[kA.geo]}};e.features.push(kB)});return e},_initEvent:function(i,T){if(!this.map){return}var e=this;if(i==="indoor"){this.spotFillLayer.addEventListener("click",function(kE){if(kE.value.dataIndex!==-1&&kE.value.dataItem){var kC=kE.value.dataItem;var kz=kC.properties.center;var kA=kC.properties.bubble_data;var kD="";switch(kC.properties.state){case 1:kD="占用";break;case 2:kD="空闲";break;case 0:kD="未知";break;default:kD="未知";break}var kB={center:kz,state:kD,properties:kC.properties};T&&T(kB)}})}else{this.spotOutFillLayer.addEventListener("click",function(kE){if(kE.value.dataIndex!==-1&&kE.value.dataItem){var kC=kE.value.dataItem;var kz=kC.properties.center;var kA=kC.properties.bubble_data;var kD="";switch(kC.properties.state){case 1:kD="占用";break;case 2:kD="空闲";break;case 0:kD="未知";break;default:kD="未知";break}var kB={center:kz,state:kD,properties:kC.properties};T&&T(kB)}})}this.map.on("destory",function(){e._distory()})},_addBubbles:function(kC){if(!kC){return}this.bubbleDatas=[];this.cusInBubbleUids=[];for(var kB=0;kB<kC.length;kB++){var e=kC[kB].bubble.name+"："+kC[kB].bubble.label;var kD=kC[kB].bubble.rank.split("-");var kz=kC[kB].bubble.color;var kE=jv.convertLL2MC(new cG(kC[kB].x,kC[kB].y));var kA="bubble_"+kC[kB].poi_uid+Math.floor(Math.random()*Math.pow(10,6));var T={position:kE,uid:kA,name:e,displayRange:kD,textMargin:8,direction:0,rank:60000,textOnIcon:true,iconSize:[100,24],noStretch:true,icon:"//bj.bcebos.com/v1/mapopen-pub-jsapigl/assets/images/spot/jixie_bk.png",style:{haloSize:0,fontSize:28,color:"#fff",strokeColor:"#fff",padding:[10,0],}};this.bubbleDatas.push(T);this.cusInBubbleUids.push(kA)}this.map.addLabelsToMapTile(this.bubbleDatas)},_addJixieLabels:function(kA){if(!kA){return}this.jixieDatas=[];this.cusOutBubbleUids=[];for(var kz=0;kz<kA.length;kz++){var kB=jv.convertLL2MC(new cG(kA[kz].x,kA[kz].y));var T="out_bubble_"+kA[kz].poi_uid;var e={position:kB,uid:T,name:kA[kz].poi_name,displayRange:[15,22],textMargin:0,direction:0,rank:60000,textOnIcon:true,iconSize:[20,30],icon:"//bj.bcebos.com/v1/mapopen-pub-jsapigl/assets/images/spot/bubble.png",style:{haloSize:0,fontSize:22,color:"#fff",strokeColor:"#fff"}};this.jixieDatas.push(e);this.cusOutBubbleUids.push(T)}this.map.addLabelsToMapTile(this.jixieDatas)},_addLabels:function(kB,kz){if(kz==="indoor"){this.labelDatas=[];this.inLabelUids=[]}else{if(kz==="outdoor"){this.outLabelDatas=[];this.outLabelUids=[]}}for(var T=0;T<kB.length;T++){var kC=jv.convertLL2MC(new cG(kB[T].x,kB[T].y));var e="carspot_lb_"+kz+"_"+kB[T].carport_name;if(kB[T].label){var kA={position:kC,uid:e,name:kB[T].carport_name+"\\["+kB[T].label+"]",displayRange:[3,22],textMargin:0,direction:0,rank:50000,style:{haloSize:2,fontSize:24,color:"#008857",strokeColor:"#fff"}}}else{var kA={position:kC,uid:e,name:kB[T].carport_name,displayRange:[3,22],textMargin:0,direction:0,rank:50000,style:{haloSize:2,fontSize:22,color:"#657d95",strokeColor:"#fff"}}}if(kz==="indoor"){this.cusInLabelUids.push(e);this.labelDatas.push(kA)}else{if(kz==="outdoor"){this.cusOutLabelUids.push(e);this.outLabelDatas.push(kA)}}}if(kz==="indoor"){this.map.addLabelsToMapTile(this.labelDatas)}else{if(kz==="outdoor"){this.map.addLabelsToMapTile(this.outLabelDatas)}}},removeParkingSpot:function(){if(this.spotFillLayer){this.map.removeNormalLayer(this.spotFillLayer);this.spotFillLayer=null;this.spotFillData=[]}if(this.spotOutFillLayer){this.map.removeNormalLayer(this.spotOutFillLayer);this.spotOutFillLayer=null;this.spotOutFillData=[]}if(this.cusOutLabelUids){this.map.removeLabelsFromMapTile(this.cusOutLabelUids);this.cusOutLabelUids=[]}if(this.cusOutBubbleUids){this.map.removeLabelsFromMapTile(this.cusOutBubbleUids);this.cusOutBubbleUids=[]}if(this.cusInLabelUids){this.map.removeLabelsFromMapTile(this.cusInLabelUids);this.cusInLabelUids=[]}if(this.cusInBubbleUids){this.map.removeLabelsFromMapTile(this.cusInBubbleUids);this.cusInBubbleUids=[]}this.spotFillCache=[];this.floorsCache=[];this._remove=true},hideLayer:function(e){if(e==="indoor"&&this.spotFillLayer){var i=this._parseParkingData([]);this.spotFillLayer.setData(i)}else{if(e==="outdoor"&&this.spotOutFillLayer){var i=this._parseParkingData([]);this.spotOutFillLayer.setData(i)}}},hideLabel:function(){if(this.cusInLabelUids){this.map.removeLabelsFromMapTile(this.cusInLabelUids)}if(this.cusInBubbleUids){this.map.removeLabelsFromMapTile(this.cusInBubbleUids)}},showLayer:function(e){if(e==="indoor"&&this.spotFillLayer){var i=this._parseParkingData([]);this.spotFillLayer.setData(i)}else{if(e==="outdoor"&&this.spotOutFillLayer){}}},searchParkingRoute:function(T,e,i){if(!this.auth){return}},toString:function(){return"ParkingSpot"}});function cv(e){e=e||{};this.visible=(e.visible===undefined?true:!!e.visible);this.minZoom=e.minZoom||3;this.maxZoom=e.maxZoom||21;this.opacity=isNaN(Number(e.opacity))?1:Math.max(0,Math.min(1,Number(e.opacity)));this.zIndex=e.zIndex||1;this.enablePicked=e.enablePicked||false;this.autoSelect=e.autoSelect||false;this.popEvent=e.popEvent||true;this.autoUpdate=false;this.pickWidth=e.pickWidth||30;this.pickHeight=e.pickHeight||30;this.center=e.referCenter||null;this.isTop=e.isTop||false;this.isLowText=e.isLowText||false;this.guid=bG.getGUID("normal_layer_")}cv.inherits(dh,"NormalLayer");e9.extend(cv.prototype,{onInit:function(kz,kA){if(this.zIndex>0){this.adjustZIndex(kz);kz._normalLayerMgr.sortLayer()}else{var e=kz._featureMgr.result.bkData;this.zIndex=e.length||1}var T={tileTypeName:this.getType?this.getType():"custom",dataType:this.toString(),ontology:this};kz._featureMgr.createLayer(this.zIndex,T);this.map=kz;this.gl=kA;this.onAdd(kz,kA);var i=this;kz.on("destroy",function(){i.onDestroy()})},adjustZIndex:function(i){if(i&&i._featureMgr){var e=i._featureMgr.result.bkData;while(e[this.zIndex]){this.zIndex+=1}}},_getAdjoinZIndex:function(kA){var T=this.zIndex;if(this.map&&this.map._featureMgr){var e=this.map._featureMgr.result.bkData;if(kA==="up"){for(var kz=this.zIndex+1;kz<e.length;kz++){if(e[kz]){T=kz+1;break}}}else{for(var kz=this.zIndex-1;kz>0;kz--){if(e[kz]){T=kz;break}}}}return T},setTargetZIndex:function(e){this.zIndex=e;if(this.map){this.map._normalLayerMgr.sortLayer()}},setZIndex:function(kD){kD=Math.abs(Math.floor(kD))||1;if(!kD||kD===this.zIndex){return}var kA=this.map._featureMgr.result.bkData;var kz=this.map.tileMgr.tileLayers;var kF=this.map._normalLayerMgr.layers;function kG(kL){var kJ=null;var kK=[kz,kF];for(var kH=0;kH<kK.length;kH++){for(var kI=0;kI<kK[kH].length;kI++){if(kK[kH][kI].zIndex===kL){kJ=kK[kH][kI];break}}if(kJ){break}}return kJ}var T=[];var kC=[];var kE=this.zIndex;var i=kG(kD);if(kA[kD]&&i){T.push(i);kC.push(kA[kD]);this.setTargetZIndex(kD);kA[kD]=kA[kE];kA[kE]=null}else{this.setTargetZIndex(kD);kA[kD]=kA[kE];kA[kE]=null;this.doOnceDraw();return}var kB=kD+1;while(kB){var e=kG(kB);if(kA[kB]&&e){T.push(e);kC.push(kA[kB]);T.shift().setTargetZIndex(kB);kA[kB]=kC.shift();kB+=1}else{T.shift().setTargetZIndex(kB);kA[kB]=kC.shift();kB=0}}this.doOnceDraw()},setRefCenter:function(e){if(e instanceof cG){this.center=e;this.parseData&&this.parseData(e)}},getRefCenter:function(){return this.center},setTop:function(e){this.isTop=!!e;this.doOnceDraw()},setLowText:function(e){this.isLowText=!!e;this.doOnceDraw()},setOpacity:function(e){if(isNaN(Number(e))){return}this.opacity=Math.max(0,Math.min(1,Number(e)));this.doOnceDraw()},getOpacity:function(){return this.opacity},setZIndexTop:function(){var e=this.map._featureMgr.result.bkData;e[e.length]=e[this.zIndex];e[this.zIndex]=null;this.setTargetZIndex(e.length-1);this.doOnceDraw()},setUpLevel:function(){var e=this._getAdjoinZIndex("up");if(this.zIndex!==e){this.setZIndex(e)}},setDownLevel:function(){var e=this._getAdjoinZIndex("down");if(this.zIndex!==e){this.setZIndex(e)}},onAdd:function(e,i){throw new Error("用户未实现onAdd方法")},preRender:function(i,e){},rgbToIndex:function(kA){var kD=kA.length/4;var kz=Math.floor(kD/2);const T=function(kF){return kA[kF]+kA[kF+1]*256+kA[kF+2]*65536-1};for(var kC=0;;kC++){var kB=kz+kC;var kE=kz-kC;if(kB===kE){var e=T(kB*4);if(e>-1){return e}continue}if(kB<kD){var e=T(kB*4);if(e>-1){return e}}if(kE>=0){var e=T(kE*4);if(e>-1){return e}}if(kB>=kD&&kE<0){break}}return -1},testEvent:function(){if(this.enablePicked||this.autoSelect){return true}return false},pick:function(kD,kC,kz){var T=this.gl;var kE=this.map.config.ratio;this.map._normalLayerMgr.saveFramebuffer();this.map._normalLayerMgr.bindFramebuffer(this.map._normalLayerMgr.pickFBO);this.map._normalLayerMgr.clear();this.map._webglPainter._camera._updatePolyLayerMatrix(this.center);var i=this.map._webglPainter._camera._modelViewMatrixLayer;var kB=mat4.create(Float64Array);mat4.multiply(kB,this.map._webglPainter.projMatrix,i);this.render(T,kB,{isPickRender:true});var e=new Uint8Array(4*this.pickWidth*this.pickHeight);T.readPixels(kD*kE-Math.floor(this.pickWidth/2),T.canvas.height-kC*kE-Math.floor(this.pickHeight/2),this.pickWidth,this.pickHeight,T.RGBA,T.UNSIGNED_BYTE,e);var kA=this.rgbToIndex(e);if(this.getPickedItem){var kF=this.getPickedItem(kA,kz)}this.map._normalLayerMgr.restoreFramebuffer();return kF},render:function(T,e,i){throw new Error("用户未实现render方法")},afterRender:function(i,e){},onDestroy:function(e,i){},onHide:function(e,i){},onShow:function(e,i){},doOnceDraw:function(){if(this.map){var e=new fW("onupdate");this.map.dispatchEvent(e)}},doRender:function(){if(!this.map){return false}var e=this.map.getZoom();if(this.visible){if(e>=this.minZoom&&e<=this.maxZoom){if(!this._status){this.onShow(this.map,this.gl);this._status=1}return true}}if(this._status){this.onHide(this.map,this.gl);this._status=0}return false},getZIndex:function(){if(this.zIndex===undefined){throw new Error("图层未添加到地图")}return this.zIndex},getVisible:function(){return this.visible},setVisible:function(e){this.visible=e;this.doOnceDraw()},getMinZoom:function(){return this.minZoom},setMinZoom:function(e){if(e<=this.maxZoom){this.minZoom=e}},getMaxZoom:function(){return this.maxZoom},setMaxZoom:function(e){if(e>=this.minZoom){this.maxZoom=e}},dispatcher:function(kA,kz,T){var i=new fW(T);i.pixel=kA.pixel;i.latLng=kA.latlng;i.value=kz;this.dispatchEvent(i)},hasEvent:function(e){if(this.enablePicked){if(e.substr(0,2)!=="on"){e+="on"}if(this._listeners&&this._listeners[e]&&Object.keys(this._listeners[e]).length>0){return true}return false}return false},toString:function(){return"normal"}});function g6(i){i=i||{};const e={alpha:false,antialias:false};this.options=Object.assign({},e,i);if(!window.THREE){throw new Error("ThreeLayer requires THREE")}cv.call(this,this.options);hP.sendMessage(a1(4,3,18),["layer","threejs"])}g6.inherits(cv,"ThreeLayer");e9.extend(g6.prototype,{onAdd:function(kA,kz){if(!this.options){throw new Error("ThreeLayer requires reCreate")}const e=this.map=kA;this._state=d5.WebGLState.get(kz,e._webGLStateId);this.customCoords=e.toFormatCoords;const i=e.getContainer();const T=i.offsetWidth;const kF=i.offsetHeight;const kD=new THREE.PerspectiveCamera(35,T/kF,10,4000);kD.matrixAutoUpdate=false;const kE=new THREE.WebGLRenderer({context:kz,alpha:this.options.alpha,antialias:this.options.antialias});kE.setSize(T,kF);kE.autoClear=false;const kC=new THREE.Scene();this.scene=kC;this.camera=kD;this.renderer=kE;const kB=new THREE.AmbientLight(16777215,1);kC.add(kB);if(this.options.onInit){this.options.onInit.bind(this)(kE,kC,kD)}this.animate()},preRender:function(i,e){if(!this.options){throw new Error("ThreeLayer requires reCreate")}if(this.options.preRender){this.options.preRender.bind(this)(this.renderer,this.scene,this.camera)}},afterRender:function(i,e){if(!this.options){throw new Error("ThreeLayer requires reCreate")}if(this.options.afterRender){this.options.afterRender.bind(this)(this.renderer,this.scene,this.camera)}},render:function(kA,i,T){if(!this.options){throw new Error("ThreeLayer requires reCreate")}this.statesForange=this._state.getRealState();this.renderer.resetState();var e=this.map._webglMapCamera._updatePolyLayerMatrix();var kz=new THREE.Matrix4().fromArray(e);this.camera.matrixWorld=kz.invert();if(this.options.onRender){this.options.onRender.bind(this)(this.renderer,this.scene,this.camera)}else{this.renderer.render(this.scene,this.camera)}this.renderer.resetState();this._state.setState(this.statesForange)},triggerRepaint:function(){this.needsUpdate=true;this.animate()},triggerStop:function(){this.needsUpdate=false},animate:function(){if(this.needsUpdate){this.doOnceDraw()}else{return}var e=this;this.frameTimer=requestAnimationFrame(function(){e.animate()})},refreshMap:function(){if(this.map){this.doOnceDraw()}},convertLngLat:function(e){this.customCoords.setCenter(this.center);const i=this.customCoords.lngLatsToCoords([e]);return i[0]},add:function(e){this.scene.add(e);this.refreshMap()},remove:function(e){this.scene.remove(e);this.refreshMap()},getScene:function(){return this.scene},getCamera:function(){return this.camera},getRender:function(){return this.renderer},onDestroy:function(){if(this.options.onDestroy){this.options.onDestroy.bind(this)(this.renderer,this.scene,this.camera)}cancelAnimationFrame(this.frameTimer);this.customCoords=null;this._clearScene(this.scene);this.scene=undefined;this.camera=undefined;this.renderer.dispose();this.renderer=undefined;this.map=null;THREE.Cache.clear();this.options=null},onHide:function(){if(this.options.onHide){this.options.onHide.bind(this)(this.renderer,this.scene,this.camera)}},onShow:function(){if(this.options.onShow){this.options.onShow.bind(this)(this.renderer,this.scene,this.camera)}},getMap:function(){if(this.map){return this.map}return null},_clearScene:function(i){var e=this;i.traverse(function(T){e._clearGroup(T)})},_clearGroup:function(T){const e=function(kz){if(kz.geometry){kz.geometry.dispose()}if(kz.material&&kz.material.dispose){kz.material.dispose()}if(kz.material.texture&&kz.material.texture.dispose){kz.material.texture.dispose()}};const i=function(kz){var kA=kz.children.filter(function(kB){return kB});kA.forEach(function(kB){if(kB.children.length){i(kB)}else{if(kB.isMesh){e(kB)}}});kA=null};i(T)}});function ee(e){e=e||{};cv.call(this,e);this.base_opt={idKey:"id",crs:"BD09LL",isFlat:true,drawPart:1,selectedIndex:-1,selectedColor:"rgba(20, 20, 200, 1.0)"};this.setBaseOptions(e);this.loadModule=false;this._stateCube={};this.def=[];this.DEL_COUNT=20;this.delIndexs=[];var i=this;hl.load("mvtParse",function(){i._async()},true);this.select_color=this.getColorStyleForGL(this.base_opt.selectedColor);var T=new Int8Array(4);this.int32View=new Int32Array(T.buffer,0,1);this.float32View=new Float32Array(T.buffer,0,1)}ee.inherits(cv,"FeatureLayer");e9.extend(ee.prototype,{_async:function(){this.loadModule=true;this.resolveStyle();this.parseData()},compileExpress:function(i,e){var i=ek.ExpressParse.normalizePropertyExpression(i,e);return i},resolveStyle:function(){var e=this.style_opt||{};var kz=c8[this.type];if(this._appendStyle){kz=JSON.parse(JSON.stringify(kz));Object.assign(kz,this._appendStyle)}if(e&&this.type&&kz){var T={};for(var i in e){var kB=kz[i];if(e.hasOwnProperty(i)&&kB!==undefined){var kA=this.compileExpress(e[i],kB);T[i]=kA}}this.styleExpress=T}},evaluateContext:function(e,T){var i=T.id||e;var kz=this._stateCube[i];return{properties:function(){return T&&T.properties},featureState:kz||{}}},evaluates:function(i,kz){if(!this.styleExpress){return null}var kB=this.styleExpress;var e={};for(var T in kB){if(kB.hasOwnProperty(T)){var kA=kB[T].evaluate(this.evaluateContext(i,kz));e[T]=kA}}return e},_updateState:function(T,i,e){if(e){this._set(i,this._stateCube,T)}else{this._stateCube[T]=i}},_set:function(i,kA,T){var kz=kA[T]||(kA[T]={});for(var e in i){kz[e]=i[e]}},updateState:function(kA,kB,e){var T=JSON.stringify(this._stateCube);if(!(kB&&typeof kB==="object"&&Object.keys(kB).length>0)){return}if(!e){this._stateCube={}}if(kA instanceof Array){for(var kz=0;kz<kA.length;kz++){this._updateState(kA[kz],kB,e)}}else{this._updateState(kA,kB,e)}var kC=JSON.stringify(this._stateCube);if(T!==kC){this.parseData()}if(this.attach){this.attach.updateState(kA,kB,e)}},replaceAllState:function(e){var i=JSON.stringify(this._stateCube);this._stateCube=e;var T=JSON.stringify(this._stateCube);if(i!==T){this.parseData()}},getAllState:function(){return this._stateCube},removeState:function(kz){var e=JSON.stringify(this._stateCube);if(kz instanceof Array){for(var T=0;T<kz.length;T++){delete this._stateCube[kz[T]]}}else{delete this._stateCube[kz]}var kA=JSON.stringify(this._stateCube);if(e!==kA){this.parseData()}},clearState:function(){var e=JSON.stringify(this._stateCube);if(e!=="{}"){this._stateCube={};this.parseData()}},getType:function(){return"feature"},setData:function(T,kz){if(T.length<=0){return}this.params=kz=kz||{};this.data=T;this.delIndexs=[];this._stateCube={};if(kz.changeCenter&&T&&T.features&&T.features[0]){var e=T.features[0];var kA=null;if(e.geometry&&e.geometry.type==="Point"){kA=e.geometry.coordinates}if(e.geometry&&(e.geometry.type==="LineString"||e.geometry.type==="MultiLineString"||e.geometry.type==="Polygon")){var i=e.geometry.coordinates[0];if(i&&i[0]){kA=i[0]}}if(kA){if(this.base_opt.crs==="BD09LL"){this.center=new cG(kA[0],kA[1])}else{kA=gcoord.transform(kA,this.base_opt.crs,gcoord.BD09LL);this.center=new cG(kA[0],kA[1])}}}this.parseData&&this.parseData(this.center)},getData:function(){return this.data},clearData:function(){this.data=null;this.buffer=null;if(this.attach){this.attach.clearData()}this.doOnceDraw()},addDelIndex:function(T){if(this.delIndexs.length>=this.DEL_COUNT){new Error("超出"+this.DEL_COUNT+"个限制")}var e=false;for(var kz=0;kz<this.delIndexs.length;kz++){if(this.delIndexs[kz]===T){e=true;break}}if(!e){this.delIndexs.push(T);this.doOnceDraw()}if(this.attach){this.attach.addDelIndex(T)}},removeDelIndex:function(e){for(var T=0;T<this.delIndexs.length;T++){if(this.delIndexs[T]===e){this.delIndexs.splice(T,1);this.doOnceDraw();return}}if(this.attach){this.attach.removeDelIndex(e)}},clearDelIndex:function(){this.delIndexs=[];this.doOnceDraw();if(this.attach){this.attach.clearDelIndex()}},setBaseOptions:function(i){i=i||{};var e=Object.assign({},this.getBaseOptions());Object.assign(this.base_opt,i);this.onOptionsChanged&&this.onOptionsChanged(this.getBaseOptions(),e);if(i.data){this.setData(i.data);delete i.data}},setStyleOptions:function(i){i=i||{};var e=Object.assign({},this.getStyleOptions());Object.assign(this.style_opt,i);this.onOptionsChanged&&this.onOptionsChanged(this.getStyleOptions(),e);if(i.data){this.setData(i.data);delete i.data}else{if(i.autoRender!==false){}}},getBaseOptions:function(){return this.base_opt||{}},getStyleOptions:function(){return this.style_opt||{}},getProperty:function(e,kz,T){if(Object.prototype.toString.call(kz)==="[object Function]"){return kz(T)}else{var i=T[e]||kz;if("properties" in T&&e in T.properties){i=T.properties[e]}return i}},getPickedItem:function(i,e){if(this.autoSelect){if(e==="onmousemove"){this.selectedIndex=i}else{this.selectedIndex=-1}}if(e==="onclick"&&this.enablePicked){this.selectedIndex=i}var T=this.dataset?this.dataset.normal:[];return{dataIndex:i,dataItem:T[i]}},formatData:function(T){var i=new gN({reference:this.base_opt.crs});var kA=i.readFeaturesFromObject(T,{isPoints:true});var e=null;var kz=this;if(this.base_opt.nodeStrict){e=JSON.parse(JSON.stringify(T));gN.coordEachReplace(e,function(kB){return[kB[0].toFixed(kz.base_opt.nodeJoin),kB[1].toFixed(kz.base_opt.nodeJoin)]})}return{normal:T.features,inner:kA,join:e?e.features:null}},_pointGeoFilter:function(kM){var k2=[];for(var k3=0;k3<kM.features.length;k3++){var kH=kM.features[k3];if(kH.geometry.type!=="LineString"){continue}var kB=kH.geometry.coordinates;var kK=kH.properties||{};if(kB.length<2){continue}var kE=k2.length;if(this.base_opt.nodeBreakpoint||this.base_opt.nodeMiddleShow){var kN;var kR=0;for(var k0=0;k0<kB.length;k0++){var kS=jv.convertLL2MC(new cG(kB[k0][0],kB[k0][1]));if(kN&&kN.similar(kS)){continue}if(k0>0){var kU=k2[k2.length-1];var kF=kU.geometry.coordinates;var kW=bj(kS.lat-kF[1],kS.lng-kF[0]);k2[k2.length-1].properties.endPoint=kS.lng+","+kS.lat;k2[k2.length-1].properties.rotation=kW;if(k0>1){var kO=k2[k2.length-2];var kP=kO.geometry.coordinates;kW=g4(kP,kF,[kS.lng,kS.lat]);k2[k2.length-1].properties.rotationPlus=Math.abs(kW)}}var kT=JSON.parse(JSON.stringify(kK));kT.index=k3;kT.line_node_type=k0===0?1:3;kT.startPoint=k0===0?"":kN.lng+","+kN.lat;kT.endPoint="";kT.rotationPlus=0;k2.push({type:"Feature",properties:kT,geometry:{coordinates:[kS.lng,kS.lat],type:"Point"}});kN=kS;kR++}if(kR===1){k2.splice(k2.length-1,1)}if(kR>=2&&k2[k2.length-1].properties.endPoint===""){var kD=k2[k2.length-2];var T=kD.geometry.coordinates;var kC=k2[k2.length-1];var e=kC.geometry.coordinates;var kW=bj(e[1]-T[1],e[0]-T[0]);kT.rotation=kW;kT.line_node_type=2}}else{var kD=kB[0];var k1=jv.convertLL2MC(new cG(kD[0],kD[1]));var kJ=kB[1];var kZ=jv.convertLL2MC(new cG(kJ[0],kJ[1]));var kC=kB[kB.length-1];var k5=jv.convertLL2MC(new cG(kC[0],kC[1]));var kQ=kB[kB.length-2];var kG=jv.convertLL2MC(new cG(kQ[0],kQ[1]));var kV=[[kZ,k1],[k5,kG]];for(var k0=0;k0<2;k0++){var k4=[kV[k0][0].lng,kV[k0][0].lat];var kL=[kV[k0][1].lng,kV[k0][1].lat];var kT=JSON.parse(JSON.stringify(kK));kT.index=k3;var kW=bj(k4[1]-kL[1],k4[0]-kL[0]);kT.rotation=kW;kT.line_node_type=k0===0?1:2;kT.startPoint=k0===0?"":k4.join(",");kT.endPoint=k0===0?kL.join(","):"";kT.rotationPlus=0;k2.push({type:"Feature",properties:kT,geometry:{coordinates:k0===0?kL:k4,type:"Point"}})}}if(this.base_opt.nodeMiddleShow&&kE+1<=k2.length){var kA=k2.length;for(var kY=kE+1;kY<kA;kY++){var kI=JSON.parse(JSON.stringify(k2[kY]));var kz=k2[kY].geometry.coordinates;kI.properties.line_node_type=4;kI.properties.startPoint="";kI.properties.endPoint="";kI.properties.rotationPlus=0;kI.properties.rotation=k2[kY-1].properties.rotation;var kX=k2[kY-1].geometry.coordinates;kI.geometry.coordinates=[(kz[0]+kX[0])/2,(kz[1]+kX[1])/2];k2.push(kI)}}}return{type:"FeatureCollection",features:k2}},_toFormatPointGeometry:function(e,i){if(!i){var kz=jv.convertLL2MC(e)}else{var kz=e}var kA=this.map._normalLayerMgr.base;var T=[kz.lng-kA.lng,kz.lat-kA.lat];return T},getColorStyleForGL:function(kz,e,T){var i=hV.formatColorCssToRgbaArray(kz,e,T);return i},rgb2value:function(e){e[0]=e[0]===255?e[0]-1:e[0];e[1]=e[1]===255?e[1]-1:e[1];e[2]=e[2]===255?e[2]-1:e[2];return e[0]+e[1]*256+e[2]*65536-1+256*0.00001},int8ArrayToFloat:function(e){var i=(e[3]<<24|e[2]<<16|e[1]<<8|e[0]);this.int32View[0]=i&4294967295;return this.float32View[0]},_toFormatPolGeometry:function(kA,e){var kz=[];if(!e){kz[0]=this._toFormatCoords(kA)}else{for(var T=0;T<kA.length;T++){kz.push(this._toFormatCoords(kA[T]))}}return kz},_toFormatCoords:function(kF){var kE=[];var kB=[];kE.pointsArray=kB;var kG=jv.convertLL2MC(kF[0]);if(this.center){var e=jv.convertLL2MC(this.center)}else{var e=this.map._normalLayerMgr.base}var kD=[kG.lng-e.lng,kG.lat-e.lat];kE.push(kD);kB.push(kD[0],kD[1]);for(var kA=1,kz=1,T=kF.length;kA<T;kA++){kG=jv.convertLL2MC(kF[kA]);var kC=[kG.lng-e.lng,kG.lat-e.lat];if(kC[0]!==kE[kz-1][0]||kC[1]!==kE[kz-1][1]){kE.push(kC);kB.push(kC[0],kC[1]);kz++}}return kE},onDestroy:function(){this.data=null;this.params={};this._stateCube={};this.delIndexs.length=0},toString:function(){return"FeatureLayer"}});function b1(e){e=e||{};this.type="polyline";this.style_opt={sequence:false,marginLength:16,traceControl:null,traceColor:[],traceDisappear:false,linksLine:false,strokeColorControl:null,strokeColor:"rgba(25, 25, 250, 1)",strokeWeight:2,borderCovered:true,borderColor:"rgba(27, 142, 236, 1)",borderWeight:0,borderMask:true,strokeOpacity:1,strokeLineJoin:"round",strokeLineCap:"square",strokeTextureUrl:"",strokeTextureWidth:16,strokeTextureHeight:16,strokeStyle:"solid",dashArray:[8,4]};this.setStyleOptions(e.style||{});this._bufferArray=[];this._texture={};e.nodeShow=e.nodeShow===undefined?false:e.nodeShow;e.linkLine=e.linkLine===undefined?true:e.linkLine;e.nodeMask=e.nodeMask===undefined?false:e.nodeMask;e.nodeStrict=e.nodeStrict===undefined?false:e.nodeStrict;e.nodeJoin=e.nodeJoin===undefined?5:e.nodeJoin;e.nodeBreakpoint=e.nodeBreakpoint===undefined?false:e.nodeBreakpoint;e.nodeMiddleShow=e.nodeMiddleShow===undefined?false:e.nodeMiddleShow;e.nodeMinZoom=(!e.nodeMinZoom||e.nodeMinZoom<3||e.nodeMinZoom>25)?6:e.nodeMinZoom;ee.call(this,e);if(e.nodeShow){var i=JSON.parse(JSON.stringify(e));i=Object.assign(i,{enablePicked:false,autoSelect:false,coorSysMc:true});this.attachNode=new aZ(i)}hP.sendMessage(a1(4,3,10),["layer","line"])}b1.Segment={START_POINT:1,END_POINT:2,BREAK_POINT:3,MIDDLE_POINT:4,1:1,2:2,3:3,4:4};b1.inherits(ee,"LineLayer");e9.extend(b1.prototype,{onAdd:function(e,i){if(this.attachNode){this.attachNode.onAdd(e,i)}if(!this.map){this.map=e;this.gl=i}if(!this.buffer){this.parseData()}},parseData:function(e){if(!this.loadModule||!this.styleExpress||!this.map||!this.map._normalLayerMgr){return}var T=this.getData();if(!T){return}var kz=this.dataset=this.formatData(T);this.dispatchEvent(new fW("ondataparsed"));var i=this.linesParse(kz.inner);this.lines=this.combineLine(i);if(!this.base_opt.nodeStrict){this.buffer=this.createBufferData(this.lines)}else{this.buffer=this.createBufferArrData(this.lines[0])}this.doOnceDraw()},linesParse:function(kM){var kE=[[],[]];var kB=0;var kI=-1;for(var kQ=0;kQ<kM.length;kQ++){var kS=kM[kQ].points;var kC=false;if(!(kS[0] instanceof cG)){kC=true}var kG=kM[kQ].properties||{};var kz=kG.hasOwnProperty(this.base_opt.idKey)?kG[this.base_opt.idKey]:false;var kF=kQ;var kK=-1;if(kM[kQ].index!==undefined){kF=kM[kQ].index}if(kM[kQ].brotherIndex!==undefined){kK=kM[kQ].brotherIndex}if(kI!==kF){kI=kF;kB=0}var kR=this.evaluates(kF,{properties:kG,id:kz});kR=Object.assign(JSON.parse(JSON.stringify(cB[this.type])),kR||{});if(this.base_opt.nodeStrict){kG.line_node_type=1;var kD=this.styleExpress.shapeType.evaluate(this.evaluateContext(kF,{properties:kG,id:kz}));kG.line_node_type=2;var kA=this.styleExpress.shapeType.evaluate(this.evaluateContext(kF,{properties:kG,id:kz}))}if(kR.borderWeight!==0){var e=this.getColorStyleForGL(kR.borderColor,undefined,false);if(kR.borderWeight<0){this.style_opt.borderMask=false}var kH=kR.strokeWeight/2+kR.borderWeight;if(kH>0){var kP=this.buildLineVertex(kR,kM[kQ],kC,kH,e,kB);kE[0][kE[0].length]={index:kF,styleData:kP,textureKey:-1,texture:null,textureSize:null,zoomWithMap:true,start:aZ.hasMask(kD),end:aZ.hasMask(kA),overlay:{_config:{textureRepeat:true},_totalDashLen:null,}}}}var kN=kR.strokeWeight/2;var kO=this.getColorStyleForGL(kR.strokeColor,kR.strokeOpacity,false);if(kK>-1&&this.style_opt.linksLine&&this.style_opt.strokeColorControl instanceof Function){var kJ=this.style_opt.strokeColorControl(kF,kK);kO=this.getColorStyleForGL(kJ,undefined,false)}var kP=this.buildLineVertex(kR,kM[kQ],kC,kN,kO,kB);var kJ=this._generateTexture(kR)||{};var kL=kJ.value||null;var T={index:kF,styleData:kP,textureKey:kJ.key||-1,texture:kL?kL.texture:null,textureSize:kL?kL.textureSize:null,zoomWithMap:true,start:this.base_opt.nodeMask&&aZ.hasMask(kD),end:this.base_opt.nodeMask&&aZ.hasMask(kA),overlay:{_config:{textureRepeat:true},_totalDashLen:kL?kL.totalDashLen:null,}};if(this.style_opt.borderCovered&&!this.base_opt.nodeStrict){kE[1][kE[1].length]=T}else{kE[0][kE[0].length]=T}if(kP[0]&&kP[0][0] instanceof Array){kB=kP[0][0][kP[0][0].length-1]/10||0}}return kE},combineLine:function(kB){var kH=[];var kz=[];var kN=[];for(var kD=0;kD<kB.length;kD++){var kJ={};var kC=kB[kD];var T=-1;for(var kE=0;kE<kC.length;kE++){if(!this.base_opt.nodeStrict){if(!kJ[kC[kE].textureKey]){kJ[kC[kE].textureKey]=[{style:[],styleData:[[],[]],index:[]}]}this._mergeOnePolylineData(kJ[kC[kE].textureKey],kC[kE])}else{var kM=kC[kE];if(T!==kC[kE].index){T=kC[kE].index;var kL=this.dataset.join[kM.index];if(!kL.properties){kL.properties={}}kL.properties.__index=kC[kE].index;this._onLine(kL,kz,kM.start,kM.end)}}}kH.push(kJ)}if(kz.length>0){var kJ={};for(var kE=0;kE<kz.length;kE++){var kC=kz[kE];if(!kJ[kE+1]){kJ[kE+1]={}}var kA=[];for(var kD=0;kD<kC.length;kD++){var kF=kC[kD].properties.__index;kA.push(kF);var kG=this._findLineIndex(kF,kB[0]);if(kG>=0){var kL=kB[0][kG];if(!kJ[kE+1][kL.textureKey]){kJ[kE+1][kL.textureKey]=[{style:[],styleData:[[],[]],index:[]}]}this._mergeOnePolylineData(kJ[kE+1][kL.textureKey],kL);var e=kB[0][kG+1];if(e&&e.index===kF){if(!kJ[kE+1][e.textureKey]){kJ[kE+1][e.textureKey]=[{style:[],styleData:[[],[]],index:[]}]}this._mergeOnePolylineData(kJ[kE+1][e.textureKey],e)}}}kN.push(kA)}kH[0]=kJ}if(this.attachNode){var kK=this._pointGeoFilter(this.getData());var kI=JSON.parse(JSON.stringify(this.params||{}));kI.nodeStrictIndex=kN;this.attachNode.setData(kK,kI)}return kH},_findLineIndex:function(e,kz){for(var T=0;T<kz.length;T++){if(kz[T].index===e){return T}}return -1},_pointOnLine:function(kD,kC,e,kB){var kE=e[kB];if(kD.length>0){for(var kA=0;kA<kE.length;kA++){var kF=kE[kA];for(var kz=0;kz<kD.length;kz++){var T=ek.booleanDisjoint({type:"Feature",geometry:{coordinates:kD[kz],type:"Point",}},kF);if(!T){return true}}}}for(var kA=0;kA<kE.length;kA++){var kF=kE[kA];var kD=kF.properties.__nodes||[];if(kD.length>0){for(var kz=0;kz<kD.length;kz++){var T=ek.booleanDisjoint({type:"Feature",geometry:{coordinates:kD[kz],type:"Point",}},kC);if(!T){return true}}}}return false},_onLine:function(kz,e,kE,T){if(kz.geometry.type!=="LineString"){return -1}var kD=kz.geometry.coordinates;var kC=[];if(kE){kC.push(kD[0])}if(T){kC.push(kD[kD.length-1])}kz.properties.__nodes=kC;var kB=false;for(var kA=0;kA<e.length;kA++){kB=this._pointOnLine(kC,kz,e,kA);if(!kB){e[kA].push(kz);return kA}}e.push([kz]);return e.length-1},_mergeOnePolylineData:function(kQ,kD){var i=kQ.length-1;var kO=kQ[i];var kB=kQ[i]["styleData"][0];var kA=kQ[i]["styleData"][1];var kP=10;var kz=(Math.floor(65536/4)-2)*4;for(var kK=0;kK<kD.styleData.length;kK++){var kH=kD.styleData[kK];var kG=kH[0];var kE=kH[1];var kR=kG.length/(kP-1);var T=Math.ceil(kR/kz);for(var kJ=0;kJ<T;kJ++){var kC=kB.length/kP;var kN=(kJ===T-1)?(kR-kz*kJ):kz;if(kC+kN>kz){i++;kO=kQ[i]={style:[],styleData:[[],[]],index:[],texture:null,textureSize:null,zoomWithMap:null,overlay:null};kB=kO.styleData[0];kA=kO.styleData[1];kC=0}if(kO.styleData[0].length===0){kO.texture=kD.texture;kO.textureSize=kD.textureSize;kO.zoomWithMap=kD.zoomWithMap;kO.overlay=kD.overlay}kO.index[kO.index.length]=kD.index;var kM=kJ>0?-2:0;for(;kM<kN;kM++){kB[kB.length]=kG[(kJ*kz+kM)*(kP-1)];kB[kB.length]=kG[(kJ*kz+kM)*(kP-1)+1];kB[kB.length]=kG[(kJ*kz+kM)*(kP-1)+2];kB[kB.length]=kG[(kJ*kz+kM)*(kP-1)+3];kB[kB.length]=kG[(kJ*kz+kM)*(kP-1)+4];kB[kB.length]=kG[(kJ*kz+kM)*(kP-1)+5];kB[kB.length]=kG[(kJ*kz+kM)*(kP-1)+6];kB[kB.length]=kG[(kJ*kz+kM)*(kP-1)+7];kB[kB.length]=kG[(kJ*kz+kM)*(kP-1)+8];kB[kB.length]=kD.index}var kF=kJ>0?(kz*(kJ+1)*3):(kN-2)*3;var kI=kJ>0?(kz*kJ-2)*3:0;var e=kJ>0?(kz*kJ-2):0;for(var kL=kI;kL<kF&&kL<kE.length;kL++){kA[kA.length]=kE[kL]-e+kC}}}},buildLineVertex:function(T,kM,kz,kA,kD,kC){var kF=[];var kJ=[];var kL=[];var kG=kM.points;var kK=T.strokeLineCap;var e=T.strokeLineJoin;var kB=iU.JOININDEX[e];var kI=iU.CAPINDEX[kK];var kH=this._toFormatPolGeometry(kG,kz);for(var kE=0;kE<kH.length;kE++){if(kH[kE].length<2){continue}if(kF.length/6+gD.getVertexCount(kH[kE].length)>65536){kL.push([kF,kJ]);kF=[];kJ=[]}gD.buildData(kH[kE],kB,kI,kF,kJ,kD,kA,undefined,kC)}kL.push([kF,kJ]);return kL},createBuffer:function(i){var T=13;var e=[{name:"a_pos",components:2,offset:0,type:"Float32"},{name:"a_normal",components:2,offset:8,type:"Float32"},{name:"a_color",components:4,offset:16,type:"Uint8",normalize:true},{name:"a_data",components:4,offset:20,type:"Float32"},{name:"a_id",components:1,offset:36,type:"Float32"}];return new B(i,{components:T,members:e},B.BufferType.VERTEX)},createBufferArrData:function(kJ){var kG=[];var kH=0;for(var kM in kJ){if(!kJ.hasOwnProperty(kM)){continue}var kC=kJ[kM];var kL=[];for(var kz in kC){if(!kC.hasOwnProperty(kz)){continue}var kF=kC[kz];var kI=[];for(var kE=0;kE<kF.length;kE++){var kB=kF[kE].styleData[0];var kD=kF[kE].styleData[1];if(!kB||!kB.length){continue}if(!this._bufferArray[kI.length+kH]){this._bufferArray[kI.length+kH]={vertex:null,element1:null,vao1:null}}var kK=this._bufferArray[kI.length+kH];kK.textureKey=kz;kK.index=kF[kE].index;if(!kK.vertex){var kA=new Float32Array(kB.length);kA.set(kB);kK.vertex=this.createBuffer(kA)}var T=new Uint16Array(kD.length);T.set(kD);if(!kK.element1){kK.element1=new B(T,{components:1},B.BufferType.ELEMENT,kD.length)}if(!kK.vao1){kK.vao1=new dY()}var e=new Float32Array(kB);e.set(kB);kK.vao1.update(this.gl,kK.vertex,e,kB.length,kK.element1,T,kD.length);kI.push(kK)}kL.push(kI);kH+=kI.length}kG.push(kL)}return kG},createBufferData:function(kI){var kF=[];var kG=0;for(var kC=0;kC<kI.length;kC++){var kJ=kI[kC];var kH=[];for(var kL in kJ){if(!kJ.hasOwnProperty(kL)){continue}var kE=kJ[kL];for(var kD=0;kD<kE.length;kD++){var kA=kE[kD].styleData[0];var kB=kE[kD].styleData[1];if(!kA||!kA.length){continue}if(!this._bufferArray[kH.length+kG]){this._bufferArray[kH.length+kG]={vertex:null,element1:null,vao1:null}}var kK=this._bufferArray[kH.length+kG];kK.textureKey=kL;kK.index=kE[kD].index;if(!kK.vertex){var kz=new Float32Array(kA.length);kz.set(kA);kK.vertex=this.createBuffer(kz)}var T=new Uint16Array(kB.length);T.set(kB);if(!kK.element1){kK.element1=new B(T,{components:1},B.BufferType.ELEMENT,kB.length)}if(!kK.vao1){kK.vao1=new dY()}var e=new Float32Array(kA);e.set(kA);kK.vao1.update(this.gl,kK.vertex,e,kA.length,kK.element1,T,kB.length);kH.push(kK)}}kG+=kH.length;kF.push(kH)}return kF},_generateTexture:function(kz){if(kz.strokeTextureUrl){var kA=kz.strokeTextureUrl+"_"+kz.strokeWeight;if(this._texture[kA]){return{key:kA,value:this._texture[kA]}}var kC=kz.strokeTextureUrl;var kB=kz.strokeTextureWidth||16;var i=kz.strokeTextureHeight||16;var kD=kz.strokeWeight*Math.round(i/kB);var e={totalDashLen:kD,texture:kC,textureSize:[kB,i]};this._texture[kA]=e;return{key:kA,value:e}}if(kz.strokeStyle==="dashed"||kz.strokeStyle==="dotted"){var kA=[kz.strokeStyle,kz.strokeWeight,kz.strokeColor,kz.strokeOpacity,kz.dashArray.join(",")];kA=kA.join("-");if(this._texture[kA]){return{key:kA,value:this._texture[kA]}}kz.sync=true;var T=this;ek._generateTexture(null,kz,function(kF,kE){T._texture[kA]=kE});return{key:kA,value:this._texture[kA]}}return null},preRender:function(T,i,e){},render:function(kD,kz,kC){if(!this.buffer){return}kC=kC||{};this.pickModel=kC.isPickRender||false;var T=this.map._webglPainter;var e=T._state;if(this.base_opt.nodeShow&&this.attachNode){if(this.base_opt.nodeStrict){for(var kB=0;kB<this.buffer.length;kB++){kC.renderIndex=kB;for(var kA=0;kA<this.buffer[kB].length;kA++){this._renderItem(kD,T,this.buffer[kB][kA],kz,kC)}}}else{if(this.map.getZoom()>this.base_opt.nodeMinZoom&&this.base_opt.nodeMask){kD.clear(kD.STENCIL_BUFFER_BIT);kD.stencilFunc(kD.ALWAYS,1,255);e.stencilOp(kD.KEEP,kD.KEEP,kD.REPLACE);kD.stencilMask(255);e.colorMask(false,false,false,false);kC.isMask=true;this.attachNode.render(kD,kz,kC);kD.stencilFunc(kD.NOTEQUAL,1,255);kD.stencilMask(0);e.stencilOp(kD.KEEP,kD.KEEP,kD.KEEP);e.colorMask(true,true,true,true)}for(var kB=0;kB<this.buffer[0].length;kB++){this.drawLine(T,this.buffer[0][kB],false)}for(var kB=0;kB<this.buffer[1].length;kB++){this.drawLine(T,this.buffer[1][kB],false)}if(this.map.getZoom()>this.base_opt.nodeMinZoom){kD.clear(kD.STENCIL_BUFFER_BIT);kD.stencilMask(255);kD.stencilFunc(kD.ALWAYS,1,255);kC.isMask=false;this.attachNode.render(kD,kz,kC)}}return}if(this.buffer[0].length>0){if(this.style_opt.borderMask&&this.style_opt.borderCovered){kD.clear(kD.STENCIL_BUFFER_BIT);kD.stencilFunc(kD.ALWAYS,1,255);e.stencilOp(kD.KEEP,kD.KEEP,kD.REPLACE);kD.stencilMask(255);e.colorMask(false,false,false,false);for(var kB=0;kB<this.buffer[1].length;kB++){this.drawLine(T,this.buffer[1][kB],true)}kD.stencilFunc(kD.NOTEQUAL,1,255);kD.stencilMask(0);e.stencilOp(kD.KEEP,kD.KEEP,kD.KEEP);e.colorMask(true,true,true,true);for(var kB=0;kB<this.buffer[0].length;kB++){this.drawLine(T,this.buffer[0][kB],false)}kD.clear(kD.STENCIL_BUFFER_BIT);kD.stencilMask(255);kD.stencilFunc(kD.ALWAYS,1,255);for(var kB=0;kB<this.buffer[1].length;kB++){this.drawLine(T,this.buffer[1][kB],false,true)}return}else{for(var kB=0;kB<this.buffer[0].length;kB++){this.drawLine(T,this.buffer[0][kB],false)}}}for(var kB=0;kB<this.buffer[1].length;kB++){this.drawLine(T,this.buffer[1][kB],false)}},_renderItem:function(kC,i,kB,T,kA){var e=i._state;if(this.map.getZoom()>this.base_opt.nodeMinZoom&&this.base_opt.nodeMask){kC.clear(kC.STENCIL_BUFFER_BIT);kC.stencilFunc(kC.ALWAYS,1,255);e.stencilOp(kC.KEEP,kC.KEEP,kC.REPLACE);kC.stencilMask(255);e.colorMask(false,false,false,false);kA.isMask=true;this.attachNode.render(kC,T,kA);kC.stencilFunc(kC.NOTEQUAL,1,255);kC.stencilMask(0);e.stencilOp(kC.KEEP,kC.KEEP,kC.KEEP);e.colorMask(true,true,true,true)}for(var kz=0;kz<kB.length;kz++){this.drawLine(i,kB[kz],false)}if(this.map.getZoom()>this.base_opt.nodeMinZoom){kC.clear(kC.STENCIL_BUFFER_BIT);kC.stencilMask(255);kC.stencilFunc(kC.ALWAYS,1,255);kA.isMask=false;this.attachNode.render(kC,T,kA)}},traceControl:function(i){if(this.style_opt.traceControl instanceof Function){var e=this.style_opt.traceControl(i);if(e instanceof Array&&e.length===i.length){return e}}return[]},_formatArrayBuffer:function(kz,i){var e;if(i){e=new Int32Array(this.DEL_COUNT)}else{e=new Int16Array(this.DEL_COUNT)}if(kz&&kz.length){var T=0;for(;T<kz.length&&T<this.DEL_COUNT;T++){e[T]=parseInt(kz[T])}if(T<this.DEL_COUNT){e[T]=-1}}else{e[0]=-1}return e},drawLine:function(kT,kM,kQ,kV){if(!kM.element1||(kM.element1&&kM.element1.length===0)){return}var kR=kT.gl;var kB=kT.programMgr.useProgram("linelayer",{def:this.def});var kG=this._texture[kM.textureKey];var kH=null;var kU=0;var kJ=this.map.getZoom();var kI=this;if(kG){var kK=kG.texture;if(kK instanceof HTMLCanvasElement||(window.ImageBitmap&&kK instanceof window.ImageBitmap)){if(!kG.glTexture){kG.glTexture=d5.utils.createTexture(kR,kK,{flipY:false,wrap:kR.REPEAT,mipmap:true,unpackAlpha:true})}kH=kG.glTexture}else{if(!kG.glTexture){kG.glTexture={status:"init"};var kX=new Image();kX.crossOrigin="anonymous";kX.onload=function(){kG.glTexture.texture=d5.utils.createTexture(kR,this,{flipY:false,wrap:kR.REPEAT,mipmap:true,unpackAlpha:true});kG.glTexture.status="done";kI.doOnceDraw()};kX.src=kK}if(kG.glTexture.status!=="done"){return}kH=kG.glTexture.texture}kT._state.activeTexture(kR.TEXTURE4);kR.bindTexture(kR.TEXTURE_2D,kH);if(kB.uniforms.lastSampler!==4){kR.uniform1i(kB.uniforms.u_image,4);kB.uniforms.lastSampler=4}kU=kG.totalDashLen}var kz=this.opacity;if(kB.lastState.opacity!==kz){kR.uniform1f(kB.uniforms.u_opacity,kz);kB.lastState.opacity=kz}var kC=this.style_opt.sequence;if(kB.lastState.sequence!==kC){kR.uniform1i(kB.uniforms.u_sequence,kC);kB.lastState.sequence=kC}var T=this.style_opt.marginLength;if(kB.lastState.marginLength!==T){kR.uniform1f(kB.uniforms.u_margin_length,T);kB.lastState.marginLength=T}if(kB.lastState.dash!==kU){kR.uniform1f(kB.uniforms.u_dash_length,kU);kB.lastState.dash=kU}if(kB.lastState.mapZoom!==kJ){kR.uniform1f(kB.uniforms.u_map_zoom,kJ);kB.lastState.mapZoom=kJ}var kN=kT._camera._modelViewMatrixLayer;if(!kB.lastState.projMatrix){kR.uniformMatrix4fv(kB.uniforms.u_proj_matrix,false,kT.projMatrix);kB.lastState.projMatrix=true}kR.uniformMatrix4fv(kB.uniforms.u_mv_matrix,false,kN);var kW=Math.pow(2,18-this.map.getZoom());if(kB.lastState.scale!==kW){kR.uniform1f(kB.uniforms.u_scale,kW);kB.lastState.scale=kW}var kF=this.base_opt.isFlat;if(kB.lastState.isFlat!==kF){kR.uniform1i(kB.uniforms.u_flat,kF);kB.lastState.isFlat=kF}var kP=this.base_opt.drawPart||1;if(kB.lastState.drawPart!==kP){kR.uniform1i(kB.uniforms.u_draw_part,kP);kB.lastState.drawPart=kP}var kD=kT._camera._far||4000;if(kB.lastState.cameraFar!==kD){kR.uniform1f(kB.uniforms.u_camera_far,kD);kB.lastState.cameraFar=kD}kR.uniform1i(kB.uniforms.u_no_gradual,kV||false);var kL;if(!(this.style_opt.traceColor instanceof Array)||this.style_opt.traceColor.length<3){kL=[153,153,153]}else{kL=this.style_opt.traceColor.slice(0,3)}kR.uniform3fv(kB.uniforms.u_trace_color,kL);kR.uniform1i(kB.uniforms.u_trace_disappear,this.style_opt.traceDisappear||false);kR.uniform1i(kB.uniforms.u_pick_model,kQ||this.pickModel);if(kB.lastState.selectColor!==this.select_color){kR.uniform4fv(kB.uniforms.u_pick_color,this.select_color);kB.lastState.selectColor=this.select_color}if(kB.lastState.pickTag!==this.selectedIndex){kR.uniform1i(kB.uniforms.u_pick_tag,this.selectedIndex+1);kB.lastState.pickTag=this.selectedIndex}var kS=new Int16Array(this.DEL_COUNT);if(this.delIndexs.length){for(var kO=0;kO<this.delIndexs.length&&kO<this.DEL_COUNT;kO++){kS[kO]=this.delIndexs[kO]}}kR.uniform1iv(kB.uniforms["u_del_tags[0]"],kS);var kA=this._formatArrayBuffer(kM.index);kR.uniform1iv(kB.uniforms["u_trace_index[0]"],kA);var e=this.traceControl(kM.index);var kE=this._formatArrayBuffer(e,true);kR.uniform1iv(kB.uniforms["u_trace_len[0]"],kE);kM.vao1.bind(kR,kB,kM.vertex,kM.element1);kR.drawElements(kR.TRIANGLES,kM.element1.length,kR.UNSIGNED_SHORT,0);tags=null},onDestroy:function(e,i){this.lines=null;this.buffer=null;this._bufferArray=[];this._texture={};ee.prototype.onDestroy.call(this);if(this.attachNode){this.attachNode.onDestroy()}},toString:function(){return"LineLayer"}});function ed(e){e=e||{};this.type="polygon";this.style_opt={fillColor:"#142655",fillOpacity:1,pattern:false,patternMask:true,patternUrl:"",patternMapping:"0, 0, 32, 32",patternScale:1,patternOffset:"0, 0"};this.setStyleOptions(e.style||{});this._bufferArray=[];this._texture=null;ee.call(this,e);e.border=e.border===undefined?true:e.border;if(e.border){var i=JSON.parse(JSON.stringify(e));i=Object.assign(i,{enablePicked:false,autoSelect:false});this.attach=new b1(i)}hP.sendMessage(a1(4,3,11),["layer","fill"])}ed.inherits(ee,"FillLayer");e9.extend(ed.prototype,{onAdd:function(e,i){if(this.attach){this.attach.onAdd(e,i)}if(!this.map){this.map=e;this.gl=i}if(!this.buffer){this.parseData()}},parseData:function(e){if(!this.loadModule||!this.styleExpress||!this.map||!this.map._normalLayerMgr){return}var T=this.getData();if(!T){return}if(this.attach){if(e&&e instanceof cG){this.attach.center=e}this.attach.setData(T,this.params)}var kz=this.dataset=this.formatData(T);this.dispatchEvent(new fW("ondataparsed"));var i=this.fillsParse(kz.inner);this.fills=this.combineFill(i);this.buffer=this.createBufferData(this.fills);this.doOnceDraw()},fillsParse:function(kG){var kN=[];for(var kF=0;kF<kG.length;kF++){var kE=kG[kF].points;var T=false;if(!(kE[0] instanceof cG)){T=true}var kK=kG[kF].properties||{};var kM=kK.hasOwnProperty(this.base_opt.idKey)?kK[this.base_opt.idKey]:false;var kB=kF;if(kG[kF].index!==undefined){kB=kG[kF].index}var e=this.evaluates(kB,{properties:kK,id:kM});e=Object.assign(JSON.parse(JSON.stringify(cB[this.type])),e||{});var kL=this.getColorStyleForGL(e.fillColor,e.fillOpacity,true).join(",");var kJ=[];if(this.style_opt.pattern&&this.style_opt.patternUrl){kJ=[e.patternMapping.split(","),e.patternScale,e.patternOffset.split(",")]}var kA=this.buildFillVertex(kE,T);var kI=kA[0].length/2*3;var kC=new Float32Array(kI);var kH=0;for(var kD=0;kD<kA[0].length;kD++){kC[kH]=kA[0][kD];kH++;if((kD+1)%2===0){kC[kH]=kB;kH++}}var kz=[kL,kC,kA[1],kJ];kz.hasMultipleParts=T;kN.push(kz)}return kN},buildFillVertex:function(kz,e){var kF=this._toFormatPolGeometry(kz,e);var kG=[];var kC;var kD=[];var kB=0;for(var kA=0;kA<kF.length;kA++){if(kA>0){kB+=kF[kA-1].length}kC=hW(kF[kA].pointsArray,null,null,kB);for(var T=0,kE=kC.length;T<kE;T+=3){kG.push(kC[T],kC[T+1],kC[T+2])}kD=kD.concat(kF[kA].pointsArray)}var kH=[new Float32Array(kD),new Uint16Array(kG)];return kH},combineFill:function(T){var kE={};var e=[];for(var kB=0;kB<T.length;kB++){var kD=this._cloneFill(T[kB]);if(kD.hasMultipleParts){e.push(kD)}else{var kA=kD[0]+"_"+kD[3].join("-");if(kE[kA]){if((kE[kA][1].length+kD[1].length)/3<65536){this.mergeDataItem(kE[kA],kD,kE[kA][1].length/3)}else{e.push(this._cloneFill(kE[kA]));kE[kA]=kD}}else{kE[kA]=kD}}}var kC=Object.keys(kE);for(var kz=0;kz<kC.length;kz++){e.push(kE[kC[kz]])}return e},_cloneFill:function(kA){var kz=kA[1].constructor;var i=new kz(kA[1].length);i.set(kA[1],0);var kB=kA[2].constructor;var T=new kB(kA[2].length);T.set(kA[2],0);var e=[kA[0],i,T,kA[3]];if(kA.hasMultipleParts){e.hasMultipleParts=kA.hasMultipleParts}return e},mergeDataItem:function(e,kB,T){var i=e[1];var kA=kB[1];var kz=e[2];var kC=kB[2];e[1]=this.concatTypedArray(i,kA);e[2]=this.concatTypedArray(kz,kC,T);return e},concatTypedArray:function(e,kC,kB){if(e.constructor===ArrayBuffer){var kz=new Uint8Array(e.byteLength+kC.byteLength);kz.set(new Uint8Array(e),0);kz.set(new Uint8Array(kC),e.byteLength);return kz.buffer}else{var kA=e.constructor;var kz=new kA(e.length+kC.length);kz.set(e,0);if(kB){for(var T=0;T<kC.length;T++){kC[T]+=kB}}kz.set(kC,e.length);return kz}},createBuffer:function(i){var T=3;var e=[{name:"a_pos",components:2,offset:0,type:"Float32"},{name:"a_id",components:1,offset:8,type:"Float32"}];return new B(i,{components:T,members:e},B.BufferType.VERTEX)},createBufferData:function(kB){var kC=[];for(var T=0;T<kB.length;T++){var kA=kB[T][1];var e=kB[T][2];if(!kA||!kA.length){continue}if(!this._bufferArray[kC.length]){this._bufferArray[kC.length]={vertex:null,element1:null,vao1:null};var kz=this._bufferArray[kC.length];kz.vertex=this.createBuffer(kA);kz.element1=new B(e,{components:1},B.BufferType.ELEMENT,e.length);kz.vao1=new dY()}else{var kz=this._bufferArray[kC.length];kz.vao1.update(this.gl,kz.vertex,kA,kA.length,kz.element1,e,e.length)}kC.push(kz)}return kC},preRender:function(T,i,e){},render:function(kB,kD,e){if(!this.buffer){return}e=e||{};if(this.style_opt.pattern&&this.style_opt.patternUrl){if(!this._texture){this._texture={status:"init"};var kF=this;var kA=new Image();kA.crossOrigin="anonymous";kA.onload=function(){kF._texture=d5.utils.createTexture(kB,this,{flipY:true,wrap:kB.REPEAT,mipmap:false,unpackAlpha:true});kF._texture.size=[this.width,this.height];kF._texture.status="done";kF.doOnceDraw()};kA.src=this.style_opt.patternUrl}if(this._texture.status!=="done"){return}}this.pickModel=e.isPickRender||false;var kE=this.map._webglPainter;var kG=kE._state;for(var kz=0;kz<this.buffer.length;kz++){var T=this.fills[kz][0];T=T.split(",");T=[T[0]/255,T[1]/255,T[2]/255,parseFloat(T[3])];var kC=this.fills[kz][3];if(this.fills[kz].hasMultipleParts){kB.clear(kB.STENCIL_BUFFER_BIT);kB.stencilFunc(kB.NEVER,0,255);kG.stencilOp(kB.INVERT,kB.INVERT,kB.INVERT);kB.stencilMask(255);kG.colorMask(false,false,false,false);this.drawFill(kE,this.buffer[kz],T,kC);kB.stencilFunc(kB.EQUAL,255,255);kB.stencilMask(0);kG.stencilOp(kB.KEEP,kB.KEEP,kB.KEEP);kG.colorMask(true,true,true,true);this.drawFill(kE,this.buffer[kz],T,kC);kB.clear(kB.STENCIL_BUFFER_BIT);kB.stencilMask(255);kB.stencilFunc(kB.ALWAYS,1,255)}else{this.drawFill(kE,this.buffer[kz],T,kC)}}if(this.attach&&!this.pickModel){this.attach.render(kB,kD,e)}},drawFill:function(kP,kH,kI,kN){if(kH.element1&&kH.element1.length===0){return}var kM=kP.gl;var kB=kP.programMgr.useProgram("filllayer",{def:this.def});var kJ=kP._camera._modelViewMatrixLayer;if(!kB.lastState.projMatrix){kM.uniformMatrix4fv(kB.uniforms.u_proj_matrix,false,kP.projMatrix);kB.lastState.projMatrix=true}kM.uniformMatrix4fv(kB.uniforms.u_mv_matrix,false,kJ);kM.uniform4fv(kB.uniforms.u_color,kI);var T=this.opacity;if(kB.lastState.opacity!==T){kM.uniform1f(kB.uniforms.u_opacity,T);kB.lastState.opacity=T}var kC=this.style_opt.pattern;if(kC&&this._texture){kP._state.activeTexture(kM.TEXTURE5);kM.bindTexture(kM.TEXTURE_2D,this._texture);if(kB.uniforms.lastSampler!==5){kM.uniform1i(kB.uniforms.u_image,5);kB.uniforms.lastSampler=5}var kF=this._texture.size;if(kB.lastState.size!==kF){kM.uniform2fv(kB.uniforms.u_size,kF);kB.lastState.size=kF}}if(kB.lastState.pattern!==kC){kM.uniform1i(kB.uniforms.u_pattern,kC);kB.lastState.pattern=kC}var kz=this.style_opt.patternMask;if(kB.lastState.patternMask!==kz){kM.uniform1i(kB.uniforms.u_pattern_mask,kz);kB.lastState.patternMask=kz}var kG=this.map.getZoom();if(kB.lastState.mapZoom!==kG){kM.uniform1f(kB.uniforms.u_map_zoom,kG);kB.lastState.mapZoom=kG}var e=kN.length>=3?kN[0]:[0,0,0,0];if(kB.lastState.bound!==e){kM.uniform4fv(kB.uniforms.u_bound,e);kB.lastState.bound=e}var kQ=kN.length>=3?kN[1]:0;if(kB.lastState.scale!==kQ){kM.uniform1f(kB.uniforms.u_scale,kQ);kB.lastState.scale=kQ}var kA=kN.length>=3?kN[2]:[0,0];if(kB.lastState.offset!==kA){kM.uniform2fv(kB.uniforms.u_offset,kA);kB.lastState.offset=kA}var kE=this.base_opt.isFlat;if(kB.lastState.isFlat!==kE){kM.uniform1i(kB.uniforms.u_flat,kE);kB.lastState.isFlat=kE}var kL=this.base_opt.drawPart||1;if(kB.lastState.drawPart!==kL){kM.uniform1i(kB.uniforms.u_draw_part,kL);kB.lastState.drawPart=kL}var kD=kP._camera._far||4000;if(kB.lastState.cameraFar!==kD){kM.uniform1f(kB.uniforms.u_camera_far,kD);kB.lastState.cameraFar=kD}kM.uniform1i(kB.uniforms.u_pick_model,this.pickModel);if(kB.lastState.selectColor!==this.select_color){kM.uniform4fv(kB.uniforms.u_pick_color,this.select_color);kB.lastState.selectColor=this.select_color}if(kB.lastState.pickTag!==this.selectedIndex){kM.uniform1i(kB.uniforms.u_pick_tag,this.selectedIndex+1);kB.lastState.pickTag=this.selectedIndex}var kO=new Int16Array(this.DEL_COUNT);if(this.delIndexs.length){for(var kK=0;kK<this.delIndexs.length&&kK<this.DEL_COUNT;kK++){kO[kK]=this.delIndexs[kK]}}kM.uniform1iv(kB.uniforms["u_del_tags[0]"],kO);kH.vao1.bind(kM,kB,kH.vertex,kH.element1);kM.drawElements(kM.TRIANGLES,kH.element1.length,kM.UNSIGNED_SHORT,0);tags=null},onDestroy:function(e,i){this.fills=null;this.buffer=null;this._bufferArray=[];this._texture=null;ee.prototype.onDestroy.call(this);if(this.attach){this.attach.onDestroy()}},toString:function(){return"FillLayer"}});function aZ(e){e=e||{};this.type="point";this.style_opt={visibility:true,nodeType:aZ.NodeType.SHAPE,shapeType:aZ.ShapeType.TRIANGLE,anchor:aZ.Anchor.CENTER,size:32,scale:1,rotation:0,offset:[0,0],color:"green",opacity:1,strokeColor:"red",strokeWeight:0};this.setStyleOptions(e.style||{});this._bufferArray=[];e.isFlat=e.isFlat===undefined?true:e.isFlat;ee.call(this,e);hP.sendMessage(a1(4,3,9,2),["layer","point","shape"])}aZ.Anchor={CENTER:0,TOP_LEFT:1,TOP_CENTER:2,TOP_RIGHT:3,RIGHT_CENTER:4,BOTTOM_RIGHT:5,BOTTOM_CENTER:6,BOTTOM_LEFT:7,LEFT_CENTER:8,0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8};aZ.NodeType={ICON:1,SHAPE:2};aZ.ShapeType={CIRCLE:0,TRIANGLE:2,CROSS:4,ARROW:5,ARROW_TAIL:6,0:0,2:2,4:4,5:5,6:6};aZ.inherits(ee,"PointShapeLayer");aZ.hasMask=function(e){if(e===aZ.ShapeType.TRIANGLE||e===aZ.ShapeType.ARROW){return true}else{return false}};e9.extend(aZ.prototype,{onAdd:function(e,i){if(!this.map){this.map=e;this.gl=i}if(!this.buffer){this.parseData()}},parseData:function(){if(!this.loadModule||!this.styleExpress||!this.map||!this.map._normalLayerMgr){return}var kA=this.getData();if(!kA){return}var kB=this.dataset=this.formatData(kA);this.dispatchEvent(new fW("ondataparsed"));var kC=this.pointsParse(kB);this.buffer=[];var e=0;for(var T=0;T<kC.length;T++){var kz=this.combineVertex(kC[T]);this.buffer.push(this.createBufferData(kz,e));e+=kz.length}this.doOnceDraw()},preRender:function(T,i,e){},pointsParse:function(kD){var kK=kD.inner;var kF=[];var kL=this.params.nodeStrictIndex||[];for(var kE=0;kE<kK.length;kE++){var kJ=kK[kE];var kG=kJ.properties||{};var kI=kG.hasOwnProperty(this.base_opt.idKey)?kG[this.base_opt.idKey]:false;var kA=this.evaluates(kJ.properties.index,{properties:kG,id:kI});kA=Object.assign(JSON.parse(JSON.stringify(cB[this.type])),kA||{});if(this.base_opt.nodeBreakpoint===false&&kG.line_node_type===3){continue}if(!kA.visibility){continue}var e=this._toFormatPointGeometry(kJ.points,this.base_opt.coorSysMc);kA.position=e;kA.index=isNaN(kG.index)?kE:kG.index;kA.id=isNaN(kI)||kI===false?kE:kI;kA.anchor=aZ.Anchor[kA.anchor]===undefined?"center":kA.anchor;kA.shapeType=aZ.ShapeType[kA.shapeType]===undefined?0:kA.shapeType;if(kG.line_node_type===1&&this.base_opt.linkLine){kA.rotation-=180}kA.lineNodeType=kG.line_node_type||9;if(kG.startPoint){var kC=kG.startPoint.split(",");if(kC.length==2){var kz=new cG(parseFloat(kC[0]),parseFloat(kC[1]));var kB=this._toFormatPointGeometry(kz,this.base_opt.coorSysMc);kA.startPoint=kB}}if(kG.endPoint){var kC=kG.endPoint.split(",");if(kC.length==2){var kz=new cG(parseFloat(kC[0]),parseFloat(kC[1]));var kH=this._toFormatPointGeometry(kz,this.base_opt.coorSysMc);kA.endPoint=kH}}if(kL.length===0){if(!kF[0]){kF[0]=[]}kF[0].push(kA)}else{var T=this._findTargetGroup(kA.index,kL);if(T>=0){if(!kF[T]){kF[T]=[]}kF[T].push(kA)}}}return kF},_findTargetGroup:function(T,kA){for(var kz=0;kz<kA.length;kz++){for(var e=0;e<kA[kz].length;e++){if(kA[kz][e]===T){return kz}}}return -1},combineVertex:function(kF){var kI=[{vertex:[],indices:[]}];var kD=kI[kI.length-1].vertex;var kG=kI[kI.length-1].indices;for(var kC=0,kE=kF.length;kC<kE;kC++){var T=kF[kC];if((kD.length+16*4)>65536){kI.push({vertex:[],indices:[]});kD=kI[kI.length-1].vertex;kG=kI[kI.length-1].indices}for(var kB=0;kB<4;kB++){kD.push(T.position[0],T.position[1]);var kz=this.int8ArrayToFloat([T.anchor,kB,T.shapeType,T.lineNodeType]);kD.push(kz);kD.push(T.size,T.scale,T.rotation*Math.PI/180);kD.push(T.offset[0],T.offset[1]);var e=this.getColorStyleForGL(T.color,undefined,true);var kH=this.getColorStyleForGL(T.strokeColor,undefined,true);kD.push(this.rgb2value(e),T.opacity,this.rgb2value(kH),T.strokeWeight);if(T.startPoint){kD.push(T.startPoint[0],T.startPoint[1])}else{kD.push(0.1,0.1)}if(T.endPoint){kD.push(T.endPoint[0],T.endPoint[1])}else{kD.push(0.1,0.1)}kD.push(T.id)}var kA=(kG.length/6)*4;kG.push(kA,kA+2,kA+1,kA,kA+3,kA+2)}return kI},createBuffer:function(i){var T=17;var e=[{name:"a_pos",components:2,offset:0,type:"Float32"},{name:"a_shape",components:4,offset:8,type:"Uint8"},{name:"a_transform",components:3,offset:12,type:"Float32"},{name:"a_offset",components:2,offset:24,type:"Float32"},{name:"a_data",components:4,offset:32,type:"Float32"},{name:"a_start",components:2,offset:48,type:"Float32"},{name:"a_end",components:2,offset:56,type:"Float32"},{name:"a_id",components:1,offset:64,type:"Float32"}];return new B(i,{components:T,members:e},B.BufferType.VERTEX)},createBufferData:function(kC,e){var kD=[];e=e||0;for(var kz=0;kz<kC.length;kz++){var kB=new Float32Array(kC[kz].vertex.length);kB.set(kC[kz].vertex);var T=new Uint16Array(kC[kz].indices.length);T.set(kC[kz].indices);if(!kB||!kB.length){continue}if(!this._bufferArray[kD.length+e]){this._bufferArray[kD.length+e]={vertex:null,element1:null,vao1:null};var kA=this._bufferArray[kD.length+e];kA.vertex=this.createBuffer(kB);kA.element1=new B(T,{components:1},B.BufferType.ELEMENT,T.length);kA.vao1=new dY()}else{var kA=this._bufferArray[kD.length+e];kA.vao1.update(this.gl,kA.vertex,kB,kB.length,kA.element1,T,T.length)}kD.push(kA)}return kD},render:function(kD,kz,kC){if(!this.buffer){return}kC=kC||{};this.pickModel=kC.isPickRender||false;var T=kC.isMask===undefined?false:kC.isMask;var e=this.map._webglPainter;if(kC.renderIndex!==undefined&&this.buffer.length>kC.renderIndex){for(var kA=0;kA<this.buffer[kC.renderIndex].length;kA++){this.drawPointShape(e,this.buffer[kC.renderIndex][kA],T)}}else{for(var kB=0;kB<this.buffer.length;kB++){for(var kA=0;kA<this.buffer[kB].length;kA++){this.drawPointShape(e,this.buffer[kB][kA],T)}}}},drawPointShape:function(kF,e,kA){if(e.element1&&e.element1.length===0){return}var T=kF.gl;var i=kF.programMgr.useProgram("pointshapelayer",{def:this.def});var kE=kF._camera._modelViewMatrixLayer;if(!i.lastState.projMatrix){T.uniformMatrix4fv(i.uniforms.u_proj_matrix,false,kF.projMatrix);i.lastState.projMatrix=true}T.uniformMatrix4fv(i.uniforms.u_mv_matrix,false,kE);var kz=this.map.getZoom();if(i.lastState.mapZoom!==kz){T.uniform1f(i.uniforms.u_map_zoom,kz);i.lastState.mapZoom=kz}var kD=kF._camera._far||4000;if(i.lastState.cameraFar!==kD){T.uniform1f(i.uniforms.u_camera_far,kD);i.lastState.cameraFar=kD}if(i.lastState.isMask!==kA){T.uniform1i(i.uniforms.u_mask,kA);i.lastState.isMask=kA}T.uniform1i(i.uniforms.u_pick_model,this.pickModel||false);var kC=[2/this.map.width,2/this.map.height];if(i.lastState.resolutionRatio!==kC){T.uniform2fv(i.uniforms.u_resolution_ratio,kC);i.lastState.resolutionRatio=kC}var kB=this.base_opt.isFlat;if(i.lastState.isFlat!==kB){T.uniform1i(i.uniforms.u_flat,kB);i.lastState.isFlat=kB}if(i.lastState.selectColor!==this.select_color){T.uniform4fv(i.uniforms.u_pick_color,this.select_color);i.lastState.selectColor=this.select_color}if(i.lastState.pickTag!==this.selectedIndex){T.uniform1i(i.uniforms.u_pick_tag,this.selectedIndex+1);i.lastState.pickTag=this.selectedIndex}e.vao1.bind(T,i,e.vertex,e.element1);T.drawElements(T.TRIANGLES,e.element1.length,T.UNSIGNED_SHORT,0)},onDestroy:function(e,i){this.buffer=null;this._bufferArray=[];ee.prototype.onDestroy.call(this)},toString:function(){return"PointShapeLayer"}});function go(e){e=e||{};this.type="point";this.style_opt={visibility:true,nodeType:go.NodeType.ICON,icon:"",iconObj:null,userSizes:true,anchors:[0,0],sizes:[32,32],scale:1,rotation:0,offset:[0,0],opacity:1,width:0,height:0,};this._appendStyle={anchors:{format:"object",defaultValue:[0,0]},sizes:{format:"object",defaultValue:[32,32]},width:{format:"number",defaultValue:32},height:{format:"number",defaultValue:32},};this.setStyleOptions(e.style||{});this._bufferArray=[];e.isFlat=e.isFlat===undefined?true:e.isFlat;e.isFixed=e.isFixed===undefined?true:e.isFixed;e.refLevel=e.refLevel===undefined?18:e.refLevel;ee.call(this,e);hP.sendMessage(a1(4,3,9,1),["layer","point","icon"])}go.NodeType={ICON:1,SHAPE:2};go.inherits(ee,"PointIconLayer");e9.extend(go.prototype,{onAdd:function(i,T){if(!this.map){this.map=i;this.gl=T}if(!this.buffer){this.parseData()}var e=this;i.addEventListener("oniconupdate",function(kz){e.updateVertex()})},parseData:function(){if(!this.loadModule||!this.styleExpress||!this.map||!this.map._normalLayerMgr){return}var e=this.getData();if(!e){return}this.dataset=this.formatData(e);this.dispatchEvent(new fW("ondataparsed"));this.updateVertex()},updateVertex:function(){if(!this.dataset){return}var i=this.pointsParse(this.dataset);if(!i||i.length==0){return}this.updateAllIconsTextureCoords(i[0]);var e=this;this.map._normalLayerMgr.loadIconImages(i[0],function(T){e.updateAllIconsTextureCoords(i[0])},true)},updateAllIconsTextureCoords:function(kB){var kD=[];for(var kz=0;kz<kB.length;kz++){var kC=kB[kz];if(this.map._webglMapScene){var T=this.map._webglMapScene._painter;if(kC.icon instanceof HTMLCanvasElement){var kA=kC.icon.id}else{var kA=kC.icon}if(T._iconTextureAtlasCoords[kA]){kC.texcoord=T._iconTextureAtlasCoords[kA];kD.push(kC)}}}this.buffer=[];var e=[{vertex:[],indices:[]}];for(var kz=0;kz<kD.length;kz++){this.combineVertex(kD[kz],e)}this.buffer.push(this.createBufferData(e));this.doOnceDraw()},preRender:function(T,i,e){},pointsParse:function(kz){var kG=kz.inner;var kB=[];for(var kA=0;kA<kG.length;kA++){var kE=kG[kA];var kC=kE.properties||{};var kD=kC.hasOwnProperty(this.base_opt.idKey)?kC[this.base_opt.idKey]:false;var T=this.evaluates(kE.properties.index,{properties:kC,id:kD});var kI=JSON.parse(JSON.stringify(cB[this.type]));if(this._appendStyle){for(var kF in this._appendStyle){kI[kF]=this._appendStyle[kF].defaultValue}}T=Object.assign(kI,T||{});if(this.base_opt.nodeBreakpoint===false&&kC.line_node_type===3){continue}if(!T.visibility){continue}var e=this._toFormatPointGeometry(kE.points,this.base_opt.coorSysMc);T.position=e;T.index=isNaN(kC.index)?kA:kC.index;T.id=isNaN(kD)||kD===false?kA:kD;if(!T.icon&&this.style_opt.iconObj&&this.style_opt.iconObj instanceof Function){var kH=this.style_opt.iconObj(T,kC);T.icon=kH.canvas;if(kH.id!==undefined){T.icon.id=this.guid+"_"+kH.id}else{T.icon.id=this.guid+"_"+T.id}}if(!kB[0]){kB[0]=[]}kB[0].push(T)}return kB},combineVertex:function(kA,e){var kz=e[e.length-1].vertex;var kB=e[e.length-1].indices;if((kz.length+14*4)>65536){e.push({vertex:[],indices:[]});kz=e[e.length-1].vertex;kB=e[e.length-1].indices}for(var T=3;T>=0;T--){kz.push(kA.position[0],kA.position[1]);if(this.style_opt.userSizes){kz.push(kA.sizes[0],kA.sizes[1],kA.anchors[0],kA.anchors[1])}else{kz.push(kA.width,kA.height,kA.anchors[0],kA.anchors[1])}kz.push(kA.scale,kA.rotation*Math.PI/180,4-T,kA.opacity);kz.push(kA.offset[0],kA.offset[1],kA.texcoord[T*2],kA.texcoord[T*2+1]);kz.push(kA.id)}var i=(kB.length/6)*4;kB.push(i,i+2,i+1,i,i+3,i+2)},createBuffer:function(i){var T=13;var e=[{name:"a_pos",components:2,offset:0,type:"Float32"},{name:"a_shape",components:4,offset:8,type:"Float32"},{name:"a_style",components:4,offset:24,type:"Float32"},{name:"a_data",components:4,offset:40,type:"Float32"},{name:"a_id",components:1,offset:56,type:"Float32"}];return new B(i,{components:T,members:e},B.BufferType.VERTEX)},createBufferData:function(kB){var kC=[];for(var T=0;T<kB.length;T++){var kA=new Float32Array(kB[T].vertex.length);kA.set(kB[T].vertex);var e=new Uint16Array(kB[T].indices.length);e.set(kB[T].indices);if(!kA||!kA.length){continue}if(!this._bufferArray[kC.length]){this._bufferArray[kC.length]={vertex:null,element1:null,vao1:null};var kz=this._bufferArray[kC.length];kz.vertex=this.createBuffer(kA);kz.element1=new B(e,{components:1},B.BufferType.ELEMENT,e.length);kz.vao1=new dY()}else{var kz=this._bufferArray[kC.length];kz.vao1.update(this.gl,kz.vertex,kA,kA.length,kz.element1,e,e.length)}kC.push(kz)}return kC},render:function(kD,kz,kC){if(!this.buffer){return}kC=kC||{};this.pickModel=kC.isPickRender||false;var T=kC.isMask===undefined?false:kC.isMask;var e=this.map._webglPainter;if(kC.renderIndex!==undefined&&this.buffer.length>kC.renderIndex){for(var kA=0;kA<this.buffer[kC.renderIndex].length;kA++){this.drawPointIcon(e,this.buffer[kC.renderIndex][kA],T)}}else{for(var kB=0;kB<this.buffer.length;kB++){for(var kA=0;kA<this.buffer[kB].length;kA++){this.drawPointIcon(e,this.buffer[kB][kA],T)}}}},drawPointIcon:function(kI,i,kC){if(i.element1&&i.element1.length===0){return}var kA=kI.gl;var kz=kI.programMgr.useProgram("pointiconlayer",{def:this.def});var kH=kI._camera._modelViewMatrixLayer;if(!kz.lastState.projMatrix){kA.uniformMatrix4fv(kz.uniforms.u_proj_matrix,false,kI.projMatrix);kz.lastState.projMatrix=true}kA.uniformMatrix4fv(kz.uniforms.u_mv_matrix,false,kH);var kB=this.map.getZoom();if(kz.lastState.mapZoom!==kB){kA.uniform1f(kz.uniforms.u_map_zoom,kB);kz.lastState.mapZoom=kB}var kG=kI._camera._far||4000;if(kz.lastState.cameraFar!==kG){kA.uniform1f(kz.uniforms.u_camera_far,kG);kz.lastState.cameraFar=kG}kA.uniform1i(kz.uniforms.u_pick_model,this.pickModel||false);var kF=[2/this.map.width,2/this.map.height];if(kz.lastState.resolutionRatio!==kF){kA.uniform2fv(kz.uniforms.u_resolution_ratio,kF);kz.lastState.resolutionRatio=kF}var kE=this.base_opt.isFlat;if(kz.lastState.isFlat!==kE){kA.uniform1i(kz.uniforms.u_flat,kE);kz.lastState.isFlat=kE}var e=this.base_opt.isFixed;if(kz.lastState.isFixed!==e){kA.uniform1i(kz.uniforms.u_fixed,e);kz.lastState.isFixed=e}var T=this.base_opt.refLevel;if(kz.lastState.refLevel!==T){kA.uniform1f(kz.uniforms.u_ref_level,T);kz.lastState.isFlat=T}if(kz.lastState.selectColor!==this.select_color){kA.uniform4fv(kz.uniforms.u_pick_color,this.select_color);kz.lastState.selectColor=this.select_color}if(kz.lastState.pickTag!==this.selectedIndex){kA.uniform1i(kz.uniforms.u_pick_tag,this.selectedIndex+1);kz.lastState.pickTag=this.selectedIndex}var kD=kI._iconTextureAtlas.getTexture();kI._state.activeTexture(kA.TEXTURE5);kA.bindTexture(kA.TEXTURE_2D,kD);if(kz.uniforms.lastSamper!==5){kA.uniform1i(kz.uniforms.u_sampler,5);kz.uniforms.lastSamper=5}i.vao1.bind(kA,kz,i.vertex,i.element1);kA.drawElements(kA.TRIANGLES,i.element1.length,kA.UNSIGNED_SHORT,0)},onDestroy:function(e,i){this.buffer=null;this._bufferArray=[];ee.prototype.onDestroy.call(this)},toString:function(){return"PointIconLayer"}});var hi=null;bG.register(function(i){if(i.config&&i.config.isOverviewMap){return}if(i.isLoaded()){M(i);hi=jF(i)}else{i.addEventListener("load",function(){M(this);hi=jF(this)})}i.cityName="中国";i.cCode="1";var e={};e.enableRequest=true;e.request=function(){if(e.enableRequest){e.enableRequest=false;setTimeout(function(){e._request()},500)}};e._request=function(){var kz=i.getBoundsIn();if(!kz){return}var kB=i.getZoom();var T=kz.getSouthWest();var kA=kz.getNorthEast();ki.request(function(kF){if(kF.current_city["code"]>=9000&&kF.current_city["code"]<=9378){kF.current_city["name"]="台湾省"}if(kF.current_city["code"]>=20000&&kF.current_city["code"]<=20499){kF.current_city["name"]="新加坡"}if(kF.current_city["code"]>=20500&&kF.current_city["code"]<=25999){kF.current_city["name"]="泰国"}if(kF.current_city["code"]>=26000&&kF.current_city["code"]<=29999){kF.current_city["name"]="日本"}if(kF.current_city["code"]>=30000&&kF.current_city["code"]<=30999){kF.current_city["name"]="韩国"}if(kF.current_city["code"]>=31000&&kF.current_city["code"]<=37000){kF.current_city["name"]="亚太"}if(kF.current_city["code"]>=46609&&kF.current_city["code"]<=52505){kF.current_city["name"]="欧洲"}if(kF.current_city["code"]>=39509&&kF.current_city["code"]<=53500){kF.current_city["name"]="南美洲"}if(kF.current_city["code"]>=54000&&kF.current_city["code"]<=70000){kF.current_city["name"]="北美洲"}if(kF.current_city["code"]===54003&&kF.current_city["code"]>=60731&&kF.current_city["code"]<=61123){kF.current_city["name"]="美国"}if(kF.current_city["code"]===54015||kF.current_city["code"]>=57970&&kF.current_city["code"]<=60223){kF.current_city["name"]="加拿大"}if(kF.current_city["code"]===54025||kF.current_city["code"]>=54338&&kF.current_city["code"]<=57374){kF.current_city["name"]="墨西哥"}e.enableRequest=true;if(kF&&kF.current_city){var kE=kF.current_city["name"];var kD=kF.current_city["code"];if(kD!==i.cCode){var kC=new fW("oncitychange");kC.name=kE;kC.code=kD;i.dispatchEvent(kC)}i.cityName=kE;i.cCode=kD;if(!b5()){da(i)}}},{qt:"cen",b:T.lng+","+T.lat+";"+kA.lng+","+kA.lat,l:kB},"","",true)};i.addEventListener("load",function(T){e.request()});i.addEventListener("moveend",function(T){e.request()});i.addEventListener("zoomend",function(T){e.request()});e.request()});function jF(T){var e={};var i=new kg(e);T.addControl(i);return i}function M(i){if(i.temp.copyadded){return}i.temp.copyadded=true;if(!i.cpyCtrl){var kz=new jm(2,2);i.config.cpyCtrlOffset=kz;if(b5()){kz.width=72;kz.height=0}var T=new gm({offset:kz,printable:true});i.cpyCtrl=T}if(!b5()){da(i);i.addEventListener("maptypechange",function(){da(i)})}i.addControl(T);var e=new bJ();e._opts={printable:true};i.logoCtrl=e;i.addControl(e);i.addEventListener("resize",function(){if(this.getSize().width>=300&&i.getSize().height>=100){e.show();T&&T.setOffset(i.config.cpyCtrlOffset)}else{e.hide();T&&T.setOffset(new jm(4,2))}});if(i.getSize().width>=300&&i.getSize().height>=100){e.show()}else{e.hide();T.setOffset(new jm(4,2))}i.addEventListener("oncopyrightoffsetchange",function(kA){i.logoCtrl.setOffset(kA.target.logo);i.cpyCtrl.setOffset(kA.target.cpy)});i.dispatchEvent(new fW("oncopyrightaddend"))}function da(kO){if(!kO.cpyCtrl){var kW=new jm(2,2);if(b5()){kW.width=72;kW.height=0}var kR=new gm({offset:kW,printable:true});kO.cpyCtrl=kR}var k5=kO.cityName||"中国";var kP=kO.getMapType();var kQ=["常州市","南昌市","乌鲁木齐市","无锡市","福州市","泉州市","珠海市","贵阳市"];var kI=["北京市","上海市","广州市","深圳市","宁波市","石家庄市","沈阳市","长春市","青岛市","温州市","台州市","金华市","佛山市","中山市","昆明市","南宁市","苏州市","西安市","济南市","郑州市","合肥市","呼和浩特市","杭州市","成都市","武汉市","长沙市","天津市","南京市","重庆市","大连市","东莞市","厦门市"];var kK=["香港特别行政区"];var kE=["台湾省"];var kX=["日本"];var k3=["韩国"];var kS=["泰国"];var kV=["亚太"];var kF=["新加坡"];var k4=["欧洲"];var kz=["南美洲"];var k0=["北美洲"];var T=["美国"];var kU=["墨西哥"];var kC=["加拿大"];for(var k1 in kQ){if(kQ[k1]===k5){var kL=true;break}}for(var k1 in kI){if(kI[k1]===k5){var kA=true;break}}for(var k1 in kK){if(kK[k1]===k5){var k7=true;break}}if(kE[0]===k5){var kZ=true}if(kF[0]===k5){var i=true}if(kX[0]===k5){var kH=true}if(k3[0]===k5){var kN=true}if(kS[0]===k5){var kM=true}if(kV[0]===k5){var kD=true}if(k4[0]===k5){var kJ=true}if(kz[0]===k5){var kG=true}if(k0[0]===k5){var e=true}if(T[0]===k5){var k2=true}if(kC[0]===k5){var kY=true}if(kU[0]===k5){var kB=true}var k6=["&copy;&nbsp;2024 Baidu - GS(2023)3206号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "];var kT="rgba(255, 255, 255, 0.701961)";if(kO.getZoom()<=9){k6=["&copy;&nbsp;2024 Baidu - GS(2023)3206号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "]}else{if(kZ){k6=["&copy;&nbsp;2024 Baidu - GS(2023)3206号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "]}else{if(kH||kN){k6=["&copy;&nbsp;2024 Baidu - GS(2023)3206号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "]}else{if(i||kM){k6=["&copy;&nbsp;2024 Baidu - GS(2023)3206号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "]}else{if(kD){k6=["&copy;&nbsp;2024 Baidu - GS(2023)3206号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "]}else{if(kJ){k6=["&copy;&nbsp;2024 Baidu - GS(2023)3206号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "]}else{if(kG){k6=["&copy;&nbsp;2024 Baidu - GS(2023)3206号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "]}else{if(e){k6=["&copy;&nbsp;2024 Baidu - GS(2023)3206号 - 甲测资字11111342 - 京ICP证030173号 - Data &copy; "]}}}}}}}}if(kO.getZoom()<=9){k6.push("百度智图");k6.push(' &amp; <a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>');k6.push(' &amp; <a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>');if(kP===BMAP_SATELLITE_MAP||kP===BMAP_HYBRID_MAP){k6.push(' &amp; <a target="_blank" href="http://www.eso.org/public/">ESO</a>');kT="rgba(0,0,0,.7)"}}else{if(kH||kN){k6.push('<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>')}else{if(i||kM){k6.push('<a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>')}else{if(kD){k6.push('<a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>');k6.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{if(kJ){k6.push('<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>');k6.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{if(kG){k6.push('<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>');k6.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{if(k2||kB||kY){k6.push('<a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>');k6.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{if(e){k6.push('<a target="_blank" href="http://www.openstreetmap.org/">OpenStreetMap</a>');k6.push(' &amp; <a target="_blank" href="https://www.mapbox.com/">Mapbox</a>')}else{k6.push("百度智图");if(kL){k6.push(' &amp; <a target="_blank" href="http://www.palmcity.cn/palmcity/">PalmCity</a>')}if(k7){k6.push(' &amp; <a target="_blank" href="http://www.mapking.com/HongKong/eng/home/MapKing_Webmap.html">MapKing</a>')}if(kZ){k6.push(' &amp; <a target="_blank" href="http://corporate.navteq.com/supplier_terms.html">HERE</a>');k6.push(' &amp; <a target="_blank" href="http://www.localking.com.tw/about/localking.aspx">樂客LocalKing</a>')}if(kP===BMAP_SATELLITE_MAP||kP===BMAP_HYBRID_MAP){kT="rgba(0,0,0,.7)"}}}}}}}}}k6.unshift('<span style="background: '+kT+';padding: 0px 1px;line-height: 16px;display: inline;height: 16px;">');k6.push("</span>");k6=k6.join("");kO.cpyCtrl.addCopyright({id:1,content:k6})}function kg(e){this["defaultAnchor"]=BMAP_ANCHOR_TOP_RIGHT;this["defaultOffset"]=e.defaultOffset||new jm(90,6);this._cZIndex=9999;this._visible=false}kg.prototype=new gY();kg.prototype.initialize=function(kA){this._map=kA;var kz=this;var e=b6("div");var i=e.style;i.left=i.top="50%";i.display="none";i.padding="24px";i.overflow="visible";i.position="absolute";i.width="50%";i.maxWidth="360px";i.transform="translate(-50% , -50%)";i.zIndex="9999";i.background="#fff";i.userSelect="none";var kB=b6("span",{style:"margin-top: 12px;\n    margin-bottom: -12px;\n    margin-left: calc(100% - 48px);\n    width: 56px;\n    height: 32px;\n    font-size: 14px;\n    text-align: center;\n    line-height: 32px;\n    display: block;\n    cursor: pointer;\n    background: #3894FF;\n    border: solid 1px #3f51b53b;\n    color: #fff;\n    border-radius: 3px;"});kB.innerText="确定";kB.addEventListener("click",function(){kz.hide()});var T=b6("div");var kC=T.style;kC.position="relative";kC.width="100%";kC.height="100%";kC.color="#000";kC.fontSize="14px";kC.wordBreak="break-all";e.appendChild(T);e.appendChild(kB);kA.getContainer().appendChild(e);return e};kg.prototype._setPosition=function(){};kg.prototype.update=function(e){if(!this.isVisible()){this._container.firstChild.innerText=e;this.show()}};window.BMAP_STATUS_SUCCESS=0;window.BMAP_STATUS_CITY_LIST=1;window.BMAP_STATUS_UNKNOWN_LOCATION=2;window.BMAP_STATUS_UNKNOWN_ROUTE=3;window.BMAP_STATUS_INVALID_KEY=4;window.BMAP_STATUS_INVALID_REQUEST=5;window.BMAP_STATUS_PERMISSION_DENIED=6;window.BMAP_STATUS_SERVICE_UNAVAILABLE=7;window.BMAP_STATUS_TIMEOUT=8;window.BMAP_ROUTE_TYPE_WALKING=2;window.BMAP_ROUTE_TYPE_DRIVING=3;window.BMAP_ROUTE_TYPE_RIDING=6;window.BMAP_ROUTE_STATUS_NORMAL=0;window.BMAP_ROUTE_STATUS_EMPTY=1;window.BMAP_ROUTE_STATUS_ADDRESS=2;var D="carport_list";var d4="carport_auth";var dn="cur";var ac="cen";var L="s";var dG="con";var dy="bd";var c0="nb";var hh="bt";var aR="nav";var iu="walk";var f5="gc";var d7="rgc";var N="dec";var iL="iploc";var gZ="bse";var gu="nse";var dk="s";var ez="bsl";var f2="bda";var ew="sa";var be="nba";var iB="drag";var jn="ext";var j1="exts";var j4="hip";var hT="ride";var kf="drct";var ca="ldt";var fB=2;var bn=4;var gc=7;var iC=11;var ch=12;var e4=14;var cX=15;var en=18;var aD=20;var bd=21;var K=19;var a=23;var iX=26;var aF=28;var gv=31;var fg=35;var iM=44;var bl=45;var aA=46;var jZ=47;var gA=-1;var bh=0;var bF=1;var js=2;var dW=3;window.BMAP_POI_TYPE_NORMAL=0;var cK=1;var iE=2;BMapGL.I=e9.I;var bP={};bP.removeHtml=function(e){e=e.replace(/<\/?[^>]*>/g,"");e=e.replace(/[ | ]* /g," ");return e};bP.parseGeoExtReg1=function(e){return e.replace(/([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0|[1-9]\d*),([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0|[1-9]\d*)(,)/g,"$1,$2;")};bP.parseGeoExtReg2=function(i,e){var T=new RegExp("(((-?\\d+)(\\.\\d+)?),((-?\\d+)(\\.\\d+)?);)(((-?\\d+)(\\.\\d+)?),((-?\\d+)(\\.\\d+)?);){"+e+"}","ig");return i.replace(T,"$1")};var dO=0;var dm=1;var W=2;bP.unique=function(T){var kB=false;var kA=[];var kC={};for(var kz=0,e=T.length;kz<e;kz++){if(!kC[T[kz]]){kC[T[kz]]=true;kA.push(T[kz])}}return kA};bP.getBestLevel=function(T,i){if(i){var e=Math.min(i.width/1100,i.height/660);T=Math.round(T+(Math.log(e)/Math.log(2)))}if(T<1){T=1}if(T>21){T=21}return T};bP.parseGeo=function(kC,kF){if(typeof kC!="string"||!kC){return}var kH=kC.split("|");var e;var kA;var T;if(kH.length==1){e=cb(kC)}else{e=cb(kH[2]);kA=cb(kH[0]);T=cb(kH[1]);if(!kF){return e}}var kD={type:e.geoType};if(kF){switch(kD.type){case W:var kE=new cG(e.geo[0][0],e.geo[0][1]);var kG=jv.convertMC2LL(kE);kD.point=kG;kD.points=[kG];break;case dm:kD.points=[];var kI=e.geo[0];for(var kB=0,kz=kI.length-1;kB<kz;kB+=2){var kJ=new cG(kI[kB],kI[kB+1]);kJ=jv.convertMC2LL(kJ);kD.points.push(kJ)}kA=new cG(kA.geo[0][0],kA.geo[0][1]);T=new cG(T.geo[0][0],T.geo[0][1]);kA=jv.convertMC2LL(kA);T=jv.convertMC2LL(T);kD.bounds=new ij(kA,T);break;default:break}}return kD};bP.parseGeoExt=function(kS,kJ){if(!kJ){kJ=0}else{if(kJ<0.25){kJ=0}else{if(kJ>0.25&&kJ<1){kJ=1}else{if(kJ>32){kJ=32}}}}var kE=kS.split("|");if(kE.length==1){var kz=cb(kE[0]);return{type:kz.type,bound:"",points:kz.geo.join(",")}}else{if(kE.length>1){var kK=kS.split(";.=");var kG=[];var kA=[];var kL=0;var kP=kK.length;for(var kM=0;kM<kP;kM++){var kR=kK[kM];if(kP>1){if(kM==0){kR=kR+";"}if(kM>0&&kM<kP-1){kR=".="+kR+";"}if(kM==kP-1){kR=".="+kR}}var kB=kR.split("|");var kO=cb(kB[0]);var kN=cb(kB[1]);kG.push(kO.geo.join(","));kG.push(kN.geo.join(","));var kz=cb(kB[2]);kL=kz.type;var kQ=kz.geo.join(",");kQ=bP.parseGeoExtReg1(kQ);if(kJ>0){kQ=bP.parseGeoExtReg2(kQ,kJ)}kA.push(kQ)}if(kP<=1){kA=kA.join(";")}if(kP==2){var T=kA[0]+";"+kA[1];var kC=T.split(";");var e=[];for(var kM=0;kM<kC.length;kM++){var kF=kC[kM].split(",")[0];var kD=kC[kM].split(",")[1];var kH=new cG(kF,kD);var kI=jv.convertMC2LL(kH);e.push(kI)}kA=e}return{type:kL,bound:kG.join(";"),points:kA}}}};bP.getPoiPoint=function(e){var T=[];var i=null;if(e.toString()=="Point"){i=e}else{if(typeof e=="string"){T=e9.trim(e).split(",");if(T.length<2){return}T[0]=parseFloat(e9.trim(T[0]));T[1]=parseFloat(e9.trim(T[1]))}else{T=e.slice(0);if(T.length<2){return}}i=new BMap.Point(T[0],T[1])}return i};bP.parseGeoStr=function(T){var i=T.split(",");var e=new cG(i[0],i[1]);return jv.convertMC2LL(e)};bP.level={country:4,province:11,city:12,area:13};var hv=["=",".","-","*"];var di=1<<23;function cb(kF){var kE=ie(kF.charAt(0));var T=kF.substr(1);var kH=0;var e=T.length;var kI=[];var kC=[];var kD=[];while(kH<e){if(T.charAt(kH)==hv[0]){if((e-kH)<13){return 0}kD=em(T.substr(kH,13),kI);if(kD<0){return 0}kH+=13}else{if(T.charAt(kH)==";"){kC.push(kI.slice(0));kI.length=0;++kH}else{if((e-kH)<8){return 0}kD=cn(T.substr(kH,8),kI);if(kD<0){return 0}kH+=8}}}for(var kB=0,kz=kC.length;kB<kz;kB++){for(var kA=0,kG=kC[kB].length;kA<kG;kA++){kC[kB][kA]/=100}}return{geoType:kE,geo:kC}}function ie(i){var e=-1;if(i==hv[1]){e=W}else{if(i==hv[2]){e=dm}else{if(i==hv[3]){e=dO}}}return e}function em(kA,T){var e=0;var kC=0;var kB=0;for(var kz=0;kz<6;kz++){kB=dF(kA.substr(1+kz,1));if(kB<0){return -1-kz}e+=kB<<(6*kz);kB=dF(kA.substr(7+kz,1));if(kB<0){return -7-kz}kC+=kB<<(6*kz)}T.push(e);T.push(kC);return 0}function cn(kB,kz){var T=kz.length;if(T<2){return -1}var e=0;var kD=0;var kC=0;for(var kA=0;kA<4;kA++){kC=dF(kB.substr(kA,1));if(kC<0){return -1-kA}e+=kC<<(6*kA);kC=dF(kB.substr(4+kA,1));if(kC<0){return -5-kA}kD+=kC<<(6*kA)}if(e>di){e=di-e}if(kD>di){kD=di-kD}kz.push(kz[T-2]+e);kz.push(kz[T-1]+kD);return 0}function dF(i){var e=i.charCodeAt(0);if(i>="A"&&i<="Z"){return e-"A".charCodeAt(0)}else{if(i>="a"&&i<="z"){return(26+e-"a".charCodeAt(0))}else{if(i>="0"&&i<="9"){return(52+e-"0".charCodeAt(0))}else{if(i=="+"){return 62}else{if(i=="/"){return 63}}}}}return -1}bP.pathToPoints=function(kB){var kz=[];if(typeof kB!=="string"){return kz}else{var kA=kB.split(";");for(var T=0;T<kA.length;T++){var e=kA[T].split(",");kz.push(new cG(e[0],e[1]))}}return kz};bP.pointsToString=function(kA){var kz="";if(typeof kA!=="object"){return kA}else{for(var T=0;T<kA.length;T++){var e=kA[T].lat+","+kA[T].lng;if(T!==kA.length-1){kz=kz+e+"|"}else{kz=kz+e}}}return kz};bP.stringToPoints=function(kB){var kz=[];if(typeof kB!=="string"||!kB){return kz}else{var kA=kB.split("|");for(var T=0;T<kA.length;T++){var e=kA[T].split(",");kz.push(new cG(e[1],e[0]))}}return kz};window.BMAP_POI_TYPE_NORMAL=0;window.BMAP_POI_TYPE_BUSSTOP=1;window.BMAP_POI_TYPE_BUSLINE=2;window.BMAP_POI_TYPE_SUBSTOP=3;window.BMAP_POI_TYPE_SUBLINE=4;var U=0;var hY=1;var fQ={};window.APIPack=fQ;function aK(i,e){dh.call(this);this._loc={};this.setLocation(i);e=e||{};e.renderOptions=e.renderOptions||{};this._opts={renderOptions:{panel:e.renderOptions.panel||null,map:e.renderOptions.map||null,autoViewport:e.renderOptions.autoViewport||true,selectFirstResult:e.renderOptions.selectFirstResult,highlightMode:e.renderOptions.highlightMode,enableDragging:e.renderOptions.enableDragging||false,lineLayerStyle:e.renderOptions.lineLayerStyle||{},},onSearchComplete:e.onSearchComplete||function(){},onMarkersSet:e.onMarkersSet||function(){},onInfoHtmlSet:e.onInfoHtmlSet||function(){},onResultsHtmlSet:e.onResultsHtmlSet||function(){},onGetBusListComplete:e.onGetBusListComplete||function(){},onGetBusLineComplete:e.onGetBusLineComplete||function(){},onBusListHtmlSet:e.onBusListHtmlSet||function(){},onBusLineHtmlSet:e.onBusLineHtmlSet||function(){},onPolylinesSet:e.onPolylinesSet||function(){},reqFrom:e.reqFrom||""};if(typeof e!="undefined"&&typeof e.renderOptions!="undefined"&&typeof e.renderOptions["autoViewport"]!="undefined"){this._opts.renderOptions.autoViewport=e.renderOptions["autoViewport"]}else{this._opts.renderOptions.autoViewport=true}this._opts.renderOptions.panel=e9.G(this._opts.renderOptions.panel)}aK.inherits(dh,"BaseSearch");e9.extend(aK.prototype,{getResults:function(){if(!this._isMultiKey){return this._results}else{return this._arrResults}},enableAutoViewport:function(){this._opts.renderOptions.autoViewport=true},disableAutoViewport:function(){this._opts.renderOptions.autoViewport=false},setLocation:function(e){if(!e){return}this._loc.src=e},setSearchCompleteCallback:function(e){this._opts.onSearchComplete=e||function(){}},setMarkersSetCallback:function(e){this._opts.onMarkersSet=e||function(){}},setPolylinesSetCallback:function(e){this._opts.onPolylinesSet=e||function(){}},setInfoHtmlSetCallback:function(e){this._opts.onInfoHtmlSet=e||function(){}},setResultsHtmlSetCallback:function(e){this._opts.onResultsHtmlSet=e||function(){}},getStatus:function(){return this._status}});var cJ=function(kz,i){aK.call(this,kz,i);i=i||{};i.renderOptions=i.renderOptions||{};this.setPageCapacity(i.pageCapacity);if(typeof i.renderOptions["selectFirstResult"]!="undefined"&&!i.renderOptions["selectFirstResult"]){this.disableFirstResultSelection()}else{this.enableFirstResultSelection()}this._overlays=[];this._arrPois=[];this._curIndex=-1;this._queryList=[];var e=this;hl.load("localSearch",function(){e._check()},true);if(i.renderOptions["map"]){var T=i.renderOptions["map"];T.on("destroy",function(){delete e})}};cJ.inherits(aK,"LocalSearch");cJ.DEFAULT_PAGE_CAPACITY=10;cJ.MIN_PAGE_CAPACITY=1;cJ.MAX_PAGE_CAPACITY=100;cJ.DEFAULT_RADIUS=2000;cJ.MAX_RADIUS=100000;e9.extend(cJ.prototype,{search:function(e,i){this._queryList.push({method:"search",arguments:[e,i]});hP.sendMessage(a1(4,4,6,1),["service","poi","normal"])},searchInBounds:function(e,T,i){this._queryList.push({method:"searchInBounds",arguments:[e,T,i]});hP.sendMessage(a1(4,4,6,2),["service","poi","bound"])},searchNearby:function(T,i,e,kz){this._queryList.push({method:"searchNearby",arguments:[T,i,e,kz]});hP.sendMessage(a1(4,4,6,3),["service","poi","circle"])},clearResults:function(){delete this._json;delete this._status;delete this._results;delete this._ud;this._curIndex=-1;this._setStatus();if(this._opts.renderOptions.panel){this._opts.renderOptions.panel.innerHTML=""}},gotoPage:function(){},enableFirstResultSelection:function(){this._opts.renderOptions.selectFirstResult=true},disableFirstResultSelection:function(){this._opts.renderOptions.selectFirstResult=false},setPageCapacity:function(e){if(typeof e=="number"&&!isNaN(e)){this._opts.pageCapacity=e<1?cJ.DEFAULT_PAGE_CAPACITY:(e>cJ.MAX_PAGE_CAPACITY?cJ.DEFAULT_PAGE_CAPACITY:e)}else{this._opts.pageCapacity=cJ.DEFAULT_PAGE_CAPACITY}},getPageCapacity:function(){return this._opts.pageCapacity},toString:function(){return"LocalSearch"}});function bo(i){this._opts={};e9.extend(this._opts,i);this._queryList=[];var e=this;hl.load("otherSearch",function(){e._asyncSearch()})}bo.inherits(dh,"Geocoder");e9.extend(bo.prototype,{getPoint:function(e,T,i){this._queryList.push({method:"getPoint",arguments:[e,T,i]})},getLocation:function(e,T,i){this._queryList.push({method:"getLocation",arguments:[e,T,i]})},toString:function(){return"Geocoder"}});function c5(e){e=e||{};this.config={timeout:e.timeout||1000*10,maximumAge:e.maximumAge||0,enableHighAccuracy:e.enableHighAccuracy===undefined?true:e.enableHighAccuracy,SDKLocation:e.SDKLocation||false};this._pendingCalls=[];var i=this;hl.load("otherSearch",function(){var T=i._pendingCalls.length;for(var kz=0;kz<T;kz++){var kA=i._pendingCalls[kz];i[kA.method].apply(i,kA.arguments)}})}e9.extend(c5.prototype,{getCurrentPosition:function(e,i){this._pendingCalls.push({method:"getCurrentPosition",arguments:arguments})},getStatus:function(){return BMAP_STATUS_UNKNOWN_LOCATION},enableSDKLocation:function(){if(b5()){this.config.SDKLocation=true}},disableSDKLocation:function(){this.config.SDKLocation=false}});function fx(){this._queryList=[];var e=this;hl.load("otherSearch",function(){e._asyncSearch()})}fx.inherits(dh,"Boundary");e9.extend(fx.prototype,{get:function(i,e){this._queryList.push({method:"get",arguments:[i,e]})},toString:function(){return"Boundary"},parsebdStr:function(i,e){}});function fq(i){i=i||{};i.renderOptions=i.renderOptions||{};this._opts={renderOptions:{map:i.renderOptions.map||null}};this._queryList=[];var e=this;hl.load("otherSearch",function(){e._asyncSearch()})}fq.inherits(dh,"LocalCity");e9.extend(fq.prototype,{get:function(e){this._queryList.push({method:"get",arguments:[e]})},toString:function(){return"LocalCity"}});function hy(e,T){dh.call(this);this.markersList=[];this.destList=[];this.pointsList=[];this._opts=T;this.json=e;this.map=this._opts.renderOptions.map||null;this.sType=this._opts.sType;this.infoWindow=null;this.curPointIndex=0;this.startName="";this.endIndex=1;this.endName="";this.resCity=[0,0,0,0,0,0,0];this.locPois=[];this.curPageIndex=[1,1,1,1,1,1,1];this.totalPage=[1,1,1,1,1,1,1];this.resCount=[0,0,0,0,0,0,0];this.resType=[0,0,0,0,0,0,0];this.qInfo=[{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1},{n:"",c:0,u:0,x:0,y:0,t:-1}];this.curSelectedIndex=-1;this.tpList=[];this.tpListInMap=[];var i=this;hl.load("route",function(){})}hy.inherits(dh,"RouteAddr");function eJ(T,i){aK.call(this,T,i);this.QUERY_TYPE_BUSLIST=dk;this.RETURN_TYPE_BUSLIST=cX;this.QUERY_TYPE_BUSLINE=ez;this.RETURN_TYPE_BUSLINE=en;this._queryList=[];var e=this;hl.load("buslineSearch",function(){e._asyncSearch()})}var fO=E.staticHost+"/wolfman/static/common/images/";eJ._iconOpen=E.apiIMG+"/iw_plus.gif";eJ._iconClose=E.apiIMG+"/iw_minus.gif";eJ._stopUrl=fO+"new/bus-stop-1x_ddd4723.png";eJ.inherits(aK,"BusLineSearch");e9.extend(eJ.prototype,{getBusList:function(e){this._queryList.push({method:"getBusList",arguments:[e]})},getBusLine:function(e){this._queryList.push({method:"getBusLine",arguments:[e]})},setGetBusListCompleteCallback:function(e){this._opts.onGetBusListComplete=e||function(){}},setGetBusLineCompleteCallback:function(e){this._opts.onGetBusLineComplete=e||function(){}},setBusListHtmlSetCallback:function(e){this._opts.onBusListHtmlSet=e||function(){}},setBusLineHtmlSetCallback:function(e){this._opts.onBusLineHtmlSet=e||function(){}},setPolylinesSetCallback:function(e){this._opts.onPolylinesSet=e||function(){}}});function jo(i){aK.call(this,i);i=i||{};this._options={input:i.input||null,showSuggestion:i.showSuggestion===undefined?true:i.showSuggestion,baseDom:i.baseDom||null,types:i.types||[],onSearchComplete:i.onSearchComplete||function(){}};this._loc.src=i.location||"全国";this._word="";this._show=false;this._suggestion=null;this._inputValue="";this._initialize();var e=this;hl.load("autocomplete",function(){e._asyncSearch()},true)}jo.inherits(aK,"Autocomplete");e9.extend(jo.prototype,{_initialize:function(){},show:function(){this._show=true},hide:function(){this._show=false},setTypes:function(e){this._options.types=e},setLocation:function(e){this._loc.src=e},search:function(e){this._word=e},setInputValue:function(e){this._inputValue=e},setSearchCompleteCallback:function(e){this._options.onSearchComplete=e}});var j6=function(i,e){aK.call(this,i,e)};e9.inherit(j6,aK,"BaseRoute");e9.extend(j6.prototype,{clearResults:function(){}});window.BMAP_TRANSIT_POLICY_RECOMMEND=0;window.BMAP_TRANSIT_POLICY_LEAST_TIME=4;window.BMAP_TRANSIT_POLICY_LEAST_TRANSFER=1;window.BMAP_TRANSIT_POLICY_LEAST_WALKING=2;window.BMAP_TRANSIT_POLICY_AVOID_SUBWAYS=3;window.BMAP_TRANSIT_POLICY_FIRST_SUBWAYS=5;window.BMAP_LINE_TYPE_BUS=0;window.BMAP_LINE_TYPE_SUBWAY=1;window.BMAP_LINE_TYPE_FERRY=2;window.BMAP_LINE_TYPE_TRAIN=3;window.BMAP_LINE_TYPE_AIRPLANE=4;window.BMAP_LINE_TYPE_COACH=5;var iF=3;var el=4;var aj=1;var iD=2;var a0=5;var cZ=6;window.BMAP_TRANSIT_TYPE_IN_CITY=0;window.BMAP_TRANSIT_TYPE_CROSS_CITY=1;window.BMAP_TRANSIT_PLAN_TYPE_ROUTE=0;window.BMAP_TRANSIT_PLAN_TYPE_LINE=1;window.BMAP_TRANSIT_TYPE_POLICY_TRAIN=0;window.BMAP_TRANSIT_TYPE_POLICY_AIRPLANE=1;window.BMAP_TRANSIT_TYPE_POLICY_COACH=2;window.BMAP_INTERCITY_POLICY_LEAST_TIME=0;window.BMAP_INTERCITY_POLICY_EARLY_START=1;window.BMAP_INTERCITY_POLICY_CHEAP_PRICE=2;function eY(T,i){j6.call(this,T,i);i=i||{};this.setPolicy(i.policy);this.setIntercityPolicy(i.intercityPolicy);this.setTransitTypePolicy(i.transitTypePolicy);this.setPageCapacity(i.pageCapacity);this.QUERY_TYPE=hh;this.RETURN_TYPE=e4;this.ROUTE_TYPE=hY;this._overlays=[];this._curIndex=-1;this._opts._enableTraffic=i.enableTraffic||false;this._queryList=[];var e=this;hl.load("route",function(){e._asyncSearch()},true)}eY.MAX_PAGE_CAPACITY=100;eY.LINE_TYPE_MAPPING=[0,1,0,0,0,0,0,0,2,0,0,0,1,1,1];eY.LINE_TYPE_MAPPING_CROSS_CITY=[0,3,4,0,0,0,5];e9.inherit(eY,j6,"TransitRoute");e9.extend(eY.prototype,{setPolicy:function(e){if(e>=BMAP_TRANSIT_POLICY_RECOMMEND&&e<=BMAP_TRANSIT_POLICY_FIRST_SUBWAYS){this._opts.policy=e}else{this._opts.policy=BMAP_TRANSIT_POLICY_RECOMMEND}},setIntercityPolicy:function(e){if(e>=BMAP_INTERCITY_POLICY_LEAST_TIME&&e<=BMAP_INTERCITY_POLICY_CHEAP_PRICE){this._opts.intercityPolicy=e}else{this._opts.intercityPolicy=BMAP_INTERCITY_POLICY_LEAST_TIME}},setTransitTypePolicy:function(e){if(e>=BMAP_TRANSIT_TYPE_POLICY_TRAIN&&e<=BMAP_TRANSIT_TYPE_POLICY_COACH){this._opts.transitTypePolicy=e}else{this._opts.transitTypePolicy=BMAP_TRANSIT_TYPE_POLICY_TRAIN}},_internalSearch:function(i,e){this._queryList.push({method:"_internalSearch",arguments:[i,e]})},search:function(i,e){this._queryList.push({method:"search",arguments:[i,e]})},setPageCapacity:function(e){if(typeof e==="string"){e=parseInt(e,10);if(isNaN(e)){this._opts.pageCapacity=eY.MAX_PAGE_CAPACITY;return}}if(typeof e!=="number"){this._opts.pageCapacity=eY.MAX_PAGE_CAPACITY;return}if(e>=1&&e<=eY.MAX_PAGE_CAPACITY){this._opts.pageCapacity=Math.round(e)}else{this._opts.pageCapacity=eY.MAX_PAGE_CAPACITY}},toString:function(){return"TransitRoute"},_shortTitle:function(e){return e.replace(/\(.*\)/,"")}});window.BMAP_HIGHLIGHT_STEP=1;window.BMAP_HIGHLIGHT_ROUTE=2;var cO=function(e,kz){j6.call(this,e,kz);this._overlays=[];this._curIndex=-1;this._queryList=[];var T=this;var i=this._opts.renderOptions;if(i.highlightMode!==BMAP_HIGHLIGHT_STEP&&i.highlightMode!==BMAP_HIGHLIGHT_ROUTE){i.highlightMode=BMAP_HIGHLIGHT_STEP}this._enableDragging=this._opts.renderOptions.enableDragging?true:false;hl.load("route",function(){T._asyncSearch()},true);if(this.init_d){this.init_d()}};cO.ROAD_TYPE=["","环岛","无属性道路","主路","高速连接路","交叉点内路段","连接道路","停车场内部道路","服务区内部道路","桥","步行街","辅路","匝道","全封闭道路","未定义交通区域","POI连接路","隧道","步行道","公交专用道","提前右转道"];e9.inherit(cO,j6,"DWRoute");e9.extend(cO.prototype,{search:function(T,e,i){this._queryList.push({method:"search",arguments:[T,e,i]})}});var i5=function(e,T){j6.call(this,e,T);this._overlays=[];this._queryList=[];var i=this;this.map=T.renderOptions.map;this._enableDragging=this._opts.renderOptions.enableDragging?true:false;this._lineLayerStyle={lineLayerColor:this._opts.renderOptions.lineLayerStyle.lineLayerColor||{color:"#0089ff",opacity:1},showTraffic:this._opts.renderOptions.lineLayerStyle.showTraffic||false,sequence:this._opts.renderOptions.sequence||true,marginLength:this._opts.renderOptions.marginLength||32,borderColor:this._opts.renderOptions.lineLayerStyle.borderColor||"#0089ff",borderMask:this._opts.renderOptions.lineLayerStyle.borderMask||false,borderWeight:this._opts.renderOptions.lineLayerStyle.borderWeight||2,strokeWeight:this._opts.renderOptions.lineLayerStyle.strokeWeight||6,strokeLineJoin:this._opts.renderOptions.lineLayerStyle.strokeLineJoin||"round",strokeLineCap:this._opts.renderOptions.lineLayerStyle.strokeLineCap||"round",strokeTextureUrl:E.bosPath+"up-to.png",strokeTextureWidth:this._opts.renderOptions.lineLayerStyle.strokeTextureWidth||32,strokeTextureHeight:this._opts.renderOptions.lineLayerStyle.strokeTextureHeight||64,};if(this._opts.renderOptions.lineLayerStyle.strokeTextureUrl){this._lineLayerStyle.strokeTextureUrl=this._opts.renderOptions.lineLayerStyle.strokeTextureUrl}else{if(this._opts.renderOptions.lineLayerStyle.strokeTextureUrl===null){delete this._lineLayerStyle.strokeTextureUrl}}this._menu=new BMapGL.ContextMenu();this._menu.addItem(new ih("删除该点",function(kB,kA,kz){i._deleteVia(kz.curNo-1)},60));this.map.addContextMenu(this._menu,true);hl.load("route",function(){i._asyncSearch()},true);if(this.init_d){this.init_d()}};e9.inherit(i5,j6,"LineLayerRoute");e9.extend(i5.prototype,{search:function(T,e,i){this._queryList.push({method:"search",arguments:[T,e,i]})}});window.BMAP_DRIVING_POLICY_DEFAULT=0;window.BMAP_DRIVING_POLICY_DESTANCE=2;window.BMAP_DRIVING_POLICY_AVOID_HIGHWAYS=3;window.BMAP_DRIVING_POLICY_FIRST_HIGHWAYS=4;window.BMAP_DRIVING_POLICY_AVOID_CONGESTION=5;window.BMAP_DRIVING_POLICY_AVOID_PAY=6;window.BMAP_DRIVING_POLICY_HIGHWAYS_AVOID_CONGESTION=7;window.BMAP_DRIVING_POLICY_AVOID_HIGHWAYS_CONGESTION=8;window.BMAP_DRIVING_POLICY_AVOID_CONGESTION_PAY=9;window.BMAP_DRIVING_POLICY_AVOID_HIGHWAYS_CONGESTION_PAY=10;window.BMAP_DRIVING_POLICY_AVOID_HIGHWAYS_PAY=11;window.BMAP_TRAFFICE_STATUS_NONE=0;window.BMAP_TRAFFICE_STATUS_NORMAL=1;window.BMAP_TRAFFICE_STATUS_SLOW=2;window.BMAP_TRAFFICE_STATUS_JAM=3;function cz(e,i){cO.call(this,e,i);i=i||{};this._opts._enableTraffic=i.enableTraffic||false;this.setPolicy(i.policy);this.alternatives=i.alternatives||0;this.QUERY_TYPE=aR;this.RETURN_TYPE=aD;this.ROUTE_TYPE=BMAP_ROUTE_TYPE_DRIVING;hP.sendMessage(a1(4,4,1,1),["service","drive","overlay"])}function ge(e,i){i5.call(this,e,i);i=i||{};this.setPolicy(i.policy);this.alternatives=i.alternatives||0;this.QUERY_TYPE=aR;hP.sendMessage(a1(4,4,1,2),["service","drive","layer"])}e9.inherit(ge,i5,"DrivingRouteLine");e9.inherit(cz,cO,"DrivingRoute");cz.prototype.setPolicy=function(e){if(e>=BMAP_DRIVING_POLICY_DEFAULT&&e<=BMAP_DRIVING_POLICY_AVOID_HIGHWAYS_PAY){this._opts.policy=e}else{this._opts.policy=BMAP_DRIVING_POLICY_DEFAULT}};ge.prototype.setPolicy=function(e){if(e>=BMAP_DRIVING_POLICY_DEFAULT&&e<=BMAP_DRIVING_POLICY_AVOID_HIGHWAYS_PAY){this._opts.policy=e}else{this._opts.policy=BMAP_DRIVING_POLICY_DEFAULT}};function fC(e,i){cO.call(this,e,i);this.QUERY_TYPE=iu;this.RETURN_TYPE=gv;this.ROUTE_TYPE=BMAP_ROUTE_TYPE_WALKING;this._enableDragging=false;hP.sendMessage(a1(4,4,4),["service","walk"])}e9.inherit(fC,cO,"WalkingRoute");function dd(e,i){cO.call(this,e,i);this.QUERY_TYPE=hT;this.ROUTE_TYPE=BMAP_ROUTE_TYPE_RIDING;this._enableDragging=false;hP.sendMessage(a1(4,4,3),["service","ride"])}e9.inherit(dd,cO,"RidingRoute");function Z(e,i){i5.call(this,e,i);i=i||{};this.QUERY_TYPE=ca;this.setPolicy(i.policy);hP.sendMessage(a1(4,4,2),["service","truck"])}e9.inherit(Z,i5,"TruckRoute");Z.prototype.setPolicy=function(e){if(e>=BMAP_DRIVING_POLICY_DEFAULT&&e<=BMAP_DRIVING_POLICY_AVOID_CONGESTION){this._opts.policy=e}else{this._opts.policy=BMAP_DRIVING_POLICY_DEFAULT}};window.BMAP_MODE_DRIVING="driving";window.BMAP_MODE_TRANSIT="transit";window.BMAP_MODE_WALKING="walking";window.BMAP_MODE_NAVIGATION="navigation";var a8={web:"//api.map.baidu.com/direction?",android:"bdapp://map/direction?",ios:"baidumap://map/direction?"};function i2(e){this.opts=e||{}}e9.extend(i2.prototype,{routeCall:function(kz,e,T){var i=this;hl.load("route",function(){i._asyncSearch(kz,e,T)})}});function ej(){return Pano.getStreetViewCoverageLayer(bG)}function e0(){Pano.PanoramaService.call(this)}e9.inherit(e0,Pano.PanoramaService,"PanoramaService");e9.extend(e0.prototype,{getPanoramaById:function(T,i){var e=this;this.getPanoById(T,function(kz){i&&i(e._makeData(kz))})},getPanoramaByLocation:function(e,T){e=jv.convertLL2MC(e);var i=this;this.getPanoByLocation(e,50,function(kz){T&&T(i._makeData(kz))})},_makeData:function(T){if(!T){return null}var i={};var e=T.content[0];i.description=e.Rname||e.Info||"";i.id=e.ID;i.pointX=e.X/100;i.pointY=e.Y/100;i.position=jv.convertMC2LL(new cG(i.pointX,i.pointY));return i}});function fs(){if(window.PANORAMA_URL){return Pano.getPanoControl(bG,{imgPath:E.imgPath,tileBaseUrl:E.panoTilePath,})}return Pano.getPanoControl(bG)}function R(T,e){if(!e){return}this.content=T;if(e.position&&!Array.isArray(e.position)){e.position=jv.convertLL2MC(e.position);this.position=e.position;this.hideDistance=!!e.hideDistance}else{this.hideDistance=true}var i=this._createDom();Pano.PanoOverlay.call(this,e.position,{dom:i,altitude:e.altitude,})}e9.inherit(R,Pano.PanoOverlay,"PanoramaLabel");e9.extend(R.prototype,{init:function(e){var i=this;this._pano=e;this.updatedDistance();Pano.PanoOverlay.prototype.init.call(this,e);this._pano.on("dataload",function(T){i.updatedDistance()})},_createDom:function(){var kz=this.content;var kC=document.createElement("div");var i=kC.style;i.position="absolute";i.backgroundColor="rgba(29, 29, 29, 0.8)";i.padding="7px 0";i.height="19px";i.font="16px arial";i.color="white";i.whiteSpace="nowrap";i.borderRadius="4px";var e=document.createElement("div");e.style["float"]="left";e.style["lineHeight"]="19px";kC.appendChild(e);var T=document.createElement("span");T.style.margin="0 14px";T.innerText=kz;e.appendChild(T);if(!this.hideDistance){var kB=document.createElement("span");kB.style.color="color:rgba(255,255,255,0.3)";kB.innerText="|";e.appendChild(kB);var kA=document.createElement("span");kA.style.margin="0 8px";kA.style.color="#60c7fa";kA.style.fontSize="12px";kA.innerText="0米";e.appendChild(kA);this._distanceDom=kA}this._dom=kC;this._titleDom=T;return kC},updatedDistance:function(){if(this.hideDistance){return}var T=0;if(this._pano){var i=this._pano.position;var e=this.position;if(i&&!i.equals(e)){T=jv.getDistanceByMC(i,e)}}if(T>100){T=T/1000;T=T<100?T.toFixed(2):T.toFixed(0);T+="公里"}else{T=T<100?T.toFixed(2):T.toFixed(0);T+="米"}this._distanceDom.innerText=T},});function f(i,kB){if(typeof i==="string"&&/^(?!#)(\w)*/.test(i)){i="#"+i}var kz={};if(window.PANORAMA_URL){kz.imgPath=E.imgPath;kz.tileBaseUrls=[E.panoTilePath]}var e=Pano.init(i,kz);var T=e.setPosition;e.setPosition=function(kC){var kD=jv.convertLL2MC(kC);T.call(e,kD)};var kA=e.addEventListener;e.addEventListener=function(kC,kD){if(kC==="position_changed"){kA.call(e,kC,function(kE){var kF=jv.convertMC2LL(kE);kD(kF)})}else{kA.call(e,kC,kD)}};if(kB){kB.on("destroy",function(){e.destroy()})}hP.sendMessage(a1(4,3,5),["layer","pano"]);return e}bG.Map=h4;bG.MapType=ev;bG.Point=cG;bG.Pixel=fv;bG.Size=jm;bG.Bounds=ij;bG.PrivateRegionDataModel=cV;bG.TileLayer=hO;bG.Copyright=o;bG.Projection=bG.Project=jv;bG.XYZProjection=bG.XYZProject=dL;bG.Convertor=f7;bG.RenderTypeUtils=df;bG.Overlay=aU;bG.Label=ib;bG.Marker=u;bG.Symbol=ft;bG.SVGSymbol=dU;bG.Icon=jP;bG.Polyline=bu;bG.BezierCurve=cQ;bG.PolylineMultipart=ex;bG.Polygon=i1;bG.MapMask=kl;bG.Prism=bA;bG.Marker3D=eo;bG.GroundOverlay=gd;bG.GroundPoint=dZ;bG.CustomOverlay=bU;bG.CustomHtmlLayer=dH;bG.ParkingSpot=iG;bG.InfoWindow=ef;bG.SimpleInfoWindow=im;bG.Circle=aX;bG.Control=gY;bG.NavigationControl=j3;bG.IndoorManager=dg;bG.NavigationControl3D=fb;bG.CopyrightControl=gm;bG.ScaleControl=ky;bG.CityListControl=bB;bG.MapTypeControl=A;bG.ZoomControl=jy;bG.LocationControl=gE;bG.LogoControl=bJ;bG.DistanceTool=co;bG.ContextMenu=hF;bG.MenuItem=ih;bG.OperationMask=am;bG.Animation=fL;bG.ViewAnimation=s;bG.Transitions=gR;bG.Event=fW;bG.trafficLayer=j0;bG.TrafficLayer=jC;bG.GeoJSONLayer=aQ;bG.XYZLayer=km;bG.PixelLayer=dB;bG.GeoJSONParse=gN;bG.NormalLayer=cv;bG.ThreeLayer=g6;bG.LineLayer=b1;bG.FillLayer=ed;bG.PointShapeLayer=aZ;bG.PointIconLayer=go;bG.Entity=jw;bG.MVTLayer=ek;bG.BaiduLayer=X;bG.Geolocation=c5;bG.Geocoder=bo;bG.Boundary=fx;bG.DistrictLayer=ea;bG.LocalCity=fq;bG.LocalSearch=cJ;bG.Autocomplete=jo;bG.BusLineSearch=eJ;bG.WalkingRoute=fC;bG.RidingRoute=dd;bG.DrivingRoute=cz;bG.DrivingRouteLine=ge;bG.TransitRoute=eY;bG.RouteSearch=i2;bG.TruckRoute=Z;bG.PanoramaCoverageLayer=ej;bG.PanoramaControl=fs;bG.PanoramaService=e0;bG.PanoramaLabel=R;bG.Panorama=f;function hw(e,i){for(var T in i){e[T]=i[T]}}bG.fetchDebug&&bG.fetchDebug.init();bG.verify();bG.apiLoad();bG.frequency();bG.getSeckeyCid();window._layer=1;e9.extend(ea.prototype,{_asyncSearch:function(){for(var T=0,e=this._queryList.length;T<e;T++){var kz=this._queryList[T];this[kz.method].apply(this,kz.arguments)}delete this._queryList},addDistrict:function(){if(this._opts.districts){var e=this._opts.districts;if(typeof e==="string"){this.getDistrictData(e)}else{if(Object.prototype.toString.call(e)==="[object Array]"){var i=this.parseArrayParams(e);this.getDistrictData(i)}}}},parseArrayParams:function(e){var kA="";for(var kz=0;kz<e.length;kz++){if(e[kz] instanceof Array){kA+="(";for(var T=0;T<e.length;T++){kA+=e[T]}kA+=")"}else{kA+="("+e[kz]+")"}}return kA},getDistrictData:function(e){var i=this;ki.request(function(kz){var T=i._parseGeoData(kz);i._drawToMap(i,T)},{qt:j1,adnames:e,level:i._opts.kind})},_drawToMap:function(kI,kE){var kH=kE.boundaries.length;if(kH===0){alert("未能获取当前输入行政区域");return}var kJ=this._config.fillColor;var kB=this._config.fillOpacity;var T=this._config.strokeColor;var e=this._config.strokeOpacity;var kF=this._config.strokeWeight;if(typeof kJ==="string"){var kz=kJ;var kK=[];for(var kD=0;kD<kH;kD++){var kG=new BMapGL.Polygon(kE.boundaries[kD],{strokeWeight:kF,strokeColor:T,strokeOpacity:e,fillColor:kz,fillOpacity:kB});kG.style={strokeWeight:kF,strokecolor:T,strokeOpacity:e,fillColor:kz,fillOpacity:kB};this.disOverlays.push(kG);this.addEventListenerIn();kI._map.addOverlay(kG);kK=kK.concat(kG.getPath())}if(this._config.viewport){kI._map.setViewport(kK)}}else{if(Object.prototype.toString.call(kJ)==="[object Array]"){var kK=[];var kC=kJ.length;if(kC<kH){for(var kD=0,kA=0;kD<kH-kC;kD++){if(kA<kC-1){kJ.push(kJ[kA++])}else{kJ.push(kJ[0])}}}for(var kD=0;kD<kH;kD++){var kz=kJ[kD];var kG=new BMapGL.Polygon(kE.boundaries[kD],{strokeWeight:kF,strokeColor:T,strokeOpacity:e,fillColor:kz,fillOpacity:kB});kG.style={strokeWeight:kF,strokecolor:T,strokeOpacity:e,fillColor:kz,fillOpacity:kB};this.disOverlays.push(kG);this.addEventListenerIn();kI._map.addOverlay(kG);kK=kK.concat(kG.getPath())}if(this._config.viewport){kI._map.setViewport(kK)}}}},_parseGeoData:function(kI){var kL={};kL.boundaries=[];if(kI&&kI.content&&kI.content["geo"]){for(var kQ=0;kQ<kI.content["geo"].length;kQ++){var kz=bP.parseGeo(kI.content["geo"][kQ],false);if(kz.geo&&kz.geo.length&&kz.geo.length>0){var kO=kz.geo.length;for(jK=0;jK<kO;jK++){var T=kz.geo[jK];if(T&&T.length&&T.length>0){var kG=T.length-1;var kN=[];var kF=false;var kM=0;var kK=0;for(var kP=0;kP<kG;kP+=2){var kD=T[kP];var kB=T[kP+1];var kJ=new cG(kD,kB);kJ=jv.convertMC2LL(kJ);if(kP<kG-3){var i=T[kP+2];var e=T[kP+3];var kH=new cG(i,e);kH=jv.convertMC2LL(kH)}kN.push(kJ.lng+", "+kJ.lat)}if(kF===true){if(kM>kK){var kR=kM;kM=kK;kK=kR}var kE=kN;var kC=kN.splice(kM+1);var kA=kC.splice(kK-kM);kE=kE.concat(kA);kL.boundaries.push(kE.join(";"));kL.boundaries.push(kC.join(";"));kF=false;continue}if(kN.length!==0){kL.boundaries.push(kN.join(";"))}}}}}}return kL},deleteDistrict:function(kz){var T=kz.disOverlays;for(var e=0;e<T.length;e++){this._map.removeOverlay(T[e])}},addEventListener:function(e,i){this.eventAndCallback[e]=i},addEventListenerIn:function(){var kz=this;var kB=Object.keys(kz.eventAndCallback);if(kB.length>0){for(var T=0;T<kB.length;T++){var kA=kz.eventAndCallback[kB[T]];for(var e=0;e<kz.disOverlays.length;e++){kz.disOverlays[e].addEventListener(kB[T],kA)}}}},searchBoundary:function(i,kA){i=i||{};var e=i.name||"";var T=i.kind||0;var kz=this;ki.request(function(kC){var kB=kz._parseGeoData(kC);kA&&kA(kB)},{qt:j1,adnames:e,level:T})}});window._layer=2;})(BMapGL,"BMapGL");